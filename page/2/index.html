<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  
  
  <title>chenyulong</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
    <meta name="description" content="Nunu&#39;s blog!">
  
  
    <meta name="keywords" content="Nunu">
  
  
    <link rel="alternate" href="/atom.xml" title="chenyulong">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">
  
  <link rel="stylesheet" href="/css/style.css">
  
    <link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">
  
  
    <link rel="stylesheet" href="/localshare/css/share.css">
  
  
  
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">chenyulong</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">理论是你知道是这样，但它却不好用；实践是它很好用，但你不知道是为什么；程序员将理论和实践结合到一起：既不好用，也不知道是为什么。</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        
          <a class="main-nav-link" href="/."><i class="fa fa-home"></i> Home</a>
        
          <a class="main-nav-link" href="/archives/"><i class="fa fa-archive"></i> Archive</a>
        
          <a class="main-nav-link" href="/about/"><i class="fa fa-user"></i> About</a>
        
          <a class="main-nav-link" href="/atom.xml"><i class="fa fa-rss"></i> RSS</a>
        
      </nav>
    </div>
    <div id="search-form">
      <div id="result-mask" class="hide"></div>
      <label><input id="search-key" type="text" autocomplete="off" placeholder="search"></label>
      <div id="result-wrap" class="hide">
        <div id="search-result"></div>
      </div>
      <div class="hide">
        <template id="search-tpl">
          <div class="item">
            <a href="/{path}" title="{title}">
              <div class="title">{title}</div>
              <div class="time">{date}</div>
              <div class="tags">{tags}</div>
            </a>
          </div>
        </template>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  <article id="post-Gradle打包流程" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/07/07/Gradle打包流程/">Gradle打包流程-Gradle Wrapper</a>
    </h1>
  


      </header>
    
    <div class="article-meta">
      
      <span class="article-date">
  <i class="fa fa-date"></i>
  <time class="dt-published" datetime="2021-07-07T07:24:52.000Z" itemprop="datePublished">2021年07月07日</time>
</span>
      
  <div class="article-category">
    <i class="fa fa-classify"></i>
    <a class="article-category-link" href="/categories/Gradle/">Gradle</a>
  </div>

      
      
<a href="/2021/07/07/Gradle打包流程/#comments" class="article-comment-link">
  
  <i class="fa fa-commt"></i>
  Guestbook
</a>


    </div>
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="主要概念"><a href="#主要概念" class="headerlink" title="主要概念"></a>主要概念</h2><h3 id="Gradle是什么？"><a href="#Gradle是什么？" class="headerlink" title="Gradle是什么？"></a>Gradle是什么？</h3><p>Gradle其实就是个构建系统,一个构建项目的工具，即把一堆堆的目录、文件按照一定的规则关联起来，形成一个项目的自动化构建工具,能够简化你的编译、打包、测试过程。Gradle版本,如下gradle-6.1.1-all.zip。</p>
<p>位置:项目主目录 gradle 文件夹-&gt;wrapper-&gt;gradle-wrapper.properties</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">distributionBase=GRADLE_USER_HOME // ~/.gradle</span><br><span class="line">distributionPath=wrapper/dists</span><br><span class="line">zipStoreBase=GRADLE_USER_HOME</span><br><span class="line">zipStorePath=wrapper/dists  // 下载到本地的~/.gradle/wrapper/dists目录</span><br><span class="line">distributionUrl=https\://services.gradle.org/distributions/gradle-6.1.1-all.zip //要下载的gradle的地址</span><br></pre></td></tr></table></figure>

<ul>
<li><p>gradle-xx-all.zip是完整版，包含了各种二进制文件，源代码文件，和离线的文档。例如，<a href="https://services.gradle.org/distributions/gradle-6.1.1-all.zip" target="_blank" rel="noopener">https://services.gradle.org/distributions/gradle-6.1.1-all.zip</a></p>
</li>
<li><p>gradle-xx-bin.zip是二进制版，只包含了二进制文件（可执行文件），没有文档和源代码。例如，<a href="https://services.gradle.org/distributions/gradle-6.1.1-bin.zip" target="_blank" rel="noopener">https://services.gradle.org/distributions/gradle-6.1.1-bin.zip</a></p>
</li>
<li><p>gradle-xx-src.zip是源码版，只包含了Gradle源代码，不能用来编译你的工程。例如，<a href="https://services.gradle.org/distributions/gradle-6.1.1-src.zip" target="_blank" rel="noopener">https://services.gradle.org/distributions/gradle-6.1.1-src.zip</a></p>
</li>
</ul>
<h3 id="Gradle-Wrapper是什么？"><a href="#Gradle-Wrapper是什么？" class="headerlink" title="Gradle Wrapper是什么？"></a>Gradle Wrapper是什么？</h3><p>Gradle Wrapper的作用是简化Gradle本身的安装、部署。不同版本的项目可能需要不同版本的Gradle，手工部署的话比较麻烦，而且可能产生冲突，所以需要Gradle Wrapper帮你搞定这些事情。Gradle Wrapper是Gradle项目的一部分.gradle-wrapper.jar/gradle-wrapper.properties，gradle-wrapper.jar是Gradle Wrapper的主体功能包。在Android Studio安装过程中产生gradle-wrapper.jar.然后每次新建项目，会将gradle-wrapper.jar拷贝到你的项目的gradle/wrapper目录中。</p>
<h3 id="Gradle插件又是什么？"><a href="#Gradle插件又是什么？" class="headerlink" title="Gradle插件又是什么？"></a>Gradle插件又是什么？</h3><p>Gradle插件是针对Gradle发行版和Android SDK Build Tools封装的一个工具，是一堆适合Android开发的Gradle插件的集合,主要有两大功能：</p>
<blockquote>
<p>调用Gradle本身的代码和批处理工具来构建项目</p>
<p>调用Android SDK的编译、打包功能</p>
</blockquote>
<p><strong>Gradle插件版本</strong>:项目主目录下的 build.gradle 中，如“com.android.tools.build:gradle:4.0.2”:它会下载到~.gradle\caches\modules-2\files-2.1\com.android.tools.build目录中。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    classpath &apos;com.android.tools.build:gradle:4.0.2&apos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Android SDK Build Tools Version</strong>：Android SDK 构建工具版本;<br>buildToolsVersion 位置:app 目录-&gt;buid.gradle 文件:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">    compileSdkVersion 28</span><br><span class="line">    defaultConfig &#123;</span><br><span class="line">        applicationId &quot;com.myapplication&quot;</span><br><span class="line">        minSdkVersion 23</span><br><span class="line">        targetSdkVersion 28</span><br><span class="line">        versionCode 1</span><br><span class="line">        versionName &quot;1.0&quot;</span><br><span class="line">        testInstrumentationRunner &quot;android.support.test.runner.AndroidJUnitRunner&quot;</span><br><span class="line">    &#125;</span><br><span class="line">    buildTypes &#123;</span><br><span class="line">        release &#123;</span><br><span class="line">            minifyEnabled false</span><br><span class="line">            proguardFiles getDefaultProguardFile(&apos;proguard-android-optimize.txt&apos;), &apos;proguard-rules.pro&apos;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    compileOptions &#123;</span><br><span class="line">        sourceCompatibility JavaVersion.VERSION_1_8</span><br><span class="line">        targetCompatibility JavaVersion.VERSION_1_8</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="依赖关系"><a href="#依赖关系" class="headerlink" title="依赖关系"></a>依赖关系</h3><p>明确概念:</p>
<ul>
<li><p>Gradle Plugin Version: Gradle 插件版本</p>
</li>
<li><p>Gradle Version: Gradle发行版本</p>
</li>
<li><p>Android SDK Build Tools Version：Android SDK 构建工具版本<br>Gradle Plugin 有不同的版本号。 即我们常见的：classpath ‘com.android.tools.build:gradle:4.0.2’】，<br>每个插件版本号又对应一个或一些 Gradle 发行版本【即我们常见的：gradle-6.1.1-all.zip】<br>如果这两个版本对应不上了，那么构建项目的时候就会报错。<br><a href="https://developer.android.google.cn/studio/releases/gradle-plugin" target="_blank" rel="noopener">Android Gradle 插件版本说明</a></p>
</li>
</ul>
<p>Gradle Plugin 还和 Android SDK BuildTool 有关联,因为它还负责和编译相关的功能，这也是为何我们要在 build.gradle 里注明 buildToolsVersion 的原因。</p>
<h2 id="断点调试"><a href="#断点调试" class="headerlink" title="断点调试"></a>断点调试</h2><p><img src="http://nunu03.github.io/2021/07/07/Gradle%E6%89%93%E5%8C%85%E6%B5%81%E7%A8%8B/debug.jpg" alt="debug调试"></p>
<h2 id="执行流程"><a href="#执行流程" class="headerlink" title="执行流程"></a>执行流程</h2><p>先看一下<a href="https://juejin.cn/post/6844904142725447687#heading-29" target="_blank" rel="noopener">来自掘金社区</a>Gradle构建的核心流程图<br><img src="http://nunu03.github.io/2021/07/07/Gradle%E6%89%93%E5%8C%85%E6%B5%81%E7%A8%8B/%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B%E5%9B%BE.image" alt="核心流程图"><br>时序图：<br><img src="http://nunu03.github.io/2021/07/07/Gradle%E6%89%93%E5%8C%85%E6%B5%81%E7%A8%8B/pretask.png" alt="时序图"><br>1.当我们执行一个 gralde 命令时，便会调用 gradle/wrapper/gradle-wrapper.jar 里面 org.gradle.wrapper.GradleWrapperMain 类的 main 方法，它就是 gradle 的一个入口方法。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public static void main(String[] args) throws Exception &#123;</span><br><span class="line">        ......</span><br><span class="line">        WrapperExecutor wrapperExecutor = WrapperExecutor.forWrapperPropertiesFile(propertiesFile);</span><br><span class="line">        wrapperExecutor.execute(</span><br><span class="line">                args,</span><br><span class="line">                new Install(logger, new Download(logger, &quot;gradlew&quot;, UNKNOWN_VERSION), new PathAssembler(gradleUserHome)),</span><br><span class="line">                new BootstrapMainStarter());</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>2.WrapperExecutor 的 execute 方法:createDist,会根据config的配置去校验版本和下载gradle wrapper需要的依赖与源码；start方法开始执行gradle的构建流程。Gradle对应版本下载完成之后，Gradle Wrapper的使命基本完成了.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public void execute(String[] args, Install install, BootstrapMainStarter bootstrapMainStarter) throws Exception &#123;</span><br><span class="line">        File gradleHome = install.createDist(config);</span><br><span class="line">        bootstrapMainStarter.start(args, gradleHome);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>3.<br>BootstrapMainStarter的start做了什么：就是调用GradleMain里的main方法。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">public void start(String[] args, File gradleHome) throws Exception &#123;</span><br><span class="line">        ......</span><br><span class="line">        Class&lt;?&gt; mainClass = contextClassLoader.loadClass(&quot;org.gradle.launcher.GradleMain&quot;);</span><br><span class="line">        Method mainMethod = mainClass.getMethod(&quot;main&quot;, String[].class);</span><br><span class="line">        mainMethod.invoke(null, new Object[]&#123;args&#125;);</span><br><span class="line">        if (contextClassLoader instanceof Closeable) &#123;</span><br><span class="line">            ((Closeable) contextClassLoader).close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>4.GradleMain不解释。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public static void main(String[] args) &#123;</span><br><span class="line">        new ProcessBootstrap().run(&quot;org.gradle.launcher.Main&quot;, args);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>5.Main</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">public static void main(String[] args) &#123;</span><br><span class="line">       new Main().run(args);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   @Override</span><br><span class="line">   protected void doAction(String[] args, ExecutionListener listener) &#123;</span><br><span class="line">       createActionFactory().convert(Arrays.asList(args)).execute(listener);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   CommandLineActionFactory createActionFactory() &#123;</span><br><span class="line">       return new DefaultCommandLineActionFactory();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>6.DefaultCommandLineActionFactory</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">public CommandLineExecution convert(List&lt;String&gt; args) &#123;</span><br><span class="line">        ......</span><br><span class="line">        return new WithLogging(loggingServices,</span><br><span class="line">            args,</span><br><span class="line">            loggingConfiguration,</span><br><span class="line">            new ParseAndBuildAction(loggingServices, args),</span><br><span class="line">            new BuildExceptionReporter(loggingServices.get(StyledTextOutputFactory.class), loggingConfiguration, clientMetaData()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void execute(ExecutionListener executionListener) &#123;</span><br><span class="line">            ......</span><br><span class="line">            Action&lt;? super ExecutionListener&gt; action;</span><br><span class="line">            try &#123;</span><br><span class="line">                ParsedCommandLine commandLine = parser.parse(args);</span><br><span class="line">                action = createAction(actions, parser, commandLine);</span><br><span class="line">            &#125; catch (CommandLineArgumentException e) &#123;</span><br><span class="line">                action = new CommandLineParseFailureAction(parser, e);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            action.execute(executionListener);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<p><img src="http://nunu03.github.io/2021/07/07/Gradle%E6%89%93%E5%8C%85%E6%B5%81%E7%A8%8B/pretask2.jpg" alt="时序图"><br>1.BuildActionsFactory</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">private Runnable runBuildInProcess(StartParameterInternal startParameter, DaemonParameters daemonParameters) &#123;</span><br><span class="line">    ServiceRegistry globalServices = ServiceRegistryBuilder.builder()</span><br><span class="line">            .displayName(&quot;Global services&quot;)</span><br><span class="line">            .parent(loggingServices)</span><br><span class="line">            .parent(NativeServices.getInstance())</span><br><span class="line">            .provider(new GlobalScopeServices(startParameter.isContinuous()))</span><br><span class="line">            .build();</span><br><span class="line"></span><br><span class="line">    // Force the user home services to be stopped first, the dependencies between the user home services and the global services are not preserved currently</span><br><span class="line">    return runBuildAndCloseServices(startParameter, daemonParameters, globalServices.get(BuildExecuter.class), globalServices, globalServices.get(GradleUserHomeScopeServiceRegistry.class));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public ServiceRegistry build() &#123;</span><br><span class="line">    DefaultServiceRegistry registry = new DefaultServiceRegistry(displayName, parents.toArray(new ServiceRegistry[0]));</span><br><span class="line">    for (Object provider : providers) &#123;</span><br><span class="line">        registry.addProvider(provider);</span><br><span class="line">    &#125;</span><br><span class="line">    return registry;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">private Runnable runBuildAndCloseServices(StartParameterInternal startParameter, DaemonParameters daemonParameters, BuildActionExecuter&lt;BuildActionParameters&gt; executer, ServiceRegistry sharedServices, Object... stopBeforeSharedServices) &#123;</span><br><span class="line">        BuildActionParameters parameters = createBuildActionParameters(startParameter, daemonParameters);</span><br><span class="line">        Stoppable stoppable = new CompositeStoppable().add(stopBeforeSharedServices).add(sharedServices);</span><br><span class="line">        return new RunBuildAction(executer, startParameter, clientMetaData(), getBuildStartTime(), parameters, sharedServices, stoppable);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>2.DefaultServiceRegistry</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">private void findProviderMethods(Object target) &#123;</span><br><span class="line">    Class&lt;?&gt; type = target.getClass();</span><br><span class="line">    RelevantMethods methods = RelevantMethods.getMethods(type);</span><br><span class="line">    for (ServiceMethod method : methods.decorators) &#123;</span><br><span class="line">        if (parentServices == null) &#123;</span><br><span class="line">            throw new ServiceLookupException(String.format(&quot;Cannot use decorator method %s.%s() when no parent registry is provided.&quot;, type.getSimpleName(), method.getName()));</span><br><span class="line">        &#125;</span><br><span class="line">        ownServices.add(new FactoryMethodService(this, target, method));</span><br><span class="line">    &#125;</span><br><span class="line">    for (ServiceMethod method : methods.factories) &#123;</span><br><span class="line">        ownServices.add(new FactoryMethodService(this, target, method));</span><br><span class="line">    &#125;</span><br><span class="line">    for (ServiceMethod method : methods.configurers) &#123;</span><br><span class="line">        applyConfigureMethod(method, target);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">private void applyConfigureMethod(ServiceMethod method, Object target) &#123;</span><br><span class="line">    Object[] params = new Object[method.getParameterTypes().length];</span><br><span class="line">    for (int i = 0; i &lt; method.getParameterTypes().length; i++) &#123;</span><br><span class="line">        Type paramType = method.getParameterTypes()[i];</span><br><span class="line">        if (paramType.equals(ServiceRegistration.class)) &#123;</span><br><span class="line">            params[i] = newRegistration();</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            Service paramProvider = find(paramType, allServices);</span><br><span class="line">            if (paramProvider == null) &#123;</span><br><span class="line">                throw new ServiceLookupException(String.format(&quot;Cannot configure services using %s.%s() as required service of type %s is not available.&quot;,</span><br><span class="line">                    method.getOwner().getSimpleName(),</span><br><span class="line">                    method.getName(),</span><br><span class="line">                    format(paramType)));</span><br><span class="line">            &#125;</span><br><span class="line">            params[i] = paramProvider.get();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    try &#123;</span><br><span class="line">        method.invoke(target, params);</span><br><span class="line">    &#125; catch (Exception e) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3.GlobalScopeServices</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">void configure(ServiceRegistration registration, ClassLoaderRegistry classLoaderRegistry) &#123;</span><br><span class="line">    registration.add(ClassLoaderScopeListeners.class);</span><br><span class="line">    final List&lt;PluginServiceRegistry&gt; pluginServiceFactories = new DefaultServiceLocator(classLoaderRegistry.getRuntimeClassLoader(), classLoaderRegistry.getPluginsClassLoader()).getAll(PluginServiceRegistry.class);</span><br><span class="line">    for (PluginServiceRegistry pluginServiceRegistry : pluginServiceFactories) &#123;</span><br><span class="line">        registration.add(PluginServiceRegistry.class, pluginServiceRegistry);</span><br><span class="line">        pluginServiceRegistry.registerGlobalServices(registration);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4.LauncherServices</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public void registerGlobalServices(ServiceRegistration registration) &#123;</span><br><span class="line">    registration.addProvider(new ToolingGlobalScopeServices());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>5.InProcessBuildActionExecuter</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">public BuildActionResult execute(final BuildAction action, final BuildRequestContext buildRequestContext, BuildActionParameters actionParameters, ServiceRegistry contextServices) &#123;</span><br><span class="line">       BuildStateRegistry buildRegistry = contextServices.get(BuildStateRegistry.class);</span><br><span class="line">       final PayloadSerializer payloadSerializer = contextServices.get(PayloadSerializer.class);</span><br><span class="line">       BuildOperationNotificationValve buildOperationNotificationValve = contextServices.get(BuildOperationNotificationValve.class);</span><br><span class="line"></span><br><span class="line">       buildOperationNotificationValve.start();</span><br><span class="line">       try &#123;</span><br><span class="line">           RootBuildState rootBuild = buildRegistry.createRootBuild(BuildDefinition.fromStartParameter(action.getStartParameter(), null));</span><br><span class="line">           return rootBuild.run(new Transformer&lt;BuildActionResult, BuildController&gt;() &#123;</span><br><span class="line">               @Override</span><br><span class="line">               public BuildActionResult transform(BuildController buildController) &#123;</span><br><span class="line">                   BuildActionRunner.Result result = buildActionRunner.run(action, buildController);</span><br><span class="line">                   if (result.getBuildFailure() == null) &#123;</span><br><span class="line">                       return BuildActionResult.of(payloadSerializer.serialize(result.getClientResult()));</span><br><span class="line">                   &#125;</span><br><span class="line">                   if (buildRequestContext.getCancellationToken().isCancellationRequested()) &#123;</span><br><span class="line">                       return BuildActionResult.cancelled(payloadSerializer.serialize(result.getBuildFailure()));</span><br><span class="line">                   &#125;</span><br><span class="line">                   return BuildActionResult.failed(payloadSerializer.serialize(result.getClientFailure()));</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;);</span><br><span class="line">       &#125; finally &#123;</span><br><span class="line">           buildOperationNotificationValve.stop();</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p><img src="http://nunu03.github.io/2021/07/07/Gradle%E6%89%93%E5%8C%85%E6%B5%81%E7%A8%8B/pretask3.png" alt="时序图"><br>1.InProcessBuildActionExecuter</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">try &#123;</span><br><span class="line">    RootBuildState rootBuild = buildRegistry.createRootBuild(BuildDefinition.fromStartParameter(action.getStartParameter(), null));</span><br><span class="line">    return rootBuild.run(new Transformer&lt;BuildActionResult, BuildController&gt;() &#123;</span><br><span class="line">        @Override</span><br><span class="line">        public BuildActionResult transform(BuildController buildController) &#123;</span><br><span class="line">            BuildActionRunner.Result result = buildActionRunner.run(action, buildController);</span><br><span class="line">            ......</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125; finally &#123;</span><br><span class="line">    buildOperationNotificationValve.stop();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2.DefaultRootBuildState</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public &lt;T&gt; T run(Transformer&lt;T, ? super BuildController&gt; buildAction) &#123;</span><br><span class="line">    final GradleBuildController buildController = new GradleBuildController(gradleLauncher);</span><br><span class="line">    RootBuildLifecycleListener buildLifecycleListener = listenerManager.getBroadcaster(RootBuildLifecycleListener.class);</span><br><span class="line">    GradleInternal gradle = buildController.getGradle();</span><br><span class="line">    buildLifecycleListener.afterStart(gradle);</span><br><span class="line">    try &#123;</span><br><span class="line">        return buildAction.transform(buildController);</span><br><span class="line">    &#125; finally &#123;</span><br><span class="line">        buildLifecycleListener.beforeComplete(gradle);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3.GradleBuildController</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public GradleInternal run() &#123;</span><br><span class="line">    return doBuild(GradleInternal.BuildType.TASKS, new Action&lt;GradleLauncher&gt;() &#123;</span><br><span class="line">        @Override</span><br><span class="line">        public void execute(@Nonnull GradleLauncher gradleLauncher) &#123;</span><br><span class="line">            gradleLauncher.executeTasks();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4.DefaultGradleLauncher</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">private void doClassicBuildStages(Stage upTo) &#123;</span><br><span class="line">    if (stage == null) &#123;</span><br><span class="line">        instantExecution.prepareForBuildLogicExecution();</span><br><span class="line">    &#125;</span><br><span class="line">    prepareSettings();</span><br><span class="line">    if (upTo == Stage.LoadSettings) &#123;</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    prepareProjects();</span><br><span class="line">    if (upTo == Stage.Configure) &#123;</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    prepareTaskExecution();</span><br><span class="line">    if (upTo == Stage.TaskGraph) &#123;</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    instantExecution.saveScheduledWork();</span><br><span class="line">    runWork();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Task源码对应"><a href="#Task源码对应" class="headerlink" title="Task源码对应"></a>Task源码对应</h2><table>
<thead>
<tr>
<th>Task Name</th>
<th>Class Name</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>preBuild</td>
<td></td>
<td>空 task，只做锚点使用</td>
</tr>
<tr>
<td>preDebugBuild</td>
<td></td>
<td>空 task，只做锚点使用，与 preBuild 区别是这个 task 是 variant 的锚点</td>
</tr>
<tr>
<td>compileDebugAidl</td>
<td>AidlCompile</td>
<td>处理 aidl</td>
</tr>
<tr>
<td>compileDebugRenderscript</td>
<td>RenderscriptCompile</td>
<td>处理 renderscript</td>
</tr>
<tr>
<td>checkDebugManifest</td>
<td>CheckManifest</td>
<td>检测 manifest 是否存在</td>
</tr>
<tr>
<td>generateDebugBuildConfig</td>
<td>GenerateBuildConfig</td>
<td>生成 BuildConfig.java</td>
</tr>
<tr>
<td>prepareLintJar</td>
<td>PrepareLintJar</td>
<td>拷贝 lint jar 包到指定位置</td>
</tr>
<tr>
<td>generateDebugResValues</td>
<td>GenerateResValues</td>
<td>生成 resvalues，generated.xml</td>
</tr>
<tr>
<td>generateDebugResources</td>
<td></td>
<td>空 task，锚点</td>
</tr>
<tr>
<td>mergeDebugResources</td>
<td>MergeResources</td>
<td>合并资源文件</td>
</tr>
<tr>
<td>createDebugCompatibleScreenManifests</td>
<td>CompatibleScreensManifest</td>
<td>manifest 文件中生成 compatible-screens，指定屏幕适配</td>
</tr>
<tr>
<td>processDebugManifest</td>
<td>MergeManifests</td>
<td>合并 manifest 文件</td>
</tr>
<tr>
<td>splitsDiscoveryTaskDebug</td>
<td>SplitsDiscovery</td>
<td>生成 split-list.json，用于 apk 分包</td>
</tr>
<tr>
<td>processDebugResources</td>
<td>ProcessAndroidResources</td>
<td>aapt 打包资源</td>
</tr>
<tr>
<td>generateDebugSources</td>
<td></td>
<td>空 task，锚点</td>
</tr>
<tr>
<td>javaPreCompileDebug</td>
<td>JavaPreCompileTask</td>
<td>生成 annotationProcessors.json 文件</td>
</tr>
<tr>
<td>compileDebugJavaWithJavac</td>
<td>AndroidJavaCompile</td>
<td>编译 java 文件</td>
</tr>
<tr>
<td>compileDebugNdk</td>
<td>NdkCompile</td>
<td>编译 ndk</td>
</tr>
<tr>
<td>compileDebugSources</td>
<td></td>
<td>空 task，锚点使用</td>
</tr>
<tr>
<td>mergeDebugShaders</td>
<td>MergeSourceSetFolders</td>
<td>合并 shader 文件</td>
</tr>
<tr>
<td>compileDebugShaders</td>
<td>ShaderCompile</td>
<td>编译 shaders</td>
</tr>
<tr>
<td>generateDebugAssets</td>
<td></td>
<td>空 task，锚点</td>
</tr>
<tr>
<td>mergeDebugAssets</td>
<td>MergeSourceSetFolders</td>
<td>合并 assets 文件</td>
</tr>
<tr>
<td>transformClassesWithDexBuilderForDebug</td>
<td>DexArchiveBuilderTransform</td>
<td>class 打包 dex</td>
</tr>
<tr>
<td>transformDexArchiveWithExternalLibsDexMergerForDebug</td>
<td>ExternalLibsMergerTransform</td>
<td>打包三方库的 dex，在 dex 增量的时候就不需要再 merge 了，节省时间</td>
</tr>
<tr>
<td>transformDexArchiveWithDexMergerForDebug</td>
<td>DexMergerTransform</td>
<td>打包最终的 dex</td>
</tr>
<tr>
<td>mergeDebugJniLibFolders</td>
<td>MergeSouceSetFolders</td>
<td>合并 jni lib 文件</td>
</tr>
<tr>
<td>transformNativeLibsWithMergeJniLibsForDebug</td>
<td>MergeJavaResourcesTransform</td>
<td>合并 jnilibs</td>
</tr>
<tr>
<td>transformNativeLibsWithStripDebugSymbolForDebug</td>
<td>StripDebugSymbolTransform</td>
<td>去掉 native lib 里的 debug 符号</td>
</tr>
<tr>
<td>processDebugJavaRes</td>
<td>ProcessJavaResConfigAction</td>
<td>处理 java res</td>
</tr>
<tr>
<td>transformResourcesWithMergeJavaResForDebug</td>
<td>MergeJavaResourcesTransform</td>
<td>合并 java res</td>
</tr>
<tr>
<td>validateSigningDebug</td>
<td>ValidateSigningTask</td>
<td>验证签名</td>
</tr>
<tr>
<td>packageDebug</td>
<td>PackageApplication</td>
<td>打包 apk</td>
</tr>
<tr>
<td>assembleDebug</td>
<td></td>
<td>空 task，锚点</td>
</tr>
</tbody></table>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://www.cnblogs.com/jiangxinnju/p/8229129.html" target="_blank" rel="noopener">Gradle、Gradle Wrapper与Android Plugin for Gradle的区别和联系</a><br><a href="https://www.cnblogs.com/mingfeng002/p/11751309.html" target="_blank" rel="noopener">Gradle之Android Gradle Plugin 主要 Task 分析</a></p>

        
        
          <blockquote id="copyright">
              <p>Original link: <a href="http://nunu03.github.io/page/2/index.html">http://nunu03.github.io/page/2/index.html</a></p>
              <p>Copyright Notice: 转载请注明出处.</p>
          </blockquote>
        
      
    </div>
    <footer class="article-footer">
      
        <div class="article-tag-wrap">
          

          
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Gradle/">Gradle</a></li></ul>

          
    <div class="social-share">
      <span>Share:</span>
    </div>



        </div>
      
      
      
    </footer>
  </div>
</article>


  <article id="post-人脸检测之Haar特征介绍" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/04/27/人脸检测之Haar特征介绍/">人脸检测之Haar特征介绍</a>
    </h1>
  


      </header>
    
    <div class="article-meta">
      
      <span class="article-date">
  <i class="fa fa-date"></i>
  <time class="dt-published" datetime="2021-04-27T03:35:32.000Z" itemprop="datePublished">2021年04月27日</time>
</span>
      
  <div class="article-category">
    <i class="fa fa-classify"></i>
    <a class="article-category-link" href="/categories/人脸检测/">人脸检测</a> > <a class="article-category-link" href="/categories/人脸检测/Haar/">Haar</a>
  </div>

      
      
<a href="/2021/04/27/人脸检测之Haar特征介绍/#comments" class="article-comment-link">
  
  <i class="fa fa-commt"></i>
  Guestbook
</a>


    </div>
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="Haar特征"><a href="#Haar特征" class="headerlink" title="Haar特征"></a>Haar特征</h2><p>图像特征提取的三种方式：HOG特征，LBP特征，Haar特征。Haar特征：也叫Haar-like特征、哈尔特征，是图像特征提取的一种方法。<br>Haar特征分为三类：边缘特征、线性特征、特定方向特征（中心特征和对角线特征），组合成特征模板。<font color="#FF0000">特征模板内有白色和黑色两种矩形，并定义该模板的特征值为白色矩形像素和减去黑色矩形像素和。</font>Haar特征值反映了图像的灰度变化情况。例如：脸部的一些特征能由矩形特征简单的描述，如：眼睛要比脸颊颜色要深，鼻梁两侧比鼻梁颜色要深，嘴巴比周围颜色要深等。但矩形特征只对一些简单的图形结构，如边缘、线段较敏感，所以只能描述特定走向（水平、垂直、对角）的结构。</p>
<p><img src="http://nunu03.github.io/2021/04/27/%E4%BA%BA%E8%84%B8%E6%A3%80%E6%B5%8B%E4%B9%8BHaar%E7%89%B9%E5%BE%81%E4%BB%8B%E7%BB%8D/haar-model.drawio.png" alt="Haar特征"></p>
<p>常用的矩形特征有三种：两矩形特征、三矩形特征、四矩形特征：如边缘特征是两矩形特征，线性特征是三矩形特征，特定方向特征是四矩形特征。如果特征模版的黑白矩形按宽高比来分段的话，那具体的比例如下表：<br><img src="http://nunu03.github.io/2021/04/27/%E4%BA%BA%E8%84%B8%E6%A3%80%E6%B5%8B%E4%B9%8BHaar%E7%89%B9%E5%BE%81%E4%BB%8B%E7%BB%8D/haar-scalemodel.drawio.png" alt="s,t比例"></p>
<h2 id="Haar特征个数计算"><a href="#Haar特征个数计算" class="headerlink" title="Haar特征个数计算"></a>Haar特征个数计算</h2><p>通过改变特征模板的大小和位置，可在图像子窗口中穷举出大量的特征。上图的特征模板称为“特征原型”；<font color="#FF0000">特征原型在图像子窗口中扩展（平移伸缩）得到的特征称为“矩形特征”；矩形特征的值称为“特征值”。</font><br>对于 m×m 子窗口，我们只需要确定了矩形左上顶点A(x1,y1)和右下顶点B(x2,y2) ，即可以确定一个矩形；如果这个矩形还必须满足下面两个条件（称为(s, t)条件，满足(s, t)条件的矩形称为条件矩形）：</p>
<p>1) x 方向边长必须能被自然数s 整除（能均等分成s 段）；<br>2) y 方向边长必须能被自然数t 整除（能均等分成t 段）；<br>则 ， <font color="#FF0000">这个矩形的最小尺寸为s×t 或t×s，</font> 最大尺寸为[m/s]·s×[m/t]·t 或[m/t]·t×[m/s]·s；其中[ ]为取整运算符。</p>
<p><img src="http://nunu03.github.io/2021/04/27/%E4%BA%BA%E8%84%B8%E6%A3%80%E6%B5%8B%E4%B9%8BHaar%E7%89%B9%E5%BE%81%E4%BB%8B%E7%BB%8D/haar-image.drawio.png" alt="特征计算-公式"><br>这种计算方式可能不太直观，那用下面的列表方式看一下就很清楚了，我们知道特征原型在图像窗口中根据平移伸缩得到矩形特征。<br><img src="http://nunu03.github.io/2021/04/27/%E4%BA%BA%E8%84%B8%E6%A3%80%E6%B5%8B%E4%B9%8BHaar%E7%89%B9%E5%BE%81%E4%BB%8B%E7%BB%8D/haar-transm.drawio.png" alt="特征计算-平移缩放"><br>综上，可以计算出24x24的特征总数为 43200+27600+43200+27600+20736=162336。所以五种可能的类型就产生了16万以上的特征数量，同时也就是16万以上的特征值，这个是一个非常大数字了。上图通过代码进行计算就是如下：</p>
<p>计算某一种特征的特征数量；</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">totalCount(24,24,2,2);</span><br></pre></td></tr></table></figure>

<p>特征数量的计算函数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> private int totalCount(int width,int height,int scaleWidth,int scaleHeight)&#123;</span><br><span class="line">    int total =0;</span><br><span class="line">    for(int i : new Range(scaleWidth, width+1, scaleWidth))&#123;</span><br><span class="line">        for(int j : new Range(scaleHeight, height+1, scaleHeight))&#123;</span><br><span class="line">            total += (width -i +1) * (height - j+1);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    Log.e(&quot;---count&quot;,total+&quot;&quot;);</span><br><span class="line">    return total;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实现类似python的range函数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">public class Range implements Iterable&lt;Integer&gt; &#123;</span><br><span class="line">    private final int start;</span><br><span class="line">    private final int end;</span><br><span class="line">    private final int step;</span><br><span class="line"></span><br><span class="line">    public Range(int end) &#123;</span><br><span class="line">        this(0, end, 1);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Range(int start, int end) &#123;</span><br><span class="line">        this(start, end, 1);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Range(int start, int end, int step) &#123;</span><br><span class="line">        this.start = start;</span><br><span class="line">        this.end = end;</span><br><span class="line">        this.step = step;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public Iterator&lt;Integer&gt; iterator() &#123;</span><br><span class="line">        return new Itr();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private class Itr implements Iterator&lt;Integer&gt; &#123;</span><br><span class="line">        int current = start;</span><br><span class="line">        @Override</span><br><span class="line">        public boolean hasNext() &#123;</span><br><span class="line">            return step &gt; 0 ? current &lt; end : current &gt; end;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public Integer next() &#123;</span><br><span class="line">            int t = current;</span><br><span class="line">            current += step;</span><br><span class="line">            return t;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public void remove() &#123;</span><br><span class="line">            Iterator.super.remove();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        @RequiresApi(api = Build.VERSION_CODES.N)</span><br><span class="line">        @Override</span><br><span class="line">        public void forEachRemaining(@NonNull Consumer&lt;? super Integer&gt; action) &#123;</span><br><span class="line">            Iterator.super.forEachRemaining(action);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h2 id="积分图"><a href="#积分图" class="headerlink" title="积分图"></a>积分图</h2><p>积分图就是只遍历一次图像就可以求出图像中所有区域像素和的快速算法，大大的提高了图像特征值计算的效率。<br>积分图主要的思想是将图像从起点开始到各个点所形成的矩形区域像素之和作为一个数组的元素保存在内存中，当要计算某个区域的像素和时可以直接索引数组的元素，不用重新计算这个区域的像素和，从而加快了计算（这有个相应的称呼，叫做动态规划算法）。积分图能够在多种尺度下，使用相同的时间（常数时间）来计算不同的特征，因此大大提高了检测速度。</p>
<p>积分图是一种能够描述全局信息的矩阵表示方法。积分图的构造方式是位置（𝑖,𝑗）处的值𝑖𝑖(𝑖,𝑗)是原图像(𝑖,𝑗)左上角方向所有像素𝑓(𝑘,𝑙)的和：<br>𝑖𝑖(𝑖,𝑗)=∑𝑘≤𝑖,𝑙≤𝑗𝑓(𝑘,𝑙)</p>
<p>积分图构建算法：</p>
<p>1、用𝑠(𝑖,𝑗)表示行方向的累加和，初始化𝑠(𝑖,−1)=0；</p>
<p>2、使用𝑖𝑖(𝑖,𝑗)表示一个积分图像，初始化𝑖𝑖(−1,𝑖)=0；</p>
<p>3、逐行扫描图像，递归计算每个像素(𝑖,𝑗)行方向的累加和𝑠(𝑖,𝑗)和积分图像𝑖𝑖(𝑖,𝑗)的值：</p>
<p>𝑠(𝑖,𝑗)=𝑠(𝑖,𝑗−1)+𝑓(𝑖,𝑗)</p>
<p>𝑖𝑖(𝑖,𝑗)=𝑖𝑖(𝑖−1,𝑗)+𝑠(𝑖,𝑗)</p>
<p>4、扫描图像一遍，当到达图像右下角像素时，积分图像𝑖𝑖就构建好了。</p>
<p>积分图构造好之后，图像中任何矩阵区域像素累加和都可以通过简单运算得到如图所示：<br><img src="http://nunu03.github.io/2021/04/27/%E4%BA%BA%E8%84%B8%E6%A3%80%E6%B5%8B%E4%B9%8BHaar%E7%89%B9%E5%BE%81%E4%BB%8B%E7%BB%8D/haar-jifen.drawio.png" alt="积分图"></p>
<p>在图M中，设D的四个顶点分别为a,b,c,d,则D的像素可以表示为：<br>𝐷𝑠𝑢𝑚=𝑖𝑖(a)+𝑖𝑖(d)−(𝑖𝑖(b)+𝑖𝑖(c))<br>看起来还是很抽象：那我们看图N，我们分别假设ABCD四个矩形的像素为1，2，3，4.<br>所以<br>a点像素值：1<br>b点像素值：1+2=3<br>c点像素值：1+3=4<br>d点像素值：1+2+3+4=10<br>验证下上面公式：1+10-（3+4）=4，所以矩形D=4是正确的。还是不直观，那我们用图表验证下：</p>
<p><img src="http://nunu03.github.io/2021/04/27/%E4%BA%BA%E8%84%B8%E6%A3%80%E6%B5%8B%E4%B9%8BHaar%E7%89%B9%E5%BE%81%E4%BB%8B%E7%BB%8D/haar-jifensample.drawio.png" alt="积分图图例"></p>
<p>可以看到，(𝑖𝑖(b)+𝑖𝑖(c))后，有一部分重合的区域，即A，所以需减掉，最后还需要将当前坐标d的像素值D包含进来。<br>(𝑖𝑖(b)+𝑖𝑖(c))-A+D = 𝑖𝑖(d) ==&gt; D= 𝑖𝑖(d) + A - (𝑖𝑖(b)+𝑖𝑖(c)) 由于A=𝑖𝑖(a)所以可以推出<br>𝐷𝑠𝑢𝑚=𝑖𝑖(a)+𝑖𝑖(d)−(𝑖𝑖(b)+𝑖𝑖(c))</p>
<p>所以无论矩形的尺寸大小，只需查找积分图像4次就可以求得任意矩形内像素值的和。</p>
<h2 id="计算特征值"><a href="#计算特征值" class="headerlink" title="计算特征值"></a>计算特征值</h2><p>上面已经知道，一个区域的像素值的和，可以由该区域的端点的积分图来计算。由前面特征模板的特征值的定义可以推出，矩形特征的特征值可以由特征端点的积分图计算出来。以A矩形特征为例，如下图，使用积分图计算其特征值：</p>
<p> <img src="http://nunu03.github.io/2021/04/27/%E4%BA%BA%E8%84%B8%E6%A3%80%E6%B5%8B%E4%B9%8BHaar%E7%89%B9%E5%BE%81%E4%BB%8B%E7%BB%8D/haar-featurevalue.drawio.png" alt="特征值-1"></p>
<p>该矩形特征的特征值，由定义，为区域A的像素值减去区域B的像素值。</p>
<p>区域A的像素值：<br>𝑖𝑖(5)+𝑖𝑖(1)−𝑖𝑖(2)−𝑖𝑖(4)<br>区域B的像素值：<br>𝑖𝑖(6)+𝑖𝑖(2)−𝑖𝑖(5)−𝑖𝑖(3)<br>所以：该矩形特征的特征值<br>𝑖𝑖(5)+𝑖𝑖(1)−𝑖𝑖(2)−𝑖𝑖(4)−[𝑖𝑖(6)+𝑖𝑖(2)−𝑖𝑖(5)−𝑖𝑖(3)]<br>=[𝑖𝑖(5)−𝑖𝑖(4)]+[𝑖𝑖(3)−𝑖𝑖(2)]−[𝑖𝑖(2)−𝑖𝑖(1)]−[𝑖𝑖(6)−𝑖𝑖(5)]<br>所以，矩形特征的特征值，只与特征矩形的端点的积分图有关，而与图像的坐标无关。通过计算特征矩形的端点的积分图，再进行简单的加减运算，就可以得到特征值，正因为如此，特征的计算速度大大提高，也提高了目标的检测速度。</p>
<p>然后看一个复杂一点的积分图示例如下：</p>
<p><img src="http://nunu03.github.io/2021/04/27/%E4%BA%BA%E8%84%B8%E6%A3%80%E6%B5%8B%E4%B9%8BHaar%E7%89%B9%E5%BE%81%E4%BB%8B%E7%BB%8D/haar-x3-jifen.drawio.png" alt="特征值-2"></p>
<p><img src="http://nunu03.github.io/2021/04/27/%E4%BA%BA%E8%84%B8%E6%A3%80%E6%B5%8B%E4%B9%8BHaar%E7%89%B9%E5%BE%81%E4%BB%8B%E7%BB%8D/haar-x3-special.drawio.png" alt="特征值-积分图"></p>
<p>然后计算一下颜色区域的特征值：</p>
<p>根据积分图公式：</p>
<p>特征A：2<br>总的像素值（有颜色区域的像素值）= 130+8-32-33 = 73<br>    白色区域的像素值 = 91+14-18-62 = 25<br>    特征值：3<em>白-总 =    3</em>25 -23 = 2</p>
<p>左侧黑色区域的像素值 =  62+8-14-33 = 23<br>右侧黑色区域的像素值 =  130+18-32-91 = 25<br>    特征值：2<em>白-黑 =  2</em>25-23+25 = 2</p>
<p>通过同样计算方式：特征B：-2<br>这个时候我们会发现，跟之前提到的特征值定义，不符合了，之前说过特征值为白色矩形像素和减去黑色矩形像素和，按此计算，应该是-23和23.那么问题在哪里？看上述我们计算发现，我们在计算特征值的时候都乘以了一个变量，3和2，那为啥要乘以两个变量呢？按照OpenCV代码，<font color="#FF0000">（Haar特征值=整个Haar区域内像素和×权重 + 黑色区域内像素和×权重）Haar特征值=白色区域内图像像素和 x 权重 - 黑色区域内图像像素和 x 权重</font>，那变量3和2其实就是权重。这也就是其他文章中提到的所谓“白色区域像素和减去黑色区域像素和”，只不过是加权相减而已（在XML文件中，每一个Haar特征都被保存在2~3个形如<x y width height weight>的标签中，其中x和y代表Haar矩形左上角点以检测窗口的左上角为原点的坐标，width和height代表矩形框的宽和高，而weight则对应了上面说的权重值。</x></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;rects&gt;</span><br><span class="line">    &lt;_&gt; 7 1 2 7 -1.&lt;/_&gt;</span><br><span class="line">    &lt;_&gt;  8 1 1 7 2.&lt;/_&gt;</span><br><span class="line">&lt;/rects&gt;</span><br></pre></td></tr></table></figure>

<p>例如上Haar特征应该表示为&lt;7 1 2 7 -1&gt;和&lt;8 1 1 7 2&gt;，原则上-1权重代表的是黑色矩形。<br>为什么要设置这种加权相减，而不是直接相减？请仔细观察上图中的特征，不难发现x3、y3、point特征黑白面积不相等，而其他特征黑白面积相等。设置权值就是为了抵消面积不等带来的影响，保证所有Haar特征的特征值在“灰度分布绝对均匀的图像”中为0。</p>
<h2 id="级联分类器"><a href="#级联分类器" class="headerlink" title="级联分类器"></a>级联分类器</h2><h3 id="XML"><a href="#XML" class="headerlink" title="XML"></a>XML</h3><p><img src="http://nunu03.github.io/2021/04/27/%E4%BA%BA%E8%84%B8%E6%A3%80%E6%B5%8B%E4%B9%8BHaar%E7%89%B9%E5%BE%81%E4%BB%8B%E7%BB%8D/xml.jpg" alt="haar-xml"></p>
<h3 id="分类器"><a href="#分类器" class="headerlink" title="分类器"></a>分类器</h3><p><img src="http://nunu03.github.io/2021/04/27/%E4%BA%BA%E8%84%B8%E6%A3%80%E6%B5%8B%E4%B9%8BHaar%E7%89%B9%E5%BE%81%E4%BB%8B%E7%BB%8D/xml-node.jpg" alt="haar-stages"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;internalNodes&gt;0 1 2 5.2434601821005344e-04 -1 -2 3 4.4573000632226467e-03&lt;/internalNodes&gt;</span><br><span class="line">&lt;leafValues&gt; 1.0216630250215530e-01 1.2384019792079926e-01 6.9103831052780151e-01&lt;/leafValues&gt;&lt;/_&gt;</span><br></pre></td></tr></table></figure>

<p>internalNodes:<br>0 、1,-1 、-2,则用于控制弱分类器树的形状；<br>5.2434601821005344e-04，弱分类器阈值t1；<br>4.4573000632226467e-03，弱分类器阈值t2；<br>2 、3 代表2个Haar特征位置；</p>
<p>leafValues：返回值。<br>其中标签中的3个浮点数，对应下图的三个value值，由左向右依次是rightValue2、leftValue和rightValue1；</p>
<p><img src="http://nunu03.github.io/2021/04/27/%E4%BA%BA%E8%84%B8%E6%A3%80%E6%B5%8B%E4%B9%8BHaar%E7%89%B9%E5%BE%81%E4%BB%8B%E7%BB%8D/haar-shu.drawio.png" alt="haar-树"></p>
<p>1.计算第一个Haar特征的特征值haar1，与第一个弱分类器阈值t1对比，当haar1&lt;t1时，进入步骤2；当haar1&gt;t1时候，该弱分类器输出rightValue2并结束。<br>2.计算第二个Haar特征值haar2，与第二个弱分类器阈值t2对比，当haar2&lt;t2时候输出leftValue；当haar2&gt;t2时输出rightValue1。</p>
<p><img src="http://nunu03.github.io/2021/04/27/%E4%BA%BA%E8%84%B8%E6%A3%80%E6%B5%8B%E4%B9%8BHaar%E7%89%B9%E5%BE%81%E4%BB%8B%E7%BB%8D/haar-shu2.drawio.png" alt="haar-树"></p>
<p>1、0和-1、-2则用于控制弱分类器树的形状。在运行时，OpenCV会把1赋值给当前的node.left，并把0赋值给node.right（请注意do-while代码中的条件，只有idx&lt;=0时才停止循环，参考图3应该可以理解这4个整数的含义）。如此，OpenCV通过这些巧妙的数值和结构，控制了整个分类器的运行。可以看到，每个弱分类器内部都是类似于这种树状的“串联”结构，所以我称其为“串联组成的的弱分类器”。</p>
<h3 id="强分类器结构"><a href="#强分类器结构" class="headerlink" title="强分类器结构"></a>强分类器结构</h3><p>在opencv中，强分类器是有多个弱分类器“并列”构成，即强分类器中的弱分类器是两两相互独立的。在目标检测时，每个弱分类器独立运行并输出cascadeLeaves[leafOfs-idx]值，然后把当前强分类器中每个弱分类器的输出值相加，即：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sum += cascadeLeaves[leafOfs - idx];</span><br></pre></td></tr></table></figure>

<p>之后与本级强分类器的stageThreshold阈值对比，当且仅当结果sum&gt;stageThreshold时，认为当前检测窗口通过了该级强分类器。当前检测窗口通过所有强分类器时，才被认为是一个检测目标。可以看出，强分类器与弱分类器结构不同，是一种类似于“并联”的结构，我称其为“并联组成的强分类器”。</p>
<h3 id="检测流程"><a href="#检测流程" class="headerlink" title="检测流程"></a>检测流程</h3><p>Haar级联分类器： 通过分析对比相邻图像区域来判断给定图像或者图像区域与已知对象是否匹配。<br>可以将多个Haar级联分类器组合起来，每个分类器负责匹配一个特征区域（比如眼睛），然后进行总体识别。<br>也可以一个分类器进行整体区域识别（比如人脸），其他分类器可识别小的部分（比如眼睛)等。<br>Haar特征具有尺度不变性，就是说它在尺度变换上具有鲁棒性。<br>Opencv提供了尺度不变的Haar级联分类器和跟踪器。但其并不具有旋转不变性。举个例子，opencv提供的Haar级联分类器并不认为侧脸和正脸一样，倒置的人脸和正脸一样。</p>
<p>训练过程： 输入图像-&gt;图像预处理-&gt;提取特征-&gt;训练分类器（二分类）-&gt;得到训练好的模型 ；<br>测试过程：输入图像-&gt;图像预处理-&gt;提取特征-&gt;导入模型-&gt;二分类（是不是所要检测的物体）；</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a href="https://docs.opencv.org/2.4/doc/user_guide/ug_traincascade.html#opencv-createsamples-utility" target="_blank" rel="noopener">Cascade Classifier Training</a><br><a href="https://www.cnblogs.com/zyly/p/9410563.html#_label0" target="_blank" rel="noopener">人脸检测之Haar分类器</a><br><a href="https://www.cnblogs.com/codingmengmeng/p/6567124.html" target="_blank" rel="noopener">积分图及其应用</a><br><a href="https://zhuanlan.zhihu.com/p/38056144" target="_blank" rel="noopener">人脸Haar特征快速检测及其特征计算</a><br><a href="https://blog.csdn.net/liulina603/article/details/8617281" target="_blank" rel="noopener">Haar特征与积分图</a><br><a href="https://blog.csdn.net/beizhengren/article/details/77095724" target="_blank" rel="noopener">Haar特征详细介绍</a><br><a href="https://blog.csdn.net/lijihw_1022/article/details/51373971" target="_blank" rel="noopener">级联分类器结构与XML文件含义</a><br><a href="https://blog.csdn.net/monk1992/article/details/105988015" target="_blank" rel="noopener">adaboost+haar目标检测技术</a></p>

        
        
          <blockquote id="copyright">
              <p>Original link: <a href="http://nunu03.github.io/page/2/index.html">http://nunu03.github.io/page/2/index.html</a></p>
              <p>Copyright Notice: 转载请注明出处.</p>
          </blockquote>
        
      
    </div>
    <footer class="article-footer">
      
        <div class="article-tag-wrap">
          

          
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Haar/">Haar</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/人脸检测/">人脸检测</a></li></ul>

          
    <div class="social-share">
      <span>Share:</span>
    </div>



        </div>
      
      
      
    </footer>
  </div>
</article>


  <article id="post-OpenCV学习" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/03/24/OpenCV学习/">OpenCV学习</a>
    </h1>
  


      </header>
    
    <div class="article-meta">
      
      <span class="article-date">
  <i class="fa fa-date"></i>
  <time class="dt-published" datetime="2021-03-24T09:46:09.000Z" itemprop="datePublished">2021年03月24日</time>
</span>
      
  <div class="article-category">
    <i class="fa fa-classify"></i>
    <a class="article-category-link" href="/categories/OpenCV/">OpenCV</a>
  </div>

      
      
<a href="/2021/03/24/OpenCV学习/#comments" class="article-comment-link">
  
  <i class="fa fa-commt"></i>
  Guestbook
</a>


    </div>
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="C-11-shared-ptr"><a href="#C-11-shared-ptr" class="headerlink" title="C++11 shared_ptr"></a>C++11 shared_ptr</h2><p>OpenCV提供了类似于C ++ 11中的std :: shared_ptr的Ptr模板类，用来实现自动内存管理。</p>

        
        
          <blockquote id="copyright">
              <p>Original link: <a href="http://nunu03.github.io/page/2/index.html">http://nunu03.github.io/page/2/index.html</a></p>
              <p>Copyright Notice: 转载请注明出处.</p>
          </blockquote>
        
      
    </div>
    <footer class="article-footer">
      
        <div class="article-tag-wrap">
          

          
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/OpenCV/">OpenCV</a></li></ul>

          
    <div class="social-share">
      <span>Share:</span>
    </div>



        </div>
      
      
      
    </footer>
  </div>
</article>


  <article id="post-日常问题解决记录" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/02/25/日常问题解决记录/">日常问题解决记录</a>
    </h1>
  


      </header>
    
    <div class="article-meta">
      
      <span class="article-date">
  <i class="fa fa-date"></i>
  <time class="dt-published" datetime="2021-02-25T03:02:40.000Z" itemprop="datePublished">2021年02月25日</time>
</span>
      
  <div class="article-category">
    <i class="fa fa-classify"></i>
    <a class="article-category-link" href="/categories/Log/">Log</a> > <a class="article-category-link" href="/categories/Log/Fix/">Fix</a>
  </div>

      
      
<a href="/2021/02/25/日常问题解决记录/#comments" class="article-comment-link">
  
  <i class="fa fa-commt"></i>
  Guestbook
</a>


    </div>
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="指令配置相关"><a href="#指令配置相关" class="headerlink" title="指令配置相关"></a>指令配置相关</h1><h2 id="Git相关"><a href="#Git相关" class="headerlink" title="Git相关"></a>Git相关</h2><h3 id="撤销commit"><a href="#撤销commit" class="headerlink" title="撤销commit"></a>撤销commit</h3><p>1.git reset HEAD^ 撤销最后一次commit</p>
<h3 id="查看远端仓库地址"><a href="#查看远端仓库地址" class="headerlink" title="查看远端仓库地址"></a>查看远端仓库地址</h3><p>2.git remote -v 查看远端仓库地址</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">chenyulong01$ git remote -v</span><br><span class="line">origin  https://github.com/danengz/OpenCVDemo.git (fetch)</span><br><span class="line">origin  https://github.com/danengz/OpenCVDemo.git (push)</span><br></pre></td></tr></table></figure>

<h3 id="git-stash"><a href="#git-stash" class="headerlink" title="git stash"></a>git stash</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">chenyulong01$ git stash list</span><br><span class="line">stash@&#123;0&#125;: On f-jy-10.16.0-teg-video-cyl: 接入teg video</span><br><span class="line">chenyulong01$ git stash clear</span><br><span class="line">chenyulong01$ git stash save &quot;接入teg video-jiaoyou&quot;</span><br><span class="line">chenyulong01$ git stash pop</span><br><span class="line">chenyulong01$ git stash apply 0</span><br><span class="line">chenyulong01$ git stash apply stash@&#123;0&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Linux下Git命令中文显示乱码"><a href="#Linux下Git命令中文显示乱码" class="headerlink" title="Linux下Git命令中文显示乱码"></a>Linux下Git命令中文显示乱码</h3><p>提示异常：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">Changes not staged for commit:</span><br><span class="line">  (use &quot;git add &lt;file&gt;...&quot; to update what will be committed)</span><br><span class="line">  (use &quot;git checkout -- &lt;file&gt;...&quot; to discard changes in working directory)</span><br><span class="line"></span><br><span class="line">        modified:   &quot;\347\211\210\346\234\254\347\256\241\347\220\206/.DS_Store&quot;</span><br><span class="line"></span><br><span class="line">Untracked files:</span><br><span class="line">  (use &quot;git add &lt;file&gt;...&quot; to include in what will be committed)</span><br><span class="line"></span><br><span class="line">        &quot;\347\211\210\346\234\254\347\256\241\347\220\206/\350\264\250\351\207\217\344\277\235\350\257\201/\346\265\213\350\257\225\347\224\250\344\276\213\351\233\206/\346\224\257\344\273\230\347\233\270\345\205\263.numbers&quot;</span><br><span class="line"></span><br><span class="line">no changes added to commit (use &quot;git add&quot; and/or &quot;git commit -a&quot;)</span><br><span class="line"></span><br><span class="line">chenyulong01deMacBook-Pro:WbuDoc chenyulong01$ git config --global core.quotepath false</span><br><span class="line">chenyulong01deMacBook-Pro:WbuDoc chenyulong01$ git status</span><br><span class="line">On branch master</span><br><span class="line">Your branch is up-to-date with &apos;origin/master&apos;.</span><br><span class="line"></span><br><span class="line">Changes not staged for commit:</span><br><span class="line">  (use &quot;git add &lt;file&gt;...&quot; to update what will be committed)</span><br><span class="line">  (use &quot;git checkout -- &lt;file&gt;...&quot; to discard changes in working directory)</span><br><span class="line"></span><br><span class="line">        modified:   .DS_Store</span><br><span class="line">        modified:   版本管理/.DS_Store</span><br><span class="line"></span><br><span class="line">Untracked files:</span><br><span class="line">  (use &quot;git add &lt;file&gt;...&quot; to include in what will be committed)</span><br></pre></td></tr></table></figure>

<p>解决方案： <strong>git config –global core.quotepath false</strong></p>
<h3 id="github-token"><a href="#github-token" class="headerlink" title="github token"></a>github token</h3><p><a href="https://docs.github.com/cn/get-started/getting-started-with-git/updating-credentials-from-the-macos-keychain" target="_blank" rel="noopener">Mac修改网址</a><br>在钥匙串中搜索github.com，点显示密码：修改密码改成token即可：<br><img src="http://nunu03.github.io/2021/02/25/%E6%97%A5%E5%B8%B8%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3%E8%AE%B0%E5%BD%95/github-password.png" alt></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chenyuddddeMacBook-Pro:nunu03.github.io chenxxx$ git remote set-url origin https://ghp_fGtnlW3RO2ncOdCwi1UVNStf9l3eSE2Jjsdsfsd@github.com/chesdsd/nunu03.github.io.git/</span><br></pre></td></tr></table></figure>

<h2 id="gradle相关"><a href="#gradle相关" class="headerlink" title="gradle相关"></a>gradle相关</h2><h3 id="查看Gradle-Task对应源码类"><a href="#查看Gradle-Task对应源码类" class="headerlink" title="查看Gradle Task对应源码类"></a>查看Gradle Task对应源码类</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">chenyulong01$ ./gradlew -q help --task app:mergeReleaseResources</span><br><span class="line">Detailed task information for app:mergeReleaseResources</span><br><span class="line">Path</span><br><span class="line">     :app:mergeReleaseResources</span><br><span class="line">Type</span><br><span class="line">     MergeResources (com.android.build.gradle.tasks.MergeResources)</span><br><span class="line">Description</span><br><span class="line">     -</span><br><span class="line">Group</span><br><span class="line">     -</span><br><span class="line">chenyulong01deMacBook-Pro:MyActivityTest chenyulong01$</span><br></pre></td></tr></table></figure>

<h3 id="bash-gradlew-Permission-denied"><a href="#bash-gradlew-Permission-denied" class="headerlink" title="bash: ./gradlew: Permission denied"></a>bash: ./gradlew: Permission denied</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +x gradlew</span><br></pre></td></tr></table></figure>

<h2 id="sdkman"><a href="#sdkman" class="headerlink" title="sdkman"></a>sdkman</h2><h3 id="安装groovy"><a href="#安装groovy" class="headerlink" title="安装groovy"></a>安装groovy</h3><p>Simply open a new terminal and enter:<br>$ curl -s get.sdkman.io | bash<br>Follow the instructions on-screen to complete installation.<br>Open a new terminal or type the command:<br>$ source “$HOME/.sdkman/bin/sdkman-init.sh”<br>Then install the latest stable Groovy:<br>$ sdk install groovy<br>After installation is complete and you’ve made it your default version, test it with:<br>$ groovy -version<br>That’s all there is to it!</p>
<h3 id="配置路径使idea容易找到"><a href="#配置路径使idea容易找到" class="headerlink" title="配置路径使idea容易找到"></a>配置路径使idea容易找到</h3><p>sudo ln -s /usr/local/opt/groovy/libexec /Library/Groovy</p>
<h3 id="安装目录"><a href="#安装目录" class="headerlink" title="安装目录"></a>安装目录</h3><p>所有sdk都安装在了sdkman目录下：~/.sdkman/candidates/<br><a href="https://zhuanlan.zhihu.com/p/82315812" target="_blank" rel="noopener">sdkman介绍</a></p>
<h2 id="Mac系统如何显示隐藏文件？"><a href="#Mac系统如何显示隐藏文件？" class="headerlink" title="Mac系统如何显示隐藏文件？"></a>Mac系统如何显示隐藏文件？</h2><p>Command+Shift+. 可以显示隐藏文件、文件夹，再按一次，恢复隐藏；</p>
<h2 id="Linux-Mac下统计当前文件夹下的文件个数、目录个数"><a href="#Linux-Mac下统计当前文件夹下的文件个数、目录个数" class="headerlink" title="Linux/Mac下统计当前文件夹下的文件个数、目录个数"></a>Linux/Mac下统计当前文件夹下的文件个数、目录个数</h2><p>1.统计当前文件夹下文件的个数</p>
<pre><code>ls -l |grep &quot;^-&quot;|wc -l</code></pre><p>2、 统计当前文件夹下目录的个数</p>
<pre><code>ls -l |grep &quot;^d&quot;|wc -l</code></pre><p>3、 统计当前文件夹下文件的个数，包括子文件夹里的</p>
<pre><code>ls -lR|grep &quot;^-&quot;|wc -l</code></pre><p>4、统计文件夹下目录的个数，包括子文件夹里的</p>
<pre><code>ls -lR|grep &quot;^d&quot;|wc -l</code></pre><p>5、 说明</p>
<p>  代码如下:</p>
<pre><code>ls -l</code></pre><p>  长列表输出当前文件夹下文件信息(注意这里的文件，不同于一般的文件，可能是目录、链接、设备文件等)</p>
<p>  代码如下:</p>
<pre><code>grep &quot;^-&quot;</code></pre><p>  这里将长列表输出信息过滤一部分，只保留一般文件，如果只保留目录就是 ^d<br>  代码如下:</p>
<pre><code>wc -l</code></pre><p>  统计输出信息的行数，因为已经过滤得只剩一般文件了，所以统计结果就是一般文件信息的行数，又由于一行信息对应一个文件，所以也就是文件的个数。</p>
<h2 id="adb-backup"><a href="#adb-backup" class="headerlink" title="adb backup"></a>adb backup</h2><p>  1.备份：adb backup -f /Users/xxx/Desktop/photo/clientbackup.ab 包名<br>  2.Android backup extractor<br>  <a href="https://github.com/nelenkov/android-backup-extractor/releases" target="_blank" rel="noopener">下载abe.jar</a><br>  执行： java -jar /Users/xxx/Desktop/photo/abe.jar unpack /Users/xxx/Desktop/photo/clientbackup.ab   /Users/xxx/Desktop/photo/clientbackup.tar<br>  3.恢复：adb restore clientbackup.ab</p>
<h2 id="adb多用户操作"><a href="#adb多用户操作" class="headerlink" title="adb多用户操作"></a>adb多用户操作</h2><p>查看用户列表</p>
<blockquote>
<p>adb shell pm list users</p>
</blockquote>
<p>创建新用户</p>
<blockquote>
<p>adb shell pm create-user [–profileOf USER_ID] [–managed] USER_NAME</p>
</blockquote>
<blockquote>
<p>adb shell pm create-user 10 godv</p>
</blockquote>
<p>启动和切换用户</p>
<blockquote>
<p>adb shell am switch-user USER_ID</p>
</blockquote>
<blockquote>
<p>adb shell am start-user USER_ID</p>
</blockquote>
<p>安装应用到某个用户下</p>
<blockquote>
<p>adb install –user USER_ID name.apk</p>
</blockquote>
<p>删除用户</p>
<blockquote>
<p>adb shell pm remove-user USER_ID</p>
</blockquote>
<p>为了多用户下的数据安全性，在每个新用户创建之初，不管是外部存储（External Storage）还是app data目录，Android都为其准备了独立的文件存储</p>
<p>/storage/emulated/下拥有不同的用户分区</p>
<blockquote>
<p>/storage/emulated/0</p>
</blockquote>
<blockquote>
<p>/storage/emulated/10</p>
</blockquote>
<p>代码查看不同用户 以SDK为例 反射获取</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">int uid = -1;</span><br><span class="line">try &#123;</span><br><span class="line">     Class clz = Class.forName(&quot;android.os.UserHandle&quot;);</span><br><span class="line">     Method m = clz.getDeclaredMethod(&quot;myUserId&quot;);</span><br><span class="line">     uid = (int) m.invoke(null);</span><br><span class="line">     &#125; catch (Exception e) &#123;</span><br><span class="line">         e.printStackTrace();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>ContentResolver下的uri</p>
<blockquote>
<p>content:// USER_ID @media/external/audio/media</p>
</blockquote>
<p>即可获取不同用户下的不同数据<br><a href="https://blog.csdn.net/we1less/article/details/108280882?utm_medium=distribute.pc_aggpage_search_result.none-task-blog-2~aggregatepage~first_rank_v2~rank_aggregation-5-108280882.pc_agg_rank_aggregation&utm_term=adb+shell%E7%94%A8%E6%88%B7id&spm=1000.2123.3001.4430" target="_blank" rel="noopener">安卓adb多用户操作</a><br><a href="https://mazhuang.org/awesome-adb/" target="_blank" rel="noopener">awesome-adb</a><br><a href="https://www.cnblogs.com/onelikeone/p/11083983.html" target="_blank" rel="noopener">Android 多用户</a></p>
<h2 id="环境变量设置"><a href="#环境变量设置" class="headerlink" title="环境变量设置"></a>环境变量设置</h2><p>手动设置：</p>
<blockquote>
<p>chenyudeMacBook-Pro:~ chenyu$ open .bash_profile</p>
</blockquote>
<blockquote>
<p>chenyudeMacBook-Pro:~ chenyu$ source .bash_profile</p>
</blockquote>
<p>自动设置：</p>
<blockquote>
<p>export PATH=$PATH:/Users/chenyulong01/gradle/gradle-7.3/bin</p>
</blockquote>
<h2 id="端口查看"><a href="#端口查看" class="headerlink" title="端口查看"></a>端口查看</h2><blockquote>
<p>sudo lsof -i :8088 // 查看端口使用情况<br>sudo kill -9 47862 // 杀死展示的PID</p>
</blockquote>
<h2 id="npm-install-https-certificate"><a href="#npm-install-https-certificate" class="headerlink" title="npm install https certificate"></a>npm install https certificate</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">chenyudeMacBook-Pro:Robot chenyu$ npm install</span><br><span class="line">npm ERR! request to https://registry.cnpmjs.org/base-64 failed, reason: Hostname/IP doesn&apos;t match certificate&apos;s altnames: &quot;Host: registry.cnpmjs.org. is not in the cert&apos;s altnames: DNS:r.cnpmjs.org&quot;</span><br><span class="line"></span><br><span class="line">npm ERR! A complete log of this run can be found in:</span><br><span class="line">npm ERR!     /Users/chenyu/.npm/_logs/2021-08-09T06_53_57_119Z-debug.log</span><br></pre></td></tr></table></figure>

<p>解决方案：关闭https认证：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chenyudeMacBook-Pro:Robot chenyu$ npm config set strict-ssl false</span><br></pre></td></tr></table></figure>

<h2 id="nps穿透"><a href="#nps穿透" class="headerlink" title="nps穿透"></a>nps穿透</h2><p><strong>安装</strong></p>
<p>$ cd /opt/nps</p>
<p>$ ./nps install -config=/etc/nps/nps.conf</p>
<p><strong>启动</strong></p>
<p>$ sudo nps start</p>
<p><strong>其他命令</strong></p>
<p><strong>停止</strong></p>
<p>$ sudo nps stop</p>
<p><strong>客户端更新</strong></p>
<p>$ sudo nps-update update</p>
<p><strong>修改配置</strong></p>
<p>如果需要更换命令内容需要先卸载./nps uninstall，再重新安装</p>
<p>$ cd /opt/nps</p>
<p>$ ./nps uninstall</p>
<p><strong>成功后再重新安装</strong></p>
<p>$ ./nps install -config=/etc/nps/nps.conf</p>
<p><a href="https://blog.csdn.net/weixin_39992665/article/details/116770933?utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromBaidu%7Edefault-6.control&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromBaidu%7Edefault-6.control" target="_blank" rel="noopener">linux卸载nps,CentOS安装nps</a></p>
<h1 id="异常相关"><a href="#异常相关" class="headerlink" title="异常相关"></a>异常相关</h1><h2 id="Android-Studio-不能调试"><a href="#Android-Studio-不能调试" class="headerlink" title="Android Studio 不能调试"></a>Android Studio 不能调试</h2><p>提示异常：Attention! No symbol directories found - please check your native debug configuration</p>
<p>解决方案：在Android studio， file–&gt;settering—&gt;plugins—-android NDK support插件的选项去掉。重新编译后再debug就可以了。</p>
<p><a href="https://www.jianshu.com/p/3d8ddf8df1b6" target="_blank" rel="noopener">android studio无法debug解决方法</a></p>
<h2 id="Android-Studio-Connect-to-127-0-0-1-8888-127-0-0-1-failed-Connection-refused-Connection-refused"><a href="#Android-Studio-Connect-to-127-0-0-1-8888-127-0-0-1-failed-Connection-refused-Connection-refused" class="headerlink" title="Android Studio - Connect to 127.0.0.1:8888 [/127.0.0.1] failed: Connection refused (Connection refused)"></a>Android Studio - Connect to 127.0.0.1:8888 [/127.0.0.1] failed: Connection refused (Connection refused)</h2><blockquote>
<p>Could not resolve com.anjuke.android.community:communitymodule:1014-1.0.0.<br>Could not get resource ‘<a href="http://artifactory.58corp.com:8081/artifactory/android-public/com/anjuke/android/community/communitymodule/1014-1.0.0/communitymodule-1014-1.0.0.pom&#39;" target="_blank" rel="noopener">http://artifactory.58corp.com:8081/artifactory/android-public/com/anjuke/android/community/communitymodule/1014-1.0.0/communitymodule-1014-1.0.0.pom&#39;</a>.<br>Could not GET ‘<a href="http://artifactory.58corp.com:8081/artifactory/android-public/com/anjuke/android/community/communitymodule/1014-1.0.0/communitymodule-1014-1.0.0.pom&#39;" target="_blank" rel="noopener">http://artifactory.58corp.com:8081/artifactory/android-public/com/anjuke/android/community/communitymodule/1014-1.0.0/communitymodule-1014-1.0.0.pom&#39;</a>.<br>Connect to 127.0.0.1:8888 [/127.0.0.1] failed: Connection refused (Connection refused)</p>
</blockquote>
<p>解决方案：cmd：lsof -i，找到COMMAND java 对应的 PID，然后kill 98087  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">chenyulong01deMacBook-Pro:~ chenyulong01$ lsof -i</span><br><span class="line">COMMAND     PID         USER   FD   TYPE             DEVICE SIZE/OFF NODE NAME</span><br><span class="line">java      77690 chenyulong01  211u  IPv6 0x426c9f64949f384b      0t0  TCP *:65337 (LISTEN)</span><br><span class="line">chenyulong01deMacBook-Pro:~ chenyulong01$ </span><br><span class="line">chenyulong01deMacBook-Pro:~ chenyulong01$ kill 77690</span><br><span class="line">chenyulong01deMacBook-Pro:~ chenyulong01$</span><br></pre></td></tr></table></figure>

<h2 id="使用Xposed去hook方法TestArray-Person-person"><a href="#使用Xposed去hook方法TestArray-Person-person" class="headerlink" title="使用Xposed去hook方法TestArray(Person[] person)"></a>使用Xposed去hook方法TestArray(Person[] person)</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Class&lt;?&gt; personClass = findClass(&quot;com.zq.inputmethodtest.Person&quot;,lpparam.classLoader);</span><br><span class="line">findAndHookMethod(&quot;com.zq.inputmethodtest.MainActivity&quot;, lpparam.classLoader,</span><br><span class="line">        &quot;TestArray&quot;,java.lang.reflect.Array.newInstance(personClass, 2).getClass(), new XC_MethodHook() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            protected void afterHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">                param.setResult(&quot;person数组被修改&quot;);</span><br><span class="line">                Log.d(&quot;InputTest--&gt;after &quot;,&quot;&quot;+ param.getResult());</span><br><span class="line">            &#125;</span><br><span class="line"> &#125;);</span><br></pre></td></tr></table></figure>

<h2 id="Execution-failed-for-JetifyTransform"><a href="#Execution-failed-for-JetifyTransform" class="headerlink" title="Execution failed for JetifyTransform"></a>Execution failed for JetifyTransform</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Suggestions:</span><br><span class="line">            - If you believe this library doesn&apos;t need to be jetified (e.g., if it already supports AndroidX, or if it doesn&apos;t use support libraries/AndroidX at all), add android.jetifier.blacklist = &#123;&lt;!-- --&gt;comma-separated list of regular expressions (or simply names) of the libraries that you don&apos;t want to be jetified&#125; to the gradle.properties file.</span><br><span class="line">            - If you believe this library needs to be jetified (e.g., if it uses old support libraries and breaks your app if it isn&apos;t jetified), contact the library&apos;s authors to update this library to support AndroidX and use the supported version once it is released.</span><br></pre></td></tr></table></figure>

<p>解决方案：在gradle.properties配置文件中添加，android.jetifier.blacklist = common-27.1.0.jar,bundletool-0.14.0.jar</p>
<h2 id="Duplicate-jar-entry-a-class"><a href="#Duplicate-jar-entry-a-class" class="headerlink" title="Duplicate jar entry [a.class])"></a>Duplicate jar entry [a.class])</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Execution failed for task &apos;:58WuxianClient:minifyReleaseWithProguard&apos;.</span><br><span class="line">&gt; java.io.IOException: Can&apos;t write [/Users/chenyulong01/AndroidStudioProjects/58/58town/58ClientProject/58WuxianClient/build/intermediates/shrunk_jar/release/minified.jar] (Can&apos;t read [/Users/chenyulong01/.gradle/caches/transforms-2/files-2.1/1749dbd4dcd5d376e66539c8b1f84b24/jetified-asm-analysis-7.0.jar(;;;;;;;**.class)] (Duplicate jar entry [a.class]))</span><br></pre></td></tr></table></figure>

<p>解决方案：在gradle task 中，点击执行androidDependencies,打印出所有依赖列表，查找出重复对组，然后去去除依赖即可。<br><img src="http://nunu03.github.io/2021/02/25/%E6%97%A5%E5%B8%B8%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3%E8%AE%B0%E5%BD%95/dependencies.jpg" alt></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+--- org.ow2.asm:asm-commons:7.0@jar</span><br><span class="line">+--- org.ow2.asm:asm-util:7.0@jar</span><br><span class="line">+--- org.ow2.asm:asm-analysis:7.0@jar</span><br><span class="line">+--- org.ow2.asm:asm-tree:7.0@jar</span><br><span class="line"></span><br><span class="line">implementation (&apos;com.android.tools.build:gradle:4.0.2&apos;)</span><br><span class="line">            &#123;</span><br><span class="line">                exclude group: &apos;javax.activation&apos;</span><br><span class="line">                exclude group: &apos;org.apache.httpcomponents&apos;</span><br><span class="line">                exclude group: &apos;org.ow2.asm&apos;</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure>

<h2 id="Duplicate-class-javax-activation-ActivationDataFlavor-found-in-modules"><a href="#Duplicate-class-javax-activation-ActivationDataFlavor-found-in-modules" class="headerlink" title="Duplicate class javax.activation.ActivationDataFlavor found in modules"></a>Duplicate class javax.activation.ActivationDataFlavor found in modules</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java.lang.RuntimeException: Duplicate class javax.activation.ActivationDataFlavor found in modules javax.activation-1.2.0.jar (com.sun.activation:javax.activation:1.2.0) and javax.activation-api-1.2.0.jar (javax.activation:javax.activation-api:1.2.0)</span><br></pre></td></tr></table></figure>

<p>解决方案：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">implementation (&apos;com.android.tools.lint:lint-gradle:27.0.2&apos;)</span><br><span class="line">            &#123;</span><br><span class="line">                exclude group: &apos;com.sun.activation&apos;, module: &apos;javax.activations&apos;</span><br><span class="line">                exclude group: &apos;com.google.code.findbugs&apos;</span><br><span class="line">                exclude group: &apos;javax.inject&apos;</span><br><span class="line">                exclude group: &apos;com.android.tools.external.com-intellij&apos;</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure>


        
        
          <blockquote id="copyright">
              <p>Original link: <a href="http://nunu03.github.io/page/2/index.html">http://nunu03.github.io/page/2/index.html</a></p>
              <p>Copyright Notice: 转载请注明出处.</p>
          </blockquote>
        
      
    </div>
    <footer class="article-footer">
      
        <div class="article-tag-wrap">
          

          
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Fix/">Fix</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Log/">Log</a></li></ul>

          
    <div class="social-share">
      <span>Share:</span>
    </div>



        </div>
      
      
      
    </footer>
  </div>
</article>


  <article id="post-nps-内网穿透" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/01/06/nps-内网穿透/">nps 内网穿透</a>
    </h1>
  


      </header>
    
    <div class="article-meta">
      
      <span class="article-date">
  <i class="fa fa-date"></i>
  <time class="dt-published" datetime="2021-01-06T12:20:53.000Z" itemprop="datePublished">2021年01月06日</time>
</span>
      
  <div class="article-category">
    <i class="fa fa-classify"></i>
    <a class="article-category-link" href="/categories/ngrok/">ngrok</a> > <a class="article-category-link" href="/categories/ngrok/nps/">nps</a>
  </div>

      
      
<a href="/2021/01/06/nps-内网穿透/#comments" class="article-comment-link">
  
  <i class="fa fa-commt"></i>
  Guestbook
</a>


    </div>
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p><a href="https://github.com/ehang-io/nps/releases" target="_blank" rel="noopener">下载nps：</a></p>
<p>Mac系统：darwin_amd64_server.tar.gz<br>下载后解压，在解压文件夹，执行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">chenyulong01deMacBook-Pro:Downloads chenyulong01$ cd darwin_amd64_server</span><br><span class="line"></span><br><span class="line">chenyulong01deMacBook-Pro:darwin_amd64_server chenyulong01$ sudo ./nps install</span><br><span class="line">2021/01/06 14:21:18 copy file ::/Users/chenyulong01/Downloads/darwin_amd64_server/conf/clients.json to /etc/nps/conf/clients.json</span><br><span class="line">2021/01/06 14:21:18 copy file ::/Users/chenyulong01/Downloads/darwin_amd64_server/conf/hosts.json to /etc/nps/conf/hosts.json</span><br><span class="line">2021/01/06 14:21:18 copy file ::/Users/chenyulong01/Downloads/darwin_amd64_server/conf/nps.conf to /etc/nps/conf/nps.conf</span><br><span class="line">2021/01/06 14:21:18 copy file ::/Users/chenyulong01/Downloads/darwin_amd64_server/conf/server.key to /etc/nps/conf/server.key</span><br><span class="line">2021/01/06 14:21:18 copy file ::/Users/chenyulong01/Downloads/darwin_amd64_server/conf/server.pem to /etc/nps/conf/server.pem</span><br><span class="line">2021/01/06 14:21:18 copy file ::/Users/chenyulong01/Downloads/darwin_amd64_server/conf/tasks.json to /etc/nps/conf/tasks.json</span><br><span class="line">2021/01/06 14:21:18 copy file ::/Users/chenyulong01/Downloads/darwin_amd64_server/web/views/client/add.html to /etc/nps/web/views/client/add.html</span><br><span class="line">2021/01/06 14:21:18 mkdir:/etc/nps/web/views/client/</span><br><span class="line">2021/01/06 14:21:18 copy file ::/Users/chenyulong01/Downloads/darwin_amd64_server/web/views/client/edit.html to /etc/nps/web/views/client/edit.html</span><br><span class="line">2021/01/06 14:21:18 copy file ::/Users/chenyulong01/Downloads/darwin_amd64_server/web/views/client/list.html to /etc/nps/web/views/client/list.html</span><br><span class="line">2021/01/06 14:21:18 copy file ::/Users/chenyulong01/Downloads/darwin_amd64_server/web/views/index/add.html to /etc/nps/web/views/index/add.html</span><br><span class="line">2021/01/06 14:21:18 mkdir:/etc/nps/web/views/index/</span><br><span class="line">2021/01/06 14:21:18 copy file ::/Users/chenyulong01/Downloads/darwin_amd64_server/web/views/index/edit.html to /etc/nps/web/views/index/edit.html</span><br><span class="line">2021/01/06 14:21:18 copy file ::/Users/chenyulong01/Downloads/darwin_amd64_server/web/views/index/hadd.html to /etc/nps/web/views/index/hadd.html</span><br><span class="line">2021/01/06 14:21:18 copy file ::/Users/chenyulong01/Downloads/darwin_amd64_server/web/views/index/hedit.html to /etc/nps/web/views/index/hedit.html</span><br><span class="line">2021/01/06 14:21:18 copy file ::/Users/chenyulong01/Downloads/darwin_amd64_server/web/views/index/help.html to /etc/nps/web/views/index/help.html</span><br><span class="line">2021/01/06 14:21:18 copy file ::/Users/chenyulong01/Downloads/darwin_amd64_server/web/views/index/hlist.html to /etc/nps/web/views/index/hlist.html</span><br><span class="line">2021/01/06 14:21:18 copy file ::/Users/chenyulong01/Downloads/darwin_amd64_server/web/views/index/index.html to /etc/nps/web/views/index/index.html</span><br><span class="line">2021/01/06 14:21:18 copy file ::/Users/chenyulong01/Downloads/darwin_amd64_server/web/views/index/list.html to /etc/nps/web/views/index/list.html</span><br><span class="line">2021/01/06 14:21:18 copy file ::/Users/chenyulong01/Downloads/darwin_amd64_server/web/views/login/index.html to /etc/nps/web/views/login/index.html</span><br><span class="line">2021/01/06 14:21:18 mkdir:/etc/nps/web/views/login/</span><br><span class="line">2021/01/06 14:21:18 copy file ::/Users/chenyulong01/Downloads/darwin_amd64_server/web/views/login/register.html to /etc/nps/web/views/login/register.html</span><br><span class="line">2021/01/06 14:21:18 copy file ::/Users/chenyulong01/Downloads/darwin_amd64_server/web/views/public/error.html to /etc/nps/web/views/public/error.html</span><br><span class="line">2021/01/06 14:21:18 mkdir:/etc/nps/web/views/public/</span><br><span class="line">2021/01/06 14:21:18 copy file ::/Users/chenyulong01/Downloads/darwin_amd64_server/web/views/public/layout.html to /etc/nps/web/views/public/layout.html</span><br><span class="line">2021/01/06 14:21:18 copy file ::/Users/chenyulong01/Downloads/darwin_amd64_server/web/static/css/bootstrap-table.min.css to /etc/nps/web/static/css/bootstrap-table.min.css</span><br><span class="line">2021/01/06 14:21:18 mkdir:/etc/nps/web/static/css/</span><br><span class="line">2021/01/06 14:21:18 copy file ::/Users/chenyulong01/Downloads/darwin_amd64_server/web/static/css/bootstrap.min.css to /etc/nps/web/static/css/bootstrap.min.css</span><br><span class="line">2021/01/06 14:21:18 copy file ::/Users/chenyulong01/Downloads/darwin_amd64_server/web/static/css/datatables.css to /etc/nps/web/static/css/datatables.css</span><br><span class="line">2021/01/06 14:21:18 copy file ::/Users/chenyulong01/Downloads/darwin_amd64_server/web/static/css/fontawesome.min.css to /etc/nps/web/static/css/fontawesome.min.css</span><br><span class="line">2021/01/06 14:21:18 copy file ::/Users/chenyulong01/Downloads/darwin_amd64_server/web/static/css/regular.min.css to /etc/nps/web/static/css/regular.min.css</span><br><span class="line">2021/01/06 14:21:18 copy file ::/Users/chenyulong01/Downloads/darwin_amd64_server/web/static/css/solid.min.css to /etc/nps/web/static/css/solid.min.css</span><br><span class="line">2021/01/06 14:21:18 copy file ::/Users/chenyulong01/Downloads/darwin_amd64_server/web/static/css/style.css to /etc/nps/web/static/css/style.css</span><br><span class="line">2021/01/06 14:21:18 copy file ::/Users/chenyulong01/Downloads/darwin_amd64_server/web/static/img/flag/en-US.png to /etc/nps/web/static/img/flag/en-US.png</span><br><span class="line">2021/01/06 14:21:18 mkdir:/etc/nps/web/static/img/</span><br><span class="line">2021/01/06 14:21:18 mkdir:/etc/nps/web/static/img/flag/</span><br><span class="line">2021/01/06 14:21:18 copy file ::/Users/chenyulong01/Downloads/darwin_amd64_server/web/static/img/flag/zh-CN.png to /etc/nps/web/static/img/flag/zh-CN.png</span><br><span class="line">2021/01/06 14:21:18 copy file ::/Users/chenyulong01/Downloads/darwin_amd64_server/web/static/js/bootstrap-table-locale-all.min.js to /etc/nps/web/static/js/bootstrap-table-locale-all.min.js</span><br><span class="line">2021/01/06 14:21:18 mkdir:/etc/nps/web/static/js/</span><br><span class="line">2021/01/06 14:21:18 copy file ::/Users/chenyulong01/Downloads/darwin_amd64_server/web/static/js/bootstrap-table.min.js to /etc/nps/web/static/js/bootstrap-table.min.js</span><br><span class="line">2021/01/06 14:21:18 copy file ::/Users/chenyulong01/Downloads/darwin_amd64_server/web/static/js/bootstrap.min.js to /etc/nps/web/static/js/bootstrap.min.js</span><br><span class="line">2021/01/06 14:21:18 copy file ::/Users/chenyulong01/Downloads/darwin_amd64_server/web/static/js/echarts.min.js to /etc/nps/web/static/js/echarts.min.js</span><br><span class="line">2021/01/06 14:21:18 copy file ::/Users/chenyulong01/Downloads/darwin_amd64_server/web/static/js/fontawesome.min.js to /etc/nps/web/static/js/fontawesome.min.js</span><br><span class="line">2021/01/06 14:21:18 copy file ::/Users/chenyulong01/Downloads/darwin_amd64_server/web/static/js/inspinia.js to /etc/nps/web/static/js/inspinia.js</span><br><span class="line">2021/01/06 14:21:18 copy file ::/Users/chenyulong01/Downloads/darwin_amd64_server/web/static/js/jquery-3.4.1.min.js to /etc/nps/web/static/js/jquery-3.4.1.min.js</span><br><span class="line">2021/01/06 14:21:18 copy file ::/Users/chenyulong01/Downloads/darwin_amd64_server/web/static/js/language.js to /etc/nps/web/static/js/language.js</span><br><span class="line">2021/01/06 14:21:18 copy file ::/Users/chenyulong01/Downloads/darwin_amd64_server/web/static/js/popper.min.js to /etc/nps/web/static/js/popper.min.js</span><br><span class="line">2021/01/06 14:21:18 copy file ::/Users/chenyulong01/Downloads/darwin_amd64_server/web/static/page/error.html to /etc/nps/web/static/page/error.html</span><br><span class="line">2021/01/06 14:21:18 mkdir:/etc/nps/web/static/page/</span><br><span class="line">2021/01/06 14:21:18 copy file ::/Users/chenyulong01/Downloads/darwin_amd64_server/web/static/page/languages.xml to /etc/nps/web/static/page/languages.xml</span><br><span class="line">2021/01/06 14:21:18 copy file ::/Users/chenyulong01/Downloads/darwin_amd64_server/web/static/webfonts/fa-solid-900.eot to /etc/nps/web/static/webfonts/fa-solid-900.eot</span><br><span class="line">2021/01/06 14:21:18 mkdir:/etc/nps/web/static/webfonts/</span><br><span class="line">2021/01/06 14:21:18 copy file ::/Users/chenyulong01/Downloads/darwin_amd64_server/web/static/webfonts/fa-solid-900.svg to /etc/nps/web/static/webfonts/fa-solid-900.svg</span><br><span class="line">2021/01/06 14:21:18 copy file ::/Users/chenyulong01/Downloads/darwin_amd64_server/web/static/webfonts/fa-solid-900.ttf to /etc/nps/web/static/webfonts/fa-solid-900.ttf</span><br><span class="line">2021/01/06 14:21:18 copy file ::/Users/chenyulong01/Downloads/darwin_amd64_server/web/static/webfonts/fa-solid-900.woff to /etc/nps/web/static/webfonts/fa-solid-900.woff</span><br><span class="line">2021/01/06 14:21:18 copy file ::/Users/chenyulong01/Downloads/darwin_amd64_server/web/static/webfonts/fa-solid-900.woff2 to /etc/nps/web/static/webfonts/fa-solid-900.woff2</span><br><span class="line">2021/01/06 14:21:18 install ok!</span><br><span class="line">2021/01/06 14:21:18 Static files and configuration files in the current directory will be useless</span><br><span class="line">2021/01/06 14:21:18 The new configuration file is located in /etc/nps you can edit them</span><br><span class="line">2021/01/06 14:21:18 You can start with:</span><br><span class="line">nps start|stop|restart|uninstall|update or nps-update update</span><br><span class="line">anywhere!</span><br></pre></td></tr></table></figure>

<p>启动：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">chenyulong01deMacBook-Pro:~ chenyulong01$ cd /etc/nps/</span><br><span class="line">chenyulong01deMacBook-Pro:nps chenyulong01$ ls</span><br><span class="line">conf	web</span><br><span class="line">chenyulong01deMacBook-Pro:nps chenyulong01$ sudo nps start</span><br><span class="line">2021/01/06 14:27:47.789 [E] [nps.go:132]  Valid actions: [&quot;start&quot; &quot;stop&quot; &quot;restart&quot; &quot;install&quot; &quot;uninstall&quot;]</span><br><span class="line">Failed to start nps内网穿透代理服务器: &quot;launchctl&quot; failed with stderr: /Library/LaunchDaemons/Nps.plist: service already loaded</span><br><span class="line"></span><br><span class="line">chenyulong01deMacBook-Pro:nps chenyulong01$ sudo nps stop</span><br><span class="line">chenyulong01deMacBook-Pro:nps chenyulong01$ sudo nps start</span><br></pre></td></tr></table></figure>

<h2 id="web管理"><a href="#web管理" class="headerlink" title="web管理"></a>web管理</h2><p>网址：<a href="http://localhost:8080/login/index" target="_blank" rel="noopener">http://localhost:8080/login/index</a></p>
<p>账号：admin</p>
<p>密码：123</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a href="http://www.nasge.com/archives/48.html" target="_blank" rel="noopener">内网穿透工具比较(ngrok,frp,lanproxy,goproxy,nps)</a><br><a href="https://github.com/ehang-io/nps/blob/master/README_zh.md" target="_blank" rel="noopener">ehang-io-nps</a></p>
<p><a href="https://ehang-io.github.io/nps/#/example" target="_blank" rel="noopener">Api</a></p>
<p><a href="https://blog.csdn.net/weixin_39251927/article/details/104843100" target="_blank" rel="noopener">NPS内网穿透工具</a></p>

        
        
          <blockquote id="copyright">
              <p>Original link: <a href="http://nunu03.github.io/page/2/index.html">http://nunu03.github.io/page/2/index.html</a></p>
              <p>Copyright Notice: 转载请注明出处.</p>
          </blockquote>
        
      
    </div>
    <footer class="article-footer">
      
        <div class="article-tag-wrap">
          

          
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ngrok/">ngrok</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nps/">nps</a></li></ul>

          
    <div class="social-share">
      <span>Share:</span>
    </div>



        </div>
      
      
      
    </footer>
  </div>
</article>


  <article id="post-Uri获取资源文件" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/11/12/Uri获取资源文件/">Uri获取资源文件</a>
    </h1>
  


      </header>
    
    <div class="article-meta">
      
      <span class="article-date">
  <i class="fa fa-date"></i>
  <time class="dt-published" datetime="2020-11-12T09:18:04.000Z" itemprop="datePublished">2020年11月12日</time>
</span>
      
  <div class="article-category">
    <i class="fa fa-classify"></i>
    <a class="article-category-link" href="/categories/Android/">Android</a>
  </div>

      
      
<a href="/2020/11/12/Uri获取资源文件/#comments" class="article-comment-link">
  
  <i class="fa fa-commt"></i>
  Guestbook
</a>


    </div>
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>开发中遇到再用fresco显示图片是，动态设置placeholder会显示问题。但是设置setImageUrl没有问题。那如何通过setImageUrl设置drawable中的图片呢？通过Uri即可。</p>
<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><p>具体的集中方式：</p>
<p>Uri uri = Uri.parse(“android.resource://“ + getPackageName() + “/raw/icon” );</p>
<p>Uri uri = Uri.parse(“android.resource://“ + getPackageName() + “/raw/“ +R.raw.icon);</p>
<p>Uri uri = Uri.parse(“android.resource://“ + getPackageName() + “/“ +R.raw.icon);</p>
<p>Uri uri = Uri.parse(“android.resource://“ + getPackageName() + “/“ +R.drawable.icon);</p>
<p>Uri uri = Uri.parse(“android.resource://“ + getPackageName() + “/xxxxxxx/icon” );</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a href="https://blog.csdn.net/guang_liang_/article/details/81939898" target="_blank" rel="noopener">Android Uri获取资源文件</a></p>

        
        
          <blockquote id="copyright">
              <p>Original link: <a href="http://nunu03.github.io/page/2/index.html">http://nunu03.github.io/page/2/index.html</a></p>
              <p>Copyright Notice: 转载请注明出处.</p>
          </blockquote>
        
      
    </div>
    <footer class="article-footer">
      
        <div class="article-tag-wrap">
          

          
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android/">Android</a></li></ul>

          
    <div class="social-share">
      <span>Share:</span>
    </div>



        </div>
      
      
      
    </footer>
  </div>
</article>


  <article id="post-GPUImage渲染流程解析" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/08/13/GPUImage渲染流程解析/">GPUImage渲染流程解析</a>
    </h1>
  


      </header>
    
    <div class="article-meta">
      
      <span class="article-date">
  <i class="fa fa-date"></i>
  <time class="dt-published" datetime="2020-08-13T09:25:22.000Z" itemprop="datePublished">2020年08月13日</time>
</span>
      
  <div class="article-category">
    <i class="fa fa-classify"></i>
    <a class="article-category-link" href="/categories/Android/">Android</a>
  </div>

      
      
<a href="/2020/08/13/GPUImage渲染流程解析/#comments" class="article-comment-link">
  
  <i class="fa fa-commt"></i>
  Guestbook
</a>


    </div>
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="渲染"><a href="#渲染" class="headerlink" title="渲染"></a>渲染</h2><h3 id="创建视图"><a href="#创建视图" class="headerlink" title="创建视图"></a>创建视图</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">//版本</span><br><span class="line">mGlSurfaceView.setEGLContextClientVersion(2);</span><br><span class="line">// 设置渲染器(这个渲染器的类非常重要)</span><br><span class="line">mGlSurfaceView.setRenderer(mRenderer);</span><br><span class="line">// 设置渲染模式为根据需要来渲染（RENDERMODE_CONTINUOUSLY）</span><br><span class="line">mGlSurfaceView.setRenderMode(GLSurfaceView.RENDERMODE_WHEN_DIRTY);</span><br><span class="line">mGlSurfaceView.requestRender();</span><br></pre></td></tr></table></figure>

<h3 id="坐标"><a href="#坐标" class="headerlink" title="坐标"></a>坐标</h3><ul>
<li><p>顶点坐标：在OpenGL中，顶点坐标使用的是笛卡尔右手坐标系（世界坐标系）。分X Y Z 3个轴，X轴朝右为正，Y轴朝上为正，Z轴垂直屏幕朝外为正。X Y Z 3个轴的最大与最小值为 1 和 -1。<br><img src="http://nunu03.github.io/2020/08/13/GPUImage%E6%B8%B2%E6%9F%93%E6%B5%81%E7%A8%8B%E8%A7%A3%E6%9E%90/%E9%A1%B6%E7%82%B9%E5%9D%90%E6%A0%87.png" alt></p>
</li>
<li><p>屏幕坐标：屏幕坐标系，就是应用在设备屏幕上的坐标系，也就是图形最终显示的地方。X轴朝右为正，Y轴朝下为正。<br><img src="http://nunu03.github.io/2020/08/13/GPUImage%E6%B8%B2%E6%9F%93%E6%B5%81%E7%A8%8B%E8%A7%A3%E6%9E%90/%E5%B1%8F%E5%B9%95%E5%9D%90%E6%A0%87.png" alt></p>
</li>
<li><p>纹理坐标：原点在左下角，X轴朝右为正，Y轴朝上为正，X Y 轴的最大与最小值为 0 和 1。<br><img src="http://nunu03.github.io/2020/08/13/GPUImage%E6%B8%B2%E6%9F%93%E6%B5%81%E7%A8%8B%E8%A7%A3%E6%9E%90/%E7%BA%B9%E7%90%86%E5%9D%90%E6%A0%87.png" alt></p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">//顶点坐标</span><br><span class="line">static final float VERTICE[] = &#123;</span><br><span class="line">            -1.0f, -1.0f,</span><br><span class="line">            1.0f, -1.0f,</span><br><span class="line">            -1.0f, 1.0f,</span><br><span class="line">            1.0f, 1.0f,</span><br><span class="line">    &#125;;</span><br><span class="line">//纹理坐标  对应顶点坐标  与之映射</span><br><span class="line">static final float TEXTURE[] = &#123;</span><br><span class="line">        0.0f, 0.0f,</span><br><span class="line">        1.0f, 0.0f,</span><br><span class="line">        0.0f, 1.0f,</span><br><span class="line">        1.0f, 1.0f,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>注意：纹理坐标与顶点坐标非必需一一对应，纹理的坐标会导致图片的缩放显示。</strong>  </p>
<h3 id="顶点着色器-Vertex-Shader-，片元着色器（Fragment-Shader）"><a href="#顶点着色器-Vertex-Shader-，片元着色器（Fragment-Shader）" class="headerlink" title="顶点着色器(Vertex Shader)，片元着色器（Fragment Shader）"></a>顶点着色器(Vertex Shader)，片元着色器（Fragment Shader）</h3><p>顶点着色器处理传入的顶点数据，包括顶点位置、顶点颜色、光照等，每个顶点都会执行一次。</p>
<p>片元着色器主要目的是计算一个像素的最终颜色。片元并不是真正意义上的像素。而是包含了很多状态的集合，这些状态用来计算最终颜色。这些状态包括但不限于它的屏幕坐标，深度信息，法线，纹理坐标等。</p>
<p>所以，顶点着色器用于绘制顶点，片元着色器用于给顶点连线后所包围的区域填充颜色，可以简单的理解成windows中画图的填充工具。所以下边是生成简单着色器的两个源码： <a href="https://www.jianshu.com/p/66b10062bd67" target="_blank" rel="noopener">GLSL基础语法介绍</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">public static final String NO_FILTER_VERTEX_SHADER = &quot;&quot; +</span><br><span class="line">	//顶点在画布中的位置</span><br><span class="line">	&quot;attribute vec4 position;\n&quot; + </span><br><span class="line">	// 纹理映射,纹理坐标是纹理映射的一部分。这意味着你想要对你的纹理进行某种滤镜操作的时候会用到它。</span><br><span class="line">	&quot;attribute vec4 inputTextureCoordinate;\n&quot; +</span><br><span class="line">	&quot; \n&quot; +</span><br><span class="line">	//变量,负责顶点着色器负责和片段着色器交流，以及信息的共享</span><br><span class="line">	&quot;varying vec2 textureCoordinate;\n&quot; +</span><br><span class="line">	&quot; \n&quot; +</span><br><span class="line">	&quot;void main()\n&quot; +</span><br><span class="line">	&quot;&#123;\n&quot; +</span><br><span class="line">	&quot;    gl_Position = position;\n&quot; +</span><br><span class="line">	//我们取出这个顶点中纹理坐标的 X 和 Y 的位置。我们只关心 inputTextureCoordinate 中的前两个参数，X 和 Y。这个坐标最开始是通过 4 个属性存在顶点着色器里的，但我们只需要其中的两个。</span><br><span class="line">	&quot;    textureCoordinate = inputTextureCoordinate.xy;\n&quot; +</span><br><span class="line">	&quot;&#125;&quot;;</span><br><span class="line">	</span><br><span class="line">	/**</span><br><span class="line">     * 这个着色器实际上不会改变图像中的任何东西。它是一个直通着色器，意味着我们输入每一个像素，然后输出完全相同的像素。</span><br><span class="line">     */</span><br><span class="line">public static final String NO_FILTER_FRAGMENT_SHADER = &quot;&quot; +</span><br><span class="line"></span><br><span class="line">   //因为片段着色器作用在每一个像素上，我们需要一个方法来确定我们当前在分析哪一个像素/片段。它需要存储像素的 X 和 Y 坐标。我们接收到的是当前在顶点着色器被设置好的纹理坐标。</span><br><span class="line">    &quot;varying highp vec2 textureCoordinate;\n&quot; +</span><br><span class="line">    &quot; \n&quot; +</span><br><span class="line">    //为了处理图像，我们从应用中接收一个图片的引用，我们把它当做一个 2D 的纹理。这个数据类型被叫做 sampler2D ，这是因为我们要从这个 2D 纹理中采样出一个点来进行处理。</span><br><span class="line">    &quot;uniform sampler2D inputImageTexture;\n&quot; +</span><br><span class="line">    &quot; \n&quot; +</span><br><span class="line">    &quot;void main()\n&quot; +</span><br><span class="line">    &quot;&#123;\n&quot; +</span><br><span class="line">    //这是一个 GLSL 特有的方法：texture2D，顾名思义，创建一个 2D 的纹理。它采用我们之前声明过的属性作为参数来决定被处理的像素的颜色。这个颜色然后被设置给另外一个内建变量，gl_FragColor。因为片段着色器的唯一目的就是确定一个像素的颜色，gl_FragColor 本质上就是我们片段着色器的返回语句。</span><br><span class="line">    &quot;     gl_FragColor = texture2D(inputImageTexture, textureCoordinate);\n&quot; +</span><br><span class="line">        &quot;&#125;&quot;;</span><br></pre></td></tr></table></figure>

<p>有了源码，我们就可以创建着色器：<br>我们首先要做的是创建一个着色器对象，注意还是用ID来引用的，所以我们储存这个顶点着色器的ID为unsigned int，然后用glCreateShader创建这个着色器，我们把需要创建的着色器类型以参数形式提供给glCreateShader，由于我们正在创建一个顶点着色器，传递的参数是GLES20.GL_VERTEX_SHADER</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">int iShader = GLES20.glCreateShader(GLES20.GL_VERTEX_SHADER);</span><br></pre></td></tr></table></figure>

<p>下一步我们把这个着色器源码附加到着色器对象上，然后编译它：第一个参数是要编译的着色器对象,第二参数指定了传递的源码字符串.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GLES20.glShaderSource(iShader, strSource);</span><br><span class="line">GLES20.glCompileShader(iShader);</span><br></pre></td></tr></table></figure>

<p>同时，我们要检测在调用glCompileShader后编译是否成功了，如果没成功的话，也希望知道错误是什么，这以便修复它们.如果结果非0，即编译成功。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">int[] compiled = new int[1]；</span><br><span class="line">GLES20.glGetShaderiv(iShader, GLES20.GL_COMPILE_STATUS, compiled, 0);</span><br><span class="line">        if (compiled[0] == 0) &#123;</span><br><span class="line">            Log.d(&quot;Load Shader Failed&quot;, &quot;Compilation\n&quot; + GLES20.glGetShaderInfoLog(iShader));</span><br><span class="line">            return 0;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<p>片元着色器的创建和顶点一样，知识参数不同和源码不同。参数类型是GLES20.GL_FRAGMENT_SHADER</p>
<h3 id="着色器程序"><a href="#着色器程序" class="headerlink" title="着色器程序"></a>着色器程序</h3><p>通过glCreateProgram函数创建一个程序，并返回新创建程序对象的ID引用，然后我们需要把之前编译的着色器附加到程序对象上，最后用glLinkProgram链接它们。着色器对象链接到程序对象以后，删除着色器对象。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">// 创建程序,返回对象的ID</span><br><span class="line">iProgId = GLES20.glCreateProgram();</span><br><span class="line">// 向程序中加入顶点着色器</span><br><span class="line">GLES20.glAttachShader(iProgId, iVShader);</span><br><span class="line">// 向程序中加入片元着色器</span><br><span class="line">GLES20.glAttachShader(iProgId, iFShader);</span><br><span class="line">// 链接程序</span><br><span class="line">GLES20.glLinkProgram(iProgId);</span><br><span class="line">// 获取program的链接情况</span><br><span class="line">GLES20.glGetProgramiv(iProgId, GLES20.GL_LINK_STATUS, link, 0);</span><br><span class="line">if (link[0] &lt;= 0) &#123;</span><br><span class="line">    Log.d(&quot;Load Program&quot;, &quot;Linking Failed&quot;);</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br><span class="line">GLES20.glDeleteShader(iVShader);</span><br><span class="line">GLES20.glDeleteShader(iFShader);</span><br><span class="line">// 获取着色器中的属性引用id(传入的字符串就是我们着色器脚本中的属性名)</span><br><span class="line">mGLAttribPosition = GLES20.glGetAttribLocation(mGLProgId, &quot;position&quot;);</span><br><span class="line">mGLUniformTexture = GLES20.glGetUniformLocation(mGLProgId, &quot;inputImageTexture&quot;);</span><br><span class="line">mGLAttribTextureCoordinate = GLES20.glGetAttribLocation(mGLProgId,</span><br><span class="line">                &quot;inputTextureCoordinate&quot;);</span><br><span class="line">//glClearColor为glClear清除颜色缓冲区时指定RGBA值（也就是所有的颜色都会被替换成指定的RGBA值）。每个值的取值范围都是0.0~1.0，超出范围的将被截断。</span><br><span class="line">GLES20.glClearColor(0, 0, 0, 1);</span><br></pre></td></tr></table></figure>

<h3 id="纹理ID"><a href="#纹理ID" class="headerlink" title="纹理ID"></a>纹理ID</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">public static int loadTexture(final IntBuffer data, final Size size, final int usedTexId) &#123;</span><br><span class="line">        int textures[] = new int[1];</span><br><span class="line">        if (usedTexId == NO_TEXTURE) &#123;</span><br><span class="line">            GLES20.glGenTextures(1, textures, 0);</span><br><span class="line">            GLES20.glBindTexture(GLES20.GL_TEXTURE_2D, textures[0]);</span><br><span class="line">            GLES20.glTexParameterf(GLES20.GL_TEXTURE_2D,</span><br><span class="line">                    GLES20.GL_TEXTURE_MAG_FILTER, GLES20.GL_LINEAR);</span><br><span class="line">            GLES20.glTexParameterf(GLES20.GL_TEXTURE_2D,</span><br><span class="line">                    GLES20.GL_TEXTURE_MIN_FILTER, GLES20.GL_LINEAR);</span><br><span class="line">            GLES20.glTexParameterf(GLES20.GL_TEXTURE_2D,</span><br><span class="line">                    GLES20.GL_TEXTURE_WRAP_S, GLES20.GL_CLAMP_TO_EDGE);</span><br><span class="line">            GLES20.glTexParameterf(GLES20.GL_TEXTURE_2D,</span><br><span class="line">                    GLES20.GL_TEXTURE_WRAP_T, GLES20.GL_CLAMP_TO_EDGE);</span><br><span class="line">            GLES20.glTexImage2D(GLES20.GL_TEXTURE_2D, 0, GLES20.GL_RGBA, size.width, size.height,</span><br><span class="line">                    0, GLES20.GL_RGBA, GLES20.GL_UNSIGNED_BYTE, data);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            GLES20.glBindTexture(GLES20.GL_TEXTURE_2D, usedTexId);</span><br><span class="line">            GLES20.glTexSubImage2D(GLES20.GL_TEXTURE_2D, 0, 0, 0, size.width,</span><br><span class="line">                    size.height, GLES20.GL_RGBA, GLES20.GL_UNSIGNED_BYTE, data);</span><br><span class="line">            textures[0] = usedTexId;</span><br><span class="line">        &#125;</span><br><span class="line">        return textures[0];</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="绘制"><a href="#绘制" class="headerlink" title="绘制"></a>绘制</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">// 使用某套shader程序</span><br><span class="line">GLES20.glUseProgram(mGLProgId);</span><br><span class="line">// 设置缓冲区起始位置</span><br><span class="line">cubeBuffer.position(0);</span><br><span class="line">// 顶点位置数据传入着色器,为画笔指定顶点位置数据(mGLAttribPosition)</span><br><span class="line">GLES20.glVertexAttribPointer(mGLAttribPosition, 2, GLES20.GL_FLOAT, false, 0, cubeBuffer);</span><br><span class="line">// 允许使用顶点坐标数组</span><br><span class="line">GLES20.glEnableVertexAttribArray(mGLAttribPosition);</span><br><span class="line">textureBuffer.position(0);</span><br><span class="line">// 纹理坐标数据传入着色器,为画笔指定纹理数据</span><br><span class="line">GLES20.glVertexAttribPointer(mGLAttribTextureCoordinate, 2, GLES20.GL_FLOAT, false, 0,</span><br><span class="line">        textureBuffer);</span><br><span class="line">GLES20.glEnableVertexAttribArray(mGLAttribTextureCoordinate);</span><br><span class="line">if (textureId != OpenGlUtils.NO_TEXTURE) &#123;</span><br><span class="line">	//设置纹理单元(sampler2D)</span><br><span class="line">    GLES20.glActiveTexture(GLES20.GL_TEXTURE0);</span><br><span class="line">    GLES20.glBindTexture(GLES20.GL_TEXTURE_2D, textureId);</span><br><span class="line">    //设置uniform采样器的位置值, 也就是mGLUniformTexture纹理单元。</span><br><span class="line">    GLES20.glUniform1i(mGLUniformTexture, 0);</span><br><span class="line">&#125;</span><br><span class="line">onDrawArraysPre();</span><br><span class="line">//// 绘制</span><br><span class="line">GLES20.glDrawArrays(GLES20.GL_TRIANGLE_STRIP, 0, 4);</span><br><span class="line">GLES20.glDisableVertexAttribArray(mGLAttribPosition);</span><br><span class="line">GLES20.glDisableVertexAttribArray(mGLAttribTextureCoordinate);</span><br></pre></td></tr></table></figure>

<h3 id="滤镜纹理"><a href="#滤镜纹理" class="headerlink" title="滤镜纹理"></a>滤镜纹理</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> protected void onDrawArraysPre() &#123;</span><br><span class="line">    if (mToneCurveTexture[0] != OpenGlUtils.NO_TEXTURE) &#123;</span><br><span class="line">        GLES20.glActiveTexture(GLES20.GL_TEXTURE3);</span><br><span class="line">        GLES20.glBindTexture(GLES20.GL_TEXTURE_2D, mToneCurveTexture[0]);</span><br><span class="line">        GLES20.glUniform1i(mToneCurveTextureUniformLocation, 3);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通过上述代码就可以实现纹理滤镜的效果了。但是这个滤镜的纹理是如何获取到的呢？<br>简单介绍两种方式：</p>
<h4 id="ps-acv-文件"><a href="#ps-acv-文件" class="headerlink" title="ps acv 文件"></a>ps acv 文件</h4><p>acv文件是ps用来设置曲线效果，不同曲线参数可以呈现出不同的滤镜效果。我们可以对acv文件进行读取，可以得到：Curves曲线信息数组，每个curvers可以分别获取到R,G,B 的PointF数组信息。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">public void setFromCurveFileInputStream(InputStream input) &#123;</span><br><span class="line">    try &#123;</span><br><span class="line">        int version = readShort(input);</span><br><span class="line">        int totalCurves = readShort(input);</span><br><span class="line">        ArrayList&lt;PointF[]&gt; curves = new ArrayList&lt;PointF[]&gt;(totalCurves);</span><br><span class="line">        float pointRate = 1.0f / 255;</span><br><span class="line"></span><br><span class="line">        for (int i = 0; i &lt; totalCurves; i++) &#123;</span><br><span class="line">            // 2 bytes, Count of points in the curve (short integer from 2...19)</span><br><span class="line">            short pointCount = readShort(input);</span><br><span class="line">            PointF[] points = new PointF[pointCount];</span><br><span class="line">            // point count * 4</span><br><span class="line">            // Curve points. Each curve point is a pair of short integers where</span><br><span class="line">            // the first number is the output value (vertical coordinate on the</span><br><span class="line">            // Curves dialog graph) and the second is the input value. All coordinates have range 0 to 255.</span><br><span class="line">            for (int j = 0; j &lt; pointCount; j++) &#123;</span><br><span class="line">                short y = readShort(input);</span><br><span class="line">                short x = readShort(input);</span><br><span class="line"></span><br><span class="line">                points[j] = new PointF(x * pointRate, y * pointRate);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            curves.add(points);</span><br><span class="line">        &#125;</span><br><span class="line">        input.close();</span><br><span class="line"></span><br><span class="line">        mRgbCompositeControlPoints = curves.get(0);</span><br><span class="line">        mRedControlPoints = curves.get(1);</span><br><span class="line">        mGreenControlPoints = curves.get(2);</span><br><span class="line">        mBlueControlPoints = curves.get(3);</span><br><span class="line">    &#125; catch (IOException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后根据RGB信息生成纹理：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"> // 设置纹理单元</span><br><span class="line">GLES20.glActiveTexture(GLES20.GL_TEXTURE3);</span><br><span class="line">// 绑定纹理</span><br><span class="line">GLES20.glBindTexture(GLES20.GL_TEXTURE_2D, mToneCurveTexture[0]);</span><br><span class="line"></span><br><span class="line">if ((mRedCurve.size() &gt;= 256) &amp;&amp; (mGreenCurve.size() &gt;= 256) &amp;&amp; (mBlueCurve.size() &gt;= 256) &amp;&amp; (mRgbCompositeCurve.size() &gt;= 256)) &#123;</span><br><span class="line">    byte[] toneCurveByteArray = new byte[256 * 4];</span><br><span class="line">    for (int currentCurveIndex = 0; currentCurveIndex &lt; 256; currentCurveIndex++) &#123;</span><br><span class="line">        // BGRA for upload to texture</span><br><span class="line">        toneCurveByteArray[currentCurveIndex * 4 + 2] = (byte) ((int) Math.min(Math.max(currentCurveIndex + mBlueCurve.get(currentCurveIndex) + mRgbCompositeCurve.get(currentCurveIndex), 0), 255) &amp; 0xff);</span><br><span class="line">        toneCurveByteArray[currentCurveIndex * 4 + 1] = (byte) ((int) Math.min(Math.max(currentCurveIndex + mGreenCurve.get(currentCurveIndex) + mRgbCompositeCurve.get(currentCurveIndex), 0), 255) &amp; 0xff);</span><br><span class="line">        toneCurveByteArray[currentCurveIndex * 4] = (byte) ((int) Math.min(Math.max(currentCurveIndex + mRedCurve.get(currentCurveIndex) + mRgbCompositeCurve.get(currentCurveIndex), 0), 255) &amp; 0xff);</span><br><span class="line">        toneCurveByteArray[currentCurveIndex * 4 + 3] = (byte) (255 &amp; 0xff);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    GLES20.glTexImage2D(GLES20.GL_TEXTURE_2D, 0, GLES20.GL_RGBA, 256 /*width*/, 1 /*height*/, 0, GLES20.GL_RGBA, GLES20.GL_UNSIGNED_BYTE, ByteBuffer.wrap(toneCurveByteArray));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="图片纹理"><a href="#图片纹理" class="headerlink" title="图片纹理"></a>图片纹理</h4><p>通过图片生成纹理ID,也就是滤镜图片：看一看资源文件目录信息：<br><img src="http://nunu03.github.io/2020/08/13/GPUImage%E6%B8%B2%E6%9F%93%E6%B5%81%E7%A8%8B%E8%A7%A3%E6%9E%90/%E7%BA%B9%E7%90%86%E5%9B%BE%E7%89%87.png" alt></p>
<p>下面是json和着色器源码：</p>
<ul>
<li><p>json</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;filterList&quot;: [&#123;</span><br><span class="line">        &quot;type&quot;: &quot;filter&quot;,</span><br><span class="line">        &quot;name&quot;: &quot;amaro&quot;,</span><br><span class="line">        &quot;vertexShader&quot;: &quot;&quot;,</span><br><span class="line">        &quot;fragmentShader&quot;: &quot;fragment.glsl&quot;,</span><br><span class="line">        &quot;uniformList&quot;:[&quot;blowoutTexture&quot;, &quot;overlayTexture&quot;, &quot;mapTexture&quot;],</span><br><span class="line">        &quot;uniformData&quot;: &#123;</span><br><span class="line">            &quot;blowoutTexture&quot;: &quot;blowout.png&quot;,</span><br><span class="line">            &quot;overlayTexture&quot;: &quot;overlay.png&quot;,</span><br><span class="line">            &quot;mapTexture&quot;: &quot;map.png&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;strength&quot;: 1.0,</span><br><span class="line">        &quot;texelOffset&quot;: 0,</span><br><span class="line">        &quot;audioPath&quot;: &quot;&quot;,</span><br><span class="line">        &quot;audioLooping&quot;: 1</span><br><span class="line">    &#125;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>fragment.glsl内容</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">precision mediump float;</span><br><span class="line"> </span><br><span class="line">varying mediump vec2 textureCoordinate;</span><br><span class="line"> </span><br><span class="line">uniform sampler2D inputTexture;</span><br><span class="line">uniform sampler2D blowoutTexture; //blowout;</span><br><span class="line">uniform sampler2D overlayTexture; //overlay;</span><br><span class="line">uniform sampler2D mapTexture; //map</span><br><span class="line"> </span><br><span class="line">uniform float strength;</span><br><span class="line"></span><br><span class="line">void main()</span><br><span class="line">&#123;</span><br><span class="line">    vec4 originColor = texture2D(inputTexture, textureCoordinate.xy);</span><br><span class="line">    vec4 texel = texture2D(inputTexture, textureCoordinate.xy);</span><br><span class="line">    vec3 bbTexel = texture2D(blowoutTexture, textureCoordinate.xy).rgb;</span><br><span class="line"></span><br><span class="line">    texel.r = texture2D(overlayTexture, vec2(bbTexel.r, texel.r)).r;</span><br><span class="line">    texel.g = texture2D(overlayTexture, vec2(bbTexel.g, texel.g)).g;</span><br><span class="line">    texel.b = texture2D(overlayTexture, vec2(bbTexel.b, texel.b)).b;</span><br><span class="line"></span><br><span class="line">    vec4 mapped;</span><br><span class="line">    mapped.r = texture2D(mapTexture, vec2(texel.r, 0.16666)).r;</span><br><span class="line">    mapped.g = texture2D(mapTexture, vec2(texel.g, 0.5)).g;</span><br><span class="line">    mapped.b = texture2D(mapTexture, vec2(texel.b, 0.83333)).b;</span><br><span class="line">    mapped.a = 1.0;</span><br><span class="line"></span><br><span class="line">    mapped.rgb = mix(originColor.rgb, mapped.rgb, strength);</span><br><span class="line"></span><br><span class="line">    gl_FragColor = mapped;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<h3 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h3><p><img src="http://nunu03.github.io/2020/08/13/GPUImage%E6%B8%B2%E6%9F%93%E6%B5%81%E7%A8%8B%E8%A7%A3%E6%9E%90/%E6%95%88%E6%9E%9C%E5%9B%BE.jpg" alt></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">static final float TEXTURE[] = &#123;</span><br><span class="line">            0.0f, 1.0f,</span><br><span class="line">            1.0f, 1.0f,</span><br><span class="line">            0.0f, 0.0f,</span><br><span class="line">            1.0f, 0.0f,</span><br><span class="line">    &#125;;</span><br></pre></td></tr></table></figure>

<p><img src="http://nunu03.github.io/2020/08/13/GPUImage%E6%B8%B2%E6%9F%93%E6%B5%81%E7%A8%8B%E8%A7%A3%E6%9E%90/%E6%AD%A3%E7%A1%AE%E7%BA%B9%E7%90%86.png" alt></p>
<h3 id="渲染流程总结"><a href="#渲染流程总结" class="headerlink" title="渲染流程总结"></a>渲染流程总结</h3><p><img src="http://nunu03.github.io/2020/08/13/GPUImage%E6%B8%B2%E6%9F%93%E6%B5%81%E7%A8%8B%E8%A7%A3%E6%9E%90/%E6%B8%B2%E6%9F%93%E6%B5%81%E7%A8%8B.png" alt><br>染流程如下：顶点数据(Vertices) &gt; 顶点着色器(Vertex Shader) &gt; 图元装配(Assembly) &gt; 几何着色器(Geometry Shader) &gt; 光栅化(Rasterization) &gt; 片元着色器(Fragment Shader) &gt; 逐片元处理(Per-Fragment Operations) &gt; 帧缓冲(FrameBuffer)。再经过双缓冲的交换(SwapBuffer)，渲染内容就显示到了屏幕上。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>根据渲染流程，我们知道，美颜的操作即是对着色器编码的源码进行编写。采用不同的算法，实现不同的美颜功能。同时滤镜的纹理，可以是ps的acv文件，也可以是图片，着色器源码针对不同的 资源分别解析和使用。</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a href="https://juejin.im/post/6844903878740148231#heading-0" target="_blank" rel="noopener">OpenGL ES</a></p>
<p><a href="https://www.cnblogs.com/zhxmdefj/p/11192408.html" target="_blank" rel="noopener">OpenGL入门1.2：渲染管线简介，画三角形</a></p>
<p><a href="https://blog.csdn.net/dengchukun/category_9281212.html" target="_blank" rel="noopener">GLES2.0中文API</a></p>
<p><a href="https://www.jianshu.com/p/cb55d8f2b4d0" target="_blank" rel="noopener">OpenGLES 绘制图片纹理</a></p>

        
        
          <blockquote id="copyright">
              <p>Original link: <a href="http://nunu03.github.io/page/2/index.html">http://nunu03.github.io/page/2/index.html</a></p>
              <p>Copyright Notice: 转载请注明出处.</p>
          </blockquote>
        
      
    </div>
    <footer class="article-footer">
      
        <div class="article-tag-wrap">
          

          
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/FaceUnity/">FaceUnity</a></li></ul>

          
    <div class="social-share">
      <span>Share:</span>
    </div>



        </div>
      
      
      
    </footer>
  </div>
</article>


  <article id="post-美颜相关概念" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/08/05/美颜相关概念/">美颜相关概念</a>
    </h1>
  


      </header>
    
    <div class="article-meta">
      
      <span class="article-date">
  <i class="fa fa-date"></i>
  <time class="dt-published" datetime="2020-08-05T09:31:12.000Z" itemprop="datePublished">2020年08月05日</time>
</span>
      
  <div class="article-category">
    <i class="fa fa-classify"></i>
    <a class="article-category-link" href="/categories/Video/">Video</a>
  </div>

      
      
<a href="/2020/08/05/美颜相关概念/#comments" class="article-comment-link">
  
  <i class="fa fa-commt"></i>
  Guestbook
</a>


    </div>
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="图像深度-amp-像素深度"><a href="#图像深度-amp-像素深度" class="headerlink" title="图像深度&amp;像素深度"></a>图像深度&amp;像素深度</h2><p>图像深度是指存储每个像素所用的位数，它也是用来度量图像的色彩分辨率的。它确定了彩色图像的每个像素可能有的色彩数，或者确定灰度图像的每个像素可能有的灰度级数。它决定了色彩图像中可能出现的最多的色彩数，或者灰度图像中的最大灰度等级。 </p>
<p>中文名        图像深度<br>特    点    量度图像的色彩分辨率<br>含    义    指存储每个像素所用的位数<br>类    型    确定彩色图像颜色数<br>1.基本概念<br>图像深度是单个像素点的色彩详细度,如16位(65536色),32位等。比如一幅单色图像,若每个像素有8位,则最大灰度数目为2的8次方,即256.一幅彩色图像RGB3个温良的像素位数分别为4,4,2,则最大颜色数目为2的4+4+2次方,即1024,就是说像素的深度为10位,每个像素可以是1024种颜色中的一种，例如：一幅画的尺寸是1024*768，深度为16，则它的数据量为1.5M。</p>
<h2 id="卷积"><a href="#卷积" class="headerlink" title="卷积"></a>卷积</h2><h3 id="线性滤波与卷积的基本概念"><a href="#线性滤波与卷积的基本概念" class="headerlink" title="线性滤波与卷积的基本概念"></a>线性滤波与卷积的基本概念</h3><p><a href="https://www.cnblogs.com/xiaojianliu/p/9075872.html" target="_blank" rel="noopener">数字图像处理中滤波和卷积操作详细说明</a> </p>
<p>线性滤波可以说是图像处理最基本的方法，它可以允许我们对图像进行处理，产生很多不同的效果。做法很简单。首先，我们有一个二维的滤波器矩阵（有个高大上的名字叫卷积核）和一个要处理的二维图像。然后，对于图像的每一个像素点，计算它的邻域像素和滤波器矩阵的对应元素的乘积，然后加起来，作为该像素位置的值。这样就完成了滤波过程。<br><img src="http://nunu03.github.io/2020/08/05/%E7%BE%8E%E9%A2%9C%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5/%E5%8D%B7%E7%A7%AF.png" alt><br>对图像和滤波矩阵进行逐个元素相乘再求和的操作就相当于将一个二维的函数移动到另一个二维函数的所有位置，这个操作就叫卷积或者协相关。卷积和协相关的差别是，卷积需要先对滤波矩阵进行180的翻转，但如果矩阵是对称的，那么两者就没有什么差别了。</p>
<p> Correlation 和 Convolution可以说是图像处理最基本的操作，但却非常有用。这两个操作有两个非常关键的特点：它们是线性的，而且具有平移不变性shift-invariant。平移不变性指我们在图像的每个位置都执行相同的操作。线性指这个操作是线性的，也就是我们用每个像素的邻域的线性组合来代替这个像素。这两个属性使得这个操作非常简单，因为线性操作是最简单的，然后在所有地方都做同样的操作就更简单了。</p>
<ul>
<li><p>实际上，在信号处理领域，卷积有广泛的意义，而且有其严格的数学定义，但在这里不关注这个。</p>
</li>
<li><p>2D卷积需要4个嵌套循环4-double loop，所以它并不快，除非我们使用很小的卷积核。这里一般使用3x3或者5x5。而且，对于滤波器，也有一定的规则要求：</p>
<p>1）滤波器的大小应该是奇数，这样它才有一个中心，例如3x3，5x5或者7x7。有中心了，也有了半径的称呼，例如5x5大小的核的半径就是2。</p>
<p>2）滤波器矩阵所有的元素之和应该要等于1，这是为了保证滤波前后图像的亮度保持不变。当然了，这不是硬性要求了。</p>
<p>3）如果滤波器矩阵所有元素之和大于1，那么滤波后的图像就会比原图像更亮，反之，如果小于1，那么得到的图像就会变暗。如果和为0，图像不会变黑，但也会非常暗。</p>
<p>4）对于滤波后的结构，可能会出现负数或者大于255的数值。对这种情况，我们将他们直接截断到0和255之间即可。对于负数，也可以取绝对值。</p>
</li>
</ul>
<h3 id="边界补充方法"><a href="#边界补充方法" class="headerlink" title="边界补充方法"></a>边界补充方法</h3><p>上面的图片说明了图像的卷积操作，但是他也反映出一个问题，如上图，原始图片尺寸为7<em>7，卷积核的大小为3</em>3，当卷积核沿着图片滑动后只能滑动出一个5*5的图片出来，这就造成了卷积后的图片和卷积前的图片尺寸不一致，这显然不是我们想要的结果，所以为了避免这种情况，需要先对原始图片做边界填充处理。</p>
<p><img src="http://nunu03.github.io/2020/08/05/%E7%BE%8E%E9%A2%9C%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5/%E5%A1%AB%E5%85%85.png" alt></p>
<h4 id="常用卷积核及其意义"><a href="#常用卷积核及其意义" class="headerlink" title="常用卷积核及其意义"></a>常用卷积核及其意义</h4><h5 id="一个没有任何作用的卷积核"><a href="#一个没有任何作用的卷积核" class="headerlink" title="一个没有任何作用的卷积核"></a>一个没有任何作用的卷积核</h5><p>卷积核：<br>这里写图片描述<br>将原像素中间像素值乘1，其余全部乘0，显然像素值不会发生任何变化。</p>
<h5 id="平滑均值滤波"><a href="#平滑均值滤波" class="headerlink" title="平滑均值滤波"></a>平滑均值滤波</h5><p>卷积核：<br>这里写图片描述<br>该卷积核的作用在于取九个值的平均值代替中间像素值，所以起到的平滑的效果：。</p>
<h5 id="高斯平滑"><a href="#高斯平滑" class="headerlink" title="高斯平滑"></a>高斯平滑</h5><p>卷积核：<br>这里写图片描述<br>高斯平滑水平和垂直方向呈现高斯分布，更突出了中心点在像素平滑后的权重，相比于均值滤波而言，有着更好的平滑效果。 </p>
<h5 id="图像锐化"><a href="#图像锐化" class="headerlink" title="图像锐化"></a>图像锐化</h5><p>卷积核： </p>
<p>该卷积利用的其实是图像中的边缘信息有着比周围像素更高的对比度，而经过卷积之后进一步增强了这种对比度，从而使图像显得棱角分明、画面清晰，起到锐化图像的效果。 </p>
<h5 id="梯度Prewitt"><a href="#梯度Prewitt" class="headerlink" title="梯度Prewitt"></a>梯度Prewitt</h5><p>梯度Prewitt卷积核与Soble卷积核的选定是类似的，都是对水平边缘或垂直边缘有比较好的检测效果。</p>
<h5 id="Soble边缘检测："><a href="#Soble边缘检测：" class="headerlink" title="Soble边缘检测："></a>Soble边缘检测：</h5><p>Soble与上述卷积核不同之处在于，Soble更强调了和边缘相邻的像素点对边缘的影响。 </p>
<h5 id="梯度Laplacian"><a href="#梯度Laplacian" class="headerlink" title="梯度Laplacian"></a>梯度Laplacian</h5><p>卷积核：<br>这里写图片描述</p>
<p>Laplacian也是一种锐化方法，同时也可以做边缘检测，而且边缘检测的应用中并不局限于水平方向或垂直方向，这是Laplacian与soble的区别。</p>
<p>回到目录</p>
<h3 id="卷积的计算"><a href="#卷积的计算" class="headerlink" title="卷积的计算"></a>卷积的计算</h3><p>对图像处理而言，存在两大类的方法：空域处理和频域处理！空域处理是指直接对原始的像素空间进行计算，频率处理是指先对图像变换到频域，再做滤波等处理。 </p>
<p>空域计算-直接2D卷积<br>直接2D卷积就是一开始说的那样，对于图像的每一个像素点，计算它的邻域像素和滤波器矩阵的对应元素的乘积，然后加起来，作为该像素位置的值。</p>
<p>直接的实现也称为暴力实现brute force，因为它严格按照定义来实现，没有任何优化。当然了，在并行实现里面，它也是比较灵活的。另外，也存在一个优化版本，如果我们的kernel是separable可分的。</p>
<p>频域计算-快速傅里叶变换FFT卷积<br> 这个快速实现得益于卷积定理：时域上的卷积等于频域上的乘积。所以将我们的图像和滤波器通过算法变换到频域后，直接将他们相乘，然后再变换回时域（也就是图像的空域）就可以了。</p>
<p>o表示矩阵逐元素相乘。那用什么方法将空域的图像和滤波器变换到频域了。</p>

        
        
          <blockquote id="copyright">
              <p>Original link: <a href="http://nunu03.github.io/page/2/index.html">http://nunu03.github.io/page/2/index.html</a></p>
              <p>Copyright Notice: 转载请注明出处.</p>
          </blockquote>
        
      
    </div>
    <footer class="article-footer">
      
        <div class="article-tag-wrap">
          

          
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/FaceUnity/">FaceUnity</a></li></ul>

          
    <div class="social-share">
      <span>Share:</span>
    </div>



        </div>
      
      
      
    </footer>
  </div>
</article>


  <article id="post-Android-CMake" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/08/05/Android-CMake/">Android CMake</a>
    </h1>
  


      </header>
    
    <div class="article-meta">
      
      <span class="article-date">
  <i class="fa fa-date"></i>
  <time class="dt-published" datetime="2020-08-05T02:49:48.000Z" itemprop="datePublished">2020年08月05日</time>
</span>
      
  <div class="article-category">
    <i class="fa fa-classify"></i>
    <a class="article-category-link" href="/categories/NDK/">NDK</a>
  </div>

      
      
<a href="/2020/08/05/Android-CMake/#comments" class="article-comment-link">
  
  <i class="fa fa-commt"></i>
  Guestbook
</a>


    </div>
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="目的"><a href="#目的" class="headerlink" title="目的"></a>目的</h2><p>向您的项目添加 C 和 C++ 代码。提供 CMake 或 ndk-build 脚本文件的路径以配置 Gradle。Gradle 使用构建脚本将源代码导入您的 Android Studio 项目并将原生库（SO 文件）打包到 APK 中。</p>
<h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>CMake是一个跨平台的安装（编译）工具，可以用简单的语句来描述所有平摊的安装编译过程。它能够输出各种各样的makefile或者project文件，能测试编译器所支持的C++特性，类似UNIX下的automake。</p>
<h2 id="配置CMake-3-6-0-或-3-10-2"><a href="#配置CMake-3-6-0-或-3-10-2" class="headerlink" title="配置CMake 3.6.0 或 3.10.2"></a>配置CMake 3.6.0 或 3.10.2</h2><h3 id="CMake-3-6-0-或-3-10-2"><a href="#CMake-3-6-0-或-3-10-2" class="headerlink" title="CMake 3.6.0 或 3.10.2"></a>CMake 3.6.0 或 3.10.2</h3><p>SDK 管理器包含 CMake 的 3.6.0 派生版本和版本 3.10.2。未在 build.gradle 中设置特定 CMake 版本的项目均使用 CMake 3.10.2 进行构建。要使用之前包含的版本，请在模块的 build.gradle 文件中指定 CMake 版本 3.6.0：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">    ...</span><br><span class="line">    externalNativeBuild &#123;</span><br><span class="line">        cmake &#123;</span><br><span class="line">            ...</span><br><span class="line">            version &quot;3.6.0&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>您可以指定此 CMake 版本作为最低版本，只需在 build.gradle 条目的末尾添加一个“+”即可，例如 3.10.2+。不过，这并非最佳做法。</p>
<h3 id="使用自定义-CMake-版本"><a href="#使用自定义-CMake-版本" class="headerlink" title="使用自定义 CMake 版本"></a>使用自定义 CMake 版本</h3><p>如果您想使用 SDK 管理器中未包含的 CMake 版本 3.7 或更高版本，请按以下步骤操作：</p>
<p>1.从官方 CMake 网站下载并安装 <a href="https://cmake.org/download/" target="_blank" rel="noopener">CMake 3.7 或更高版本</a>。<br>2.指定您想要让 Gradle 在模块的 build.gradle 文件中使用的 CMake 版本：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">    ...</span><br><span class="line">    externalNativeBuild &#123;</span><br><span class="line">        cmake &#123;</span><br><span class="line">            ...</span><br><span class="line">            version &quot;cmake-version&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3.将 CMake 的安装路径添加到 PATH 环境变量，或将其添加到项目的 local.properties 文件中，具体步骤如下所示。如果 Gradle 找不到您在 build.gradle 文件中指定的 CMake 版本，您便会遇到构建错误。<br>    # If you set this property, Gradle no longer uses PATH to find CMake.<br>    cmake.dir=”path-to-cmake”</p>
<p>4.如果您尚未在工作站上安装 Ninja 构建系统，请访问 Ninja 官方网站，然后下载并安装适用于您的操作系统的最新版 Ninja。此外，请务必将 Ninja 的安装路径也添加到 PATH 环境变量。</p>
<h2 id="创建支持-C-C-的新项目"><a href="#创建支持-C-C-的新项目" class="headerlink" title="创建支持 C/C++ 的新项目"></a>创建支持 C/C++ 的新项目</h2><p>创建支持原生代码的新项目的步骤与创建任何其他 Android Studio 项目的步骤相似，但前者还需要执行一个额外的步骤：</p>
<p>1.在向导的 Choose your project 部分中，选择 Native C++ 项目类型。<br>2.点击 Next。<br>3.填写向导下一部分中的所有其他字段。<br>4.点击 Next。<br>5.在向导的 Customize C++ Support 部分中，您可以使用 C++ Standard 字段来自定义项目。使用下拉列表选择您想要使用哪种 C++ 标准化。选择 Toolchain Default 可使用默认的 CMake 设置。<br>6.点击 Finish。<br><img src="http://nunu03.github.io/2020/08/05/Android-CMake/cmake%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84.png" alt></p>
<h2 id="原有项目支持-C-C"><a href="#原有项目支持-C-C" class="headerlink" title="原有项目支持 C/C++"></a>原有项目支持 C/C++</h2><p><img src="http://nunu03.github.io/2020/08/05/Android-CMake/cmake%E5%8A%A0%E5%85%A5%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84.png" alt></p>
<h2 id="配置-CMake"><a href="#配置-CMake" class="headerlink" title="配置 CMake"></a>配置 CMake</h2><p>CMake 构建脚本是一个纯文本文件，您必须将其命名为 CMakeLists.txt，并在其中包含 CMake 构建您的 C/C++ 库时需要使用的命令。如果您的原生源代码文件还没有 CMake 构建脚本，您需要自行创建一个，并在其中包含适当的 CMake 命令。</p>
<p>本部分将介绍您应该在构建脚本中包含哪些基本命令，以便指示 CMake 在创建原生库时使用哪些源代码文件。如需了解详情，请参阅介绍 <a href="https://cmake.org/cmake/help/latest/manual/cmake-commands.7.html" target="_blank" rel="noopener">CMake 命令的官方文档</a>。</p>
<p>在配置新的 CMake 构建脚本后，您需要<a href="https://developer.android.com/studio/projects/gradle-external-native-builds" target="_blank" rel="noopener">配置 Gradle</a> 以将 CMake 项目作为构建依赖项包含在内，从而让 Gradle 构建原生库，并将其与应用的 APK 打包在一起。</p>
<ul>
<li>注意：如果项目使用的是 ndk-build，您不需要创建 CMake 构建脚本。您只需配置 Gradle 以包含现有的原生库项目即可；为此，您需要提供 Android.mk 文件的路径。</li>
</ul>
<h3 id="创建-CMake-构建脚本"><a href="#创建-CMake-构建脚本" class="headerlink" title="创建 CMake 构建脚本"></a>创建 CMake 构建脚本</h3><p>要创建一个可以用作 CMake 构建脚本的纯文本文件，请按以下步骤操作：</p>
<p>1.从 IDE 的左侧打开 Project 窗格，然后从下拉菜单中选择 Project 视图。<br>2.右键点击 your-module 的根目录，然后依次选择 New &gt; File。</p>
<ul>
<li>注意：您可以在所需的任何位置创建构建脚本。不过，在配置构建脚本时，原生源代码文件和库的路径将与构建脚本的位置相关。</li>
</ul>
<p>3.输入“CMakeLists.txt”作为文件名，然后点击 OK。<br>现在，您可以通过添加 CMake 命令来配置您的构建脚本。要指示 CMake 根据原生源代码创建原生库，请向您的构建脚本添加 cmake_minimum_required() 和 add_library() 命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># Sets the minimum version of CMake required to build your native library.</span><br><span class="line"># This ensures that a certain set of CMake features is available to</span><br><span class="line"># your build.</span><br><span class="line"></span><br><span class="line">cmake_minimum_required(VERSION 3.4.1)</span><br><span class="line"></span><br><span class="line"># Specifies a library name, specifies whether the library is STATIC or</span><br><span class="line"># SHARED, and provides relative paths to the source code. You can</span><br><span class="line"># define multiple libraries by adding multiple add_library() commands,</span><br><span class="line"># and CMake builds them for you. When you build your app, Gradle</span><br><span class="line"># automatically packages shared libraries with your APK.</span><br><span class="line"></span><br><span class="line">add_library( # Specifies the name of the library.</span><br><span class="line">             native-lib</span><br><span class="line"></span><br><span class="line">             # Sets the library as a shared library.</span><br><span class="line">             SHARED</span><br><span class="line"></span><br><span class="line">             # Provides a relative path to your source file(s).</span><br><span class="line">             src/main/cpp/native-lib.cpp )</span><br></pre></td></tr></table></figure>

<ul>
<li>提示：与指示 CMake 根据源代码文件创建原生库的方式一样，您可以使用 add_executable() 命令指示 CMake 改为根据这些源代码文件来创建可执行文件。不过，根据原生源代码文件构建可执行文件是可选操作，构建原生库以将其打包到 APK 中即可满足大多数项目的要求。</li>
</ul>
<p>在使用 add_library() 向 CMake 构建脚本添加源代码文件或库时，Android Studio 还会在您同步项目后在 Project 视图中显示相关的头文件。不过，为了让 CMake 能够在编译时找到头文件，您需要向 CMake 构建脚本添加 include_directories() 命令，并指定头文件的路径：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">add_library(...)</span><br><span class="line"></span><br><span class="line"># Specifies a path to native header files.</span><br><span class="line">include_directories(src/main/cpp/include/)</span><br></pre></td></tr></table></figure>

<p>CMake 使用以下规范来为库文件命名：</p>
<p>liblibrary-name.so<br>例如，如果您在构建脚本中指定“native-lib”作为共享库的名称，CMake 就会创建一个名为 libnative-lib.so 的文件。不过，在 Java 或 Kotlin 代码中加载此库时，请使用您在 CMake 构建脚本中指定的名称：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">static &#123;</span><br><span class="line">    System.loadLibrary(&quot;native-lib&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>注意：如果重命名或移除了 CMake 构建脚本中的库，您需要在 Gradle 实施相关更改或从 APK 中移除旧版库之前清理您的项目。要清理项目，请在菜单栏中依次选择 Build &gt; Clean Project。</li>
</ul>
<p>Android Studio 会自动向 Project 窗格中的 cpp 群组添加源代码文件和头文件。通过使用多个 add_library() 命令，您可以为 CMake 定义要根据其他源代码文件构建的更多库。</p>
<h3 id="添加-NDK-API"><a href="#添加-NDK-API" class="headerlink" title="添加 NDK API"></a>添加 NDK API</h3><p>Android NDK 提供了一套您可能会觉得非常实用的原生 API 和库。通过在项目的 CMakeLists.txt 脚本文件中包含 NDK 库，您可以使用其中任何 API。</p>
<p>Android 平台上已存在预构建的 NDK 库，因此您无需构建它们或将它们打包到 APK 中。由于这些 NDK 库已位于 CMake 搜索路径中，因此您甚至无需指定本地安装的 NDK 库的位置，您只需为 CMake 提供您想要使用的库的名称，并将其与您自己的原生库相关联即可。</p>
<p>向 CMake 构建脚本添加 find_library() 命令以找到 NDK 库并将其路径存储为一个变量。您可以使用此变量在构建脚本的其他部分引用 NDK 库。以下示例可以找到 Android 专有的日志支持库，并会将其路径存储在 log-lib 中：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">find_library( # Defines the name of the path variable that stores the</span><br><span class="line">              # location of the NDK library.</span><br><span class="line">              log-lib</span><br><span class="line"></span><br><span class="line">              # Specifies the name of the NDK library that</span><br><span class="line">              # CMake needs to locate.</span><br><span class="line">              log )</span><br></pre></td></tr></table></figure>

<p>为了让您的原生库能够调用 log 库中的函数，您需要使用 CMake 构建脚本中的 target_link_libraries() 命令来关联这些库：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">find_library(...)</span><br><span class="line"></span><br><span class="line"># Links your native library against one or more other native libraries.</span><br><span class="line">target_link_libraries( # Specifies the target library.</span><br><span class="line">                       native-lib</span><br><span class="line"></span><br><span class="line">                       # Links the log library to the target library.</span><br><span class="line">                       $&#123;log-lib&#125; )</span><br></pre></td></tr></table></figure>

<p>NDK 还以源代码的形式包含一些库，您将需要构建这些代码并将其关联到您的原生库。您可以使用 CMake 构建脚本中的 add_library() 命令将源代码编译到原生库中。如需提供本地 NDK 库的路径，您可以使用 Android Studio 自动为您定义的 ANDROID_NDK 路径变量。</p>
<p>以下命令告诉 CMake 要构建 android_native_app_glue.c（负责管理 NativeActivity 生命周期事件和触摸输入），并将其链接到静态库 native-lib 中：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">add_library( app-glue</span><br><span class="line">             STATIC</span><br><span class="line">             $&#123;ANDROID_NDK&#125;/sources/android/native_app_glue/android_native_app_glue.c )</span><br><span class="line"></span><br><span class="line"># You need to link static libraries against your shared native library.</span><br><span class="line">target_link_libraries( native-lib app-glue $&#123;log-lib&#125; )</span><br></pre></td></tr></table></figure>

<h3 id="添加其他预构建库"><a href="#添加其他预构建库" class="headerlink" title="添加其他预构建库"></a>添加其他预构建库</h3><p>添加预构建库的步骤与为 CMake 指定其他要构建的原生库的步骤相似。不过，由于库已构建，因此您需要使用 IMPORTED 标记告诉 CMake 您只想要将此库导入到您的项目中。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">add_library( imported-lib</span><br><span class="line">             SHARED</span><br><span class="line">             IMPORTED )</span><br></pre></td></tr></table></figure>

<p>然后，您需要使用 set_target_properties() 命令指定库的路径，具体步骤如下所示。</p>
<p>某些库会针对特定的 CPU 架构或应用二进制接口 (ABI) 提供单独的软件包，并将其整理到单独的目录中。此方法既有助于库充分利用特定的 CPU 架构，又能让您只使用所需的库版本。要向 CMake 构建脚本添加库的多个 ABI 版本，而不必为库的每个版本编写多个命令，您可以使用 ANDROID_ABI 路径变量。此变量使用的是 NDK 支持的一组默认 ABI，或者您手动配置 Gradle 以使用的一组经过过滤的 ABI。例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">add_library(...)</span><br><span class="line">set_target_properties( # Specifies the target library.</span><br><span class="line">                       imported-lib</span><br><span class="line"></span><br><span class="line">                       # Specifies the parameter you want to define.</span><br><span class="line">                       PROPERTIES IMPORTED_LOCATION</span><br><span class="line"></span><br><span class="line">                       # Provides the path to the library you want to import.</span><br><span class="line">                       imported-lib/src/$&#123;ANDROID_ABI&#125;/libimported-lib.so )</span><br></pre></td></tr></table></figure>

<p>为了让 CMake 能够在编译时定位您的头文件，您需要使用 include_directories() 命令并包含相应头文件的路径：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">include_directories( imported-lib/include/ )</span><br></pre></td></tr></table></figure>

<ul>
<li>注意：如果您想要打包不属于构建时依赖项的预构建库（例如在添加属于 imported-lib 依赖项的预构建库时），则无需按以下说明操作来关联库。</li>
</ul>
<p>如需将预构建库关联到您自己的原生库，请将其添加到 CMake 构建脚本的 target_link_libraries() 命令中：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">target_link_libraries( native-lib imported-lib app-glue $&#123;log-lib&#125; )</span><br></pre></td></tr></table></figure>

<p>如需将预构建库打包到 APK 中，您需要使用 sourceSets 块手动配置 Gradle 以包含 .so 文件的路径。构建 APK 后，您可以使用 APK 分析器验证 Gradle 会将哪些库打包到您的 APK 中。</p>
<h3 id="包含其他-CMake-项目"><a href="#包含其他-CMake-项目" class="headerlink" title="包含其他 CMake 项目"></a>包含其他 CMake 项目</h3><p>如果想要构建多个 CMake 项目并在 Android 项目中包含它们的输出，您可以使用一个 CMakeLists.txt 文件（即您关联到 Gradle 的那个文件）作为顶级 CMake 构建脚本，并添加其他 CMake 项目作为此构建脚本的依赖项。以下顶级 CMake 构建脚本会使用 add_subdirectory() 命令将另一个 CMakeLists.txt 文件指定为构建依赖项，然后关联其输出，就像处理任何其他预构建库一样。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"># Sets lib_src_DIR to the path of the target CMake project.</span><br><span class="line">set( lib_src_DIR ../gmath )</span><br><span class="line"></span><br><span class="line"># Sets lib_build_DIR to the path of the desired output directory.</span><br><span class="line">set( lib_build_DIR ../gmath/outputs )</span><br><span class="line">file(MAKE_DIRECTORY $&#123;lib_build_DIR&#125;)</span><br><span class="line"></span><br><span class="line"># Adds the CMakeLists.txt file located in the specified directory</span><br><span class="line"># as a build dependency.</span><br><span class="line">add_subdirectory( # Specifies the directory of the CMakeLists.txt file.</span><br><span class="line">                  $&#123;lib_src_DIR&#125;</span><br><span class="line"></span><br><span class="line">                  # Specifies the directory for the build outputs.</span><br><span class="line">                  $&#123;lib_build_DIR&#125; )</span><br><span class="line"></span><br><span class="line"># Adds the output of the additional CMake build as a prebuilt static</span><br><span class="line"># library and names it lib_gmath.</span><br><span class="line">add_library( lib_gmath STATIC IMPORTED )</span><br><span class="line">set_target_properties( lib_gmath PROPERTIES IMPORTED_LOCATION</span><br><span class="line">                       $&#123;lib_build_DIR&#125;/$&#123;ANDROID_ABI&#125;/lib_gmath.a )</span><br><span class="line">include_directories( $&#123;lib_src_DIR&#125;/include )</span><br><span class="line"></span><br><span class="line"># Links the top-level CMake build output against lib_gmath.</span><br><span class="line">target_link_libraries( native-lib ... lib_gmath )</span><br></pre></td></tr></table></figure>

<h2 id="关联Gradle"><a href="#关联Gradle" class="headerlink" title="关联Gradle"></a>关联Gradle</h2><h3 id="手动配置-Gradle"><a href="#手动配置-Gradle" class="headerlink" title="手动配置 Gradle"></a>手动配置 Gradle</h3><p>要手动配置 Gradle 以关联到您的原生库，您需要将 externalNativeBuild 块添加到模块级 build.gradle 文件中，并使用 cmake 或 ndkBuild 块对其进行配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">android &#123;</span><br><span class="line">  ...</span><br><span class="line">  defaultConfig &#123;...&#125;</span><br><span class="line">  buildTypes &#123;...&#125;</span><br><span class="line"></span><br><span class="line">  // Encapsulates your external native build configurations.</span><br><span class="line">  externalNativeBuild &#123;</span><br><span class="line"></span><br><span class="line">    // Encapsulates your CMake build configurations.</span><br><span class="line">    cmake &#123;</span><br><span class="line"></span><br><span class="line">      // Provides a relative path to your CMake build script.</span><br><span class="line">      path &quot;CMakeLists.txt&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>注意：如果您要将 Gradle 关联到现有的 ndk-build 项目，请使用 ndkBuild 块（而不是 cmake 块），并提供指向 Android.mk 文件的相对路径。如果 Application.mk 文件与您的 Android.mk 文件位于同一目录下，Gradle 也会包含此文件。</li>
</ul>
<h3 id="指定可选配置"><a href="#指定可选配置" class="headerlink" title="指定可选配置"></a>指定可选配置</h3><p>您可以在模块级 build.gradle 文件的 defaultConfig 块中配置另一个 externalNativeBuild 块，为 CMake 或 ndk-build 指定可选参数和标记。与 defaultConfig 块中的其他属性类似，您也可以在构建配置中为每种产品特性重写这些属性。</p>
<p>例如，如果您的 CMake 或 ndk-build 项目定义多个原生库和可执行文件，您可以使用 targets 属性为指定产品特性构建和打包其中的部分工件。以下代码示例说明了您可以配置的部分属性：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">android &#123;</span><br><span class="line">  ...</span><br><span class="line">  defaultConfig &#123;</span><br><span class="line">    ...</span><br><span class="line">    // This block is different from the one you use to link Gradle</span><br><span class="line">    // to your CMake or ndk-build script.</span><br><span class="line">    externalNativeBuild &#123;</span><br><span class="line"></span><br><span class="line">      // For ndk-build, instead use the ndkBuild block.</span><br><span class="line">      cmake &#123;</span><br><span class="line"></span><br><span class="line">        // Passes optional arguments to CMake.</span><br><span class="line">        arguments &quot;-DANDROID_ARM_NEON=TRUE&quot;, &quot;-DANDROID_TOOLCHAIN=clang&quot;</span><br><span class="line"></span><br><span class="line">        // Sets a flag to enable format macro constants for the C compiler.</span><br><span class="line">        cFlags &quot;-D__STDC_FORMAT_MACROS&quot;</span><br><span class="line"></span><br><span class="line">        // Sets optional flags for the C++ compiler.</span><br><span class="line">        cppFlags &quot;-fexceptions&quot;, &quot;-frtti&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  buildTypes &#123;...&#125;</span><br><span class="line"></span><br><span class="line">  productFlavors &#123;</span><br><span class="line">    ...</span><br><span class="line">    demo &#123;</span><br><span class="line">      ...</span><br><span class="line">      externalNativeBuild &#123;</span><br><span class="line">        cmake &#123;</span><br><span class="line">          ...</span><br><span class="line">          // Specifies which native libraries or executables to build and package</span><br><span class="line">          // for this product flavor. The following tells Gradle to build only the</span><br><span class="line">          // &quot;native-lib-demo&quot; and &quot;my-executible-demo&quot; outputs from the linked</span><br><span class="line">          // CMake project. If you don&apos;t configure this property, Gradle builds all</span><br><span class="line">          // executables and shared object libraries that you define in your CMake</span><br><span class="line">          // (or ndk-build) project. However, by default, Gradle packages only the</span><br><span class="line">          // shared libraries in your APK.</span><br><span class="line">          targets &quot;native-lib-demo&quot;,</span><br><span class="line">                  // You need to specify this executable and its sources in your CMakeLists.txt</span><br><span class="line">                  // using the add_executable() command. However, building executables from your</span><br><span class="line">                  // native sources is optional, and building native libraries to package into</span><br><span class="line">                  // your APK satisfies most project requirements.</span><br><span class="line">                  &quot;my-executible-demo&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    paid &#123;</span><br><span class="line">      ...</span><br><span class="line">      externalNativeBuild &#123;</span><br><span class="line">        cmake &#123;</span><br><span class="line">          ...</span><br><span class="line">          targets &quot;native-lib-paid&quot;,</span><br><span class="line">                  &quot;my-executible-paid&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // Use this block to link Gradle to your CMake or ndk-build script.</span><br><span class="line">  externalNativeBuild &#123;</span><br><span class="line">    cmake &#123;...&#125;</span><br><span class="line">    // or ndkBuild &#123;...&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如需详细了解如何配置产品变种和构建变体，请参阅配置构建变体。如需了解您可以使用 arguments 属性为 CMake 配置的变量列表，请参阅使用 CMake 变量。</p>
<h3 id="添加预构建的原生库"><a href="#添加预构建的原生库" class="headerlink" title="添加预构建的原生库"></a>添加预构建的原生库</h3><p>如果您希望 Gradle 将预构建的原生库打包到您的 APK 中，请修改默认的源代码集配置，以添加预构建 .so 文件所在的目录，如下所示。请注意，若要添加关联到 Gradle 的 CMake 构建脚本的工件，则无需执行此操作。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">    ...</span><br><span class="line">    sourceSets &#123;</span><br><span class="line">        main &#123;</span><br><span class="line">            jniLibs.srcDirs &apos;imported-lib/src/&apos;, &apos;more-imported-libs/src/&apos;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="指定-ABI"><a href="#指定-ABI" class="headerlink" title="指定 ABI"></a>指定 ABI</h3><p>默认情况下，Gradle 会针对 NDK 支持的应用二进制接口 (ABI) 将您的原生库构建到单独的 .so 文件中，并将这些文件全部打包到您的 APK 中。如果您希望 Gradle 仅构建和打包原生库的部分 ABI 配置，则可以在模块级 build.gradle 文件中使用 ndk.abiFilters 标记指定这些配置，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">  ...</span><br><span class="line">  defaultConfig &#123;</span><br><span class="line">    ...</span><br><span class="line">    externalNativeBuild &#123;</span><br><span class="line">      cmake &#123;...&#125;</span><br><span class="line">      // or ndkBuild &#123;...&#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // Similar to other properties in the defaultConfig block,</span><br><span class="line">    // you can configure the ndk block for each product flavor</span><br><span class="line">    // in your build configuration.</span><br><span class="line">    ndk &#123;</span><br><span class="line">      // Specifies the ABI configurations of your native</span><br><span class="line">      // libraries Gradle should build and package with your APK.</span><br><span class="line">      abiFilters &apos;x86&apos;, &apos;x86_64&apos;, &apos;armeabi&apos;, &apos;armeabi-v7a&apos;,</span><br><span class="line">                   &apos;arm64-v8a&apos;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  buildTypes &#123;...&#125;</span><br><span class="line">  externalNativeBuild &#123;...&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在大多数情况下，您只需要在 ndk 块中指定 abiFilters（如上所示），因为它会指示 Gradle 构建和打包原生库的这些版本。但是，如果您想控制 Gradle 应当构建的配置，而不依赖于您希望其打包到 APK 中的配置，请在 defaultConfig.externalNativeBuild.cmake 块（或 defaultConfig.externalNativeBuild.ndkBuild 块）中配置另一个 abiFilters 标记。Gradle 会构建这些 ABI 配置，但只会打包您在 defaultConfig.ndk 块中指定的配置。</p>
<p>为了进一步降低 APK 的大小，请考虑基于 ABI 配置多个 APK，而不是创建一个包含原生库所有版本的大型 APK。Gradle 会为您想要支持的每个 ABI 创建单独的 APK，并且仅打包每个 ABI 需要的文件。如果您为每个 ABI 配置多个 APK，而不像上面的代码示例中所示的那样指定 abiFilters 标记，则 Gradle 会为您的原生库构建所有受支持的 ABI 版本，但是仅打包您在多 APK 配置中指定的版本。为避免构建不想要的原生库版本，请为 abiFilters 标记和“一个 ABI 多个 APK”配置提供相同的 ABI 列表。</p>
<h2 id="异常问题"><a href="#异常问题" class="headerlink" title="异常问题"></a>异常问题</h2><p><img src="http://nunu03.github.io/2020/08/05/Android-CMake/%E5%BC%82%E5%B8%B81.png" alt><br><img src="http://nunu03.github.io/2020/08/05/Android-CMake/%E5%BC%82%E5%B8%B82.jpeg" alt></p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a href="https://developer.android.com/studio/projects" target="_blank" rel="noopener">developer.android.com</a></p>

        
        
          <blockquote id="copyright">
              <p>Original link: <a href="http://nunu03.github.io/page/2/index.html">http://nunu03.github.io/page/2/index.html</a></p>
              <p>Copyright Notice: 转载请注明出处.</p>
          </blockquote>
        
      
    </div>
    <footer class="article-footer">
      
        <div class="article-tag-wrap">
          

          
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CMake/">CMake</a></li></ul>

          
    <div class="social-share">
      <span>Share:</span>
    </div>



        </div>
      
      
      
    </footer>
  </div>
</article>


  <article id="post-Wireshark使用及数据分析" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/07/07/Wireshark使用及数据分析/">Wireshark使用及数据分析</a>
    </h1>
  


      </header>
    
    <div class="article-meta">
      
      <span class="article-date">
  <i class="fa fa-date"></i>
  <time class="dt-published" datetime="2020-07-07T02:24:16.000Z" itemprop="datePublished">2020年07月07日</time>
</span>
      
  <div class="article-category">
    <i class="fa fa-classify"></i>
    <a class="article-category-link" href="/categories/Tools/">Tools</a>
  </div>

      
      
<a href="/2020/07/07/Wireshark使用及数据分析/#comments" class="article-comment-link">
  
  <i class="fa fa-commt"></i>
  Guestbook
</a>


    </div>
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>以直播消息采集和分析数据为例进行讲解。</p>
<h2 id="采集"><a href="#采集" class="headerlink" title="采集"></a>采集</h2>
        
        
          <blockquote id="copyright">
              <p>Original link: <a href="http://nunu03.github.io/page/2/index.html">http://nunu03.github.io/page/2/index.html</a></p>
              <p>Copyright Notice: 转载请注明出处.</p>
          </blockquote>
        
      
    </div>
    <footer class="article-footer">
      
        <div class="article-tag-wrap">
          

          
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Wireshark/">Wireshark</a></li></ul>

          
    <div class="social-share">
      <span>Share:</span>
    </div>



        </div>
      
      
      
    </footer>
  </div>
</article>



    <nav id="page-nav">

<a class="extend prev" rel="prev" href="/">Previous</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/3/">Next</a>
</nav>


</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title"><i class="fa fa-posts"></i> Recent</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2022/05/29/Android知识点整理/">Android知识点整理</a>
          </li>
        
          <li>
            <a href="/2022/05/29/hello-world/">Hexo 配置</a>
          </li>
        
          <li>
            <a href="/2022/04/08/epic原理浅析/">epic原理浅析</a>
          </li>
        
          <li>
            <a href="/2022/02/16/python-设置Host代理/">Python设置Host代理</a>
          </li>
        
          <li>
            <a href="/2021/12/27/Pngquant-图片压缩/">Pngquant-图片压缩</a>
          </li>
        
      </ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title"><i class="fa fa-tag"></i> Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Android/" style="font-size: 20px;">Android</a> <a href="/tags/CMake/" style="font-size: 10px;">CMake</a> <a href="/tags/Charles/" style="font-size: 13.33px;">Charles</a> <a href="/tags/Color/" style="font-size: 10px;">Color</a> <a href="/tags/FaceUnity/" style="font-size: 16.67px;">FaceUnity</a> <a href="/tags/Fix/" style="font-size: 10px;">Fix</a> <a href="/tags/Flutter/" style="font-size: 10px;">Flutter</a> <a href="/tags/GitLab/" style="font-size: 10px;">GitLab</a> <a href="/tags/Gradle/" style="font-size: 20px;">Gradle</a> <a href="/tags/Haar/" style="font-size: 10px;">Haar</a> <a href="/tags/Hexo/" style="font-size: 10px;">Hexo</a> <a href="/tags/Hook/" style="font-size: 10px;">Hook</a> <a href="/tags/Kotlin/" style="font-size: 10px;">Kotlin</a> <a href="/tags/Log/" style="font-size: 10px;">Log</a> <a href="/tags/OpenCV/" style="font-size: 10px;">OpenCV</a> <a href="/tags/Python/" style="font-size: 10px;">Python</a> <a href="/tags/Title/" style="font-size: 10px;">Title</a> <a href="/tags/Toast/" style="font-size: 10px;">Toast</a> <a href="/tags/View/" style="font-size: 10px;">View</a> <a href="/tags/WebHook/" style="font-size: 10px;">WebHook</a> <a href="/tags/Wireshark/" style="font-size: 10px;">Wireshark</a> <a href="/tags/Xposed/" style="font-size: 13.33px;">Xposed</a> <a href="/tags/aar/" style="font-size: 10px;">aar</a> <a href="/tags/cmd/" style="font-size: 10px;">cmd</a> <a href="/tags/ngrok/" style="font-size: 13.33px;">ngrok</a> <a href="/tags/nps/" style="font-size: 10px;">nps</a> <a href="/tags/人脸检测/" style="font-size: 10px;">人脸检测</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title"><i class="fa fa-classify"></i> Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a><span class="category-list-count">14</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Charles/">Charles</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Flutter/">Flutter</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/GitLab/">GitLab</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Gradle/">Gradle</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Hexo/">Hexo</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Kotlin/">Kotlin</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Log/">Log</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Log/Fix/">Fix</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/NDK/">NDK</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/OpenCV/">OpenCV</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tools/">Tools</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Video/">Video</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/WebHook/">WebHook</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/WebHook/ngrok/">ngrok</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/cmd/">cmd</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ngrok/">ngrok</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/ngrok/nps/">nps</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/人脸检测/">人脸检测</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/人脸检测/Haar/">Haar</a><span class="category-list-count">1</span></li></ul></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title"><i class="fa fa-archive"></i> Archive</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/">2022年</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/">2021年</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/">2020年</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/">2019年</a><span class="archive-list-count">16</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title"><i class="fa fa-tag"></i> Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android/">Android</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CMake/">CMake</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Charles/">Charles</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Color/">Color</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/FaceUnity/">FaceUnity</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Fix/">Fix</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Flutter/">Flutter</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GitLab/">GitLab</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Gradle/">Gradle</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Haar/">Haar</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hexo/">Hexo</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hook/">Hook</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Kotlin/">Kotlin</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Log/">Log</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OpenCV/">OpenCV</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/">Python</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Title/">Title</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Toast/">Toast</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/View/">View</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WebHook/">WebHook</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Wireshark/">Wireshark</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Xposed/">Xposed</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/aar/">aar</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cmd/">cmd</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ngrok/">ngrok</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nps/">nps</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/人脸检测/">人脸检测</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title"><i class="fa fa-link"></i> Blogroll</h3>
    <div class="widget">
      <ul>
      
        <li>
          <a href="http://www.example1.com/">site-name1</a>
        </li>
      
        <li>
          <a href="http://www.example2.com/">site-name2</a>
        </li>
      
        <li>
          <a href="http://www.example3.com/">site-name3</a>
        </li>
      
      </ul>
    </div>
  </div>


  
</aside>
        
      </div>
      <a id="totop" href="#top"></a>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      <p>
        <a href="/sitemap.xml">Site Map</a>
        <span> | </span><a href="/atom.xml">Subscribe to this site</a>
        <span> | </span><a href="/about/">Contact the blogger</a>
      </p>
      
        <p>
          <i class="fa fa-visitors"></i>
          <i id="busuanzi_container_site_uv"><i id="busuanzi_value_site_uv"></i></i>
          ，
          <i class="fa fa-views"></i>
          <i id="busuanzi_container_site_pv"><i id="busuanzi_value_site_pv"></i></i>
        </p>
      
      <p>
        <span>Copyright &copy; 2022 Nunu Long.</span>
        <span>Theme by <a href="https://github.com/chaooo/hexo-theme-BlueLake/" target="_blank">BlueLake.</a></span>
        <span>Powered by <a href="https://hexo.io/" target="_blank">Hexo.</a></span>
      </p>
    </div>
  </div>
</footer>

    </div>
  </div>
  <script src="/js/jquery-3.4.1.min.js"></script>
<script src="/js/search.json.js"></script>

  <script src="/fancybox/jquery.fancybox.min.js"></script>


<script src="/js/script.js"></script>





  <script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>







  



</body>
</html>