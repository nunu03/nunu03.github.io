<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  
  
  <title>Glide图片加载框架原理 | chenyulong</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
    <meta name="description" content="Nunu&#39;s blog!">
  
  
    <meta name="keywords" content="Nunu">
  
  
    <link rel="alternate" href="/atom.xml" title="chenyulong">
  
  
    <link rel="shortcut icon" href="/css/images/avatar.jpg">
  
  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">
  
  <link rel="stylesheet" href="/css/style.css">
  
    <link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">
  
  
    <link rel="stylesheet" href="/localshare/css/share.css">
  
  
  
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">chenyulong</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">理论是你知道是这样，但它却不好用；实践是它很好用，但你不知道是为什么；程序员将理论和实践结合到一起：既不好用，也不知道是为什么。</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        
          <a class="main-nav-link" href="/."><i class="fa fa-home"></i> 首页</a>
        
          <a class="main-nav-link" href="/archives"><i class="fa fa-rss"></i> 归档</a>
        
          <a class="main-nav-link" href="/categories/"><i class="fa fa-archive"></i> 分类</a>
        
          <a class="main-nav-link" href="/tags/"><i class="fa fa-user"></i> 标签</a>
        
      </nav>
    </div>
    <div id="search-form">
      <div id="result-mask" class="hide"></div>
      <label><input id="search-key" type="text" autocomplete="off" placeholder="search"></label>
      <div id="result-wrap" class="hide">
        <div id="search-result"></div>
      </div>
      <div class="hide">
        <template id="search-tpl">
          <div class="item">
            <a href="/{path}" title="{title}">
              <div class="title">{title}</div>
              <div class="time">{date}</div>
              <div class="tags">{tags}</div>
            </a>
          </div>
        </template>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-Glide图片加载框架原理" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      Glide图片加载框架原理
    </h1>
  


      </header>
    
    <div class="article-meta">
      
      <span class="article-date">
  <i class="fa fa-date"></i>
  <time class="dt-published" datetime="2022-06-08T01:29:39.000Z" itemprop="datePublished">2022年06月08日</time>
</span>
      
  <div class="article-category">
    <i class="fa fa-classify"></i>
    <a class="article-category-link" href="/categories/Android/">Android</a>
  </div>

      
        <span class="article-views">
  <i class="fa fa-views"></i>
  <i id="busuanzi_container_page_pv">
      <i id="busuanzi_value_page_pv"></i>
  </i>
</span>

      
      
<a href="/2022/06/08/Glide图片加载框架原理/#comments" class="article-comment-link">
  
    
    
    
    
    
  
  <i class="fa fa-commt"></i>
  Guestbook
</a>


    </div>
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="什么是Glide"><a href="#什么是Glide" class="headerlink" title="什么是Glide"></a>什么是Glide</h2><p>Glide是一个快速高效的图片加载库(Android)，性能高，流式API的语法特点。</p>
<h2 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h2><ul>
<li>1.可配置高，自适应度高；</li>
<li>2.支持多种数据源，本地，网络，assets，gif再glide中都是支持的；</li>
<li>3.高效缓存，支持memory和disk图片缓存，默认使用二级缓存；</li>
<li>4.具有和AF同步的生命周期；</li>
<li>5.高效处理Bitmap：使用Bitmap pool复用Bitmap，享元设计模式；</li>
<li>6.图片接在过程可以监听。<a id="more"></a>
<h2 id="性能"><a href="#性能" class="headerlink" title="性能"></a>性能</h2>Glide 充分考虑了Android图片加载性能的两个关键方面：</li>
<li>图片解码速度</li>
<li>解码图片带来的资源压力<br>为了让用户拥有良好的App使用体验，图片不仅要快速加载，而且还不能因为过多的主线程I/O或频繁的垃圾回收导致页面的闪烁和抖动现象。</li>
</ul>
<p>Glide使用了多个步骤来确保在Android上加载图片尽可能的快速和平滑：</p>
<ul>
<li>自动、智能地下采样(downsampling)和缓存(caching)，以最小化存储开销和解码次数；</li>
<li>积极的资源重用，例如字节数组和Bitmap，以最小化昂贵的垃圾回收和堆碎片影响；</li>
<li>深度的生命周期集成，以确保仅优先处理活跃的Fragment和Activity的请求，并有利于应用在必要时释放资源以避免在后台时被杀掉。<h2 id="架构"><a href="#架构" class="headerlink" title="架构"></a>架构</h2>图片请求，是发送到一个队列里，然后多个线程进行消费。如下图：<br><img src="http://nunu03.github.io/2022/06/08/Glide%E5%9B%BE%E7%89%87%E5%8A%A0%E8%BD%BD%E6%A1%86%E6%9E%B6%E5%8E%9F%E7%90%86/glide-jg.png" alt><h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><h3 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">repositories &#123;</span><br><span class="line">  google()</span><br><span class="line">  mavenCentral()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dependencies &#123;</span><br><span class="line">  implementation &apos;com.github.bumptech.glide:glide:4.11.0&apos;</span><br><span class="line">  annotationProcessor &apos;com.github.bumptech.glide:compiler:4.11.0&apos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="加载"><a href="#加载" class="headerlink" title="加载"></a>加载</h3><p>this是imageview绑定的生命周期对象（Activity或Fragment）。<br><img src="http://nunu03.github.io/2022/06/08/Glide%E5%9B%BE%E7%89%87%E5%8A%A0%E8%BD%BD%E6%A1%86%E6%9E%B6%E5%8E%9F%E7%90%86/glide-this.png" alt></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">RequestOptions requestOptions = new RequestOptions();</span><br><span class="line">Glide.with(this)</span><br><span class="line">    .load(&quot;https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fi0&quot;)</span><br><span class="line">    .addListener(new RequestListener&lt;Drawable&gt;() &#123;</span><br><span class="line">        @Override</span><br><span class="line">        public boolean onLoadFailed(@Nullable GlideException e, Object model, Target&lt;Drawable&gt; target, boolean isFirstResource) &#123;</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public boolean onResourceReady(Drawable resource, Object model, Target&lt;Drawable&gt; target, DataSource dataSource, boolean isFirstResource) &#123;</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    .centerCrop()</span><br><span class="line">    .placeholder(R.drawable.ic_launcher_background)</span><br><span class="line">    .error(R.drawable.ic_launcher_foreground)</span><br><span class="line">    .override(100,100)</span><br><span class="line">    .apply(requestOptions)</span><br><span class="line">    .into(img);</span><br></pre></td></tr></table></figure>

<p>override,默认使用xml设置，如果这里设置，就使用override设置大小。也可以通过RequestOptions设置。</p>
<h3 id="取消加载"><a href="#取消加载" class="headerlink" title="取消加载:"></a>取消加载:</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Glide.with(this).clear(imageView);</span><br></pre></td></tr></table></figure>

<p>尽管及时取消不必要的加载是很好的实践，但这并不是必须的操作。实际上，当 Glide.with() 中传入的 Activity 或 Fragment 实例销毁时，Glide 会自动取消加载并回收资源。</p>
<h3 id="过度"><a href="#过度" class="headerlink" title="过度"></a>过度</h3><p>再加载图片过程中，可以定义glide如何从占位到新加载的图片，或从缩略图到全尺寸图像的过度。再这些过程中，可以设置过渡动画。Glide默认实现了交叉淡入效果。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">DrawableCrossFadeFactory fadeFactory = new DrawableCrossFadeFactory.Builder().setCrossFadeEnabled(true).build();</span><br><span class="line"></span><br><span class="line">Glide.with(this)</span><br><span class="line">  .transition(DrawableTransitionOptions.with(fadeFactory))</span><br><span class="line">  .into(img);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Glide.with(this)</span><br><span class="line">  .transition(DrawableTransitionOptions.with(3000))</span><br><span class="line">  .into(img);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Glide.with(this).asBitmap()</span><br><span class="line">  .transition(BitmapTransitionOptions.with(3000))</span><br><span class="line">  .into(img);</span><br></pre></td></tr></table></figure>

<p>不幸的是，虽然禁用交叉淡入通常是一个比较好的默认行为，当待加载的图片包含透明像素时仍然可能造成问题。当占位符比实际加载的图片要大，或者图片部分为透明时，禁用交叉淡入会导致动画完成后占位符在图片后面仍然可见。如果你在加载透明图片时使用了占位符，你可以启用交叉淡入，具体办法是调整 DrawableCrossFadeFactory 里的参数并将结果传到 transition() 中：<br>为了提升性能，请在使用 Glide 向 ListView , GridView, 或 RecyclerView 加载图片时考虑避免使用动画，尤其是大多数情况下，你希望图片被尽快缓存和加载的时候。</p>
<h3 id="变换"><a href="#变换" class="headerlink" title="变换"></a>变换</h3><p>在Glide中，Transformations 可以获取资源并修改它，然后返回被修改后的资源。通常变换操作是用来完成剪裁或对位图应用过滤器，但它也可以用于转换GIF动画，甚至自定义的资源类型。<br>Glide 提供了很多内置的变换，包括：</p>
<ul>
<li>CenterCrop</li>
<li>FitCenter</li>
<li>CircleCrop<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Glide.with(fragment)</span><br><span class="line">  .load(url)</span><br><span class="line">  .fitCenter()</span><br><span class="line">  .into(imageView);</span><br><span class="line"></span><br><span class="line">或使用 RequestOptions ：</span><br><span class="line"></span><br><span class="line">RequestOptions options = new RequestOptions();</span><br><span class="line">options.centerCrop();</span><br><span class="line"></span><br><span class="line">Glide.with(fragment)</span><br><span class="line">    .load(url)</span><br><span class="line">    .apply(options)</span><br><span class="line">    .into(imageView);</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>这里的变换指的是多重变换：默认情况下，每个 transform() 调用，或任何特定转换方法(fitCenter(), centerCrop(), bitmapTransform() etc)的调用都会替换掉之前的变换。<br>如果你想在单次加载中应用多个变换，请使用 MultiTransformation 类，或其快捷方法 .transforms() 。<br>比如：</p>
<ul>
<li>1.CircleCrop：圆角</li>
<li>2.RoundedCorners:内个叫统一指定</li>
<li>3.GranularRoundedCorners:四个角单独指定</li>
<li>4.Rotate：旋转<br>看下图效果：<br><img src="http://nunu03.github.io/2022/06/08/Glide%E5%9B%BE%E7%89%87%E5%8A%A0%E8%BD%BD%E6%A1%86%E6%9E%B6%E5%8E%9F%E7%90%86/glide-circle.png" alt><br>其他效果，自行调试。<br>其中变换还有定制变换，重用变变换，具体自行看文档。<h3 id="Generated-API"><a href="#Generated-API" class="headerlink" title="Generated API"></a>Generated API</h3>添加 Glide 注解处理器的依赖：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">  annotationProcessor &apos;com.github.bumptech.glide:compiler:4.11.0&apos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>在 Application 模块中包含一个 AppGlideModule 的实现：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import com.bumptech.glide.annotation.GlideModule;</span><br><span class="line">import com.bumptech.glide.module.AppGlideModule;</span><br><span class="line"></span><br><span class="line">@GlideModule</span><br><span class="line">public final class MyAppGlideModule extends AppGlideModule &#123;&#125;</span><br></pre></td></tr></table></figure>

<p>Generated API 默认名为 GlideApp ，与 Application 模块中 AppGlideModule的子类包名相同。在 Application 模块中将 Glide.with() 替换为 GlideApp.with()，即可使用该 API 去完成加载工作：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">GlideApp.with(fragment)</span><br><span class="line">   .load(myUrl)</span><br><span class="line">   .placeholder(R.drawable.placeholder)</span><br><span class="line">   .fitCenter()</span><br><span class="line">   .into(imageView);</span><br><span class="line">```   </span><br><span class="line">与 Glide.with() 不同，诸如 fitCenter() 和 placeholder() 等选项在 Builder 中直接可用，并不需要再传入单独的 RequestOptions 对象。</span><br><span class="line">### GlideExtension &amp; GlideOption</span><br><span class="line">Option扩展类，可以自定义实现选项配置。使用Glide更加简单。**变换效果不能配置**</span><br></pre></td></tr></table></figure>

<p>@GlideExtension<br>public class MyAppExtension {<br>// Size of mini thumb in pixels.<br>private static final int MINI_THUMB_SIZE = 100;</p>
<p>private MyAppExtension() { } // utility class</p>
<p>//静态方法，BaseRequestOptions的扩展，封装了一些options的配置方法。<br>@NonNull<br>@GlideOption<br>public static BaseRequestOptions<?> miniThumb(BaseRequestOptions<?> options) {<br>return options<br>    .fitCenter()<br>    .override(MINI_THUMB_SIZE);<br>}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">之后你就可以使用生成的 GlideApp 类调用你的自定义方法：</span><br></pre></td></tr></table></figure>

<p>GlideApp.with(fragment)<br>   .load(url)<br>   .miniThumb(thumbnailSize)<br>   .into(imageView);   </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">## 源码分析</span><br><span class="line"></span><br><span class="line">根据Glide分成三条主线：</span><br><span class="line"></span><br><span class="line">### with</span><br><span class="line"></span><br><span class="line">with返回的是RequestManager对象</span><br></pre></td></tr></table></figure>

<p>public static RequestManager with(@NonNull FragmentActivity activity) {<br>    return getRetriever(activity).get(activity);<br>}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">最总会进入这个方法：这里会给Glide添加生命周期。</span><br></pre></td></tr></table></figure>

<p>@NonNull<br>public RequestManager get(@NonNull FragmentActivity activity) {<br>    //如果不是主线程，则没有生命周期<br>    if (Util.isOnBackgroundThread()) {<br>        return get(activity.getApplicationContext());<br>    } else {<br>        assertNotDestroyed(activity);<br>        //主线程，添加了一个空白的Fragment，通过空白的Fragment监听this的生命周期。<br>        FragmentManager fm = activity.getSupportFragmentManager();<br>        return supportFragmentGet(activity, fm, /<em>parentHint=</em>/ null, isActivityVisible(activity));<br>    }<br>}</p>
<p>private RequestManager supportFragmentGet(<br>    @NonNull Context context,<br>    @NonNull FragmentManager fm,<br>    @Nullable Fragment parentHint,<br>    boolean isParentVisible) {<br>    SupportRequestManagerFragment current =<br>        getSupportRequestManagerFragment(fm, parentHint, isParentVisible);<br>    RequestManager requestManager = current.getRequestManager();<br>    if (requestManager == null) {<br>        Glide glide = Glide.get(context);<br>        requestManager =<br>            factory.build(<br>                glide, current.getGlideLifecycle(), current.getRequestManagerTreeNode(), context);<br>        current.setRequestManager(requestManager);<br>    }<br>    return requestManager;<br>}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">同时,Glide再构造对象时,会顶一个registry,这个对象会append多种设置:</span><br></pre></td></tr></table></figure>

<p>registry<br>        .append(Uri.class, InputStream.class, new UriLoader.StreamFactory(contentResolver))<br>        .append(<br>            Uri.class,<br>            ParcelFileDescriptor.class,<br>            new UriLoader.FileDescriptorFactory(contentResolver))<br>        .append(<br>            Uri.class,<br>            AssetFileDescriptor.class,<br>            new UriLoader.AssetFileDescriptorFactory(contentResolver))<br>        .append(Uri.class, InputStream.class, new UrlUriLoader.StreamFactory())<br>        .append(URL.class, InputStream.class, new UrlLoader.StreamFactory())<br>        .append(Uri.class, File.class, new MediaStoreFileLoader.Factory(context))<br>        .append(GlideUrl.class, InputStream.class, new HttpGlideUrlLoader.Factory())<br>        .append(byte[].class, ByteBuffer.class, new ByteArrayLoader.ByteBufferFactory())<br>        .append(byte[].class, InputStream.class, new ByteArrayLoader.StreamFactory())<br>        .append(Uri.class, Uri.class, UnitModelLoader.Factory.<uri>getInstance())<br>        .append(Drawable.class, Drawable.class, UnitModelLoader.Factory.<drawable>getInstance())<br>        .append(Drawable.class, Drawable.class, new UnitDrawableDecoder())<br>        /* Transcoders */<br>        .register(Bitmap.class, BitmapDrawable.class, new BitmapDrawableTranscoder(resources))<br>        .register(Bitmap.class, byte[].class, bitmapBytesTranscoder)<br>        .register(<br>            Drawable.class,<br>            byte[].class,<br>            new DrawableBytesTranscoder(<br>                bitmapPool, bitmapBytesTranscoder, gifDrawableBytesTranscoder))<br>        .register(GifDrawable.class, byte[].class, gifDrawableBytesTranscoder);</drawable></uri></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### load</span><br><span class="line"></span><br><span class="line">load是指定url，返回的RequestBuilder对象，</span><br></pre></td></tr></table></figure>

<p>public RequestBuilder<drawable> load(@Nullable String string) {<br>    return asDrawable().load(string);<br>}</drawable></p>
<p>private RequestBuilder<transcodetype> loadGeneric(@Nullable Object model) {<br>    this.model = model;<br>    isModelSet = true;<br>    return this;<br>}</transcodetype></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### into</span><br><span class="line"></span><br><span class="line">into，是重点啊,这个图片的显示,都在这个执行流程里:</span><br><span class="line">RequestBuilder.into -&gt; buildRequest -&gt; </span><br><span class="line">RequestManager.track -&gt; RequestTracker.runRequest -&gt; SingleRequest.begin -&gt; onSizeReady -&gt; Engile.load -&gt; loadFromMemory -&gt;waitForExistingOrStartNewJob -&gt;  EngineJob.build -&gt; DecodeJob.build -&gt; run -&gt;  runWrapped &gt; runGenerators -&gt; SourceGenerator.startNext -&gt; DecodeHelper.getLoadData -&gt; HttpGlideUrlLoader.buildLoadData -&gt; HttpUrlFetcher.loadData &gt; loadDataWithRedirects</span><br></pre></td></tr></table></figure>

<p>@NonNull<br>public ViewTarget&lt;ImageView, TranscodeType&gt; into(@NonNull ImageView view) {<br>Util.assertMainThread();<br>Preconditions.checkNotNull(view);</p>
<p>BaseRequestOptions&lt;?&gt; requestOptions = this;<br>if (!requestOptions.isTransformationSet()<br>    &amp;&amp; requestOptions.isTransformationAllowed()<br>    &amp;&amp; view.getScaleType() != null) {<br>    // Clone in this method so that if we use this RequestBuilder to load into a View and then<br>    // into a different target, we don’t retain the transformation applied based on the previous<br>    // View’s scale type.<br>    switch (view.getScaleType()) {<br>    case CENTER_CROP:<br>        requestOptions = requestOptions.clone().optionalCenterCrop();<br>        break;<br>    case CENTER_INSIDE:<br>        requestOptions = requestOptions.clone().optionalCenterInside();<br>        break;<br>    case FIT_CENTER:<br>    case FIT_START:<br>    case FIT_END:<br>        requestOptions = requestOptions.clone().optionalFitCenter();<br>        break;<br>    case FIT_XY:<br>        requestOptions = requestOptions.clone().optionalCenterInside();<br>        break;<br>    case CENTER:<br>    case MATRIX:<br>    default:<br>        // Do nothing.<br>    }<br>}</p>
<p>return into(<br>    //得到ImageViewTarget<br>    glideContext.buildImageViewTarget(view, transcodeClass),<br>    /<em>targetListener=</em>/ null,<br>    requestOptions,<br>    Executors.mainThreadExecutor());<br>}</p>
<p>private &lt;Y extends Target<transcodetype>&gt; Y into(<br>    @NonNull Y target,<br>    @Nullable RequestListener<transcodetype> targetListener,<br>    BaseRequestOptions&lt;?&gt; options,<br>    Executor callbackExecutor) {<br>    。。。。。。。。。。。。。。。。。。<br>    // 构建一个请求,实现类SingleRequest<br>    Request request = buildRequest(target, targetListener, options, callbackExecutor);</transcodetype></transcodetype></p>
<pre><code>Request previous = target.getRequest();
//如果上一个请求没有请求完
if (request.isEquivalentTo(previous)
    &amp;&amp; !isSkipMemoryCacheWithCompletePreviousRequest(options, previous)) {
    if (!Preconditions.checkNotNull(previous).isRunning()) {
        previous.begin();
    }
    return target;
}

requestManager.clear(target);
target.setRequest(request);
requestManager.track(target, request);
return target;</code></pre><p>}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RequestTracker:</span><br></pre></td></tr></table></figure>

<p>//正在运行的队列<br>private final Set<request> requests =<br>    Collections.newSetFromMap(new WeakHashMap&lt;Request, Boolean&gt;());<br>//等待中的队列<br>private final List<request> pendingRequests = new ArrayList&lt;&gt;();</request></request></p>
<p>public void runRequest(@NonNull Request request) {<br>requests.add(request);<br>    if (!isPaused) {<br>        request.begin();<br>    } else {<br>        request.clear();<br>        if (Log.isLoggable(TAG, Log.VERBOSE)) {<br>        Log.v(TAG, “Paused, delaying request”);<br>        }<br>        pendingRequests.add(request);<br>    }<br>}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SingleRequest.begin:</span><br></pre></td></tr></table></figure>

<p>@Override<br>public void begin() {<br>synchronized (requestLock) {<br>    。。。。。。。。。。。。<br>    //正在执行，直接返回异常<br>    if (status == Status.RUNNING) {<br>    throw new IllegalArgumentException(“Cannot restart a running request”);<br>    }</p>
<pre><code>if (status == Status.COMPLETE) {
onResourceReady(resource, DataSource.MEMORY_CACHE);
return;
}

status = Status.WAITING_FOR_SIZE;
if (Util.isValidDimensions(overrideWidth, overrideHeight)) {
    onSizeReady(overrideWidth, overrideHeight);
} else {
    target.getSize(this);
}</code></pre><p>…………………………………<br>}<br>// 传进宽高<br>public void onSizeReady(int width, int height) {<br>    synchronized (requestLock) {<br>    ………………………………..<br>        loadStatus =<br>            engine.load(<br>                glideContext,<br>                model,<br>                requestOptions.getSignature(),<br>                this.width,<br>                this.height,<br>                requestOptions.getResourceClass(),<br>                transcodeClass,<br>                priority,<br>                requestOptions.getDiskCacheStrategy(),<br>                requestOptions.getTransformations(),<br>                requestOptions.isTransformationRequired(),<br>                requestOptions.isScaleOnlyOrNoTransform(),<br>                requestOptions.getOptions(),<br>                requestOptions.isMemoryCacheable(),<br>                requestOptions.getUseUnlimitedSourceGeneratorsPool(),<br>                requestOptions.getUseAnimationPool(),<br>                requestOptions.getOnlyRetrieveFromCache(),<br>                this,<br>                callbackExecutor);<br>    }<br>}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Engine.load</span><br></pre></td></tr></table></figure>

<p>public <r> LoadStatus load(<br>      GlideContext glideContext,<br>      Object model,<br>      Key signature,<br>      int width,<br>      int height,<br>      Class<?> resourceClass,
      Class<r> transcodeClass,
      Priority priority,
      DiskCacheStrategy diskCacheStrategy,
      Map<class<?>, Transformation&lt;?&gt;&gt; transformations,<br>      boolean isTransformationRequired,<br>      boolean isScaleOnlyOrNoTransform,<br>      Options options,<br>      boolean isMemoryCacheable,<br>      boolean useUnlimitedSourceExecutorPool,<br>      boolean useAnimationPool,<br>      boolean onlyRetrieveFromCache,<br>      ResourceCallback cb,<br>      Executor callbackExecutor) {<br>    long startTime = VERBOSE_IS_LOGGABLE ? LogTime.getLogTime() : 0;</class<?></r></r></p>
<pre><code>//生成的 key 会用于缓存
EngineKey key =
    keyFactory.buildKey(
        model,
        signature,
        width,
        height,
        transformations,
        resourceClass,
        transcodeClass,
        options);

EngineResource&lt;?&gt; memoryResource;
synchronized (this) {
 // 从缓存中拿
memoryResource = loadFromMemory(key, isMemoryCacheable, startTime);

    if (memoryResource == null) {
        return waitForExistingOrStartNewJob(
            glideContext,
            model,
            signature,
            width,
            height,
            resourceClass,
            transcodeClass,
            priority,
            diskCacheStrategy,
            transformations,
            isTransformationRequired,
            isScaleOnlyOrNoTransform,
            options,
            isMemoryCacheable,
            useUnlimitedSourceExecutorPool,
            useAnimationPool,
            onlyRetrieveFromCache,
            cb,
            callbackExecutor,
            key,
            startTime);
    }
}
cb.onResourceReady(memoryResource, DataSource.MEMORY_CACHE);
return null;</code></pre><p>}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">loadFromMemory从缓存取,也称运行时缓存(如果app被kill掉,就没有了):</span><br></pre></td></tr></table></figure>

<p>private EngineResource<?> loadFromMemory(
      EngineKey key, boolean isMemoryCacheable, long startTime) {
    if (!isMemoryCacheable) {
      return null;
    }
    // 先从活动缓存(用户正在显示的图片)拿,一级缓存
    EngineResource<?> active = loadFromActiveResources(key);<br>    if (active != null) {<br>      if (VERBOSE_IS_LOGGABLE) {<br>        logWithTimeAndKey(“Loaded resource from active resources”, startTime, key);<br>      }<br>      return active;<br>    }<br>    // 再从内存缓存(活动缓存回收后给到内存缓存)拿,二级缓存<br>    EngineResource&lt;?&gt; cached = loadFromCache(key);<br>    if (cached != null) {<br>      if (VERBOSE_IS_LOGGABLE) {<br>        logWithTimeAndKey(“Loaded resource from cache”, startTime, key);<br>      }<br>      return cached;<br>    }</p>
<pre><code>return null;</code></pre><p>}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">waitForExistingOrStartNewJob:缓存中没有</span><br></pre></td></tr></table></figure>

<p>private <r> LoadStatus waitForExistingOrStartNewJob(<br>    GlideContext glideContext,<br>    Object model,<br>    Key signature,<br>    int width,<br>    int height,<br>    Class<?> resourceClass,
    Class<r> transcodeClass,
    Priority priority,
    DiskCacheStrategy diskCacheStrategy,
    Map<class<?>, Transformation<?>> transformations,
    boolean isTransformationRequired,
    boolean isScaleOnlyOrNoTransform,
    Options options,
    boolean isMemoryCacheable,
    boolean useUnlimitedSourceExecutorPool,
    boolean useAnimationPool,
    boolean onlyRetrieveFromCache,
    ResourceCallback cb,
    Executor callbackExecutor,
    EngineKey key,
    long startTime) {
        //根据key拿当前正在运行中,有没有缓存(这里指磁盘缓存)可用,再验证一次缓存
    EngineJob<?> current = jobs.get(key, onlyRetrieveFromCache);<br>    if (current != null) {<br>        current.addCallback(cb, callbackExecutor);<br>        if (VERBOSE_IS_LOGGABLE) {<br>        logWithTimeAndKey(“Added to existing load”, startTime, key);<br>        }<br>        return new LoadStatus(cb, current);<br>    }<br>    // 网络请求了<br>    EngineJob<r> engineJob =<br>        engineJobFactory.build(<br>            key,<br>            isMemoryCacheable,<br>            useUnlimitedSourceExecutorPool,<br>            useAnimationPool,<br>            onlyRetrieveFromCache);</r></class<?></r></r></p>
<pre><code>DecodeJob&lt;R&gt; decodeJob =
    decodeJobFactory.build(
        glideContext,
        model,
        key,
        signature,
        width,
        height,
        resourceClass,
        transcodeClass,
        priority,
        diskCacheStrategy,
        transformations,
        isTransformationRequired,
        isScaleOnlyOrNoTransform,
        onlyRetrieveFromCache,
        options,
        engineJob);

jobs.put(key, engineJob);
//把decodeJob,添加给引擎job,然后开始执行.
engineJob.addCallback(cb, callbackExecutor);
engineJob.start(decodeJob);
return new LoadStatus(cb, engineJob);</code></pre><p>}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">EngineJob,引擎Job,这里会由很多的线程池Executor,用来执行操作的:</span><br><span class="line">DecodeJob,是一个任务,runnable.</span><br></pre></td></tr></table></figure>

<p>private final StateVerifier stateVerifier = StateVerifier.newInstance();<br>private final ResourceListener resourceListener;<br>private final Pools.Pool&lt;EngineJob&lt;?&gt;&gt; pool;<br>private final EngineResourceFactory engineResourceFactory;<br>private final EngineJobListener engineJobListener;<br>private final GlideExecutor diskCacheExecutor;<br>private final GlideExecutor sourceExecutor;<br>private final GlideExecutor sourceUnlimitedExecutor;<br>private final GlideExecutor animationExecutor;<br>private final AtomicInteger pendingCallbacks = new AtomicInteger();</p>
<p>public synchronized void start(DecodeJob<r> decodeJob) {<br>    this.decodeJob = decodeJob;<br>    //线程池<br>    GlideExecutor executor =<br>        decodeJob.willDecodeFromCache() ? diskCacheExecutor : getActiveSourceExecutor();<br>    //执行runnable<br>    executor.execute(decodeJob);<br>}</r></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DecodeJob.run &gt; runWrapped &gt; runGenerators</span><br></pre></td></tr></table></figure>

<p>public void run() {<br>    DataFetcher&lt;?&gt; localFetcher = currentFetcher;<br>    try {<br>      if (isCancelled) {<br>        notifyFailed();<br>        return;<br>      }<br>      runWrapped();<br>    } catch (CallbackException e) {<br>    }<br>}</p>
<p>private void runWrapped() {<br>    switch (runReason) {<br>      case INITIALIZE:<br>        stage = getNextStage(Stage.INITIALIZE);<br>        currentGenerator = getNextGenerator();<br>        runGenerators();<br>        break;<br>      case SWITCH_TO_SOURCE_SERVICE:<br>        runGenerators();<br>        break;<br>      case DECODE_DATA:<br>        decodeFromRetrievedData();<br>        break;<br>      default:<br>        throw new IllegalStateException(“Unrecognized run reason: “ + runReason);<br>    }<br>}<br>//如果你配置了缓存策略,就使用,如果没有,就使用默认SOURCE策略<br>private DataFetcherGenerator getNextGenerator() {<br>    switch (stage) {<br>      case RESOURCE_CACHE:<br>        return new ResourceCacheGenerator(decodeHelper, this);<br>      case DATA_CACHE:<br>        return new DataCacheGenerator(decodeHelper, this);<br>      case SOURCE:<br>        return new SourceGenerator(decodeHelper, this);<br>      case FINISHED:<br>        return null;<br>      default:<br>        throw new IllegalStateException(“Unrecognized stage: “ + stage);<br>    }<br>}</p>
<p>private void runGenerators() {<br>    currentThread = Thread.currentThread();<br>    startFetchTime = LogTime.getLogTime();<br>    boolean isStarted = false;<br>    while (!isCancelled<br>        &amp;&amp; currentGenerator != null<br>        &amp;&amp; !(isStarted = currentGenerator.startNext())) {<br>      stage = getNextStage(stage);<br>      currentGenerator = getNextGenerator();</p>
<pre><code>  if (stage == Stage.SOURCE) {
    reschedule();
    return;
}</code></pre><p>}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SourceGenerator.startNext</span><br></pre></td></tr></table></figure>

<p>public boolean startNext() {<br>    if (dataToCache != null) {<br>      Object data = dataToCache;<br>      dataToCache = null;<br>      cacheData(data);<br>    }<br>    …………………………..<br>    loadData = null;<br>    boolean started = false;<br>    while (!started &amp;&amp; hasNextModelLoader()) {<br>        //获取网络请求的对象loadData.HttpUrlFetcher<br>      loadData = helper.getLoadData().get(loadDataListIndex++);<br>      if (loadData != null<br>          &amp;&amp; (helper.getDiskCacheStrategy().isDataCacheable(loadData.fetcher.getDataSource())<br>              || helper.hasLoadPath(loadData.fetcher.getDataClass()))) {<br>        started = true;<br>        //开始网络请求<br>        startNextLoad(loadData);<br>      }<br>    }<br>    return started;<br>}<br>// 这里创建了网络请求成功后的callback:DataCacheGenerator<br>private void cacheData(Object dataToCache) {<br>    sourceCacheGenerator =<br>        new DataCacheGenerator(Collections.singletonList(loadData.sourceKey), helper, this);<br>}</p>
<p>//网络请求fetcher.loadData<br>private void startNextLoad(final LoadData&lt;?&gt; toStart) {<br>    loadData.fetcher.loadData(<br>        helper.getPriority(),<br>        new DataCallback<object>() {<br>          @Override<br>          public void onDataReady(@Nullable Object data) {<br>            if (isCurrentRequest(toStart)) {<br>              onDataReadyInternal(toStart, data);<br>            }<br>          }</object></p>
<pre><code>  @Override
  public void onLoadFailed(@NonNull Exception e) {
    if (isCurrentRequest(toStart)) {
      onLoadFailedInternal(toStart, e);
    }
  }
});</code></pre><p>}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DecodeHelper.getLoadData &gt; HttpGlideUrlLoader.buildLoadData</span><br></pre></td></tr></table></figure>

<p>List&lt;LoadData<?>> getLoadData() {
    if (!isLoadDataSet) {
      isLoadDataSet = true;
      loadData.clear();
      List<modelloader<object, ?>&gt; modelLoaders = glideContext.getRegistry().getModelLoaders(model);<br>      //noinspection ForLoopReplaceableByForEach to improve perf<br>      for (int i = 0, size = modelLoaders.size(); i &lt; size; i++) {<br>        ModelLoader&lt;Object, ?&gt; modelLoader = modelLoaders.get(i);<br>        LoadData&lt;?&gt; current = modelLoader.buildLoadData(model, width, height, options);<br>        if (current != null) {<br>          loadData.add(current);<br>        }<br>      }<br>    }<br>    return loadData;<br>}<br>//buildLoadData这个函数就返回了HttpUrlFetcher,而HttpUrlFetcher是封装再LoadData对象里的.<br>public LoadData<inputstream> buildLoadData(<br>      @NonNull GlideUrl model, int width, int height, @NonNull Options options) {<br>    // GlideUrls memoize parsed URLs so caching them saves a few object instantiations and time<br>    // spent parsing urls.<br>    GlideUrl url = model;<br>    if (modelCache != null) {<br>      url = modelCache.get(model, 0, 0);<br>      if (url == null) {<br>        modelCache.put(model, 0, 0, model);<br>        url = model;<br>      }<br>    }<br>    int timeout = options.get(TIMEOUT);<br>    return new LoadData&lt;&gt;(url, new HttpUrlFetcher(url, timeout));<br>}</inputstream></modelloader<object,></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">开始请求网络:HttpUrlFetcher.loadData &gt; loadDataWithRedirects</span><br></pre></td></tr></table></figure>

<p>@Override<br>public void loadData(<br>    @NonNull Priority priority, @NonNull DataCallback&lt;? super InputStream&gt; callback) {<br>    long startTime = LogTime.getLogTime();<br>    try {<br>        //返回InputStream<br>        InputStream result = loadDataWithRedirects(glideUrl.toURL(), 0, null, glideUrl.getHeaders());<br>        //把返回的InputStream返回给callback:DataCacheGenerator<br>        callback.onDataReady(result);<br>    }<br>}</p>
<p>//真正的网络请求再这里,返回InputStream<br>private InputStream loadDataWithRedirects(<br>    URL url, int redirects, URL lastUrl, Map&lt;String, String&gt; headers) throws IOException {<br>    if (redirects &gt;= MAXIMUM_REDIRECTS) {<br>        throw new HttpException(“Too many (&gt; “ + MAXIMUM_REDIRECTS + “) redirects!”);<br>    } else {<br>        // Comparing the URLs using .equals performs additional network I/O and is generally broken.<br>        // See <a href="http://michaelscharf.blogspot.com/2006/11/javaneturlequals-and-hashcode-make.html" target="_blank" rel="noopener">http://michaelscharf.blogspot.com/2006/11/javaneturlequals-and-hashcode-make.html</a>.<br>        try {<br>        if (lastUrl != null &amp;&amp; url.toURI().equals(lastUrl.toURI())) {<br>            throw new HttpException(“In re-direct loop”);<br>        }<br>        } catch (URISyntaxException e) {<br>        // Do nothing, this is best effort.<br>    }<br>    }<br>    //url:图片的网络地址<br>    urlConnection = connectionFactory.build(url);<br>    for (Map.Entry&lt;String, String&gt; headerEntry : headers.entrySet()) {<br>        urlConnection.addRequestProperty(headerEntry.getKey(), headerEntry.getValue());<br>    }<br>    urlConnection.setConnectTimeout(timeout);<br>    urlConnection.setReadTimeout(timeout);<br>    urlConnection.setUseCaches(false);<br>    urlConnection.setDoInput(true);</p>
<pre><code>// Stop the urlConnection instance of HttpUrlConnection from following redirects so that
// redirects will be handled by recursive calls to this method, loadDataWithRedirects.
urlConnection.setInstanceFollowRedirects(false);

// Connect explicitly to avoid errors in decoders if connection fails.
urlConnection.connect();
// Set the stream so that it&apos;s closed in cleanup to avoid resource leaks. See #2352.
stream = urlConnection.getInputStream();
if (isCancelled) {
    return null;
}
final int statusCode = urlConnection.getResponseCode();
if (isHttpOk(statusCode)) {
    return getStreamForSuccessfulRequest(urlConnection);
} else if (isHttpRedirect(statusCode)) {
    String redirectUrlString = urlConnection.getHeaderField(&quot;Location&quot;);
    if (TextUtils.isEmpty(redirectUrlString)) {
    throw new HttpException(&quot;Received empty or null redirect url&quot;);
    }
    URL redirectUrl = new URL(url, redirectUrlString);
    // Closing the stream specifically is required to avoid leaking ResponseBodys in addition
    // to disconnecting the url connection below. See #2352.
    cleanup();
    return loadDataWithRedirects(redirectUrl, redirects + 1, url, headers);
} </code></pre><p>}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">网络请求完成后,开始往回走了</span><br><span class="line">DataCacheGenerator.onDataReady</span><br></pre></td></tr></table></figure>

<p>public void onDataReady(Object data) {<br>    cb.onDataFetcherReady(sourceKey, data, loadData.fetcher, DataSource.DATA_DISK_CACHE, sourceKey);<br>}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FetcherReadyCallback.onDataFetcherReady &gt; DecodeJob.onDataFetcherReady &gt;  decodeFromRetrievedData &gt; decodeFromData &gt; decodeFromFetcher &gt;runLoadPath &gt;  path.load LoadPth &gt; LoadPth.loadWithExceptionList &gt; path.decode DecodePath &gt; DecodePath.decode</span><br></pre></td></tr></table></figure>

<p>//开始解码了<br>public Resource<transcode> decode(<br>      DataRewinder<datatype> rewinder,<br>      int width,<br>      int height,<br>      @NonNull Options options,<br>      DecodeCallback<resourcetype> callback)<br>      throws GlideException {<br>    Resource<resourcetype> decoded = decodeResource(rewinder, width, height, options);<br>    Resource<resourcetype> transformed = callback.onResourceDecoded(decoded);<br>    return transcoder.transcode(transformed, options);<br>}</resourcetype></resourcetype></resourcetype></datatype></transcode></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DecodePath.decodeResource &gt; decodeResourceWithList &gt; decoder.decode StreamBitmapDecoder.decode</span><br><span class="line">这里就开始采用压缩,返回Bitmap</span><br></pre></td></tr></table></figure>

<p>public Resource<bitmap> decode(<br>      @NonNull InputStream source, int width, int height, @NonNull Options options)<br>      throws IOException {</bitmap></p>
<pre><code>// Use to fix the mark limit to avoid allocating buffers that fit entire images.
final RecyclableBufferedInputStream bufferedStream;
final boolean ownsBufferedStream;
if (source instanceof RecyclableBufferedInputStream) {
  bufferedStream = (RecyclableBufferedInputStream) source;
  ownsBufferedStream = false;
} else {
  bufferedStream = new RecyclableBufferedInputStream(source, byteArrayPool);
  ownsBufferedStream = true;
}
ExceptionCatchingInputStream exceptionStream =
    ExceptionCatchingInputStream.obtain(bufferedStream);

MarkEnforcingInputStream invalidatingStream = new MarkEnforcingInputStream(exceptionStream);
UntrustedCallbacks callbacks = new UntrustedCallbacks(bufferedStream, exceptionStream);
try {
  return downsampler.decode(invalidatingStream, width, height, options, callbacks);
} </code></pre><p>}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">最终返回到DecodePath,因为我们是再DecodePath.decode的decodeResource里进来的:</span><br><span class="line">再看下代码:</span><br></pre></td></tr></table></figure>

<p>public Resource<transcode> decode(<br>      DataRewinder<datatype> rewinder,<br>      int width,<br>      int height,<br>      @NonNull Options options,<br>      DecodeCallback<resourcetype> callback)<br>      throws GlideException {<br>    Resource<resourcetype> decoded = decodeResource(rewinder, width, height, options);<br>    //这里把获取的图片返回到DecodeJob里:<br>    Resource<resourcetype> transformed = callback.onResourceDecoded(decoded);<br>    //其实这里还会对图片进行处理优化<br>    return transcoder.transcode(transformed, options);<br>}</resourcetype></resourcetype></resourcetype></datatype></transcode></p>
<p>public Resource<z> onResourceDecoded(@NonNull Resource<z> decoded) {<br>    return DecodeJob.this.onResourceDecoded(dataSource, decoded);<br>}</z></z></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">DecodeJob.onResourceDecoded....&gt; notifyEncodeAndRelease &gt; notifyComplete</span><br><span class="line">-&gt; onResourceReady &gt; EngineJob.onResourceReady &gt; notifyCallbacksOfResult &gt; entry.executor.execute(new CallResourceReady(entry.cb)) .... &gt;EnginJob.loadFromActiveResources</span><br><span class="line">最终把Bitmap存到了活动缓存里:</span><br></pre></td></tr></table></figure>

<p> private EngineResource<?> loadFromActiveResources(Key key) {
    EngineResource<?> active = activeResources.get(key);<br>    if (active != null) {<br>      active.acquire();<br>    }</p>
<pre><code>return active;</code></pre><p>}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">接着再通过onResourceReady回调返回到SingleRequest里:这里有个target,这个target,就是我们再into开始时根据imageview创建的ImageViewTarget</span><br></pre></td></tr></table></figure>

<p>private void onResourceReady(Resource<r> resource, R result, DataSource dataSource) {<br>    if (!anyListenerHandledUpdatingTarget) {<br>        Transition&lt;? super R&gt; animation = animationFactory.build(dataSource, isFirstResource);<br>        target.onResourceReady(result, animation);<br>      }<br>    }<br>    notifyLoadSuccess();<br>}</r></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ImageViewTarget,最终显示图片,DrawableImageViewTarget</span><br></pre></td></tr></table></figure>

<p>public void onResourceReady(@NonNull Z resource, @Nullable Transition&lt;? super Z&gt; transition) {<br>    if (transition == null || !transition.transition(resource, this)) {<br>        setResourceInternal(resource);<br>    } else {<br>        maybeUpdateAnimatable(resource);<br>    }<br>}</p>
<p>private void setResourceInternal(@Nullable Z resource) {<br>    // Order matters here. Set the resource first to make sure that the Drawable has a valid and<br>    // non-null Callback before starting it.<br>    setResource(resource);<br>    maybeUpdateAnimatable(resource);<br>}</p>
<p>protected void setResource(@Nullable Drawable resource) {<br>    view.setImageDrawable(resource);<br>}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">## 生命周期分析</span><br><span class="line"></span><br><span class="line">首先Activity中对生命周期的监听,也是参考这个方式:</span><br><span class="line">还是从with的RequestManager开始:</span><br></pre></td></tr></table></figure>

<p>private RequestManager supportFragmentGet(<br>    @NonNull Context context,<br>    @NonNull FragmentManager fm,<br>    @Nullable Fragment parentHint,<br>    boolean isParentVisible) {<br>    //空白的Fragment<br>    SupportRequestManagerFragment current =<br>        getSupportRequestManagerFragment(fm, parentHint, isParentVisible);<br>    //给到 RequestManager<br>    RequestManager requestManager = current.getRequestManager();<br>    if (requestManager == null) {<br>        Glide glide = Glide.get(context);<br>        requestManager =<br>            factory.build(<br>                glide, current.getGlideLifecycle(), current.getRequestManagerTreeNode(), context);<br>        current.setRequestManager(requestManager);<br>    }<br>    return requestManager;<br>}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SupportRequestManagerFragment</span><br></pre></td></tr></table></figure>

<p>@Override<br>public void onDestroy() {<br>    super.onDestroy();<br>    lifecycle.onDestroy();<br>    unregisterFragmentWithRoot();<br>}<br>// ActivityFragmentLifecycle implements Lifecycle<br>// interface LifecycleListener 生命周期的监听接口<br>void onDestroy() {<br>    isDestroyed = true;<br>    for (LifecycleListener lifecycleListener : Util.getSnapshot(lifecycleListeners)) {<br>      lifecycleListener.onDestroy();<br>    }<br>  }</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">所以当界面生命周期发生变化后,实现了LifecycleListener 接口的类,都会收到生命周期的回调监听.我们就可以针对具体的生命周期,执行对应逻辑处理.</span><br><span class="line"></span><br><span class="line">```  </span><br><span class="line">// RequestManager</span><br><span class="line">public synchronized void onDestroy() &#123;</span><br><span class="line">    targetTracker.onDestroy();</span><br><span class="line">    for (Target&lt;?&gt; target : targetTracker.getAll()) &#123;</span><br><span class="line">      clear(target);</span><br><span class="line">    &#125;</span><br><span class="line">    targetTracker.clear();</span><br><span class="line">    requestTracker.clearRequests();</span><br><span class="line">    lifecycle.removeListener(this);</span><br><span class="line">    lifecycle.removeListener(connectivityMonitor);</span><br><span class="line">    mainHandler.removeCallbacks(addSelfToLifecycle);</span><br><span class="line">    glide.unregisterRequestManager(this);</span><br><span class="line">&#125;</span><br><span class="line">// RequestTracker,pendingRequests缓存了等待执行的url请求</span><br><span class="line">public void clearRequests() &#123;</span><br><span class="line">    for (Request request : Util.getSnapshot(requests)) &#123;</span><br><span class="line">      // It&apos;s unsafe to recycle the Request here because we don&apos;t know who might else have a</span><br><span class="line">      // reference to it.</span><br><span class="line">      clearAndRemove(request);</span><br><span class="line">    &#125;</span><br><span class="line">    pendingRequests.clear();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="缓存机制"><a href="#缓存机制" class="headerlink" title="缓存机制"></a>缓存机制</h2><p><img src="http://nunu03.github.io/2022/06/08/Glide%E5%9B%BE%E7%89%87%E5%8A%A0%E8%BD%BD%E6%A1%86%E6%9E%B6%E5%8E%9F%E7%90%86/glide-cache.png" alt></p>
<h3 id="缓存获取流程"><a href="#缓存获取流程" class="headerlink" title="缓存获取流程"></a>缓存获取流程</h3><p>先从活动缓存取,有,直接显示,没有从LRU内存缓存取,并LRU内存缓存的数据放入到活动缓存,并显示.如果LRU内存缓存没有,则从LRU磁盘缓存取,放入到活动缓存(磁盘缓存不移除)并显示,都没有,使用http请求下载或外部资源.下载完成缓存到磁盘缓存.<br>反向同理:生命周期onDestroy时,把活动缓存的移到LRU内存缓存.而下载的图片首先会存到磁盘缓存.<br>内存缓存大小:自动计算当前内存的1/8.<br><strong>为什么要一个活动缓存?</strong><br>如果图片再LRU内存缓存里,而正在显示的图片正在使用,而当有图片添加到LRU内存缓存后,有可能这个LRU内存缓存里的图片被清除了,这个时候就可能出问题了.</p>
<h3 id="LRU-Cache"><a href="#LRU-Cache" class="headerlink" title="LRU Cache"></a>LRU Cache</h3><p>其实就是一个LinkedHashMap,如果参数位true,就会执行LRU算法.数据put进,如果最终数据大于了maxSize,则就会把最少使用,最先添加的的数据清除,如果没有大于maxSize,添加的而是map中已经有的数据,则会把这条数据提到队尾,这再添加一个,就会把队首的数据删掉.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">public class LruCache&lt;K, V&gt; &#123;</span><br><span class="line">    private final LinkedHashMap&lt;K, V&gt; map;</span><br><span class="line">    public LruCache(int maxSize) &#123;</span><br><span class="line">        if (maxSize &lt;= 0) &#123;</span><br><span class="line">            throw new IllegalArgumentException(&quot;maxSize &lt;= 0&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        this.maxSize = maxSize;</span><br><span class="line">        this.map = new LinkedHashMap&lt;K, V&gt;(0, 0.75f, true);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a href="https://muyangmin.github.io/glide-docs-cn/" target="_blank" rel="noopener">Glide中文文档</a></p>

        
            <div id="toc-article">
                
  <div class="widget-wrap" id="toc-wrap">
    <h3 class="widget-title"><i class="fa fa-toc"></i> Contents</h3>
    <div class="widget">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#什么是Glide"><span class="toc-text">什么是Glide</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#特点"><span class="toc-text">特点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#性能"><span class="toc-text">性能</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#架构"><span class="toc-text">架构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#使用"><span class="toc-text">使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#依赖"><span class="toc-text">依赖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#加载"><span class="toc-text">加载</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#取消加载"><span class="toc-text">取消加载:</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#过度"><span class="toc-text">过度</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#变换"><span class="toc-text">变换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Generated-API"><span class="toc-text">Generated API</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#缓存机制"><span class="toc-text">缓存机制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#缓存获取流程"><span class="toc-text">缓存获取流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LRU-Cache"><span class="toc-text">LRU Cache</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#参考资料"><span class="toc-text">参考资料</span></a></li></ol>
    </div>
  </div>


            </div>
        
        
          <blockquote id="copyright">
              <p>Original link: <a href="http://nunu03.github.io/2022/06/08/Glide图片加载框架原理/">http://nunu03.github.io/2022/06/08/Glide图片加载框架原理/</a></p>
              <p>Copyright Notice: 转载请注明出处.</p>
          </blockquote>
        
      
    </div>
    <footer class="article-footer">
      
        <div class="article-tag-wrap">
          

          
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Glide/">Glide</a></li></ul>

          
    <div class="social-share">
      <span>Share:</span>
    </div>



        </div>
      
      
        
<nav id="article-nav">
  
    <a href="/2022/06/07/SPI原理解析/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">older</strong>
      <div class="article-nav-title">
        
          SPI原理解析
        
      </div>
    </a>
  
  
    <a href="/2022/06/09/手写实现ARouter/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">newer</strong>
      <div class="article-nav-title">
        
          手写实现ARouter
        
      </div>
    </a>
  
</nav>

      
      
        








      
    </footer>
  </div>
</article>
</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title"><i class="fa fa-posts"></i> Recent</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2022/06/20/设计模式/">设计模式</a>
          </li>
        
          <li>
            <a href="/2022/06/09/手写实现ARouter/">手写实现ARouter</a>
          </li>
        
          <li>
            <a href="/2022/06/08/Glide图片加载框架原理/">Glide图片加载框架原理</a>
          </li>
        
          <li>
            <a href="/2022/06/07/SPI原理解析/">SPI原理解析</a>
          </li>
        
          <li>
            <a href="/2022/06/03/SharedPreferences-MMAP-MMKV数据持久化原理解析/">SharedPreferences+MMAP+MMKV数据持久化原理解析</a>
          </li>
        
      </ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title"><i class="fa fa-tag"></i> Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Android/" style="font-size: 20px;">Android</a> <a href="/tags/CMake/" style="font-size: 10px;">CMake</a> <a href="/tags/Charles/" style="font-size: 13.33px;">Charles</a> <a href="/tags/Color/" style="font-size: 10px;">Color</a> <a href="/tags/FaceUnity/" style="font-size: 16.67px;">FaceUnity</a> <a href="/tags/Fix/" style="font-size: 10px;">Fix</a> <a href="/tags/Flutter/" style="font-size: 10px;">Flutter</a> <a href="/tags/GitLab/" style="font-size: 10px;">GitLab</a> <a href="/tags/Glide/" style="font-size: 10px;">Glide</a> <a href="/tags/Gradle/" style="font-size: 20px;">Gradle</a> <a href="/tags/Haar/" style="font-size: 10px;">Haar</a> <a href="/tags/Hexo/" style="font-size: 10px;">Hexo</a> <a href="/tags/Hook/" style="font-size: 10px;">Hook</a> <a href="/tags/Kotlin/" style="font-size: 10px;">Kotlin</a> <a href="/tags/LiveData/" style="font-size: 10px;">LiveData</a> <a href="/tags/Log/" style="font-size: 10px;">Log</a> <a href="/tags/OkHttp/" style="font-size: 10px;">OkHttp</a> <a href="/tags/OpenCV/" style="font-size: 10px;">OpenCV</a> <a href="/tags/Python/" style="font-size: 10px;">Python</a> <a href="/tags/Retrofit/" style="font-size: 10px;">Retrofit</a> <a href="/tags/SPI/" style="font-size: 10px;">SPI</a> <a href="/tags/Title/" style="font-size: 10px;">Title</a> <a href="/tags/Toast/" style="font-size: 10px;">Toast</a> <a href="/tags/View/" style="font-size: 10px;">View</a> <a href="/tags/ViewModel/" style="font-size: 10px;">ViewModel</a> <a href="/tags/WMS/" style="font-size: 10px;">WMS</a> <a href="/tags/WebHook/" style="font-size: 10px;">WebHook</a> <a href="/tags/Wireshark/" style="font-size: 10px;">Wireshark</a> <a href="/tags/Xposed/" style="font-size: 13.33px;">Xposed</a> <a href="/tags/aar/" style="font-size: 10px;">aar</a> <a href="/tags/cmd/" style="font-size: 10px;">cmd</a> <a href="/tags/mmap/" style="font-size: 10px;">mmap</a> <a href="/tags/ngrok/" style="font-size: 13.33px;">ngrok</a> <a href="/tags/nps/" style="font-size: 10px;">nps</a> <a href="/tags/人脸检测/" style="font-size: 10px;">人脸检测</a> <a href="/tags/组件化/" style="font-size: 10px;">组件化</a> <a href="/tags/设计模式/" style="font-size: 10px;">设计模式</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title"><i class="fa fa-classify"></i> Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a><span class="category-list-count">23</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Charles/">Charles</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Flutter/">Flutter</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/GitLab/">GitLab</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Gradle/">Gradle</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Hexo/">Hexo</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Kotlin/">Kotlin</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Log/">Log</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Log/Fix/">Fix</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/NDK/">NDK</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/OpenCV/">OpenCV</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tools/">Tools</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Video/">Video</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/WebHook/">WebHook</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/WebHook/ngrok/">ngrok</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/cmd/">cmd</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ngrok/">ngrok</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/ngrok/nps/">nps</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/人脸检测/">人脸检测</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/人脸检测/Haar/">Haar</a><span class="category-list-count">1</span></li></ul></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title"><i class="fa fa-archive"></i> Archive</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/">2022年</a><span class="archive-list-count">14</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/">2021年</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/">2020年</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/">2019年</a><span class="archive-list-count">16</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title"><i class="fa fa-tag"></i> Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android/">Android</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CMake/">CMake</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Charles/">Charles</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Color/">Color</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/FaceUnity/">FaceUnity</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Fix/">Fix</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Flutter/">Flutter</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GitLab/">GitLab</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Glide/">Glide</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Gradle/">Gradle</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Haar/">Haar</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hexo/">Hexo</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hook/">Hook</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Kotlin/">Kotlin</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LiveData/">LiveData</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Log/">Log</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OkHttp/">OkHttp</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OpenCV/">OpenCV</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/">Python</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Retrofit/">Retrofit</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SPI/">SPI</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Title/">Title</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Toast/">Toast</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/View/">View</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ViewModel/">ViewModel</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WMS/">WMS</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WebHook/">WebHook</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Wireshark/">Wireshark</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Xposed/">Xposed</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/aar/">aar</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cmd/">cmd</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mmap/">mmap</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ngrok/">ngrok</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nps/">nps</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/人脸检测/">人脸检测</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/组件化/">组件化</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/设计模式/">设计模式</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title"><i class="fa fa-link"></i> Blogroll</h3>
    <div class="widget">
      <ul>
      
        <li>
          <a href="https://handsomeliuyang.github.io/">liuyang</a>
        </li>
      
      </ul>
    </div>
  </div>


  
</aside>
        
      </div>
      <a id="totop" href="#top"></a>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      <p>
        <a href="/sitemap.xml">Site Map</a>
        <span> | </span><a href="/atom.xml">Subscribe to this site</a>
        <span> | </span><a href="/about/">Contact the blogger</a>
      </p>
      
        <p>
          <i class="fa fa-visitors"></i>
          <i id="busuanzi_container_site_uv"><i id="busuanzi_value_site_uv"></i></i>
          ，
          <i class="fa fa-views"></i>
          <i id="busuanzi_container_site_pv"><i id="busuanzi_value_site_pv"></i></i>
        </p>
      
      <p>
        <span>Copyright &copy; 2022 Nunu Long.</span>
        <span>Theme by <a href="https://github.com/chaooo/hexo-theme-BlueLake/" target="_blank">BlueLake.</a></span>
        <span>Powered by <a href="https://hexo.io/" target="_blank">Hexo.</a></span>
      </p>
    </div>
  </div>
</footer>

    </div>
  </div>
  <script src="/js/jquery-3.4.1.min.js"></script>
<script src="/js/search.json.js"></script>

  <script src="/fancybox/jquery.fancybox.min.js"></script>


<script src="/js/script.js"></script>





  <script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>



  
    <script src="/localshare/js/social-share.js"></script>
    <script src="/localshare/js/qrcode.js"></script>
  
  



  

  

  

  

  

  

  

  
  





</body>
</html>