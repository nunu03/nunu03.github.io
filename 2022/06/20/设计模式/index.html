<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  
  
  <title>设计模式 | chenyulong</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
    <meta name="description" content="Nunu&#39;s blog!">
  
  
    <meta name="keywords" content="Nunu">
  
  
    <link rel="alternate" href="/atom.xml" title="chenyulong">
  
  
    <link rel="shortcut icon" href="/css/images/avatar.jpg">
  
  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">
  
  <link rel="stylesheet" href="/css/style.css">
  
    <link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">
  
  
    <link rel="stylesheet" href="/localshare/css/share.css">
  
  
  
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">chenyulong</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">理论是你知道是这样，但它却不好用；实践是它很好用，但你不知道是为什么；程序员将理论和实践结合到一起：既不好用，也不知道是为什么。</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        
          <a class="main-nav-link" href="/."><i class="fa fa-home"></i> 首页</a>
        
          <a class="main-nav-link" href="/archives"><i class="fa fa-rss"></i> 归档</a>
        
          <a class="main-nav-link" href="/categories/"><i class="fa fa-archive"></i> 分类</a>
        
          <a class="main-nav-link" href="/tags/"><i class="fa fa-user"></i> 标签</a>
        
      </nav>
    </div>
    <div id="search-form">
      <div id="result-mask" class="hide"></div>
      <label><input id="search-key" type="text" autocomplete="off" placeholder="Suche"></label>
      <div id="result-wrap" class="hide">
        <div id="search-result"></div>
      </div>
      <div class="hide">
        <template id="search-tpl">
          <div class="item">
            <a href="/{path}" title="{title}">
              <div class="title">{title}</div>
              <div class="time">{date}</div>
              <div class="tags">{tags}</div>
            </a>
          </div>
        </template>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-设计模式" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      设计模式
    </h1>
  


      </header>
    
    <div class="article-meta">
      
      <span class="article-date">
  <i class="fa fa-date"></i>
  <time class="dt-published" datetime="2022-06-20T08:44:18.000Z" itemprop="datePublished">2022年06月20日</time>
</span>
      
  <div class="article-category">
    <i class="fa fa-classify"></i>
    <a class="article-category-link" href="/categories/Java/">Java</a>
  </div>

      
        <span class="article-views">
  <i class="fa fa-views"></i>
  <i id="busuanzi_container_page_pv">
      <i id="busuanzi_value_page_pv"></i>
  </i>
</span>

      
      
<a href="/2022/06/20/设计模式/#comments" class="article-comment-link">
  
    
    
    
    
    
  
  <i class="fa fa-commt"></i>
  Gästebuch
</a>


    </div>
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="1-工厂设计模式"><a href="#1-工厂设计模式" class="headerlink" title="1.工厂设计模式"></a>1.工厂设计模式</h2><h3 id="简单工厂模式"><a href="#简单工厂模式" class="headerlink" title="简单工厂模式"></a>简单工厂模式</h3><p><strong>适用场景：</strong></p>
<ul>
<li>工厂类负责创建的对象较少；</li>
<li>客户端只需要传入工厂类的参数，对于如何创建对象的逻辑不需要关心。</li>
</ul>
<p><strong>优点：</strong></p>
<ul>
<li>只需要传入一个正确的参数，就可以获取你所需要的对象，无须知道其创建的细节。</li>
</ul>
<p><strong>缺点：</strong></p>
<ul>
<li>不易于扩展过于复杂的产品结构。</li>
</ul>
<a id="more"></a>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">public interface ILanguages &#123;</span><br><span class="line">    void out();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class JavaLanguage implements ILanguages &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void out() &#123;</span><br><span class="line">        System.out.println(&quot;JavaLanguage--------------&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class PythonLanguage implements ILanguages &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void out() &#123;</span><br><span class="line">        System.out.println(&quot;PythonLanguage--------------&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class LanaguageFactory &#123;</span><br><span class="line">    public ILanguages create(Class&lt;?extends ILanguages&gt; clsName)&#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            if (null != clsName)&#123;</span><br><span class="line">                return clsName.newInstance();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;catch (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class Test &#123;</span><br><span class="line">    public static void main(String[] args)&#123;</span><br><span class="line">        System.out.println(&quot;pattern----------------start&quot;);</span><br><span class="line">        ILanguages language = new LanaguageFactory().create(PythonLanguage.class);</span><br><span class="line">        language.out();</span><br><span class="line">        System.out.println(&quot;pattern----------------end&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="工厂方法模式"><a href="#工厂方法模式" class="headerlink" title="工厂方法模式"></a>工厂方法模式</h3><p>工厂方法模式,Factory Method Pattern，指定义一个创建对象的接口，但让实现这个接口的类来决定实例化哪个类，工厂方法让类的实例化推迟到子类中进行。属于创建型设计模式。</p>
<p><strong>适用场景：</strong> </p>
<ul>
<li>创建对象需要大量重复的代码。</li>
<li>客户端(应用层)不依赖产品类实例如何被创建、实现等细节。</li>
<li>一个类通过其子类来指定创建哪个对象。</li>
</ul>
<p><strong>优点：</strong> </p>
<ul>
<li>用户只需关心所需产品对应的工厂，无需关心创建细节。</li>
<li>加入新产品需求符合开闭原则，提高了系统的可扩展性。</li>
</ul>
<p><strong>缺点：</strong> </p>
<ul>
<li>类的个数容易过多，增加了代码的复杂度。</li>
<li>增加了系统的抽象性和理解难度。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">public interface ILanguages &#123;</span><br><span class="line">    void out();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class JavaLanguage implements ILanguages &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void out() &#123;</span><br><span class="line">        System.out.println(&quot;JavaLanguage--------------&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class PythonLanguage implements ILanguages &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void out() &#123;</span><br><span class="line">        System.out.println(&quot;PythonLanguage--------------&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public interface ILanaguageFactory &#123;</span><br><span class="line">     ILanguages create();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class JavaLanguageFactory implements ILanaguageFactory &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public ILanguages create() &#123;</span><br><span class="line">        return new JavaLanguage();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class PythonLanguageFactory implements ILanaguageFactory &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public ILanguages create() &#123;</span><br><span class="line">        return new PythonLanguage();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class Test &#123;</span><br><span class="line">    public static void main(String[] args)&#123;</span><br><span class="line">        System.out.println(&quot;pattern----------------start&quot;);</span><br><span class="line">        ILanaguageFactory languageFactory = new JavaLanguageFactory();</span><br><span class="line">        ILanguages languages = languageFactory.create();</span><br><span class="line">        languages.out();</span><br><span class="line">        System.out.println(&quot;pattern----------------end&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="抽象工厂模式"><a href="#抽象工厂模式" class="headerlink" title="抽象工厂模式"></a>抽象工厂模式</h3><p>抽象工厂模式(Abastract Factory Pattern)是指提供一个创建一系列相关或相互依赖对象的接口，无须指定他们具体的类。属于创建型设计模式。<br><img src="http://nunu03.github.io/2022/06/20/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/pattern-factory.png" alt><br>产品族：一系列的相关的产品，整合到一起有关联性。<br>产品等级：同一个继承体系。</p>
<p><strong>适用场景：</strong> </p>
<ul>
<li>客户端(应用层)不依赖产品类实例如何被创建、实现等细节。</li>
<li>强调一系列相关的产品对象(属于同一产品族)一起使用创建对象需要大量重复的代码。</li>
<li>提供一个产品类的库，所有的产品以同样的接口出现，从而使客户端不依赖于具体实现。</li>
</ul>
<p><strong>优点：</strong> </p>
<ul>
<li>具体产品在应用层代码隔离，无须关心创建细节。</li>
<li>将一个系列的产品族统一到一起创建。</li>
</ul>
<p><strong>缺点：</strong> </p>
<ul>
<li>规定了所有可能被创建的产品集合，产品族中扩展新的产品困难，需要修改抽象工厂的接口。</li>
<li>增加了系统的抽象性和理解难度。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">public interface IFile &#123;</span><br><span class="line">    void setParams();</span><br><span class="line">&#125;</span><br><span class="line">public interface IMethod &#123;</span><br><span class="line">    void setValue();</span><br><span class="line">&#125;</span><br><span class="line">public abstract class LanguageFactory &#123;</span><br><span class="line">    public void init()&#123;</span><br><span class="line">        System.out.println(&quot;初始化&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    protected  abstract IFile createFile();</span><br><span class="line"></span><br><span class="line">    protected  abstract IMethod createMethod();</span><br><span class="line">&#125;</span><br><span class="line">.......................................................</span><br><span class="line">public class JavaFile implements IFile&#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void setParams() &#123;</span><br><span class="line">        System.out.println(&quot;JavaFile-----setParams&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">public class JavaMethod implements  IMethod&#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void setValue() &#123;</span><br><span class="line">        System.out.println(&quot;JavaMethod-----setValue&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">public class JavaLanguageFactory extends LanguageFactory &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected IFile createFile() &#123;</span><br><span class="line">        super.init();</span><br><span class="line">        return new JavaFile();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected IMethod createMethod() &#123;</span><br><span class="line">        super.init();</span><br><span class="line">        return new JavaMethod();</span><br><span class="line">&#125;</span><br><span class="line">.......................................................</span><br><span class="line">public class PythonFile implements IFile &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void setParams() &#123;</span><br><span class="line">        System.out.println(&quot;PythonFile-----setParams&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">public class PythonMethod implements IMethod &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void setValue() &#123;</span><br><span class="line">        System.out.println(&quot;PythonMethod-----setValue&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">public class PythonLanguageFactory extends LanguageFactory &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected IFile createFile() &#123;</span><br><span class="line">        super.init();</span><br><span class="line">        return new PythonFile();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected IMethod createMethod() &#123;</span><br><span class="line">        super.init();</span><br><span class="line">        return new PythonMethod();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">.......................................................</span><br><span class="line">public class Test &#123;</span><br><span class="line">    public static void main(String[] args)&#123;</span><br><span class="line">        System.out.println(&quot;pattern----------------start&quot;);</span><br><span class="line">        LanguageFactory factory = new JavaLanguageFactory();</span><br><span class="line">        factory.createFile().setParams();</span><br><span class="line">        factory.createMethod().setValue();</span><br><span class="line">        System.out.println(&quot;pattern----------------end&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>比如在58同城IM source体系中，具体的业务实现，可以分为交友与同镇，同城等，三者大部分业务相同，但是也有不同的业务卡片。</p>
<h2 id="2-单例模式"><a href="#2-单例模式" class="headerlink" title="2.单例模式"></a>2.单例模式</h2><p>单例模式(Singleton Pattern) 是指确保一个类在任何情况下都绝对只有一个实例，并提供一个全局访问点，防止重复创建。隐藏其所有的构造方法。属于创建型模式。</p>
<p><strong>适用场景：</strong></p>
<ul>
<li>确保任何情况下都绝对只有一个实例。ApplicationContext、ServletConfig、DBPool。</li>
</ul>
<p><strong>优点：</strong></p>
<ul>
<li>在内存中只有一个实例，减少了内存开销。</li>
<li>可以避免对资源的多重占用。</li>
<li>设置全局访问点，严格控制访问。</li>
</ul>
<p><strong>缺点：</strong></p>
<ul>
<li>没有接口，扩展困难。</li>
<li>如果要扩展单例对象，只有修改代码，没有其他途径。</li>
</ul>
<h3 id="饿汉式单例"><a href="#饿汉式单例" class="headerlink" title="饿汉式单例"></a>饿汉式单例</h3><p>在单例类首次加载时就创建实例。</p>
<p><strong>优点：</strong></p>
<ul>
<li>执行效率高</li>
<li>性能高</li>
<li>没有任何锁</li>
</ul>
<p><strong>缺点：</strong></p>
<ul>
<li>某些情况下，可能会造成内存浪费(类加载就会创建，但不一定会被使用)<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public class HungrySingleton &#123;</span><br><span class="line">    private static HungrySingleton mInstanace = new HungrySingleton();</span><br><span class="line">    private HungrySingleton()&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    public static HungrySingleton getInstance()&#123;</span><br><span class="line">        return mInstanace;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>另一种写法：和上述没本质区别；</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">public class HungryStaticSingleton &#123;</span><br><span class="line">    // 类加载顺序：先静态后动态；先上，后下；先属性后方法。</span><br><span class="line">    private static final HungryStaticSingleton mInstance;</span><br><span class="line">    //在静态代码块中初始化：</span><br><span class="line">    static &#123;</span><br><span class="line">       mInstance = new HungryStaticSingleton();</span><br><span class="line">    &#125;</span><br><span class="line">    private HungryStaticSingleton()&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    public static HungryStaticSingleton getInstance()&#123;</span><br><span class="line">        return mInstance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="懒汉式单例"><a href="#懒汉式单例" class="headerlink" title="懒汉式单例"></a>懒汉式单例</h3><p>被外部类调用时才创建实例。</p>
<p><strong>优点：</strong></p>
<ul>
<li>在调用时创建实例，节省内存。</li>
</ul>
<p><strong>缺点：</strong></p>
<ul>
<li>多线程时，如果同时都进入条件，会导致多线程不安全，指令重排序问题。</li>
</ul>
<h4 id="线程不安全"><a href="#线程不安全" class="headerlink" title="线程不安全"></a>线程不安全</h4><p>如果两个线程同时调用，有可能创建两个不同实例。</p>
<ul>
<li>同一个实例：</li>
</ul>
<p>1.正常顺序执行，正常结果<br>2.同时进入条件，后一个覆盖前一个实例，异常情况。</p>
<ul>
<li>不同实例：<br>同时进入条件，按顺序返回</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">public class LazySington &#123;</span><br><span class="line">    private static LazySington mInstance;</span><br><span class="line">    private LazySington()&#123;&#125;</span><br><span class="line">    public static LazySington getInstance()&#123;</span><br><span class="line">        if (null == mInstance)&#123;</span><br><span class="line">            mInstance = new LazySington();</span><br><span class="line">        &#125;</span><br><span class="line">        return mInstance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="线程安全"><a href="#线程安全" class="headerlink" title="线程安全"></a>线程安全</h4><p>增加synchronized锁：当有线程执行到条件RUNNING时，其他的线程状态是MONITOR状态，不能进入getInstance()，而是进入监听等待状态，即为阻塞。当第一线程执行完后，其他的线程状态改为了RUNNING，继续执行。<br>但是这个synchronized阻塞了所有资源，即使mInstance不为空，也会阻塞。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">public class LazySington &#123;</span><br><span class="line">    private static LazySington mInstance;</span><br><span class="line">    private LazySington()&#123;&#125;</span><br><span class="line">    public synchronized static LazySington getInstance()&#123;</span><br><span class="line">        if (null == mInstance)&#123;</span><br><span class="line">            mInstance = new LazySington();</span><br><span class="line">        &#125;</span><br><span class="line">        return mInstance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>改进,使阻塞粒度变得更小：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">public class LazySington &#123;</span><br><span class="line">    private static LazySington mInstance;</span><br><span class="line">    private LazySington()&#123;&#125;</span><br><span class="line">    public static LazySington getInstance()&#123;</span><br><span class="line">        if (null == mInstance)&#123;</span><br><span class="line">            synchronized (LazySington.class)&#123;</span><br><span class="line">                mInstance = new LazySington();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return mInstance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>再次改进：看双重校验</p>
<h4 id="双重校验"><a href="#双重校验" class="headerlink" title="双重校验"></a>双重校验</h4><p>但是这个时候如果多线程问题，还时存在指令重排问题的：解决方案，就是增加 volatile</p>
<p><strong>优点：</strong></p>
<ul>
<li>性能高，线程安全</li>
</ul>
<p><strong>缺点：</strong></p>
<ul>
<li>可读性差，多重判空</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">public class LazySington &#123;</span><br><span class="line">    private volatile static LazySington mInstance;</span><br><span class="line">    private LazySington()&#123;&#125;</span><br><span class="line">    public static LazySington getInstance()&#123;</span><br><span class="line">        // 检查是否阻塞</span><br><span class="line">        if (null == mInstance)&#123;</span><br><span class="line">            synchronized (LazySington.class)&#123;</span><br><span class="line">                // 检查是否重新创建实例</span><br><span class="line">                if (null == mInstance)&#123;</span><br><span class="line">                    mInstance = new LazySington();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return mInstance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="静态内部类"><a href="#静态内部类" class="headerlink" title="静态内部类"></a>静态内部类</h4><p><strong>优点：</strong></p>
<ul>
<li>写法优雅，利用了java本身的语法特点</li>
<li>性能高，避免了内存浪费</li>
</ul>
<p><strong>缺点：</strong></p>
<ul>
<li>能够被反射破坏，其实上述单例都能够被破坏。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 先加载类：首先加载LazyInnerSingleton.class</span><br><span class="line"> * 再加载内部类：LazyInnerSingleton&amp;LazyInnerSingletonHolder.class</span><br><span class="line"> */</span><br><span class="line">public class LazyInnerSingleton &#123;</span><br><span class="line">    private LazyInnerSingleton()&#123;&#125;</span><br><span class="line">    public static LazyInnerSingleton getInstance()&#123;</span><br><span class="line">        return LazyInnerSingletonHolder.INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line">    //只在使用的时候才分配内存，进行加载</span><br><span class="line">    private static class LazyInnerSingletonHolder&#123;</span><br><span class="line">        private static final LazyInnerSingleton INSTANCE = new LazyInnerSingleton();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="反射破坏单例"><a href="#反射破坏单例" class="headerlink" title="反射破坏单例"></a>反射破坏单例</h3><p>以静态内部类反射为例：<br><strong>反射：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">public class ReflectTest &#123;</span><br><span class="line">    public static void main(String[] args)&#123;</span><br><span class="line">        try&#123;</span><br><span class="line">            Class&lt;?&gt; clazz = LazyInnerSingleton.class;</span><br><span class="line">            Constructor constructor = clazz.getDeclaredConstructor();</span><br><span class="line">            constructor.setAccessible(true);</span><br><span class="line">            Object instance = constructor.newInstance();</span><br><span class="line">            System.out.println(instance);</span><br><span class="line">            Object instance1 = constructor.newInstance();</span><br><span class="line">            System.out.println(instance1);</span><br><span class="line">        &#125;catch (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输入结果:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">com.javadesignpatterns.Singleton.lazy.LazyInnerSingleton@15db9742</span><br><span class="line">com.javadesignpatterns.Singleton.lazy.LazyInnerSingleton@6d06d69c</span><br></pre></td></tr></table></figure>

<p>所以，多个实例，违背了单例的单一原则。<br>所以改进,在构造方法中增加非空判断：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 先加载类：首先加载LazyInnerSingleton.class</span><br><span class="line"> * 再加载内部类：LazyInnerSingleton&amp;LazyInnerSingletonHolder.class</span><br><span class="line"> */</span><br><span class="line">public class LazyInnerSingleton &#123;</span><br><span class="line">    private LazyInnerSingleton()&#123;</span><br><span class="line">        if (LazyInnerSingletonHolder.INSTANCE != null)&#123;</span><br><span class="line">            throw new RuntimeException(&quot;不允许非法的访问&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    public static LazyInnerSingleton getInstance()&#123;</span><br><span class="line">        return LazyInnerSingletonHolder.INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line">    //只在使用的时候才分配内存，进行加载</span><br><span class="line">    private static class LazyInnerSingletonHolder&#123;</span><br><span class="line">        private static final LazyInnerSingleton INSTANCE = new LazyInnerSingleton();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>输出：Caused by: java.lang.RuntimeException: 不允许非法的访问</strong></p>
<p><strong>优点：</strong></p>
<ul>
<li>写法优雅，利用了java本身的语法特点</li>
<li>性能高，避免了内存浪费</li>
<li>不能被反射破坏</li>
</ul>
<p><strong>缺点：</strong></p>
<ul>
<li>代码不优雅。<br>那如何再次改进，看注册式单例：</li>
</ul>
<h3 id="注册式单例"><a href="#注册式单例" class="headerlink" title="注册式单例"></a>注册式单例</h3><p>大批量创建单例，将每一个实例都缓存到统一的容器中，使用唯一标识获取实例。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">public class ContainerSingleton &#123;</span><br><span class="line">    private ContainerSingleton()&#123;&#125;</span><br><span class="line">    private static Map&lt;String,Object&gt; ioc = new ConcurrentHashMap&lt;&gt;();</span><br><span class="line">    public static Object getInstance(String className)&#123;</span><br><span class="line">        if (!ioc.containsKey(className))&#123;</span><br><span class="line">            Object instance = null;</span><br><span class="line">            try &#123;</span><br><span class="line">                instance = Class.forName(className).newInstance();</span><br><span class="line">                ioc.put(className,instance);</span><br><span class="line">            &#125; catch (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            return instance;</span><br><span class="line">        &#125;else &#123;</span><br><span class="line">            return ioc.get(className);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="序列化、反序列化破坏单例"><a href="#序列化、反序列化破坏单例" class="headerlink" title="序列化、反序列化破坏单例"></a>序列化、反序列化破坏单例</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">public class SeriableHungrySingleton implements Serializable &#123;</span><br><span class="line">    //序列化：把内存中对象的状态转换为字节码的形式，再把字节码通过IO输出流，写到磁盘上，永久保存，持久化。</span><br><span class="line"></span><br><span class="line">    //反序列化：将持久化的字节码内容通过IO输入流读到内存中来，再转换成一个对象。</span><br><span class="line"></span><br><span class="line">    private static SeriableHungrySingleton mInstanace = new SeriableHungrySingleton();</span><br><span class="line">    private SeriableHungrySingleton()&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    public static SeriableHungrySingleton getInstance()&#123;</span><br><span class="line">        return mInstanace;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">public class SeriableHungrySingletonTest &#123;</span><br><span class="line">    public static void main(String[] args)&#123;</span><br><span class="line">        SeriableHungrySingleton s1 = null;</span><br><span class="line">        SeriableHungrySingleton s2 = SeriableHungrySingleton.getInstance();</span><br><span class="line">        FileOutputStream fos = null;</span><br><span class="line">        try &#123;</span><br><span class="line">            fos = new FileOutputStream(&quot;SeriableHungrySingleton.obj&quot;);</span><br><span class="line">            ObjectOutputStream oos = new ObjectOutputStream(fos);</span><br><span class="line">            oos.writeObject(s2);</span><br><span class="line">            oos.flush();;</span><br><span class="line">            oos.close();</span><br><span class="line"></span><br><span class="line">            FileInputStream fis = new FileInputStream(&quot;SeriableHungrySingleton.obj&quot;);</span><br><span class="line">            ObjectInputStream ois = new ObjectInputStream(fis);</span><br><span class="line">            s1 = (SeriableHungrySingleton)ois.readObject();</span><br><span class="line">            ois.close();</span><br><span class="line"></span><br><span class="line">            System.out.println(s1);</span><br><span class="line">            System.out.println(s2);</span><br><span class="line">            System.out.println(s1==s2);</span><br><span class="line">        &#125;catch (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出结果：两次得到的实例不一样</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">com.javadesignpatterns.seriable.SeriableHungrySingleton@776ec8df</span><br><span class="line">com.javadesignpatterns.seriable.SeriableHungrySingleton@5c647e05</span><br><span class="line">false</span><br></pre></td></tr></table></figure>

<p>如何解决：增加一个readResolve()方法</p>
<figure class="highlight plain"><figcaption><span>class SeriableHungrySingleton implements Serializable &#123;</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">    .............</span><br><span class="line">    private Object readResolve()&#123;</span><br><span class="line">        return mInstanace;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试，输入结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">com.javadesignpatterns.seriable.SeriableHungrySingleton@5c647e05</span><br><span class="line">com.javadesignpatterns.seriable.SeriableHungrySingleton@5c647e05</span><br><span class="line">true</span><br></pre></td></tr></table></figure>

<p>那为什么加一个readResolve，就解决了呢？需要看readObject源码，在这个源码里有一个<br> checkResolve(readOrdinaryObject(unshared));</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">private Object readOrdinaryObject(boolean unshared)</span><br><span class="line">    。。。。。。。。。。。。。。。。。。。。。</span><br><span class="line">    Object obj;</span><br><span class="line">        try &#123;</span><br><span class="line">            // newInstance，创建实例</span><br><span class="line">            obj = desc.isInstantiable() ? desc.newInstance() : null;</span><br><span class="line">        &#125; catch (Exception ex) &#123;</span><br><span class="line">            throw (IOException) new InvalidClassException(</span><br><span class="line">                desc.forClass().getName(),</span><br><span class="line">                &quot;unable to create instance&quot;).initCause(ex);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        passHandle = handles.assign(unshared ? unsharedMarker : obj);</span><br><span class="line">        ClassNotFoundException resolveEx = desc.getResolveException();</span><br><span class="line">        if (resolveEx != null) &#123;</span><br><span class="line">            handles.markException(passHandle, resolveEx);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        if (desc.isExternalizable()) &#123;</span><br><span class="line">            readExternalData((Externalizable) obj, desc);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            readSerialData(obj, desc);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        handles.finish(passHandle);</span><br><span class="line">    if (obj != null &amp;&amp;</span><br><span class="line">        handles.lookupException(passHandle) == null &amp;&amp;</span><br><span class="line">        desc.hasReadResolveMethod())</span><br><span class="line">    &#123;</span><br><span class="line">        //通过反射获取ReadResolve对象，这个就是我们单例中readResolve返回的对象</span><br><span class="line">        Object rep = desc.invokeReadResolve(obj);</span><br><span class="line">        if (unshared &amp;&amp; rep.getClass().isArray()) &#123;</span><br><span class="line">            rep = cloneArray(rep);</span><br><span class="line">        &#125;</span><br><span class="line">        //如果跟newInstance的对象不一样，就赋值给obj，返回，这个就不时新创建新的对象了。</span><br><span class="line">        if (rep != obj) &#123;</span><br><span class="line">            // Filter the replacement object</span><br><span class="line">            if (rep != null) &#123;</span><br><span class="line">                if (rep.getClass().isArray()) &#123;</span><br><span class="line">                    filterCheck(rep.getClass(), Array.getLength(rep));</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    filterCheck(rep.getClass(), -1);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            handles.setObject(passHandle, obj = rep);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return obj;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">private Object checkResolve(Object obj) throws IOException &#123;</span><br><span class="line">    if (!enableResolve || handles.lookupException(passHandle) != null) &#123;</span><br><span class="line">        return obj;</span><br><span class="line">    &#125;</span><br><span class="line">    Object rep = resolveObject(obj);</span><br><span class="line">    if (rep != obj) &#123;</span><br><span class="line">        // The type of the original object has been filtered but resolveObject</span><br><span class="line">        // may have replaced it;  filter the replacement&apos;s type</span><br><span class="line">        if (rep != null) &#123;</span><br><span class="line">            if (rep.getClass().isArray()) &#123;</span><br><span class="line">                filterCheck(rep.getClass(), Array.getLength(rep));</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                filterCheck(rep.getClass(), -1);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        handles.setObject(passHandle, rep);</span><br><span class="line">    &#125;</span><br><span class="line">    return rep;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ThreadLocal单例"><a href="#ThreadLocal单例" class="headerlink" title="ThreadLocal单例"></a>ThreadLocal单例</h3><p>保证线程内部的全局唯一，且天生线程安全。但是在不同的线程，肯定是不同的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">public class ThreadLocalSingleton &#123;</span><br><span class="line">    public static ThreadLocalSingleton getInstance()&#123;</span><br><span class="line">        return threadLocalInstance.get();</span><br><span class="line">    &#125;</span><br><span class="line">    private ThreadLocalSingleton()&#123;&#125;</span><br><span class="line">    private static final ThreadLocal&lt;ThreadLocalSingleton&gt; threadLocalInstance =</span><br><span class="line">            new ThreadLocal&lt;ThreadLocalSingleton&gt;()&#123;</span><br><span class="line">                @Override</span><br><span class="line">                protected ThreadLocalSingleton initialValue() &#123;</span><br><span class="line">                    return new ThreadLocalSingleton();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public class ThreadLocalSingletonTest &#123;</span><br><span class="line">    //在主线程</span><br><span class="line">    public static void main(String[] args)&#123;</span><br><span class="line">        System.out.println(ThreadLocalSingleton.getInstance());</span><br><span class="line">        System.out.println(ThreadLocalSingleton.getInstance());</span><br><span class="line">        System.out.println(ThreadLocalSingleton.getInstance());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">com.javadesignpatterns.Singleton.threadlocal.ThreadLocalSingleton@15db9742</span><br><span class="line">com.javadesignpatterns.Singleton.threadlocal.ThreadLocalSingleton@15db9742</span><br><span class="line">com.javadesignpatterns.Singleton.threadlocal.ThreadLocalSingleton@15db9742</span><br></pre></td></tr></table></figure>

<p>ThreadLocal：getEntry(this),就是当前线程位key。从map中获取：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">public T get() &#123;</span><br><span class="line">    Thread t = Thread.currentThread();</span><br><span class="line">    ThreadLocalMap map = getMap(t);</span><br><span class="line">    if (map != null) &#123;</span><br><span class="line">        ThreadLocalMap.Entry e = map.getEntry(this);</span><br><span class="line">        if (e != null) &#123;</span><br><span class="line">            @SuppressWarnings(&quot;unchecked&quot;)</span><br><span class="line">            T result = (T)e.value;</span><br><span class="line">            return result;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return setInitialValue();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><ul>
<li>1.私有化构造方法。</li>
<li>2.保证线程安全。</li>
<li>3.延迟加载。</li>
<li>4.防止序列化和反序列化破坏单例。</li>
<li>5.防止反射攻击单例。</li>
</ul>
<h2 id="3-原型模式"><a href="#3-原型模式" class="headerlink" title="3.原型模式"></a>3.原型模式</h2><p>原型模式(Prototype Pattern),是指原型实例指定创建对象的种类，并且通过拷贝这些原型创建新的对象。调用者不需要知道任何创建细节，不调用构造函数。属于创建型模式。</p>
<p><strong>适用场景：</strong></p>
<ul>
<li>类初始化消耗资源较多。</li>
<li>new 产生的一个对象需要非常繁琐的过程（数据准备、访问权限等）。</li>
<li>构造函数比较复杂。</li>
<li>循环体中生成大量对象时。</li>
</ul>
<p><strong>优点：</strong></p>
<ul>
<li>在内存中只有一个实例，减少了内存开销，性能优良。</li>
<li>可以避免对资源的多重占用。</li>
<li>设置全局访问点，严格控制访问。</li>
<li>java自带的原型模式是基于内存二进制流的拷贝，比直接new对象性能上提升很多。</li>
<li>可以用深克隆的方式保存对象的状态，使用原型模式将对象复制一份并将其状态保存起来，简化了流程。</li>
</ul>
<p><strong>缺点：</strong></p>
<ul>
<li>必须配备克隆方法。</li>
<li>当对已有类进行改造的时候，需要修改代码，违反了开闭原则。</li>
<li>深拷贝、浅拷贝需要运用得当。</li>
<li>原型模式和单例模式的使用是互斥的。</li>
</ul>
<p>通用写法举例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">public interface IPrototype&lt;T&gt; &#123;</span><br><span class="line">    T clone();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class LanguageBean implements IPrototype&#123;</span><br><span class="line">    public String id;</span><br><span class="line">    public String name;</span><br><span class="line">    public String nickName;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public LanguageBean clone() &#123;</span><br><span class="line">        LanguageBean languageBean = new LanguageBean();</span><br><span class="line">        languageBean.id = &quot;2&quot;;</span><br><span class="line">        languageBean.name =&quot;java&quot;;</span><br><span class="line">        languageBean.nickName=&quot;javaName&quot;;</span><br><span class="line">        return languageBean;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String toString() &#123;</span><br><span class="line">        return &quot;LanguageBean&#123;&quot; +</span><br><span class="line">                &quot;id=&apos;&quot; + id + &apos;\&apos;&apos; +</span><br><span class="line">                &quot;, name=&apos;&quot; + name + &apos;\&apos;&apos; +</span><br><span class="line">                &quot;, nickName=&apos;&quot; + nickName + &apos;\&apos;&apos; +</span><br><span class="line">                &apos;&#125;&apos;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">//也可以通过反射赋值clone，在58时曾经用过这种方式。</span><br><span class="line">public class LanguageUtils &#123;</span><br><span class="line">    public static Object copy(Object prototype)&#123;</span><br><span class="line">        Class clazz = prototype.getClass();</span><br><span class="line">        Object objectVlue = null;</span><br><span class="line">        try&#123;</span><br><span class="line">            objectVlue = clazz.newInstance();</span><br><span class="line">            for (Field field: clazz.getDeclaredFields())&#123;</span><br><span class="line">                field.setAccessible(true);</span><br><span class="line">                field.set(objectVlue,field.get(prototype));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;catch (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        return  objectVlue;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">public class Test &#123;</span><br><span class="line">    public static void main(String[] args)&#123;</span><br><span class="line">        System.out.println(&quot;pattern----------------start&quot;);</span><br><span class="line">        //创建原型对象</span><br><span class="line">        LanguageBean languageBean = new LanguageBean();</span><br><span class="line">        languageBean.id = &quot;2&quot;;</span><br><span class="line">        languageBean.name =&quot;java&quot;;</span><br><span class="line">        languageBean.nickName=&quot;javaName&quot;;</span><br><span class="line">        System.out.println(languageBean);</span><br><span class="line">        // 拷贝原型对象</span><br><span class="line">        LanguageBean cloneBean = languageBean.clone();</span><br><span class="line">        System.out.println(cloneBean);</span><br><span class="line">        System.out.println(&quot;pattern----------------end&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出：一模一样，通过方法clone，没有通过new。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pattern----------------start</span><br><span class="line">LanguageBean&#123;id=&apos;2&apos;, name=&apos;java&apos;, nickName=&apos;javaName&apos;&#125;</span><br><span class="line">LanguageBean&#123;id=&apos;2&apos;, name=&apos;java&apos;, nickName=&apos;javaName&apos;&#125;</span><br><span class="line">pattern----------------end</span><br></pre></td></tr></table></figure>

<h3 id="浅克隆"><a href="#浅克隆" class="headerlink" title="浅克隆"></a>浅克隆</h3><p>使用jdk的Cloneable接口，它的实现是在Object类中,而Object的clone是一个native方法。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * @author  unascribed</span><br><span class="line"> * @see     java.lang.CloneNotSupportedException</span><br><span class="line"> * @see     java.lang.Object#clone()</span><br><span class="line"> * @since   JDK1.0</span><br><span class="line"> */</span><br><span class="line">public interface Cloneable &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class Object &#123;</span><br><span class="line">    protected native Object clone() throws CloneNotSupportedException;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class LanguageBean implements Cloneable &#123;</span><br><span class="line">    public String id;</span><br><span class="line">    public String name;</span><br><span class="line">    public String nickName;</span><br><span class="line">    public List&lt;String&gt; method;//添加一个list</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public LanguageBean clone() &#123;</span><br><span class="line">        try&#123;</span><br><span class="line">            return (LanguageBean)super.clone();</span><br><span class="line">        &#125;catch (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            return null;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String toString() &#123;</span><br><span class="line">        return &quot;LanguageBean&#123;&quot; +</span><br><span class="line">                &quot;id=&apos;&quot; + id + &apos;\&apos;&apos; +</span><br><span class="line">                &quot;, name=&apos;&quot; + name + &apos;\&apos;&apos; +</span><br><span class="line">                &quot;, nickName=&apos;&quot; + nickName + &apos;\&apos;&apos; +</span><br><span class="line">                &quot;, method=&quot; + method +</span><br><span class="line">                &apos;&#125;&apos;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">public static void main(String[] args)&#123;</span><br><span class="line">    System.out.println(&quot;pattern----------------start&quot;);</span><br><span class="line">    //创建原型对象</span><br><span class="line">    LanguageBean languageBean = new LanguageBean();</span><br><span class="line">    languageBean.id = &quot;2&quot;;</span><br><span class="line">    languageBean.name =&quot;java&quot;;</span><br><span class="line">    languageBean.nickName=&quot;javaName&quot;;</span><br><span class="line">    List&lt;String&gt; listMethod = new ArrayList&lt;String&gt;();</span><br><span class="line">    listMethod.add(&quot;money&quot;);</span><br><span class="line">    listMethod.add(&quot;cat&quot;);</span><br><span class="line">    languageBean.method = listMethod;</span><br><span class="line">    System.out.println(languageBean);</span><br><span class="line">    // 拷贝原型对象</span><br><span class="line">    LanguageBean cloneBean = languageBean.clone();</span><br><span class="line">    cloneBean.method.add(&quot;dog&quot;);</span><br><span class="line">    System.out.println(cloneBean);</span><br><span class="line">    System.out.println(languageBean);</span><br><span class="line">    System.out.println(languageBean==cloneBean);</span><br><span class="line">    System.out.println(&quot;pattern----------------end&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输入：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">pattern----------------start</span><br><span class="line">LanguageBean&#123;id=&apos;2&apos;, name=&apos;java&apos;, nickName=&apos;javaName&apos;, method=[money, cat]&#125;</span><br><span class="line">LanguageBean&#123;id=&apos;2&apos;, name=&apos;java&apos;, nickName=&apos;javaName&apos;, method=[money, cat, dog]&#125;</span><br><span class="line">LanguageBean&#123;id=&apos;2&apos;, name=&apos;java&apos;, nickName=&apos;javaName&apos;, method=[money, cat, dog]&#125;</span><br><span class="line">false</span><br><span class="line">pattern----------------end</span><br></pre></td></tr></table></figure>

<p>可以看到，第2和3打印的结果竟然一致，但是我们第三个原型对象并没有添加dog。并且原型和克隆对象的地址不是一个（打印的结果时false）。<br>再打印下List对象：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(cloneBean.method);</span><br><span class="line">System.out.println(languageBean.method);</span><br><span class="line">System.out.println(languageBean.method==cloneBean.method);</span><br></pre></td></tr></table></figure>

<p>输入：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[money, cat, dog]</span><br><span class="line">[money, cat, dog]</span><br><span class="line">true</span><br></pre></td></tr></table></figure>

<p>所以，两个对象中的List地址是一样的，也就是共用了一个List对象。所以，通过Cloneable的clone的对象，如果是引用类型属性，只是拷贝了内存地址，并没有拷贝具体的元素。所以当改变元素内容时，也改变了原型对象内的元素。<br><strong>解决方案：深克隆</strong></p>
<h3 id="深克隆"><a href="#深克隆" class="headerlink" title="深克隆"></a>深克隆</h3><p>不使用默认的clone，而是通过序列化和反序列化进行克隆，或者通过转换成JSON:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">public class LanguageBean implements Cloneable , Serializable &#123;</span><br><span class="line">    public String id;</span><br><span class="line">    public String name;</span><br><span class="line">    public String nickName;</span><br><span class="line">    public List&lt;String&gt; method;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public LanguageBean clone() &#123;</span><br><span class="line">        try&#123;</span><br><span class="line">            return (LanguageBean)super.clone();</span><br><span class="line">        &#125;catch (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            return null;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 采用ArrayList的深克隆方式</span><br><span class="line">    public LanguageBean deepCloneMethod() &#123;</span><br><span class="line">        try&#123;</span><br><span class="line">            LanguageBean languageBean =  (LanguageBean)super.clone();</span><br><span class="line">            languageBean.method = (List&lt;String&gt;) ((ArrayList)languageBean.method).clone();</span><br><span class="line">            return languageBean;</span><br><span class="line">        &#125;catch (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            return null;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //通过序列化克隆</span><br><span class="line">    public LanguageBean deepClone()&#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            ByteArrayOutputStream bos = new ByteArrayOutputStream();</span><br><span class="line">            ObjectOutputStream oos = new ObjectOutputStream(bos);</span><br><span class="line">            oos.writeObject(this);</span><br><span class="line"></span><br><span class="line">            ByteArrayInputStream bis = new ByteArrayInputStream(bos.toByteArray());</span><br><span class="line">            ObjectInputStream ois = new ObjectInputStream(bis);</span><br><span class="line">            return (LanguageBean)ois.readObject();</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            return null;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String toString() &#123;</span><br><span class="line">        return &quot;LanguageBean&#123;&quot; +</span><br><span class="line">                &quot;id=&apos;&quot; + id + &apos;\&apos;&apos; +</span><br><span class="line">                &quot;, name=&apos;&quot; + name + &apos;\&apos;&apos; +</span><br><span class="line">                &quot;, nickName=&apos;&quot; + nickName + &apos;\&apos;&apos; +</span><br><span class="line">                &quot;, method=&quot; + method +</span><br><span class="line">                &apos;&#125;&apos;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试一下啊：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">public static void main(String[] args)&#123;</span><br><span class="line">    System.out.println(&quot;pattern----------------start&quot;);</span><br><span class="line">    //创建原型对象</span><br><span class="line">    LanguageBean languageBean = new LanguageBean();</span><br><span class="line">    languageBean.id = &quot;2&quot;;</span><br><span class="line">    languageBean.name =&quot;java&quot;;</span><br><span class="line">    languageBean.nickName=&quot;javaName&quot;;</span><br><span class="line">    List&lt;String&gt; listMethod = new ArrayList&lt;String&gt;();</span><br><span class="line">    listMethod.add(&quot;money&quot;);</span><br><span class="line">    listMethod.add(&quot;cat&quot;);</span><br><span class="line">    languageBean.method = listMethod;</span><br><span class="line">    System.out.println(languageBean);</span><br><span class="line">    // 拷贝原型对象</span><br><span class="line">    LanguageBean cloneBean = languageBean.deepClone();</span><br><span class="line">    cloneBean.method.add(&quot;dog&quot;);</span><br><span class="line">    System.out.println(cloneBean);</span><br><span class="line">    System.out.println(languageBean);</span><br><span class="line">    System.out.println(languageBean==cloneBean);</span><br><span class="line"></span><br><span class="line">    System.out.println(cloneBean.method);</span><br><span class="line">    System.out.println(languageBean.method);</span><br><span class="line">    System.out.println(languageBean.method==cloneBean.method);</span><br><span class="line">    System.out.println(&quot;pattern----------------end&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出结果：没问题了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">pattern----------------start</span><br><span class="line">LanguageBean&#123;id=&apos;2&apos;, name=&apos;java&apos;, nickName=&apos;javaName&apos;, method=[money, cat]&#125;</span><br><span class="line">LanguageBean&#123;id=&apos;2&apos;, name=&apos;java&apos;, nickName=&apos;javaName&apos;, method=[money, cat, dog]&#125;</span><br><span class="line">LanguageBean&#123;id=&apos;2&apos;, name=&apos;java&apos;, nickName=&apos;javaName&apos;, method=[money, cat]&#125;</span><br><span class="line">false</span><br><span class="line">[money, cat, dog]</span><br><span class="line">[money, cat]</span><br><span class="line">false</span><br><span class="line">pattern----------------end</span><br></pre></td></tr></table></figure>

<p><strong>但是这个deepClone，也有可能是有问题的，如果这个原型是个单例，就有可能被破坏。所以如果是单例，就不能实现Cloneable的clone接口，或者实现的话，就直接返回instance。所以原型和单例其实是互斥的。</strong></p>
<h2 id="4-适配器模式"><a href="#4-适配器模式" class="headerlink" title="4.适配器模式"></a>4.适配器模式</h2><p>适配器模式(Adapter Pattern)也叫变压器模式，它的功能是将一个类的接口变成客户端所期望的另一种接口，从而使原本因接口不匹配而导致无法在一起工作的两个类能够一起工作。属于结构性设计模式。</p>
<p><strong>适用场景：</strong></p>
<ul>
<li>已经存在的类，它的方法和需求不匹配的情况。</li>
<li>适配器模式不是软件设计阶段考虑的设计模式，是随着软件维护，由于不同产品、不同厂家造成功能类似而接口不相同情况下的解决方案。</li>
</ul>
<p><strong>优点：</strong></p>
<ul>
<li>解决兼容问题。</li>
<li>能提高类的透明性和复用，现有的类复用但不需要改变。</li>
<li>目标类和适配器类解耦，提高程序的扩展性。</li>
<li>在很多业务场景中符合开闭原则。</li>
</ul>
<p><strong>缺点：</strong></p>
<ul>
<li>适配器在编写过程中需要全名考虑，可能会增加系统的复杂性。</li>
<li>增加代码阅读难度，降低代码可读性，过多使用适配器会使系统代码变的凌乱。</li>
</ul>
<h3 id="类适配器"><a href="#类适配器" class="headerlink" title="类适配器"></a>类适配器</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">public interface Its &#123;</span><br><span class="line">    String outOther();</span><br><span class="line">&#125;</span><br><span class="line">//业务角色</span><br><span class="line">public class JavaBean &#123;</span><br><span class="line">    public String out()&#123;</span><br><span class="line">        String nm = &quot;java bean&quot;;</span><br><span class="line">        System.out.println(nm);</span><br><span class="line">        return nm;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">//转换成另外一种角色</span><br><span class="line">public class lAdapter extends JavaBean implements Its&#123;</span><br><span class="line">    @Override</span><br><span class="line">    public String outOther() &#123;</span><br><span class="line">        String javabean = out();</span><br><span class="line">        String pythonBean = javabean + &quot; to python bean&quot;;</span><br><span class="line">        System.out.println(pythonBean);</span><br><span class="line">        return pythonBean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="对象适配器"><a href="#对象适配器" class="headerlink" title="对象适配器"></a>对象适配器</h3><p>跟类适配器的区别就是在适配器中，不是通过继承，而是通过对象的传递。其实我们在Android中的adapter采用的就是这种。通过不同type，传递不同的对象。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">public class lAdapter implements Its &#123;</span><br><span class="line">    private JavaBean javaBean;</span><br><span class="line">    public lAdapter(JavaBean javaBean)&#123;</span><br><span class="line">        this.javaBean = javaBean;</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public String outOther() &#123;</span><br><span class="line">        String javabean = javaBean.out();</span><br><span class="line">        String pythonBean = javabean + &quot; to python bean&quot;;</span><br><span class="line">        System.out.println(pythonBean);</span><br><span class="line">        return pythonBean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="接口适配器"><a href="#接口适配器" class="headerlink" title="接口适配器"></a>接口适配器</h3><p>所有的业务操作都定义在目标Target中，具体的逻辑处理在适配器里：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">public interface Target &#123;</span><br><span class="line">    int request1();</span><br><span class="line">    int request2();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public abstract class Adapter implements Target &#123;</span><br><span class="line">    protected Adaptee adaptee;</span><br><span class="line">    public Adapter(Adaptee adaptee)&#123;</span><br><span class="line">        this.adaptee = adaptee;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public int request1()&#123;</span><br><span class="line">        return 0;</span><br><span class="line">    &#125;</span><br><span class="line">    public int request2()&#123;</span><br><span class="line">        return 0;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class Adaptee &#123;</span><br><span class="line">    public int specificRequest()&#123;</span><br><span class="line">        return 220;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class Test &#123;</span><br><span class="line">    public static void main(String[] args)&#123;</span><br><span class="line">        System.out.println(&quot;pattern----------------start&quot;);</span><br><span class="line">        Target adapter = new Adapter(new Adaptee());</span><br><span class="line">        adapter.request1();</span><br><span class="line">        adapter.request2();</span><br><span class="line">        System.out.println(&quot;pattern----------------end&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-建造者模式"><a href="#5-建造者模式" class="headerlink" title="5.建造者模式"></a>5.建造者模式</h2><p>建造者模式(Builder Pattern)是将一个复杂对象的构建与它的表示分离，使得同样的构建过程可以创建不同的表示。</p>
<p><strong>特征：</strong></p>
<ul>
<li>用户只需要指定需要建造的类型就可以获得对象，建造过程及细节不需要了解。<br>属于创建型模式。</li>
</ul>
<p><strong>适用场景：</strong></p>
<ul>
<li>适用于创建对象需要很多步骤，但是步骤的顺序不一定固定。</li>
<li>如果一个对象有非常复杂的内部结构，属性比较多。</li>
<li>把复杂对象的创建和使用分离。</li>
</ul>
<p><strong>优点：</strong></p>
<ul>
<li>封装性好，创建和使用分离。</li>
<li>扩展性好，建造类之间独立，一定程度上解耦。</li>
<li>使用方便。</li>
</ul>
<p><strong>缺点：</strong></p>
<ul>
<li>产生多余的Builder对象。</li>
<li>产品内部发生变化，建造者都要修改，成本较大。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">public class Course &#123;</span><br><span class="line">    public String name;</span><br><span class="line">    public String pppt;</span><br><span class="line">    public String video;</span><br><span class="line">    public String note;</span><br><span class="line">    public String work;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class CourseBuilder implements IBuilder&#123;</span><br><span class="line">    private Course course = new Course();</span><br><span class="line">    public CourseBuilder addName(String name)&#123;</span><br><span class="line">        course.name = name;</span><br><span class="line">        return this;</span><br><span class="line">    &#125;</span><br><span class="line">    public CourseBuilder addPpt(String ppt)&#123;</span><br><span class="line">        course.pppt = ppt;</span><br><span class="line">        return this;</span><br><span class="line">    &#125;</span><br><span class="line">    public CourseBuilder addVideo(String vido)&#123;</span><br><span class="line">        course.video = vido;</span><br><span class="line">        return this;</span><br><span class="line">    &#125;</span><br><span class="line">    public CourseBuilder addNote(String note)&#123;</span><br><span class="line">        course.note = note;</span><br><span class="line">        return this;</span><br><span class="line">    &#125;</span><br><span class="line">    public CourseBuilder addWork(String work)&#123;</span><br><span class="line">        course.work = work;</span><br><span class="line">        return this;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public Course builder() &#123;</span><br><span class="line">        return course;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public static void main(String[] args)&#123;</span><br><span class="line">    CourseBuilder builder = new CourseBuilder();</span><br><span class="line">    builder.addName(&quot;建造者&quot;)</span><br><span class="line">            .addNote(&quot;备注&quot;)</span><br><span class="line">            .addPpt(&quot;PPT&quot;)</span><br><span class="line">            .addPpt(&quot;PPT&quot;)</span><br><span class="line">            .addVideo(&quot;视频&quot;);</span><br><span class="line">    System.out.print(builder.builder());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="6-建造者模式和工厂模式的区别"><a href="#6-建造者模式和工厂模式的区别" class="headerlink" title="6.建造者模式和工厂模式的区别"></a>6.建造者模式和工厂模式的区别</h2><ul>
<li>1.建造者模式更加注重方法的调用顺序，工厂模式注重于创建对象。</li>
<li>2.创建对象的力度不同，建造者模式创建复杂的对象，由各种复杂的部件组成，工厂模式创建出来的都一样。</li>
<li>3.关注点不同：工厂模式只需要把对象创建出来就可以了，而建造者模式中不仅要创建出这个对象，还要知道这个对象由哪些部件组成。</li>
<li>4.建造者模式根据建造过程中的顺序不一样，最终的对象部件组成也不一样。</li>
</ul>
<h2 id="7-代理模式"><a href="#7-代理模式" class="headerlink" title="7.代理模式"></a>7.代理模式</h2><p>代理模式(Proxy Pattern),指为其他对象提供一种代理，以控制对这个对象的访问。代理对象在客户端和目标对象之间起到中介作用。属于结构性设计模式。</p>
<p><strong>适用场景：</strong></p>
<ul>
<li>保护目标对象。</li>
<li>增强目标对象。</li>
</ul>
<p><strong>优点：</strong></p>
<ul>
<li>代理模式能将代理对象与真实被调用的目标对象分离。</li>
<li>一定程度上降低了系统的耦合程度，易于扩展。</li>
<li>代理可以起到保护目标对象的作用。</li>
<li>增强目标对象的职责。</li>
</ul>
<p><strong>缺点：</strong></p>
<ul>
<li>代理模式会造成系统设计中类的数目增加。</li>
<li>再客户端和目标对象之间增加了一个代理对象，七请求处理速度变慢。</li>
<li>增加了系统的复杂度。</li>
</ul>
<h3 id="静态代理"><a href="#静态代理" class="headerlink" title="静态代理"></a>静态代理</h3><p>显示生命被代理对象。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">public interface IPerson &#123;</span><br><span class="line">    void findLove();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class Person implements IPerson &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void findLove() &#123;</span><br><span class="line">        System.out.println(&quot;漂亮&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class PersonProxy implements IPerson&#123;</span><br><span class="line">    private Person person;</span><br><span class="line">    public PersonProxy(Person person)&#123;</span><br><span class="line">        this.person  = person;</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public void findLove() &#123;</span><br><span class="line">        System.out.println(&quot;找人&quot;);</span><br><span class="line">        person.findLove();</span><br><span class="line">        System.out.println(&quot;成功&quot;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public static void main(String[] args)&#123;</span><br><span class="line">    PersonProxy personProxy = new PersonProxy(new Person());</span><br><span class="line">    personProxy.findLove();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>问题：只能代理一个Person。那如果代理多个呢？使用动态代理</p>
<h3 id="动态代理"><a href="#动态代理" class="headerlink" title="动态代理"></a>动态代理</h3><p>动态配置和替换被代理对象。</p>
<h4 id="JDK实现"><a href="#JDK实现" class="headerlink" title="JDK实现"></a>JDK实现</h4><p>具体实现已经有了类库： java.lang.reflect.Proxy</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">public interface IPerson &#123;</span><br><span class="line">    void findLove();</span><br><span class="line">    void buy();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class Person1 implements IPerson &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void findLove() &#123;</span><br><span class="line">        System.out.println(&quot;漂亮&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void buy() &#123;</span><br><span class="line">        System.out.println(&quot;要买车子&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">public class Person2 implements IPerson &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void findLove() &#123;</span><br><span class="line">        System.out.println(&quot;学历高&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void buy() &#123;</span><br><span class="line">        System.out.println(&quot;要买房子&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">public class JdkProxy implements InvocationHandler&#123;</span><br><span class="line">    private IPerson target;</span><br><span class="line">    public IPerson getInstance(IPerson target) &#123;</span><br><span class="line">        this.target = target;</span><br><span class="line">        Class&lt;?&gt; clazz = target.getClass();</span><br><span class="line">    /*    return (IPerson) Proxy.newProxyInstance(clazz.getClassLoader(), clazz.getInterfaces(), new InvocationHandler() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public Object invoke(Object proxy, Method method, Object[] args) throws Throwable &#123;</span><br><span class="line"></span><br><span class="line">                return null;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);*/</span><br><span class="line">        return (IPerson) Proxy.newProxyInstance(clazz.getClassLoader(), clazz.getInterfaces(),this);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable &#123;</span><br><span class="line">        before();</span><br><span class="line">        Object result = method.invoke(this.target,args);</span><br><span class="line">        after();</span><br><span class="line">        return result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void before()&#123;</span><br><span class="line">        System.out.println(&quot;before proxy is called&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    public void after()&#123;</span><br><span class="line">        System.out.println(&quot;after  proxy is called&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public class Test &#123;</span><br><span class="line">    public static void main(String[] args)&#123;</span><br><span class="line">        JdkProxy personProxy = new JdkProxy();</span><br><span class="line">        IPerson person1 = personProxy.getInstance(new Person1());</span><br><span class="line">        person1.findLove();</span><br><span class="line"></span><br><span class="line">        IPerson person2 = personProxy.getInstance(new Person2());</span><br><span class="line">        person2.findLove();</span><br><span class="line">        person2.buy();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输入结果:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">before proxy is called</span><br><span class="line">漂亮</span><br><span class="line">after  proxy is called</span><br><span class="line">before proxy is called</span><br><span class="line">学历高</span><br><span class="line">after  proxy is called</span><br><span class="line">before proxy is called</span><br><span class="line">要买房子</span><br><span class="line">after  proxy is called</span><br></pre></td></tr></table></figure>

<p>只需要一个JdkProxy类，就可以代理Person1，和Person2的代理.</p>
<h4 id="cglib-实现"><a href="#cglib-实现" class="headerlink" title="cglib 实现"></a>cglib 实现</h4><p>因为我的演示时Android工程，但是cglib在Android不能使用，这里就不实现了。</p>
<h4 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h4><p>我们断点看一下，实际上jdk Proxy给我们动态生成了一个实现类：这个类以$符号开头，在内存中可见，在外面看不到。Proxy0，是生成第0个代理类。<br><img src="http://nunu03.github.io/2022/06/20/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/pattern-proxy.png" alt><br>那具体这个类是什么样？我们把这个类在拿出来，反编译生成类，存起来。<br>我们知道类名$Proxy0，然后通过ProxyGenerator生成class文件。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">try &#123;</span><br><span class="line">    byte[] bytes =  ProxyGenerator.generateProxyClass(&quot;$Proxy0&quot;,new Class[]&#123;IPerson.class&#125;);</span><br><span class="line">    FileOutputStream os = new FileOutputStream(&quot;E:\\JavaDesignPatterns\\src\\main\\java\\com\\javadesignpatterns\\proxy\\dynamicproxy\\jdk\\$Proxy0.class&quot;);</span><br><span class="line">    os.write(bytes);</span><br><span class="line">    os.close();</span><br><span class="line">&#125; catch (Exception e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>class文件读取不容易，我们可以再通过jad反编译成jad文件：这个jax文件其实就是java文件内容。<br>E:\JavaDesignPatterns\src\main\java\com\javadesignpatterns\proxy\dynamicproxy\jdk&gt;jad $Proxy0.class</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line">// Decompiled by Jad v1.5.8g. Copyright 2001 Pavel Kouznetsov.</span><br><span class="line">// Jad home page: http://www.kpdus.com/jad.html</span><br><span class="line">// Decompiler options: packimports(3) </span><br><span class="line"></span><br><span class="line">import com.javadesignpatterns.proxy.dynamicproxy.jdk.IPerson;</span><br><span class="line">import java.lang.reflect.*;</span><br><span class="line"></span><br><span class="line">public final class $Proxy0 extends Proxy</span><br><span class="line">    implements IPerson</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    public $Proxy0(InvocationHandler invocationhandler)</span><br><span class="line">    &#123;</span><br><span class="line">        super(invocationhandler);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public final boolean equals(Object obj)</span><br><span class="line">    &#123;</span><br><span class="line">        try</span><br><span class="line">        &#123;</span><br><span class="line">            return ((Boolean)super.h.invoke(this, m1, new Object[] &#123;</span><br><span class="line">                obj</span><br><span class="line">            &#125;)).booleanValue();</span><br><span class="line">        &#125;</span><br><span class="line">        catch(Error _ex) &#123; &#125;</span><br><span class="line">        catch(Throwable throwable)</span><br><span class="line">        &#123;</span><br><span class="line">            throw new UndeclaredThrowableException(throwable);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //实现了接口IPerson方法</span><br><span class="line">    public final void findLove()</span><br><span class="line">    &#123;</span><br><span class="line">        try</span><br><span class="line">        &#123;</span><br><span class="line">            // 这个h是什么？应该是父类Proxy中一个对象。</span><br><span class="line">            super.h.invoke(this, m3, null);</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        catch(Error _ex) &#123; &#125;</span><br><span class="line">        catch(Throwable throwable)</span><br><span class="line">        &#123;</span><br><span class="line">            throw new UndeclaredThrowableException(throwable);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public final String toString()</span><br><span class="line">    &#123;</span><br><span class="line">        try</span><br><span class="line">        &#123;</span><br><span class="line">            return (String)super.h.invoke(this, m2, null);</span><br><span class="line">        &#125;</span><br><span class="line">        catch(Error _ex) &#123; &#125;</span><br><span class="line">        catch(Throwable throwable)</span><br><span class="line">        &#123;</span><br><span class="line">            throw new UndeclaredThrowableException(throwable);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public final void buy()</span><br><span class="line">    &#123;</span><br><span class="line">        try</span><br><span class="line">        &#123;</span><br><span class="line">            super.h.invoke(this, m4, null);</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        catch(Error _ex) &#123; &#125;</span><br><span class="line">        catch(Throwable throwable)</span><br><span class="line">        &#123;</span><br><span class="line">            throw new UndeclaredThrowableException(throwable);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public final int hashCode()</span><br><span class="line">    &#123;</span><br><span class="line">        try</span><br><span class="line">        &#123;</span><br><span class="line">            return ((Integer)super.h.invoke(this, m0, null)).intValue();</span><br><span class="line">        &#125;</span><br><span class="line">        catch(Error _ex) &#123; &#125;</span><br><span class="line">        catch(Throwable throwable)</span><br><span class="line">        &#123;</span><br><span class="line">            throw new UndeclaredThrowableException(throwable);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static Method m1;</span><br><span class="line">    private static Method m3;</span><br><span class="line">    private static Method m2;</span><br><span class="line">    private static Method m4;</span><br><span class="line">    private static Method m0;</span><br><span class="line"></span><br><span class="line">    static </span><br><span class="line">    &#123;</span><br><span class="line">        try</span><br><span class="line">        &#123;</span><br><span class="line">            m1 = Class.forName(&quot;java.lang.Object&quot;).getMethod(&quot;equals&quot;, new Class[] &#123;</span><br><span class="line">                Class.forName(&quot;java.lang.Object&quot;)</span><br><span class="line">            &#125;);</span><br><span class="line">            m3 = Class.forName(&quot;com.javadesignpatterns.proxy.dynamicproxy.jdk.IPerson&quot;).getMethod(&quot;findLove&quot;, new Class[0]);</span><br><span class="line">            m2 = Class.forName(&quot;java.lang.Object&quot;).getMethod(&quot;toString&quot;, new Class[0]);</span><br><span class="line">            m4 = Class.forName(&quot;com.javadesignpatterns.proxy.dynamicproxy.jdk.IPerson&quot;).getMethod(&quot;buy&quot;, new Class[0]);</span><br><span class="line">            m0 = Class.forName(&quot;java.lang.Object&quot;).getMethod(&quot;hashCode&quot;, new Class[0]);</span><br><span class="line">        &#125;</span><br><span class="line">        catch(NoSuchMethodException nosuchmethodexception)</span><br><span class="line">        &#123;</span><br><span class="line">            throw new NoSuchMethodError(nosuchmethodexception.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">        catch(ClassNotFoundException classnotfoundexception)</span><br><span class="line">        &#123;</span><br><span class="line">            throw new NoClassDefFoundError(classnotfoundexception.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们再看看Proxy类中h是什么：我们调用的是</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Proxy.newProxyInstance(clazz.getClassLoader(), clazz.getInterfaces(),this);</span><br></pre></td></tr></table></figure>

<p>所以h就是this,也就是我们的代理类JdkProxy：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">public static Object newProxyInstance(ClassLoader loader,</span><br><span class="line">                                          Class&lt;?&gt;[] interfaces,</span><br><span class="line">                                          InvocationHandler h)</span><br><span class="line">        throws IllegalArgumentException</span><br><span class="line">&#123;</span><br><span class="line">    Objects.requireNonNull(h);</span><br><span class="line"></span><br><span class="line">    final Class&lt;?&gt;[] intfs = interfaces.clone();</span><br><span class="line">    final SecurityManager sm = System.getSecurityManager();</span><br><span class="line">    if (sm != null) &#123;</span><br><span class="line">        checkProxyAccess(Reflection.getCallerClass(), loader, intfs);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /*</span><br><span class="line">        * Look up or generate the designated proxy class.</span><br><span class="line">        */</span><br><span class="line">    Class&lt;?&gt; cl = getProxyClass0(loader, intfs);</span><br><span class="line"></span><br><span class="line">    /*</span><br><span class="line">        * Invoke its constructor with the designated invocation handler.</span><br><span class="line">        */</span><br><span class="line">    try &#123;</span><br><span class="line">        if (sm != null) &#123;</span><br><span class="line">            checkNewProxyPermission(Reflection.getCallerClass(), cl);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        final Constructor&lt;?&gt; cons = cl.getConstructor(constructorParams);</span><br><span class="line">        final InvocationHandler ih = h;</span><br><span class="line">        if (!Modifier.isPublic(cl.getModifiers())) &#123;</span><br><span class="line">            AccessController.doPrivileged(new PrivilegedAction&lt;Void&gt;() &#123;</span><br><span class="line">                public Void run() &#123;</span><br><span class="line">                    cons.setAccessible(true);</span><br><span class="line">                    return null;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        //这里会带哦用Proxy的构造方法，并把h赋值给InvocationHandler</span><br><span class="line">        return cons.newInstance(new Object[]&#123;h&#125;);</span><br><span class="line">    &#125; catch (IllegalAccessException|InstantiationException e) &#123;</span><br><span class="line">        throw new InternalError(e.toString(), e);</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">protected Proxy(InvocationHandler h) &#123;</span><br><span class="line">    Objects.requireNonNull(h);</span><br><span class="line">    this.h = h;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>所以，我们的jax文件中 super.h.invoke(this, m3, null);其实就是调用的JdkProxy中的invoke方法。那参数：</p>
<ul>
<li><p>this：就是生成的对象$Proxy0</p>
</li>
<li><p>m3:就是IPerson的findLove的方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">m3 = Class.forName(&quot;com.javadesignpatterns.proxy.dynamicproxy.jdk.IPerson&quot;).getMethod(&quot;findLove&quot;, new Class[0]);</span><br></pre></td></tr></table></figure>
</li>
<li><p>null：没有参数</p>
</li>
</ul>
<h4 id="手写动态代理"><a href="#手写动态代理" class="headerlink" title="手写动态代理"></a>手写动态代理</h4><p>其实根据java.lang.reflect.Proxy原理，我们可以自己实现一个动态代理。手动生成$Proxy0.java类。有空再写吧。</p>
<h2 id="8-门面模式-amp-外观模式"><a href="#8-门面模式-amp-外观模式" class="headerlink" title="8.门面模式 &amp; 外观模式"></a>8.门面模式 &amp; 外观模式</h2><p>门面模式(Facade Pattern)，提供一个统一的接口，用来访问子系统中的一群接口。</p>
<p><strong>特征：</strong><br>门面模式定义了一个高级接口，让子系统更容易使用。<br>属于结构型模式。</p>
<p><strong>适用场景：</strong></p>
<ul>
<li>子系统越来越复杂，增加门面模式提供简单接口。</li>
<li>构建多层系统结构，利用门面对象作为每层的入口，简化层间调用。</li>
</ul>
<p><strong>优点：</strong></p>
<ul>
<li>简化了调用过程，无需深入了解子系统，以防给子系统带来风险。</li>
<li>减少系统依赖、松散耦合。</li>
<li>更好地划分访问层次，提高了安全性。</li>
<li>遵顼迪米特法则，即最少知道原则。</li>
</ul>
<p><strong>缺点：</strong></p>
<ul>
<li>当增加子系统和扩展子系统行为时，可能容易带来未知风险。</li>
<li>不符合开闭原则。</li>
<li>某些情况下可能违背单一职责原则。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">public class GiftInfo &#123;</span><br><span class="line">    public String name;</span><br><span class="line">    public GiftInfo(String name)&#123;</span><br><span class="line">        this.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class QualifyService &#123;</span><br><span class="line">    public boolean qualify(GiftInfo giftInfo)&#123;</span><br><span class="line">        System.out.println(giftInfo.name + &quot;10积分&quot;);</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class PayService &#123;</span><br><span class="line">    public boolean pay(GiftInfo giftInfo)&#123;</span><br><span class="line">        System.out.println(&quot;支付&quot;+giftInfo.name + &quot;积分成功&quot;);</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class ShippingService &#123;</span><br><span class="line">    public String delivery(GiftInfo giftInfo)&#123;</span><br><span class="line">        System.out.println(giftInfo.name + &quot;快递中&quot;);</span><br><span class="line">        return &quot;666&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//门面</span><br><span class="line">public class FacadeService &#123;</span><br><span class="line">    private QualifyService qualifyService = new QualifyService();</span><br><span class="line">    private PayService payService = new PayService();</span><br><span class="line">    private ShippingService shippingService = new ShippingService();</span><br><span class="line"></span><br><span class="line">    public void exchange(GiftInfo giftInfo)&#123;</span><br><span class="line">        if (qualifyService.qualify(giftInfo))&#123;</span><br><span class="line">            if (payService.pay(giftInfo))&#123;</span><br><span class="line">                System.out.println(shippingService.delivery(giftInfo));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public static void main(String[] args)&#123;</span><br><span class="line">    System.out.println(&quot;pattern----------------start&quot;);</span><br><span class="line">    FacadeService facadeService = new FacadeService();</span><br><span class="line">    facadeService.exchange(new GiftInfo(&quot;礼物信息&quot;));</span><br><span class="line">    System.out.println(&quot;pattern----------------end&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="9-装饰器模式"><a href="#9-装饰器模式" class="headerlink" title="9.装饰器模式"></a>9.装饰器模式</h2><p>装饰器模式(Decorator Pattern)也叫包装模式(Wrapper Pattern)，是指在不改变原有对象的基础之上，将功能附加到对象上，提供了比继承更有弹性的替代方案(扩展原有对象的功能)。属于结构性模式。</p>
<p><strong>适用场景：</strong></p>
<ul>
<li>用于扩展一个类的功能或给一个类添加附加职责。</li>
<li>动态的给一个对象添加功能，这些功能可以再动态的撤销。</li>
</ul>
<p><strong>优点：</strong></p>
<ul>
<li>装饰器是继承的有力补充，比继承灵活，不改变原有对象的情况下动态的给一个对象扩展功能，即插即用。</li>
<li>通过使用不同装饰类以及这些装饰类的排列组合，可实现不同效果。</li>
<li>装饰器完全遵守开闭原则。</li>
</ul>
<p><strong>缺点：</strong></p>
<ul>
<li>会出现更多的代码和类，增加了程序的复杂性。</li>
<li>动态装饰时，多层装饰时会更加复杂。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">public abstract class Battercake &#123;</span><br><span class="line">    protected abstract String getName();</span><br><span class="line">    public abstract int getPrice();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//抽象装饰器</span><br><span class="line">public class BatterDecortor extends Battercake &#123;</span><br><span class="line">    private Battercake battercake;</span><br><span class="line">    public BatterDecortor(Battercake battercake)&#123;</span><br><span class="line">        this.battercake = battercake;</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    protected String getName() &#123;</span><br><span class="line">        return this.battercake.getName();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public int getPrice() &#123;</span><br><span class="line">        return this.battercake.getPrice();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class BaseBatterCake extends Battercake&#123;</span><br><span class="line">    @Override</span><br><span class="line">    protected String getName() &#123;</span><br><span class="line">        return &quot;煎饼&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public int getPrice() &#123;</span><br><span class="line">        return 10;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class EggDecortor extends BatterDecortor &#123;</span><br><span class="line">    public EggDecortor(Battercake battercake)&#123;</span><br><span class="line">        super(battercake);</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    protected String getName() &#123;</span><br><span class="line">        return super.getName()+&quot;鸡蛋&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public int getPrice() &#123;</span><br><span class="line">        return super.getPrice() +2;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class SauageDecortor extends BatterDecortor &#123;</span><br><span class="line">    public SauageDecortor(Battercake battercake)&#123;</span><br><span class="line">        super(battercake);</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    protected String getName() &#123;</span><br><span class="line">        return super.getName()+&quot;香肠&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public int getPrice() &#123;</span><br><span class="line">        return super.getPrice() +4;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">public static void main(String[] args)&#123;</span><br><span class="line">    Battercake battercake = new BaseBatterCake();</span><br><span class="line">    System.out.println(battercake.getName() +&quot;:&quot;+ battercake.getPrice()+ &quot;元&quot;);</span><br><span class="line">    battercake = new EggDecortor(battercake);</span><br><span class="line">    System.out.println(battercake.getName() +&quot;:&quot;+ battercake.getPrice()+ &quot;元&quot;);</span><br><span class="line">    battercake = new SauageDecortor(battercake);</span><br><span class="line">    System.out.println(battercake.getName() +&quot;:&quot;+ battercake.getPrice()+ &quot;元&quot;);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">煎饼:10元</span><br><span class="line">煎饼鸡蛋:12元</span><br><span class="line">煎饼鸡蛋香肠:16元</span><br></pre></td></tr></table></figure>

<h2 id="10-装饰器模式和代理模式对比"><a href="#10-装饰器模式和代理模式对比" class="headerlink" title="10.装饰器模式和代理模式对比"></a>10.装饰器模式和代理模式对比</h2><ul>
<li><ol>
<li>装饰器模式就是一种特殊的代理模式。</li>
</ol>
</li>
<li><ol start="2">
<li>装饰器模式强调自身的功能扩展，用自己说了算的透明扩展，可动态定制的扩展。</li>
</ol>
</li>
<li><ol start="3">
<li>代理模式强调代理过程的控制。</li>
</ol>
</li>
</ul>
<h2 id="11-享元模式"><a href="#11-享元模式" class="headerlink" title="11.享元模式"></a>11.享元模式</h2><p>享元模式(Flyweight Pattern)又称为轻量级模式，是对象池的一种实现。类似于线程池，线程池可以避免不停的创建和销毁多个对象，消耗性能。提供了减少对象数量从而改善应用所需的对象结构的方式。</p>
<p><strong>宗旨：</strong></p>
<ul>
<li>共享细粒度对象，将多个对统一对象的访问集中起来。<br>属于结构性模式。</li>
</ul>
<p><strong>适用场景：</strong></p>
<ul>
<li>常常用于系统底层的开发，以便解决系统的性能问题。</li>
<li>系统有大量相似的对象、需要缓冲池的场景。</li>
</ul>
<p><strong>优点：</strong></p>
<ul>
<li>减少对象的创建，降低内存中对象的数量，降低系统的内存使用，提高效率。</li>
<li>减少内存之外的其他资源占用。</li>
</ul>
<p><strong>缺点：</strong></p>
<ul>
<li>关注内外部状态，关注线程安全问题。</li>
<li>使系统、内存的逻辑复杂化。</li>
</ul>
<p>不举例了，Android中Message就是一种典型的享元模式。</p>
<h2 id="12-组合模式"><a href="#12-组合模式" class="headerlink" title="12.组合模式"></a>12.组合模式</h2><p>组合模式(Composite Pattern)，也成为整体-部分(Part-Whole)模式，它的宗旨是通过将单个对象(叶子节点)和组合对象(树枝节点)用相同的接口进行表示。作用就是使客户端对单个对象和组合对象保持一致的方式处理。属于结构性模式。<br><img src="http://nunu03.github.io/2022/06/20/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/pattern-composite.png" alt></p>
<p><strong>适用场景：</strong></p>
<ul>
<li>希望客户端可以忽略组合对象与单个对象的差异时；</li>
<li>对象层次具备整体和部分，呈树形结构(如树形菜单、操作系统目录结构、公司组织架构等)。</li>
</ul>
<p><strong>优点：</strong></p>
<ul>
<li>清楚的定义分层次的复杂对象，表示对象的全部或者部分层次。</li>
<li>让客户端忽略了层次的差异，方便对整个层次结构进行控制。</li>
<li>简化客户端代码。</li>
<li>符合开闭原则。</li>
</ul>
<p><strong>缺点：</strong></p>
<ul>
<li>限制类型时会较为复杂。</li>
<li>使设计变得更加抽象。</li>
</ul>
<p>典型的就是HashMap.putAll,put方法就是putVal，而putAll是put一个map，而map最终还是通过put Entry循环putVal完成数据存储。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">public void putAll(Map&lt;? extends K, ? extends V&gt; m) &#123;</span><br><span class="line">    putMapEntries(m, true);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">final void putMapEntries(Map&lt;? extends K, ? extends V&gt; m, boolean evict) &#123;</span><br><span class="line">    int s = m.size();</span><br><span class="line">    if (s &gt; 0) &#123;</span><br><span class="line">        if (table == null) &#123; // pre-size</span><br><span class="line">            float ft = ((float)s / loadFactor) + 1.0F;</span><br><span class="line">            int t = ((ft &lt; (float)MAXIMUM_CAPACITY) ?</span><br><span class="line">                        (int)ft : MAXIMUM_CAPACITY);</span><br><span class="line">            if (t &gt; threshold)</span><br><span class="line">                threshold = tableSizeFor(t);</span><br><span class="line">        &#125;</span><br><span class="line">        else if (s &gt; threshold)</span><br><span class="line">            resize();</span><br><span class="line">        for (Map.Entry&lt;? extends K, ? extends V&gt; e : m.entrySet()) &#123;</span><br><span class="line">            K key = e.getKey();</span><br><span class="line">            V value = e.getValue();</span><br><span class="line">            putVal(hash(key), key, value, false, evict);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">//最终都是put一个key，value</span><br><span class="line">putVal(hash(key), key, value, false, evict);</span><br></pre></td></tr></table></figure>

<h3 id="透明组合模式"><a href="#透明组合模式" class="headerlink" title="透明组合模式"></a>透明组合模式</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">public abstract class CourseComponet &#123;</span><br><span class="line">    public void addChild(CourseComponet componet)&#123;</span><br><span class="line">        throw new UnsupportedOperationException(&quot;不支持添加&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    public void removeChild(CourseComponet componet)&#123;</span><br><span class="line">        throw new UnsupportedOperationException(&quot;不支持删除&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    public String getName(CourseComponet componet)&#123;</span><br><span class="line">        throw new UnsupportedOperationException(&quot;不支持获取名称&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    public double getPrice(CourseComponet componet)&#123;</span><br><span class="line">        throw new UnsupportedOperationException(&quot;不支持获取价格&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    public void print()&#123;</span><br><span class="line">        throw new UnsupportedOperationException(&quot;不支持打印&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class Course extends CourseComponet &#123;</span><br><span class="line">    private String name;</span><br><span class="line">    private double price;</span><br><span class="line">    public Course(String name, double price)&#123;</span><br><span class="line">        this.name = name;</span><br><span class="line">        this.price = price;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String getName(CourseComponet componet) &#123;</span><br><span class="line">        return this.name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public double getPrice(CourseComponet componet) &#123;</span><br><span class="line">        return  this.price;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void print() &#123;</span><br><span class="line">        System.out.println(this.name+&quot;:&quot;+this.price+&quot;元&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class CoursePackage extends CourseComponet&#123;</span><br><span class="line">    private List&lt;CourseComponet&gt; items = new ArrayList&lt;&gt;();</span><br><span class="line">    private String name;</span><br><span class="line">    private Integer level;</span><br><span class="line">    public CoursePackage(String name, int level)&#123;</span><br><span class="line">        this.name = name;</span><br><span class="line">        this.level = level;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void addChild(CourseComponet componet) &#123;</span><br><span class="line">        items.add(componet);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void removeChild(CourseComponet componet) &#123;</span><br><span class="line">        items.remove(componet);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String getName(CourseComponet componet) &#123;</span><br><span class="line">        return this.name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void print() &#123;</span><br><span class="line">        System.out.println(this.name);</span><br><span class="line">        for (CourseComponet courseComponet :items)&#123;</span><br><span class="line">            if (this.level != null)&#123;</span><br><span class="line">                for (int i=0;i&lt;this.level;i++)&#123;</span><br><span class="line">                    System.out.print(&quot; &quot;);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                for (int i=0;i&lt;this.level;i++)&#123;</span><br><span class="line">                    if (i == 0)&#123;</span><br><span class="line">                        System.out.print(&quot;+&quot;);</span><br><span class="line">                    &#125;</span><br><span class="line">                    System.out.print(&quot;-&quot;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">           courseComponet.print();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">public static void main(String[] args)&#123;</span><br><span class="line">    System.out.println(&quot;===================透明组合模式==============&quot;);</span><br><span class="line">    CourseComponet java = new Course(&quot;Java&quot;,2000);</span><br><span class="line">    CourseComponet ai = new Course(&quot;ai&quot;,8000);</span><br><span class="line">    CourseComponet coursePackage = new CoursePackage(&quot;架构师&quot;,2);</span><br><span class="line"></span><br><span class="line">    CourseComponet python = new Course(&quot;python&quot;,6000);</span><br><span class="line">    CourseComponet css = new Course(&quot;css&quot;,3000);</span><br><span class="line"></span><br><span class="line">    coursePackage.addChild(python);</span><br><span class="line">    coursePackage.addChild(css);</span><br><span class="line"></span><br><span class="line">    CourseComponet catalog = new CoursePackage(&quot;课程目录&quot;,1);</span><br><span class="line">    catalog.addChild(java);</span><br><span class="line">    catalog.addChild(ai);</span><br><span class="line">    catalog.addChild(coursePackage);</span><br><span class="line"></span><br><span class="line">    catalog.print();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出结果：根据level输出等级的结果</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">===================透明组合模式==============</span><br><span class="line">课程目录</span><br><span class="line">     +-Java:2000.0元</span><br><span class="line">     +-ai:8000.0元</span><br><span class="line">     +-架构师</span><br><span class="line">          +--python:6000.0元</span><br><span class="line">          +--css:3000.0元</span><br></pre></td></tr></table></figure>

<h3 id="安全组合模式"><a href="#安全组合模式" class="headerlink" title="安全组合模式"></a>安全组合模式</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">public abstract class Direcotry &#123;</span><br><span class="line">    protected String name;</span><br><span class="line">    public Direcotry(String name)&#123;</span><br><span class="line">        this.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    public abstract void show();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class File extends  Direcotry&#123;</span><br><span class="line">    public File(String name)&#123;</span><br><span class="line">        super(name);</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public void show() &#123;</span><br><span class="line">        System.out.println(this.name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class Folder extends  Direcotry&#123;</span><br><span class="line">    private List&lt;Direcotry&gt; dirs;</span><br><span class="line">    private Integer level;</span><br><span class="line">    public Folder(String name,Integer level)&#123;</span><br><span class="line">        super(name);</span><br><span class="line">        this.level = level;</span><br><span class="line">        this.dirs = new ArrayList&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public void show() &#123;</span><br><span class="line">        System.out.println(this.name);</span><br><span class="line">        for (Direcotry direcotry :dirs)&#123;</span><br><span class="line">            if (this.level != null)&#123;</span><br><span class="line">                for (int i=0;i&lt;this.level;i++)&#123;</span><br><span class="line">                    System.out.print(&quot;     &quot;);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                for (int i=0;i&lt;this.level;i++)&#123;</span><br><span class="line">                    if (i == 0)&#123;</span><br><span class="line">                        System.out.print(&quot;+&quot;);</span><br><span class="line">                    &#125;</span><br><span class="line">                    System.out.print(&quot;-&quot;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            direcotry.show();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public boolean add(Direcotry direcotry)&#123;</span><br><span class="line">        return this.dirs.add(direcotry);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public boolean remove(Direcotry direcotry)&#123;</span><br><span class="line">        return this.dirs.remove(direcotry);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Direcotry get(int index)&#123;</span><br><span class="line">        return this.dirs.get(index);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void list()&#123;</span><br><span class="line">        for (Direcotry direcotry:this.dirs)&#123;</span><br><span class="line">            System.out.println(direcotry.name);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">public static void main(String[] args)&#123;</span><br><span class="line">    System.out.println(&quot;===================安全组合模式==============&quot;);</span><br><span class="line">    File java = new File(&quot;Java&quot;);</span><br><span class="line">    File python = new File(&quot;Python&quot;);</span><br><span class="line"></span><br><span class="line">    Folder office = new Folder(&quot;办公&quot;,2);</span><br><span class="line"></span><br><span class="line">    File word = new File(&quot;Word&quot;);</span><br><span class="line">    File ppt = new File(&quot;ppt&quot;);</span><br><span class="line">    office.add(word);</span><br><span class="line">    office.add(ppt);</span><br><span class="line"></span><br><span class="line">    Folder root = new Folder(&quot;D:&quot;,1);</span><br><span class="line">    root.add(java);</span><br><span class="line">    root.add(python);</span><br><span class="line">    root.add(office);</span><br><span class="line">    System.out.println(&quot;===================show==============&quot;);</span><br><span class="line"></span><br><span class="line">    root.show();</span><br><span class="line">    System.out.println(&quot;===================list==============&quot;);</span><br><span class="line">    root.list();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">===================安全组合模式==============</span><br><span class="line">===================show==============</span><br><span class="line">D:</span><br><span class="line">     +-Java</span><br><span class="line">     +-Python</span><br><span class="line">     +-办公</span><br><span class="line">          +--Word</span><br><span class="line">          +--ppt</span><br><span class="line">===================list==============</span><br><span class="line">Java</span><br><span class="line">Python</span><br><span class="line">办公</span><br></pre></td></tr></table></figure>

<h2 id="13-桥接模式"><a href="#13-桥接模式" class="headerlink" title="13.桥接模式"></a>13.桥接模式</h2><p>桥接模式(Bridge Pattern)也称为桥梁模式、接口(Interface)模式或柄体(Handle and Body)模式,是将抽象部分与它的具体实现部分分离，使它们都可以独立的变化。<br>通过组合的方式建立两个类之间的联系，而不是继承。<br>属于结构性模式。</p>
<p><strong>适用场景：</strong></p>
<ul>
<li>在抽象和具体实现之间需要增加更多的灵活性的场景。</li>
<li>一个类存在两个(或多个)独立变化的维度，而这两个(或多个)维度都需要独立进行扩展。</li>
<li>不希望使用继承，或因为多层继承导致系统类的个数剧增。</li>
</ul>
<p><strong>优点：</strong></p>
<ul>
<li>分离抽象部分以及其具体实现部分。</li>
<li>提高了系统的扩展性。</li>
<li>符合开闭原则。</li>
<li>符合合成复用原则。</li>
</ul>
<p><strong>缺点：</strong></p>
<ul>
<li>增加了系统的理解与设计难度。</li>
<li>需要正确的识别系统中两个独立变化的维度。</li>
</ul>
<p>两种消息Email和SMS,紧急程度：Normal普通和Urgency加急，桥接类AbastractMessage，当需要给消息加急时，把消息对象给了桥接类，桥接类有两个子类普通和加急。所以，桥接模式，就是通过桥接类，对两个不同维度进行封装。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">public interface IMessage &#123;</span><br><span class="line">    void sendMessage(String msg,String toUser);</span><br><span class="line">&#125;</span><br><span class="line">public class EmailMessage implements IMessage&#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void sendMessage(String msg, String toUser) &#123;</span><br><span class="line">        System.out.println(&quot;邮件发送内容：&quot;+msg+&quot; 给谁&quot;+toUser);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">public class SmsMessage implements IMessage&#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void sendMessage(String msg, String toUser) &#123;</span><br><span class="line">        System.out.println(&quot;SMS发送内容：&quot;+msg+&quot; 给谁&quot;+toUser);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class NormalMessage extends AbastractMessage&#123;</span><br><span class="line">    public NormalMessage(IMessage message) &#123;</span><br><span class="line">        super(message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">//紧急消息</span><br><span class="line">public class UrgencyMessage extends AbastractMessage&#123;</span><br><span class="line">    public UrgencyMessage(IMessage message) &#123;</span><br><span class="line">        super(message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void sendMessage(String msg, String toUser) &#123;</span><br><span class="line">        msg = &quot;加急 ： &quot;+msg;</span><br><span class="line">        super.sendMessage(msg,toUser);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Object watch(String id)&#123;</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public abstract class AbastractMessage &#123;</span><br><span class="line">    private IMessage message;</span><br><span class="line">    public AbastractMessage(IMessage message)&#123;</span><br><span class="line">        this.message = message;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void sendMessage(String msg, String toUser) &#123;</span><br><span class="line">        this.message.sendMessage(msg,toUser);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">public static void main(String[] args)&#123;</span><br><span class="line"></span><br><span class="line">        IMessage message = new SmsMessage();</span><br><span class="line">        AbastractMessage abastractMessage = new NormalMessage(message);</span><br><span class="line">        abastractMessage.sendMessage(&quot;加班申请&quot;,&quot;王老板&quot;);</span><br><span class="line">        System.out.println(&quot;===================普通==============&quot;);</span><br><span class="line"></span><br><span class="line">        message = new EmailMessage();</span><br><span class="line">        abastractMessage = new UrgencyMessage(message);</span><br><span class="line">        abastractMessage.sendMessage(&quot;加班申请&quot;,&quot;王老板&quot;);</span><br><span class="line">        System.out.println(&quot;===================加急==============&quot;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SMS发送内容：加班申请 给谁王老板</span><br><span class="line">===================普通==============</span><br><span class="line">邮件发送内容：加急 ： 加班申请 给谁王老板</span><br><span class="line">===================加急==============</span><br></pre></td></tr></table></figure>

<h2 id="14-委派模式"><a href="#14-委派模式" class="headerlink" title="14.委派模式"></a>14.委派模式</h2><p>委派模式(Delegate Pattern)又叫委托模式。它的基本作用是负责任务的调度和任务分配，将任务的分配和执行分离开来。可以看作是一种特殊情况下的静态代理的全权代理。<br>不属于GOF 23种设计模式之一。<br>属于行为型模式。</p>
<p><strong>适用场景：</strong></p>
<ul>
<li>委派对象本身不知道如何处理一个任务(或一个请求)，把请求交给其他对象来处理。</li>
<li>实现程序的解耦。</li>
</ul>
<p><strong>优点：</strong></p>
<ul>
<li>分离抽象部分以及其具体实现部分。</li>
<li>提高了系统的扩展性。</li>
<li>符合开闭原则。</li>
<li>符合合成复用原则。</li>
<li>通过任务委派能够将一个大型的任务细化，然后通过统一管理这些子任务的完成情况实现任务的跟进，能够加快任务执行的效率。</li>
</ul>
<p><strong>缺点：</strong></p>
<ul>
<li>增加了系统的理解与设计难度。</li>
<li>需要正确的识别系统中两个独立变化的维度。</li>
<li>任务委派方式需要根据任务的复杂程度进行不同的改变，再任务比较复杂的情况下可能需要进行多重委派，容易造成紊乱。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">//老板发任务</span><br><span class="line">public class Boos &#123;</span><br><span class="line">    public void command(String task,Leader leader)&#123;</span><br><span class="line">        leader.doing(task);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">//代理着经理分配任务，啥事不干</span><br><span class="line">public class Leader implements IEmployee &#123;</span><br><span class="line">    private Map&lt;String,IEmployee&gt; employees = new HashMap&lt;&gt;();</span><br><span class="line">    public Leader()&#123;</span><br><span class="line">        employees.put(&quot;Banner&quot;,new EmplyeeA());</span><br><span class="line">        employees.put(&quot;List&quot;,new EmplyeeB());</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public void doing(String task) &#123;</span><br><span class="line">        /*if (&quot;Banner&quot;.equals(task))&#123;</span><br><span class="line">            new EmplyeeA().doing(task);</span><br><span class="line">        &#125; else if (&quot;List&quot;.equals(task))&#123;</span><br><span class="line">            new EmplyeeB().doing(task);</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            System.out.println(&quot;这个任务&quot;+task+&quot;做不了，人手不够&quot;);</span><br><span class="line">        &#125;*/</span><br><span class="line"></span><br><span class="line">        if (!employees.containsKey(task))&#123;</span><br><span class="line">            System.out.println(&quot;这个任务&quot;+task+&quot;做不了，人手不够&quot;);</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        employees.get(task).doing(task);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//员工</span><br><span class="line">public interface IEmployee &#123;</span><br><span class="line">    void doing(String task);</span><br><span class="line">&#125;</span><br><span class="line">public class EmplyeeA implements IEmployee &#123;</span><br><span class="line">    protected String goodAt = &quot;Banner&quot;;</span><br><span class="line">    @Override</span><br><span class="line">    public void doing(String task) &#123;</span><br><span class="line">        System.out.println(&quot;我是员工A，擅长 &quot;+ goodAt +&quot;,接受工作&quot;+task);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">public class EmplyeeB implements IEmployee &#123;</span><br><span class="line">    protected String goodAt = &quot;List&quot;;</span><br><span class="line">    @Override</span><br><span class="line">    public void doing(String task) &#123;</span><br><span class="line">        System.out.println(&quot;我是员工B，擅长 &quot;+ goodAt +&quot;,接受工作&quot;+task);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public class Test &#123;</span><br><span class="line">    public static void main(String[] args)&#123;</span><br><span class="line">        new Boos().command(&quot;Banner&quot;,new Leader());</span><br><span class="line">        new Boos().command(&quot;List&quot;,new Leader());</span><br><span class="line">        new Boos().command(&quot;Ad&quot;,new Leader());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">我是员工A，擅长 Banner,接受工作Banner</span><br><span class="line">我是员工B，擅长 List,接受工作List</span><br><span class="line">这个任务Ad做不了，人手不够</span><br></pre></td></tr></table></figure>

<p>还有ClassLoader源码也是典型的双亲委派模式，避免重复加载。</p>
<h2 id="15-委派模式和代理模式的区别"><a href="#15-委派模式和代理模式的区别" class="headerlink" title="15.委派模式和代理模式的区别"></a>15.委派模式和代理模式的区别</h2><ul>
<li>委派模式是行为型模式，代理模式是结构型模式。</li>
<li>委派模式注重的是任务派遣，注重结果；代理模式注重的是代码增强，注重过程。</li>
<li>委派模式是一种特殊的静态代理，相当于全权代理。</li>
</ul>
<h2 id="16-模板方法模式"><a href="#16-模板方法模式" class="headerlink" title="16.模板方法模式"></a>16.模板方法模式</h2><p>模板方法模式(Template Method Pattern)通常又叫模板模式，是指定一个算法的骨架，并允许子类为其中的一个或者多个步骤提供实现。<br>模板方法使得子类可以再不改变算法结构的情况下，重新定义算法的某些步骤。<br>属于行为型设计模式。</p>
<p><strong>适用场景：</strong></p>
<ul>
<li>一次性实现一个算法不变的部分，并将可变的行为留给子类来实现。</li>
<li>各子类中公共的行为被提取出来并集中到一个公共的父类中，从而避免代码重复。</li>
</ul>
<p><strong>优点：</strong></p>
<ul>
<li>利用模板方法将相同处理逻辑的代码放到抽象父类中，可以提高代码的复用性。</li>
<li>将不同的代码放在不同的子类中，通过对子类的扩展增加新的行为，提高代码的扩展性。</li>
<li>把不变的行为写在父类上，去除子类的重复代码，提供了一个很好的代码复用平台，符合开闭原则。</li>
</ul>
<p><strong>缺点：</strong></p>
<ul>
<li>类数目的增加，每一个抽象类都需要一个子类实现，这样导致类的个数增加。</li>
<li>类数量的增加，间接地增加了系统实现的复杂度。</li>
<li>继承关系的自身缺点，如果父类增加新的抽象方法，所有子类都要改一遍。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">public abstract class AbastractCourse &#123;</span><br><span class="line">    public final void createCourse()&#123;</span><br><span class="line">        //发布预习资料</span><br><span class="line">        postPreResource();</span><br><span class="line">        //制作课件</span><br><span class="line">        createPPT();</span><br><span class="line">        //直播授课</span><br><span class="line">        liveVideo();</span><br><span class="line">        //上传课后资料</span><br><span class="line">        postResource();</span><br><span class="line">        // 布置作业</span><br><span class="line">        postWork();</span><br><span class="line">        if (needCheckWork())&#123;</span><br><span class="line">            checkWork();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    protected boolean needCheckWork()&#123;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    protected abstract void checkWork();</span><br><span class="line"></span><br><span class="line">    protected void postPreResource() &#123;</span><br><span class="line">        System.out.println(&quot;发布预习资料&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    protected void createPPT() &#123;</span><br><span class="line">        System.out.println(&quot;制作课件&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    protected void liveVideo() &#123;</span><br><span class="line">        System.out.println(&quot;直播授课&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    protected void postResource() &#123;</span><br><span class="line">        System.out.println(&quot;上传课后资料&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    protected void postWork() &#123;</span><br><span class="line">        System.out.println(&quot;布置作业&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class JavaCourse extends AbastractCourse &#123;</span><br><span class="line">    private boolean needCheckWork = false;</span><br><span class="line"></span><br><span class="line">    public void setNeedCheckWork(boolean needCheckWork) &#123;</span><br><span class="line">        this.needCheckWork = needCheckWork;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected boolean needCheckWork() &#123;</span><br><span class="line">        return this.needCheckWork;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void checkWork() &#123;</span><br><span class="line">        System.out.println(&quot;检查java作业&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class PythonCourse extends AbastractCourse &#123;</span><br><span class="line">    @Override</span><br><span class="line">    protected void checkWork() &#123;</span><br><span class="line">        System.out.println(&quot;检查python作业&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">public static void main(String[] args)&#123;</span><br><span class="line">    System.out.println(&quot;pattern----------------start&quot;);</span><br><span class="line">    JavaCourse java = new JavaCourse();</span><br><span class="line">    java.setNeedCheckWork(true);</span><br><span class="line">    java.createCourse();</span><br><span class="line">    System.out.println(&quot;pattern----------------Divider&quot;);</span><br><span class="line">    PythonCourse python = new PythonCourse();</span><br><span class="line">    python.createCourse();</span><br><span class="line">    System.out.println(&quot;pattern----------------end&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">pattern----------------start</span><br><span class="line">发布预习资料</span><br><span class="line">制作课件</span><br><span class="line">直播授课</span><br><span class="line">上传课后资料</span><br><span class="line">布置作业</span><br><span class="line">检查java作业</span><br><span class="line">pattern----------------Divider</span><br><span class="line">发布预习资料</span><br><span class="line">制作课件</span><br><span class="line">直播授课</span><br><span class="line">上传课后资料</span><br><span class="line">布置作业</span><br><span class="line">pattern----------------end</span><br></pre></td></tr></table></figure>

<h2 id="17-策略模式"><a href="#17-策略模式" class="headerlink" title="17.策略模式"></a>17.策略模式</h2><p>策略模式(Strategy Pattern)又叫政策模式(Policy Pattern)，它是将定义的算法家族，分别封装起来，让他们之间可以互相替换，从而让算法的变化不会影响到使用算法的用户。<br>可以避免多重分支的if…else…和switch语句。<br>属于行为型模式。</p>
<p><strong>适用场景：</strong></p>
<ul>
<li>假如系统中的很多类，而他们的区别仅仅在于他们的行为不同。</li>
<li>一个系统需要动态地在几种算法中选择一种。</li>
<li>需要屏蔽算法规则。</li>
</ul>
<p><strong>优点：</strong></p>
<ul>
<li>策略模式符合开闭原则。</li>
<li>避免使用多重条件转移语句，如if…else…和switch语句。</li>
<li>使用策略模式可以提高算法的保密性和安全性。</li>
</ul>
<p><strong>缺点：</strong></p>
<ul>
<li>客户端必须知道所有的策略，并且自行决定使用哪一个策略类。</li>
<li>代码中会产生非常多策略类，增加维护难度。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line">public abstract class Payment &#123;</span><br><span class="line">    public abstract String getPayName();</span><br><span class="line">    public MsgResult pay(String uid,double amount)&#123;</span><br><span class="line">        if (queryBalance(uid) &lt; amount)&#123;</span><br><span class="line">            return new MsgResult(500,&quot;支付失败&quot;,&quot;余额不足&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        return new MsgResult(200,&quot;支付成功&quot;,&quot;订单金额：&quot;+amount);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    protected abstract double queryBalance(String uid);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class AliPay extends Payment &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public String getPayName() &#123;</span><br><span class="line">        return &quot;支付宝&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    protected double queryBalance(String uid) &#123;</span><br><span class="line">        return 5000;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class JDPay extends Payment &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public String getPayName() &#123;</span><br><span class="line">        return &quot;京东&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    protected double queryBalance(String uid) &#123;</span><br><span class="line">        return 6000;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class WechatPay extends Payment &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public String getPayName() &#123;</span><br><span class="line">        return &quot;微信&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    protected double queryBalance(String uid) &#123;</span><br><span class="line">        return 100;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class UnionPay extends Payment &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public String getPayName() &#123;</span><br><span class="line">        return &quot;银联&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    protected double queryBalance(String uid) &#123;</span><br><span class="line">        return 10000;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">//这里其实用到了委派模式</span><br><span class="line">public class PayStrategy &#123;</span><br><span class="line">    public static  final String ALI_PAY=&quot;AliPay&quot;;</span><br><span class="line">    public static  final String WECHAT_PAY=&quot;WechatPay&quot;;</span><br><span class="line">    public static  final String JD_PAY=&quot;JDPay&quot;;</span><br><span class="line">    public static  final String UNION_PAY=&quot;UnionPay&quot;;</span><br><span class="line">    public static  final String DEFAULT_PAY=ALI_PAY;</span><br><span class="line">    private static Map&lt;String,Payment&gt; payStrategy = new HashMap&lt;&gt;();</span><br><span class="line">    static &#123;</span><br><span class="line">        payStrategy.put(ALI_PAY,new AliPay());</span><br><span class="line">        payStrategy.put(WECHAT_PAY,new WechatPay());</span><br><span class="line">        payStrategy.put(JD_PAY,new JDPay());</span><br><span class="line">        payStrategy.put(UNION_PAY,new UnionPay());</span><br><span class="line">    &#125;</span><br><span class="line">    public static Payment get(String payKey)&#123;</span><br><span class="line">        if (!payStrategy.containsKey(payKey))&#123;</span><br><span class="line">            return payStrategy.get(DEFAULT_PAY);</span><br><span class="line">        &#125;</span><br><span class="line">        return  payStrategy.get(payKey);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class Order &#123;</span><br><span class="line">    public String uid;</span><br><span class="line">    public String orderId;</span><br><span class="line">    public double amount;</span><br><span class="line">    public Order(String uid, String orderId,double amount)&#123;</span><br><span class="line">        this.uid = uid;</span><br><span class="line">        this.orderId = orderId;</span><br><span class="line">        this.amount = amount;</span><br><span class="line">    &#125;</span><br><span class="line">    public MsgResult pay()&#123;</span><br><span class="line">        return pay(PayStrategy.DEFAULT_PAY);</span><br><span class="line">    &#125;</span><br><span class="line">    public MsgResult pay(String payKey)&#123;</span><br><span class="line">        Payment payment = PayStrategy.get(payKey);</span><br><span class="line">        System.out.println(&quot;支付方式：&quot;+payment.getPayName());</span><br><span class="line">        System.out.println(&quot;交易金额：&quot;+this.amount);</span><br><span class="line">        return payment.pay(uid,amount);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class MsgResult &#123;</span><br><span class="line">    public int code;</span><br><span class="line">    public Object data;</span><br><span class="line">    public String msg;</span><br><span class="line">    public MsgResult(int code,String msg,Object data)&#123;</span><br><span class="line">        this.code = code;</span><br><span class="line">        this.data = data;</span><br><span class="line">        this.msg = msg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String toString() &#123;</span><br><span class="line">        return &quot;MsgResult&#123;&quot; +</span><br><span class="line">                &quot;code=&quot; + code +</span><br><span class="line">                &quot;, data=&quot; + data +</span><br><span class="line">                &quot;, msg=&apos;&quot; + msg + &apos;\&apos;&apos; +</span><br><span class="line">                &apos;&#125;&apos;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">public class Test &#123;</span><br><span class="line">    public static void main(String[] args)&#123;</span><br><span class="line">        System.out.println(&quot;pattern----------------start&quot;);</span><br><span class="line">        Order order = new Order(&quot;1&quot;,&quot;12392847283753&quot;,230.87);</span><br><span class="line">        System.out.println(order.pay());</span><br><span class="line">        System.out.println(order.pay(PayStrategy.WECHAT_PAY));</span><br><span class="line">        System.out.println(&quot;pattern----------------end&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">pattern----------------start</span><br><span class="line">支付方式：支付宝</span><br><span class="line">交易金额：230.87</span><br><span class="line">MsgResult&#123;code=200, data=订单金额：230.87, msg=&apos;支付成功&apos;&#125;</span><br><span class="line">支付方式：微信</span><br><span class="line">交易金额：230.87</span><br><span class="line">MsgResult&#123;code=500, data=余额不足, msg=&apos;支付失败&apos;&#125;</span><br><span class="line">pattern----------------end</span><br></pre></td></tr></table></figure>

<h2 id="18-责任链模式"><a href="#18-责任链模式" class="headerlink" title="18.责任链模式"></a>18.责任链模式</h2><p>责任链模式(Chain of Responsibility Pattern)，是将链中每一个节点看作一个对象，每个节点处理的请求均不同，且内部自动维护一个下一个节点对象。当一个请求从链式的首端发出时，会沿着链的路径依次传递给每一个节点对象，直至有对象处理这个请求为止。<br>属于行为型模式。</p>
<p><strong>适用场景：</strong></p>
<ul>
<li>多个对象可以处理同一请求，但是具体由哪个对象处理则在运行时动态决定。</li>
<li>在不明确指定接收者的情况下，向多个对象中的一个提交一个请求。</li>
<li>可动态指定一组对象处理请求。</li>
</ul>
<p><strong>优点：</strong></p>
<ul>
<li>将请求与处理解耦。</li>
<li>请求处理者(节点对象)只需要关注自己感兴趣的请求进行处理即可，对于不感兴趣的请求，直接转发给下一级节点对象。</li>
<li>具备链式传递处理请求功能，请求发送者无需知晓链路结构，只需要等待请求处理结果。</li>
<li>链路结构灵活，可以通过改变链路结构动态的新增或删除责任。</li>
<li>易于扩展新的请求处理类(节点对象)，符合开闭原则。</li>
</ul>
<p><strong>缺点：</strong></p>
<ul>
<li>责任链太长或处理时间过长，会影响整体性能。</li>
<li>如果节点对象存在循环引用时，会造成死循环，导致系统崩溃。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line">public class Member &#123;</span><br><span class="line">    public String loginName;</span><br><span class="line">    public String loginPass;</span><br><span class="line">    public String roleName;</span><br><span class="line">    public Member(String loginName,String loginPass)&#123;</span><br><span class="line">        this.loginName = loginName;</span><br><span class="line">        this.loginPass = loginPass;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public abstract class Handler&lt;T&gt; &#123;</span><br><span class="line">    protected Handler next;</span><br><span class="line">    public void next(Handler next)&#123;</span><br><span class="line">        this.next = next;</span><br><span class="line">    &#125;;</span><br><span class="line">    public abstract void doHandler(Member member);</span><br><span class="line"></span><br><span class="line">    //建造者模式</span><br><span class="line">    public static class Builder&lt;T&gt; &#123;</span><br><span class="line">        private Handler&lt;T&gt; head;</span><br><span class="line">        private Handler&lt;T&gt; tail;</span><br><span class="line">        public Builder&lt;T&gt; addHandler(Handler&lt;T&gt; handler)&#123;</span><br><span class="line">            if (this.head == null)&#123;</span><br><span class="line">                this.head = this.tail = handler;</span><br><span class="line">                return this;</span><br><span class="line">            &#125;</span><br><span class="line">            this.tail.next(handler);</span><br><span class="line">            this.tail = handler;</span><br><span class="line">            return this;</span><br><span class="line">        &#125;</span><br><span class="line">        public Handler&lt;T&gt; build()&#123;</span><br><span class="line">            return this.head;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class ValidateHandler extends Handler &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void doHandler(Member member) &#123;</span><br><span class="line">        if(StringUtils.isEmpty(member.loginName) || StringUtils.isEmpty(member.loginPass))&#123;</span><br><span class="line">            System.out.println(&quot;用户名或密码为空&quot;);</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(&quot;用户名或密码不为空，往下执行&quot;);</span><br><span class="line">        next.doHandler(member);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class LoginHandler extends Handler &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void doHandler(Member member) &#123;</span><br><span class="line">        System.out.println(&quot;登录成功&quot;);</span><br><span class="line">        member.roleName = &quot;管理员&quot;;</span><br><span class="line">        System.out.println(&quot;用户名或密码不为空，往下执行&quot;);</span><br><span class="line">        next.doHandler(member);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class AuthHandler extends  Handler&#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void doHandler(Member member) &#123;</span><br><span class="line">        if(!&quot;管理员&quot;.equals(member.roleName))&#123;</span><br><span class="line">            System.out.println(&quot;你不是管理员，不能操作&quot;);</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(&quot;允许操作&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class MemberChain &#123;</span><br><span class="line">    public void login(String loginName,String loginPass)&#123;</span><br><span class="line">        //通用模式</span><br><span class="line"></span><br><span class="line">        /*ValidateHandler validateHandler = new ValidateHandler();</span><br><span class="line">        LoginHandler loginHandler = new LoginHandler();</span><br><span class="line">        AuthHandler authHandler = new AuthHandler();</span><br><span class="line">        validateHandler.next(loginHandler);</span><br><span class="line">        loginHandler.next(authHandler);</span><br><span class="line">        validateHandler.doHandler(new Member(loginName,loginPass));*/</span><br><span class="line"></span><br><span class="line">        //和建造者模式结合使用</span><br><span class="line">        Handler.Builder builder = new Handler.Builder();</span><br><span class="line">         builder.addHandler(new ValidateHandler())</span><br><span class="line">                .addHandler(new LoginHandler())</span><br><span class="line">                .addHandler(new AuthHandler());</span><br><span class="line">        builder.build().doHandler(new Member(loginName,loginPass));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public class Test &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        System.out.println(&quot;pattern----------------start&quot;);</span><br><span class="line">        MemberChain memberChain = new MemberChain();</span><br><span class="line">        memberChain.login(&quot;tim&quot;,&quot;123&quot;);</span><br><span class="line">        System.out.println(&quot;pattern----------------end&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">pattern----------------start</span><br><span class="line">用户名或密码不为空，往下执行</span><br><span class="line">登录成功</span><br><span class="line">用户名或密码不为空，往下执行</span><br><span class="line">允许操作</span><br><span class="line">pattern----------------end</span><br></pre></td></tr></table></figure>

<h2 id="19-迭代器模式"><a href="#19-迭代器模式" class="headerlink" title="19.迭代器模式"></a>19.迭代器模式</h2><p>迭代器模式(Iterator Pattern),又称为游标(Cursor Pattern)模式，它提供一种顺序访问集合、容器对象元素的方法，而又无须暴漏集合内部表示。<br>本质：抽离集合对象迭代行为到迭代器中，提供一致访问接口。<br>属于行为型模式。<br><strong>适用场景：</strong></p>
<ul>
<li>访问一个集合对象的内容而无需暴露它的内部表示。</li>
<li>为遍历不同的集合结构提供一个统一的访问接口。</li>
</ul>
<p><strong>优点：</strong></p>
<ul>
<li>多态迭代：为不同的聚合结构提供一致的遍历接口，即一个迭代接口可以访问不同的聚集对象。</li>
<li>简化集合对象接口：迭代器模式将集合对象本身应该提供的元素迭代接口抽取到了迭代器中，使集合对象无须关心具体迭代行为。</li>
<li>元素迭代功能多样化：每个集合对象都可以提供一个或多个不同的迭代器，使得同种元素聚合结构可以有不同的迭代行为。</li>
<li>接口迭代与集合：迭代器模式封装了具体的迭代算法，迭代算法的变化，不会影响到集合对象的架构。</li>
</ul>
<p><strong>缺点：</strong></p>
<ul>
<li>对于比较简单的遍历（数组或者有序列表），使用迭代器方式遍历较为繁琐。</li>
</ul>
<p>迭代器比较简单啊，而且jdk已经给实现了，下面手写一个迭代器，看下迭代器原理啊：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">public interface Iterator&lt;E&gt; &#123;</span><br><span class="line">    E next();</span><br><span class="line">    boolean hasNext();</span><br><span class="line">&#125;</span><br><span class="line">public class IteratorImpl&lt;E&gt; implements Iterator&lt;E&gt;&#123;</span><br><span class="line">    private List&lt;E&gt; list;</span><br><span class="line">    private int cursor;</span><br><span class="line">    private E element;</span><br><span class="line"></span><br><span class="line">    public IteratorImpl( List&lt;E&gt; list)&#123;</span><br><span class="line">        this.list= list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public E next() &#123;</span><br><span class="line">        System.out.println(&quot;当前位置：&quot;+cursor);</span><br><span class="line">        element = list.get(cursor);</span><br><span class="line">        cursor++;</span><br><span class="line">        return element;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public boolean hasNext() &#123;</span><br><span class="line">        if (cursor &gt; list.size()-1)&#123;</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public interface ICourseAggreagte &#123;</span><br><span class="line">    void add(Course course);</span><br><span class="line">    void remove(Course course);</span><br><span class="line">    Iterator&lt;Course&gt; iterator();</span><br><span class="line">&#125;</span><br><span class="line">public class CourseAggreagteImpl implements ICourseAggreagte &#123;</span><br><span class="line">    private List courseList;</span><br><span class="line">    public CourseAggreagteImpl()&#123;</span><br><span class="line">        this.courseList = new ArrayList();</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public void add(Course course) &#123;</span><br><span class="line">        courseList.add(course);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void remove(Course course) &#123;</span><br><span class="line">        courseList.remove(course);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public Iterator&lt;Course&gt; iterator() &#123;</span><br><span class="line">        return new IteratorImpl&lt;Course&gt;(courseList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class Course &#123;</span><br><span class="line">    public String name;</span><br><span class="line">    public Course(String name)&#123;</span><br><span class="line">        this.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">public class Test &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        System.out.println(&quot;pattern----------------start&quot;);</span><br><span class="line">        Course java = new Course(&quot;java&quot;);</span><br><span class="line">        Course py = new Course(&quot;python&quot;);</span><br><span class="line">        Course js = new Course(&quot;js&quot;);</span><br><span class="line">        Course ai = new Course(&quot;ai&quot;);</span><br><span class="line"></span><br><span class="line">        ICourseAggreagte aggreagte = new CourseAggreagteImpl();</span><br><span class="line">        aggreagte.add(java);</span><br><span class="line">        aggreagte.add(py);</span><br><span class="line">        aggreagte.add(js);</span><br><span class="line">        aggreagte.add(ai);</span><br><span class="line"></span><br><span class="line">        System.out.println(&quot;========课程列表========&quot;);</span><br><span class="line">        printCourser(aggreagte);</span><br><span class="line"></span><br><span class="line">        aggreagte.remove(js);</span><br><span class="line">        System.out.println(&quot;========课程列表-删除js========&quot;);</span><br><span class="line">        printCourser(aggreagte);</span><br><span class="line">        System.out.println(&quot;pattern----------------end&quot;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static void printCourser(ICourseAggreagte aggreagte)&#123;</span><br><span class="line">        Iterator&lt;Course&gt; iterator = aggreagte.iterator();</span><br><span class="line">        while(iterator.hasNext())&#123;</span><br><span class="line">            Course coure = iterator.next();</span><br><span class="line">            System.out.println(&quot;(&quot;+coure.name+&quot;)&quot;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">pattern----------------start</span><br><span class="line">========课程列表========</span><br><span class="line">当前位置：0</span><br><span class="line">(java)</span><br><span class="line">当前位置：1</span><br><span class="line">(python)</span><br><span class="line">当前位置：2</span><br><span class="line">(js)</span><br><span class="line">当前位置：3</span><br><span class="line">(ai)</span><br><span class="line">========课程列表-删除js========</span><br><span class="line">当前位置：0</span><br><span class="line">(java)</span><br><span class="line">当前位置：1</span><br><span class="line">(python)</span><br><span class="line">当前位置：2</span><br><span class="line">(ai)</span><br><span class="line">pattern----------------end</span><br></pre></td></tr></table></figure>

<h2 id="20-命令模式"><a href="#20-命令模式" class="headerlink" title="20.命令模式"></a>20.命令模式</h2><p>命令模式(Command Pattern)是对命令的封装，每一个命令都是一个操作：请求的一方发出请求要求执行一个操作；接收的一方收到请求，并执行操作。命令模式解耦了请求方和接收方，请求方只需请求执行命令，不用关心命令是怎样被接收，怎样被操作以及是否被执行等等。<br>本质：解耦命令请求与处理。<br>属于行为型模式。</p>
<p><strong>适用场景：</strong></p>
<ul>
<li>现实语义中具备命令的操作(如命令菜单，shell命令。。。。。).</li>
<li>请求调用者和请求的接收者需要解耦，使得调用者和接收者不直接交互。</li>
<li>需要抽象出等待执行的行为，比如撤销操作和恢复操作等等。</li>
<li>需要支持命令宏(即命令组合操作)。</li>
</ul>
<p><strong>优点：</strong></p>
<ul>
<li>通过引入中间件(抽象接口)，解耦了命令请求与实现。</li>
<li>扩展性良好，可以很容的增加新命令。</li>
<li>支持组合命令，支持命令队列。</li>
<li>可以在现有命令的基础上，增加额外功能。</li>
</ul>
<p><strong>缺点：</strong></p>
<ul>
<li>具体命令类可能很多。</li>
<li>增加了程序的复杂度，理解更加困难。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">public interface ICommand &#123;</span><br><span class="line">    void execute();</span><br><span class="line">&#125;</span><br><span class="line">public class PlayCommand implements ICommand&#123;</span><br><span class="line">    private Gplayer gplayer;</span><br><span class="line">    public PlayCommand(Gplayer gplayer)&#123;</span><br><span class="line">        this.gplayer = gplayer;</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public void execute() &#123;</span><br><span class="line">        this.gplayer.paly();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">public class PauseCommand implements ICommand&#123;</span><br><span class="line">    private Gplayer gplayer;</span><br><span class="line">    public PauseCommand(Gplayer gplayer)&#123;</span><br><span class="line">        this.gplayer = gplayer;</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public void execute() &#123;</span><br><span class="line">        this.gplayer.pause();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class SpeedCommand implements ICommand&#123;</span><br><span class="line">    private Gplayer gplayer;</span><br><span class="line">    public SpeedCommand(Gplayer gplayer)&#123;</span><br><span class="line">        this.gplayer = gplayer;</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public void execute() &#123;</span><br><span class="line">        this.gplayer.speed();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">public class StopCommand implements ICommand&#123;</span><br><span class="line">    private Gplayer gplayer;</span><br><span class="line">    public StopCommand(Gplayer gplayer)&#123;</span><br><span class="line">        this.gplayer = gplayer;</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public void execute() &#123;</span><br><span class="line">        this.gplayer.stop();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//播放器</span><br><span class="line">public class Gplayer &#123;</span><br><span class="line">    public void paly()&#123;</span><br><span class="line">        System.out.println(&quot;播放&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    public void speed()&#123;</span><br><span class="line">        System.out.println(&quot;滑动&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    public void stop()&#123;</span><br><span class="line">        System.out.println(&quot;停止&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    public void pause()&#123;</span><br><span class="line">        System.out.println(&quot;暂停&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">//控制条？人</span><br><span class="line">public class Controller &#123;</span><br><span class="line">    private List&lt;ICommand&gt; commons = new ArrayList&lt;&gt;();</span><br><span class="line">    public void execute(ICommand command)&#123;</span><br><span class="line">        command.execute();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void addCommond(ICommand command)&#123;</span><br><span class="line">        commons.add(command);</span><br><span class="line">    &#125;</span><br><span class="line">    public void executes()&#123;</span><br><span class="line">        for(ICommand command: commons)&#123;</span><br><span class="line">            command.execute();</span><br><span class="line">        &#125;</span><br><span class="line">        commons.clear();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">public static void main(String[] args)&#123;</span><br><span class="line">    System.out.println(&quot;pattern----------------start&quot;);</span><br><span class="line">    Gplayer gplayer = new Gplayer();</span><br><span class="line">    Controller controller = new Controller();</span><br><span class="line">    controller.execute(new PlayCommand(gplayer));</span><br><span class="line">    System.out.println(&quot;=======执行组合擦欧总=========&quot;);</span><br><span class="line">    controller.addCommond(new PlayCommand(gplayer));</span><br><span class="line">    controller.addCommond(new PauseCommand(gplayer));</span><br><span class="line">    controller.addCommond(new SpeedCommand(gplayer));</span><br><span class="line">    controller.addCommond(new StopCommand(gplayer));</span><br><span class="line">    controller.executes();</span><br><span class="line">    System.out.println(&quot;pattern----------------end&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">pattern----------------start</span><br><span class="line">播放</span><br><span class="line">=======执行组合擦欧总=========</span><br><span class="line">播放</span><br><span class="line">暂停</span><br><span class="line">滑动</span><br><span class="line">停止</span><br><span class="line">pattern----------------end</span><br></pre></td></tr></table></figure>

<h2 id="21-状态模式"><a href="#21-状态模式" class="headerlink" title="21.状态模式"></a>21.状态模式</h2><p>状态模式（State Pattern）,也称为状态机(State Machine Pattern)模式，是允许对象在内部状态发生改变时改变它的行为，对象看起来好像修改了它的类。<br>属于行为模式。</p>
<p><strong>适用场景：</strong></p>
<ul>
<li>行为随状态改变而改变的场景.</li>
<li>一个操作中含有庞大的多分支结构，并且这些分支取决于对象的状态。</li>
</ul>
<p><strong>优点：</strong></p>
<ul>
<li>结构清晰：将状态独立为类，消除了冗余的if else 或者switch语句，使代码更加简洁，提高系统的可维护性。</li>
<li>将状态转换显示化：通常的对象内部都是使用数值类型来定义状态，状态切换是通过赋值进行表现，不够直观；而使用状态类，在切换状态时，是以不同的类进行表示，转换目的更加明确。</li>
<li>状态类职责明确且具备扩展性。</li>
</ul>
<p><strong>缺点：</strong></p>
<ul>
<li>类膨胀：如果一个事务具备多种状态，则会造成状态类太多。</li>
<li>状态模式的结构与实现较为复杂，如果使用不当将导致程序结构和代码的混乱。</li>
<li>状态模式对开闭原则的支持不太好，对于可以切换状态的状态模式，增加新的的状态类需要修改那些负责状态转换的源代码，否则无法切换到新增状态，而且修改某个状态类的行为也需要修改对应类的源代码。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">public abstract class UserState &#123;</span><br><span class="line">    protected AppContext context;</span><br><span class="line"></span><br><span class="line">    public void setContext(AppContext context) &#123;</span><br><span class="line">        this.context = context;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public abstract void favorite();</span><br><span class="line">    public abstract void comment(String comment);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class LoginState extends UserState &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void favorite() &#123;</span><br><span class="line">        System.out.println(&quot;收藏成功&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void comment(String comment) &#123;</span><br><span class="line">        System.out.println(&quot;评论成功：&quot;+comment);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class UnLoginState extends UserState &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void favorite() &#123;</span><br><span class="line">        this.jumpLoin();</span><br><span class="line">        this.context.getCurrentUserState().favorite();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void comment(String comment) &#123;</span><br><span class="line">        this.jumpLoin();</span><br><span class="line">        this.context.getCurrentUserState().comment(comment);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void jumpLoin() &#123;</span><br><span class="line">        System.out.println(&quot;未登录，跳转登录页&quot;);</span><br><span class="line">        this.context.setState(this.context.STATE_LOGIN);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class AppContext &#123;</span><br><span class="line">    public static final UserState STATE_LOGIN = new LoginState();</span><br><span class="line">    public static final UserState STATE_UNLOGIN = new UnLoginState();</span><br><span class="line">    private UserState currentUserState = STATE_UNLOGIN;</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line">        STATE_LOGIN.setContext(this);</span><br><span class="line">        STATE_UNLOGIN.setContext(this);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setState(UserState userState)&#123;</span><br><span class="line">        this.currentUserState = userState;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public UserState getCurrentUserState() &#123;</span><br><span class="line">        return currentUserState;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void favorite()&#123;</span><br><span class="line">        this.currentUserState.favorite();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void comment(String comment) &#123;</span><br><span class="line">        this.currentUserState.comment(comment);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public static void main(String[] args)&#123;</span><br><span class="line">    System.out.println(&quot;pattern----------------start&quot;);</span><br><span class="line">    AppContext context = new AppContext();</span><br><span class="line">    context.favorite();</span><br><span class="line">    context.comment(&quot;评论&quot;);</span><br><span class="line">    System.out.println(&quot;pattern----------------end&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">pattern----------------start</span><br><span class="line">未登录，跳转登录页</span><br><span class="line">收藏成功</span><br><span class="line">评论成功：评论</span><br><span class="line">pattern----------------end</span><br></pre></td></tr></table></figure>

<p>其中最经典的状态机模式，还是Android中页面的生命周期。</p>
<h2 id="22-备忘录模式"><a href="#22-备忘录模式" class="headerlink" title="22.备忘录模式"></a>22.备忘录模式</h2><p><strong>适用场景：</strong></p>
<ul>
<li>.</li>
</ul>
<p><strong>优点：</strong></p>
<ul>
<li>。</li>
</ul>
<p><strong>缺点：</strong></p>
<ul>
<li>。</li>
</ul>
<h2 id="23-中介者模式"><a href="#23-中介者模式" class="headerlink" title="23.中介者模式"></a>23.中介者模式</h2><p><strong>适用场景：</strong></p>
<ul>
<li>.</li>
</ul>
<p><strong>优点：</strong></p>
<ul>
<li>。</li>
</ul>
<p><strong>缺点：</strong></p>
<ul>
<li>。</li>
</ul>
<h2 id="24-解释器模式"><a href="#24-解释器模式" class="headerlink" title="24.解释器模式"></a>24.解释器模式</h2><p><strong>适用场景：</strong></p>
<ul>
<li>.</li>
</ul>
<p><strong>优点：</strong></p>
<ul>
<li>。</li>
</ul>
<p><strong>缺点：</strong></p>
<ul>
<li>。</li>
</ul>
<h2 id="25-观察者模式"><a href="#25-观察者模式" class="headerlink" title="25.观察者模式"></a>25.观察者模式</h2><p><strong>适用场景：</strong></p>
<ul>
<li>.</li>
</ul>
<p><strong>优点：</strong></p>
<ul>
<li>。</li>
</ul>
<p><strong>缺点：</strong></p>
<ul>
<li>。</li>
</ul>
<h2 id="26-访问者模式"><a href="#26-访问者模式" class="headerlink" title="26.访问者模式"></a>26.访问者模式</h2><p><strong>适用场景：</strong></p>
<ul>
<li>.</li>
</ul>
<p><strong>优点：</strong></p>
<ul>
<li>。</li>
</ul>
<p><strong>缺点：</strong></p>
<ul>
<li>。</li>
</ul>
<h2 id="27-设计模式总结"><a href="#27-设计模式总结" class="headerlink" title="27.设计模式总结"></a>27.设计模式总结</h2><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a href="https://www.bilibili.com/video/BV1L5411R7BP?p=4&spm_id_from=pageDriver&vd_source=5442b4c25ece27e33e3aeca4f29ec7f6" target="_blank" rel="noopener">从未见过如此通俗易懂的Java设计模式教程</a></p>

        
            <div id="toc-article">
                
  <div class="widget-wrap" id="toc-wrap">
    <h3 class="widget-title"><i class="fa fa-toc"></i> Inhalte</h3>
    <div class="widget">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-工厂设计模式"><span class="toc-text">1.工厂设计模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#简单工厂模式"><span class="toc-text">简单工厂模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#工厂方法模式"><span class="toc-text">工厂方法模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#抽象工厂模式"><span class="toc-text">抽象工厂模式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-单例模式"><span class="toc-text">2.单例模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#饿汉式单例"><span class="toc-text">饿汉式单例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#懒汉式单例"><span class="toc-text">懒汉式单例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#线程不安全"><span class="toc-text">线程不安全</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#线程安全"><span class="toc-text">线程安全</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#双重校验"><span class="toc-text">双重校验</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#静态内部类"><span class="toc-text">静态内部类</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#反射破坏单例"><span class="toc-text">反射破坏单例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#注册式单例"><span class="toc-text">注册式单例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#序列化、反序列化破坏单例"><span class="toc-text">序列化、反序列化破坏单例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ThreadLocal单例"><span class="toc-text">ThreadLocal单例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#总结"><span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-原型模式"><span class="toc-text">3.原型模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#浅克隆"><span class="toc-text">浅克隆</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#深克隆"><span class="toc-text">深克隆</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-适配器模式"><span class="toc-text">4.适配器模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#类适配器"><span class="toc-text">类适配器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#对象适配器"><span class="toc-text">对象适配器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#接口适配器"><span class="toc-text">接口适配器</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-建造者模式"><span class="toc-text">5.建造者模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-建造者模式和工厂模式的区别"><span class="toc-text">6.建造者模式和工厂模式的区别</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-代理模式"><span class="toc-text">7.代理模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#静态代理"><span class="toc-text">静态代理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#动态代理"><span class="toc-text">动态代理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#JDK实现"><span class="toc-text">JDK实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#cglib-实现"><span class="toc-text">cglib 实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#原理"><span class="toc-text">原理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#手写动态代理"><span class="toc-text">手写动态代理</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-门面模式-amp-外观模式"><span class="toc-text">8.门面模式 &amp; 外观模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-装饰器模式"><span class="toc-text">9.装饰器模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-装饰器模式和代理模式对比"><span class="toc-text">10.装饰器模式和代理模式对比</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-享元模式"><span class="toc-text">11.享元模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-组合模式"><span class="toc-text">12.组合模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#透明组合模式"><span class="toc-text">透明组合模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#安全组合模式"><span class="toc-text">安全组合模式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13-桥接模式"><span class="toc-text">13.桥接模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#14-委派模式"><span class="toc-text">14.委派模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#15-委派模式和代理模式的区别"><span class="toc-text">15.委派模式和代理模式的区别</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#16-模板方法模式"><span class="toc-text">16.模板方法模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#17-策略模式"><span class="toc-text">17.策略模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#18-责任链模式"><span class="toc-text">18.责任链模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#19-迭代器模式"><span class="toc-text">19.迭代器模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#20-命令模式"><span class="toc-text">20.命令模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#21-状态模式"><span class="toc-text">21.状态模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#22-备忘录模式"><span class="toc-text">22.备忘录模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#23-中介者模式"><span class="toc-text">23.中介者模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#24-解释器模式"><span class="toc-text">24.解释器模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#25-观察者模式"><span class="toc-text">25.观察者模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#26-访问者模式"><span class="toc-text">26.访问者模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#27-设计模式总结"><span class="toc-text">27.设计模式总结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#参考资料"><span class="toc-text">参考资料</span></a></li></ol>
    </div>
  </div>


            </div>
        
        
          <blockquote id="copyright">
              <p>Ursprünglicher Link: <a href="http://nunu03.github.io/2022/06/20/设计模式/">http://nunu03.github.io/2022/06/20/设计模式/</a></p>
              <p>Copyright-Erklärung: 转载请注明出处.</p>
          </blockquote>
        
      
    </div>
    <footer class="article-footer">
      
        <div class="article-tag-wrap">
          

          
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/设计模式/">设计模式</a></li></ul>

          
    <div class="social-share">
      <span>Aktie:</span>
    </div>



        </div>
      
      
        
<nav id="article-nav">
  
    <a href="/2022/06/09/手写实现ARouter/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">older</strong>
      <div class="article-nav-title">
        
          手写实现ARouter
        
      </div>
    </a>
  
  
</nav>

      
      
        








      
    </footer>
  </div>
</article>
</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title"><i class="fa fa-posts"></i> Letzte</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2022/06/20/设计模式/">设计模式</a>
          </li>
        
          <li>
            <a href="/2022/06/09/手写实现ARouter/">手写实现ARouter</a>
          </li>
        
          <li>
            <a href="/2022/06/08/Glide图片加载框架原理/">Glide图片加载框架原理</a>
          </li>
        
          <li>
            <a href="/2022/06/07/SPI原理解析/">SPI原理解析</a>
          </li>
        
          <li>
            <a href="/2022/06/03/SharedPreferences-MMAP-MMKV数据持久化原理解析/">SharedPreferences+MMAP+MMKV数据持久化原理解析</a>
          </li>
        
      </ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title"><i class="fa fa-tag"></i> Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Android/" style="font-size: 20px;">Android</a> <a href="/tags/CMake/" style="font-size: 10px;">CMake</a> <a href="/tags/Charles/" style="font-size: 13.33px;">Charles</a> <a href="/tags/Color/" style="font-size: 10px;">Color</a> <a href="/tags/FaceUnity/" style="font-size: 16.67px;">FaceUnity</a> <a href="/tags/Fix/" style="font-size: 10px;">Fix</a> <a href="/tags/Flutter/" style="font-size: 10px;">Flutter</a> <a href="/tags/GitLab/" style="font-size: 10px;">GitLab</a> <a href="/tags/Glide/" style="font-size: 10px;">Glide</a> <a href="/tags/Gradle/" style="font-size: 20px;">Gradle</a> <a href="/tags/Haar/" style="font-size: 10px;">Haar</a> <a href="/tags/Hexo/" style="font-size: 10px;">Hexo</a> <a href="/tags/Hook/" style="font-size: 10px;">Hook</a> <a href="/tags/Kotlin/" style="font-size: 10px;">Kotlin</a> <a href="/tags/LiveData/" style="font-size: 10px;">LiveData</a> <a href="/tags/Log/" style="font-size: 10px;">Log</a> <a href="/tags/OkHttp/" style="font-size: 10px;">OkHttp</a> <a href="/tags/OpenCV/" style="font-size: 10px;">OpenCV</a> <a href="/tags/Python/" style="font-size: 10px;">Python</a> <a href="/tags/Retrofit/" style="font-size: 10px;">Retrofit</a> <a href="/tags/SPI/" style="font-size: 10px;">SPI</a> <a href="/tags/Title/" style="font-size: 10px;">Title</a> <a href="/tags/Toast/" style="font-size: 10px;">Toast</a> <a href="/tags/View/" style="font-size: 10px;">View</a> <a href="/tags/ViewModel/" style="font-size: 10px;">ViewModel</a> <a href="/tags/WMS/" style="font-size: 10px;">WMS</a> <a href="/tags/WebHook/" style="font-size: 10px;">WebHook</a> <a href="/tags/Wireshark/" style="font-size: 10px;">Wireshark</a> <a href="/tags/Xposed/" style="font-size: 13.33px;">Xposed</a> <a href="/tags/aar/" style="font-size: 10px;">aar</a> <a href="/tags/cmd/" style="font-size: 10px;">cmd</a> <a href="/tags/mmap/" style="font-size: 10px;">mmap</a> <a href="/tags/ngrok/" style="font-size: 13.33px;">ngrok</a> <a href="/tags/nps/" style="font-size: 10px;">nps</a> <a href="/tags/人脸检测/" style="font-size: 10px;">人脸检测</a> <a href="/tags/组件化/" style="font-size: 10px;">组件化</a> <a href="/tags/设计模式/" style="font-size: 10px;">设计模式</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title"><i class="fa fa-classify"></i> Kategorien</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a><span class="category-list-count">23</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Charles/">Charles</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Flutter/">Flutter</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/GitLab/">GitLab</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Gradle/">Gradle</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Hexo/">Hexo</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Kotlin/">Kotlin</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Log/">Log</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Log/Fix/">Fix</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/NDK/">NDK</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/OpenCV/">OpenCV</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tools/">Tools</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Video/">Video</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/WebHook/">WebHook</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/WebHook/ngrok/">ngrok</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/cmd/">cmd</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ngrok/">ngrok</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/ngrok/nps/">nps</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/人脸检测/">人脸检测</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/人脸检测/Haar/">Haar</a><span class="category-list-count">1</span></li></ul></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title"><i class="fa fa-archive"></i> Archiv</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/">2022年</a><span class="archive-list-count">14</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/">2021年</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/">2020年</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/">2019年</a><span class="archive-list-count">16</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title"><i class="fa fa-tag"></i> Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android/">Android</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CMake/">CMake</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Charles/">Charles</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Color/">Color</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/FaceUnity/">FaceUnity</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Fix/">Fix</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Flutter/">Flutter</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GitLab/">GitLab</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Glide/">Glide</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Gradle/">Gradle</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Haar/">Haar</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hexo/">Hexo</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hook/">Hook</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Kotlin/">Kotlin</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LiveData/">LiveData</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Log/">Log</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OkHttp/">OkHttp</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OpenCV/">OpenCV</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/">Python</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Retrofit/">Retrofit</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SPI/">SPI</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Title/">Title</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Toast/">Toast</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/View/">View</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ViewModel/">ViewModel</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WMS/">WMS</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WebHook/">WebHook</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Wireshark/">Wireshark</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Xposed/">Xposed</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/aar/">aar</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cmd/">cmd</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mmap/">mmap</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ngrok/">ngrok</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nps/">nps</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/人脸检测/">人脸检测</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/组件化/">组件化</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/设计模式/">设计模式</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title"><i class="fa fa-link"></i> Blogroll</h3>
    <div class="widget">
      <ul>
      
        <li>
          <a href="https://handsomeliuyang.github.io/">liuyang</a>
        </li>
      
      </ul>
    </div>
  </div>


  
</aside>
        
      </div>
      <a id="totop" href="#top"></a>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      <p>
        <a href="/sitemap.xml">Sitemap</a>
        <span> | </span><a href="/atom.xml">Abonnieren Sie diese Site</a>
        <span> | </span><a href="/about/">Kontaktieren Sie den Blogger</a>
      </p>
      
        <p>
          <i class="fa fa-visitors"></i>
          <i id="busuanzi_container_site_uv"><i id="busuanzi_value_site_uv"></i></i>
          ，
          <i class="fa fa-views"></i>
          <i id="busuanzi_container_site_pv"><i id="busuanzi_value_site_pv"></i></i>
        </p>
      
      <p>
        <span>Copyright &copy; 2022 Nunu Long.</span>
        <span>Theme by <a href="https://github.com/chaooo/hexo-theme-BlueLake/" target="_blank">BlueLake.</a></span>
        <span>Powered by <a href="https://hexo.io/" target="_blank">Hexo.</a></span>
      </p>
    </div>
  </div>
</footer>

    </div>
  </div>
  <script src="/js/jquery-3.4.1.min.js"></script>
<script src="/js/search.json.js"></script>

  <script src="/fancybox/jquery.fancybox.min.js"></script>


<script src="/js/script.js"></script>





  <script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>



  
    <script src="/localshare/js/social-share.js"></script>
    <script src="/localshare/js/qrcode.js"></script>
  
  



  

  

  

  

  

  

  

  
  





</body>
</html>