<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
    
    
    <title>Xposed的配置与简单使用 | chenyulong | 理论是你知道是这样，但它却不好用；实践是它很好用，但你不知道是为什么；程序员将理论和实践结合到一起：既不好用，也不知道是为什么。</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="keywords" content="Xposed">
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.2/dist/jquery.fancybox.min.css">
    <link rel="stylesheet" href="/css/style.css?v=1.4.4">
    
    <script type="text/javascript">
        // Data Center
        var DC = {
            reward:	false,
            lv: JSON.parse('{"enable":false,"app_id":null,"app_key":null,"icon":true}'),
            v: JSON.parse('{"enable":false,"appid":null,"appkey":null,"notify":true,"verify":true,"placeholder":"give me some sugers plz...","avatar":"wavatar"}'),
            g: JSON.parse('{"enable":false,"lazy":true,"owner":"codefine","repo":"gitment","oauth":{"client_id":null,"client_secret":null},"perPage":10}'),
            d: JSON.parse('{"app_id":null}')
        };
    </script>
    <script type="text/javascript">
        window.lazyScripts=[];
    </script>
    
</head>


<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="">
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap">
      
      <img src="/img/brand.jpg" class="brand-bg">
      
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">Nunu Long</h5>
          <a href="mailto:594531261@qq.com" title="594531261@qq.com" class="mail">
            
              <span>5</span>
            
              <span>9</span>
            
              <span>4</span>
            
              <span>5</span>
            
              <span>3</span>
            
              <span>1</span>
            
              <span>2</span>
            
              <span>6</span>
            
              <span>1</span>
            
              <span>@</span>
            
              <span>q</span>
            
              <span>q</span>
            
              <span>.</span>
            
              <span>c</span>
            
              <span>o</span>
            
              <span>m</span>
            
          </a>
        </hgroup>
        
        <ul class="menu-link">
          
              <li>
                <a href="https://github.com/nunu03/" target="_blank">
                  <i class="icon icon-lg icon-github"></i>
                </a>
              </li>
            
        </ul>
        
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                首页
              </a>
            </li>
        
            <li class="">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                分类
              </a>
            </li>
        
            <li class="">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                标签
              </a>
            </li>
        
            <li class="">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                归档
              </a>
            </li>
        
            <li class="">
              <a href="/custom"  >
                <i class="icon icon-lg icon-plus-square"></i>
                CUSTOM
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row clearfix">
        <a href="javascript:;" class="header-icon pull-left waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">
            <span>Xposed的配置与简单使用</span>
            
        </div>
        
        <a href="javascript:;" id="site_search_btn" class="header-icon pull-right waves-effect waves-circle waves-light">
            <i class="icon icon-lg icon-search"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">
    <img src="/img/banner.jpg" class="header-bg">
    <div class="container fade-scale">
        <h1 class="title">Xposed的配置与简单使用</h1>
        <h5 class="subtitle">
            
                <time datetime="2019-07-02T05:20:51.000Z" itemprop="datePublished" class="page-time">
  2019-07-02
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Android/">Android</a></li></ul>

            
        </h5>
        
    </div>
    

</header>

<div id="site_search">
    <div class="search-title clearfix">
        <span class="pull-left">
          <i class="icon icon-lg icon-search"></i>
        </span>
        <input type="text" id="local-search-input" name="q" results="0" placeholder="search my blog..." class="form-control pull-left"/>
        <a href="javascript:;" class="close pull-right waves-effect waves-circle waves-light">
          <i class="icon icon-lg icon-close"></i>
        </a>
    </div>
    <div id="local-search-result"></div>
</div>


<div class="container body-wrap">
    <article id="post-xposed"
  class="post-article article-type-post" itemprop="blogPost">
    <div class="post-card">
        <h1 class="post-card-title">Xposed的配置与简单使用</h1>
        <div class="post-meta">
            <time class="post-time" title="2019-07-02 13:20:51" datetime="2019-07-02T05:20:51.000Z"  itemprop="datePublished">2019-07-02</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Android/">Android</a></li></ul>



            

            


            
        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            
            <h2 id="Xposed是什么"><a href="#Xposed是什么" class="headerlink" title="Xposed是什么"></a>Xposed是什么</h2><p>官方对此的解释是这样的：<br>“Xposed是一个适用于Android的框架。基于这个框架开发的模块可以改变系统和app应用的行为，而不需要修改APK。这是一个很棒的特性，意味着Xposed模块可以不经过任何修改，安装在各种不同的ROM上。Xposed模块可以很容易的开启和关闭。你只需要激活或者禁用Xposed模块，然后重启手机即可。”</p>
<a id="more"></a>
<h2 id="Hook是什么"><a href="#Hook是什么" class="headerlink" title="Hook是什么"></a>Hook是什么</h2><p>Hook 英文就是「挂钩」的意思.那我们如何使用这个「挂钩」呢？在我们的应用程序种，包括应用触发事件和后台逻辑处理，都是是根据事件流程一步步地向下执行。而「挂钩」的意思，就是在事件传送到终点前截获并监控事件的传输，像个钩子钩上事件一样，并且能够在钩上事件时，处理一些自己特定的事件。</p>
<figure class="image-box">
                <a rel=Xposed的配置与简单使用 href="http://nunu03.github.io/2019/07/02/xposed/hook.png" title="hook" data-fancybox="images"><img src="http://nunu03.github.io/2019/07/02/xposed/hook.png" alt="hook" title class></a>
                <p>hook</p>
            </figure>
<p>如何理解，例如我们有一个方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">private int getResult(int i, int i2) &#123;</span><br><span class="line">    return i+i2; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>正常情况下，i=1，i2=1，我们能得到2，但是根据上图，现在我们知道利用Hook现在能做些什么了，通过Hook我们可以对参数i，i2进行修改，i=1，i2=2，最终我们得到的结果是3.这就是挂钩的作用。</p>
<p>关于Android中的Hook机制，大致有两个方式：</p>
<p>要 root 权限，直接Hook系统，可以干掉所有的App。</p>
<p>免root权限，但是只能 Hook 自身，对系统其它 App 无能为力。</p>
<h2 id="Xposed接入"><a href="#Xposed接入" class="headerlink" title="Xposed接入"></a>Xposed接入</h2><h3 id="创建工程"><a href="#创建工程" class="headerlink" title="创建工程"></a>创建工程</h3><p>这个工程就是我们的插件工程，也是我们需要激活的Xposed模块工程。在我们的群控项目中，我们的hotB就是我们的模块工程。什么是模块工程，可以理解我们使用Hook挂钩自定义消息体的工程。这个app安装后可以在Xposed app的模块中找到。</p>
<figure class="image-box">
                <a rel=Xposed的配置与简单使用 href="http://nunu03.github.io/2019/07/02/xposed/mokuai.png" title="set" data-fancybox="images"><img src="http://nunu03.github.io/2019/07/02/xposed/mokuai.png" alt="set" title class></a>
                <p>set</p>
            </figure>
<h3 id="导入api"><a href="#导入api" class="headerlink" title="导入api"></a>导入api</h3><p>倒入api比较简单：直接在build.gradle中添加依赖即可：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/* Xposed */</span><br><span class="line">    provided &apos;de.robv.android.xposed:api:82&apos;</span><br><span class="line">    provided &apos;de.robv.android.xposed:api:82:sources&apos;</span><br></pre></td></tr></table></figure>

<p><strong>注意：这里是provided，因为Xposed里已有该jar包内容，再次打包进去会冲突，并导致handleLoadPackage没有回调</strong></p>
<h3 id="修改AndroidManifest-xml文件"><a href="#修改AndroidManifest-xml文件" class="headerlink" title="修改AndroidManifest.xml文件"></a>修改AndroidManifest.xml文件</h3><p>在标签里面加三个meta-data</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 作为xposed模块 --&gt;</span><br><span class="line">&lt;meta-data android:name=&quot;xposedmodule&quot; android:value=&quot;true&quot; /&gt;</span><br><span class="line">&lt;!-- Xposed的模块描述 显示在xposed模块列表那里第二行--&gt;</span><br><span class="line">&lt;meta-data android:name=&quot;xposeddescription&quot; android:value=&quot;HotAX&quot; /&gt;</span><br><span class="line">&lt;!-- XposedBridgeApi的最低版本号 --&gt;</span><br><span class="line">&lt;meta-data android:name=&quot;xposedminversion&quot; android:value=&quot;53&quot; /&gt;</span><br></pre></td></tr></table></figure>

<h3 id="编写hook类"><a href="#编写hook类" class="headerlink" title="编写hook类"></a>编写hook类</h3><p>创建一个类，实现IXposedHookLoadPackage接口，重写handleLoadPackage方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">public class XposedModule implements IXposedHookLoadPackage &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void handleLoadPackage(final XC_LoadPackage.LoadPackageParam loadPackageParam) throws Throwable &#123;</span><br><span class="line">        if (!loadPackageParam.packageName.startsWith(&quot;com.hotax.autowechat&quot;)) &#123;</span><br><span class="line">            if (loadPackageParam.packageName.startsWith(&quot;com.tencent.mm&quot;)) &#123;</span><br><span class="line">                XposedHelpers.findAndHookMethod(Application.class, &quot;attach&quot;, Context.class, new XC_MethodHook() &#123;</span><br><span class="line">                    @Override</span><br><span class="line">                    protected void beforeHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line"></span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    @Override</span><br><span class="line">                    protected void afterHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">                        </span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="创建xposed-init文件"><a href="#创建xposed-init文件" class="headerlink" title="创建xposed_init文件"></a>创建xposed_init文件</h3><p>在main/assets目录下创建xposed_init文件，不要后缀名。这个就是模块的入口，只有一行代码，就是说明入口类,这个类就是我们上边的类，在这里我们能打印出所有package。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">com.hotax.autowechat.xposed.XposedModule。</span><br></pre></td></tr></table></figure>

<p>至此，Xposed模块开发的接入就全部完成了。</p>
<h2 id="Hook实现"><a href="#Hook实现" class="headerlink" title="Hook实现"></a>Hook实现</h2><h3 id="hook变量"><a href="#hook变量" class="headerlink" title="hook变量"></a>hook变量</h3><p>hook前</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">private static  int staticPrivateInt = 100;</span><br><span class="line">public static  int staticPublicInt = 100;</span><br><span class="line">private static  String staticPrivateString = &quot;staticPrivateString&quot;;</span><br><span class="line">private static  String staticPublicString = &quot;staticPublicString&quot;;</span><br><span class="line"></span><br><span class="line">public  int publicInt = 200;</span><br><span class="line">private int privateInt = 300;</span><br><span class="line">private String privateString = &quot;privateString&quot;;</span><br><span class="line">private String publicString = &quot;publicString&quot;;</span><br></pre></td></tr></table></figure>

<p>hook</p>
<p>获取Class：</p>
<p>final Class&lt;?&gt; clazz = XposedHelpers.findClass(“全路径类名”, loadPackageParam.classLoader);</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">XposedHelpers.setStaticIntField(clazz, &quot;staticPrivateInt&quot;, 99);</span><br><span class="line">XposedHelpers.setStaticIntField(clazz, &quot;staticPublicInt&quot;, 99);</span><br><span class="line">XposedHelpers.setStaticObjectField(clazz, &quot;staticPrivateString&quot;, &quot;hook_staticPrivateString&quot;);</span><br><span class="line">XposedHelpers.setStaticObjectField(clazz, &quot;staticPublicString&quot;, &quot;hook_staticPublicString&quot;);</span><br><span class="line"></span><br><span class="line">XposedHelpers.setStaticIntField(clazz, &quot;publicInt&quot;, 99);</span><br></pre></td></tr></table></figure>

<p>hook后结果打印</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">D/HookDemo: staticPrivateInt = 99</span><br><span class="line">D/HookDemo: staticPublicInt = 99</span><br><span class="line">D/HookDemo: staticPrivateString = hook_staticPrivateString</span><br><span class="line">D/HookDemo: staticPublicString = hook_staticPublicString</span><br><span class="line">D/HookDemo: publicInt = 200</span><br><span class="line">D/HookDemo: privateInt = 300</span><br><span class="line">D/HookDemo: privateString = privateString</span><br><span class="line">D/HookDemo: publicString = publicString</span><br></pre></td></tr></table></figure>

<p><strong>结论：XposedHelpers.setStaticObjectField方法只能修改静态变量，非静态变量不能使用此方式修改。否则会报java.lang.NullPointerException:异常；</strong>那非静态变量如何修改呢：例如我们目标程序里有两个方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public void publicMethod(String value)&#123;    </span><br><span class="line">   Log.d(Tag, &quot;参数打印-publicMethod：&quot; + value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">private void privateMethod(String value)&#123;</span><br><span class="line">   Log.d(Tag, &quot;参数打印-privateMethod：&quot; + value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>hook非静态变量</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">XposedHelpers.findAndHookMethod(clazz, &quot;publicFunc&quot;, String.class, new XC_MethodHook() &#123;</span><br><span class="line">               @Override</span><br><span class="line">               protected void beforeHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">                   param.args[0] = &quot;before--------------publicMethod&quot;;</span><br><span class="line">                   XposedHelpers.setIntField(param.thisObject, &quot;publicInt&quot;, 199);</span><br><span class="line">                   XposedHelpers.setIntField(param.thisObject, &quot;privateInt&quot;, 199);</span><br><span class="line">                   XposedHelpers.setObjectField(param.thisObject, &quot;privateString&quot;, &quot;hook_privateString&quot;);</span><br><span class="line">                   XposedHelpers.setObjectField(param.thisObject, &quot;publicString&quot;, &quot;hook_publicString&quot;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                   XposedHelpers.setIntField(param.thisObject, &quot;staticPrivateInt&quot;, 199);</span><br><span class="line">                   XposedHelpers.setIntField(param.thisObject, &quot;staticPublicInt&quot;, 199);</span><br><span class="line">                   XposedHelpers.setObjectField(param.thisObject, &quot;staticPrivateString&quot;, &quot;hook_-setObjectField-staticPrivateString&quot;);</span><br><span class="line">                   XposedHelpers.setObjectField(param.thisObject, &quot;staticPublicString&quot;, &quot;hook_-setObjectField-staticPublicString&quot;);</span><br><span class="line"></span><br><span class="line">               &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>hook后结果打印</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">参数打印-publicMethod：before--------------publicMethod</span><br><span class="line">D/HookDemo: staticPrivateInt = 199</span><br><span class="line">D/HookDemo: staticPublicInt = 199</span><br><span class="line">D/HookDemo: staticPrivateString = hook_-setObjectField-staticPrivateString</span><br><span class="line">D/HookDemo: staticPublicString = hook_-setObjectField-staticPublicString</span><br><span class="line">D/HookDemo: publicInt = 199</span><br><span class="line">D/HookDemo: privateInt = 199</span><br><span class="line">D/HookDemo: privateString = hook_privateString</span><br><span class="line">D/HookDemo: publicString = hook_publicString</span><br></pre></td></tr></table></figure>

<p><strong>结论：非静态变量的修改只能通过反射某类中的某个方法（方法类型不限）中修改，且静态变量也可以这么修改。</strong></p>
<h3 id="hook方法"><a href="#hook方法" class="headerlink" title="hook方法"></a>hook方法</h3><h5 id="hook构造方法"><a href="#hook构造方法" class="headerlink" title="hook构造方法"></a>hook构造方法</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">public HookDemo(String value)&#123;</span><br><span class="line">    Log.d(Tag, &quot;参数打印-带参构造方法：&quot; + value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">-------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">//Hook有参构造函数，修改参数</span><br><span class="line"> XposedHelpers.findAndHookConstructor(clazz, String.class,  new XC_MethodHook() &#123;</span><br><span class="line">                @Override</span><br><span class="line">                protected void beforeHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">                    param.args[0] = &quot;参数打印-带参构造方法：我是修改后的参数&quot;;</span><br><span class="line">                &#125;</span><br><span class="line">                @Override</span><br><span class="line">                protected void afterHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">                    XposedBridge.log(&quot;HOOK-After：&quot; +param.args[0]);</span><br><span class="line">                &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">  </span><br><span class="line">-------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">D/HookDemo: 参数打印-带参构造方法：我是修改后的参数</span><br><span class="line">D/HookDemo: HOOK-After：参数打印-带参构造方法：我是修改后的参数</span><br></pre></td></tr></table></figure>

<h5 id="hook带返回值的方法"><a href="#hook带返回值的方法" class="headerlink" title="hook带返回值的方法"></a>hook带返回值的方法</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">public String getHook(String value)&#123;</span><br><span class="line">   return value;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">-------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">1、</span><br><span class="line">XposedHelpers.findAndHookMethod(clazz, &quot;getHook&quot;, String.class, new XC_MethodHook() &#123;</span><br><span class="line">                @Override</span><br><span class="line">                protected void beforeHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">                    param.args[0] = &quot;返回值：before--------------gethook&quot;;</span><br><span class="line">                &#125;</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line">执行结果：</span><br><span class="line">D/HookDemo: getHook 返回值 = 返回值：before--------------gethook</span><br><span class="line"></span><br><span class="line">-------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">2、</span><br><span class="line">   XposedHelpers.findAndHookMethod(clazz, &quot;getHook&quot;, String.class, new XC_MethodHook() &#123;</span><br><span class="line">                @Override</span><br><span class="line">                protected void beforeHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">//                    param.args[0] = &quot;返回值：before--------------gethook&quot;;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                @Override</span><br><span class="line">                protected void afterHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">                    param.setResult(&quot;返回值：after--------------gethook&quot;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line"> 执行结果：</span><br><span class="line">D/HookDemo: getHook 返回值 = 返回值：after--------------gethook</span><br></pre></td></tr></table></figure>

<h5 id="hook静态方法"><a href="#hook静态方法" class="headerlink" title="hook静态方法"></a>hook静态方法</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">private static String staticPrivateMethod(String value)&#123;</span><br><span class="line">    Log.d(&quot;HookDemo&quot;, &quot;静态函数--&quot; + value);</span><br><span class="line">    return &quot;静态函数--返回：&quot;+value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">-------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">1、</span><br><span class="line">XposedHelpers.findAndHookMethod(clazz, &quot;staticPrivateMethod&quot;, String.class, new XC_MethodHook() &#123;</span><br><span class="line">                @Override</span><br><span class="line">                protected void beforeHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">                    param.args[0] = &quot;before---&quot;;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">    </span><br><span class="line">执行结果：</span><br><span class="line">D/HookDemo: 静态函数--before---</span><br><span class="line">D/HookDemo: 静态函数--返回：before---</span><br><span class="line"></span><br><span class="line">-------------------------------------------------------------------</span><br><span class="line">2、</span><br><span class="line">XposedHelpers.findAndHookMethod(clazz, &quot;staticPrivateMethod&quot;, String.class, new XC_MethodHook() &#123;</span><br><span class="line">                @Override</span><br><span class="line">                protected void beforeHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">                    param.args[0] = &quot;before---&quot;;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                @Override</span><br><span class="line">                protected void afterHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">                    param.setResult(&quot;静态函数--返回：after---&quot;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">执行结果：</span><br><span class="line">D/HookDemo: 静态函数--before---</span><br><span class="line">D/HookDemo: 静态函数--返回：after---</span><br><span class="line"></span><br><span class="line">-------------------------------------------------------------------</span><br><span class="line">3、</span><br><span class="line">Object object = XposedHelpers.callStaticMethod(clazz, &quot;staticPrivateMethod&quot;, &quot;callStaticMethod 静态函数调用&quot;);</span><br><span class="line">Log.d(&quot;HookDemo&quot;, &quot;xposed-:staticPrivateFunc:&quot;+object);</span><br><span class="line"></span><br><span class="line">执行结果：</span><br><span class="line">D/HookDemo: 静态函数--callStaticMethod 静态函数调用</span><br><span class="line">D/HookDemo: xposed-:staticPrivateFunc:静态函数--返回：callStaticMethod 静态函数调用</span><br></pre></td></tr></table></figure>

<p><strong>结论：静态方法的修改和其他方法hook方式一样，但是静态方法可以直接通过callStaticMethod进行参数的修改。</strong></p>
<h5 id="Hook复杂的参数"><a href="#Hook复杂的参数" class="headerlink" title="Hook复杂的参数"></a>Hook复杂的参数</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">public void paramsClass(ClasName cn, String value,Intent intent,int key,Map map,List list)&#123;  </span><br><span class="line">&#125;</span><br><span class="line">-------------------------------------------------------------------</span><br><span class="line">Class cnClazz  = loadPackageParam.classLoader.loadClass(&quot;com.xxxx. ClasName&quot;);</span><br><span class="line">Class cnMap = XposedHelpers.findClass(&quot;java.util.Map&quot;, loadPackageParam.classLoader);</span><br><span class="line">Class cnArrayList = XposedHelpers.findClass(&quot;java.util.ArrayList&quot;, loadPackageParam.classLoader);</span><br><span class="line"></span><br><span class="line">XposedHelpers.findAndHookMethod(clazz, &quot;paramsClass&quot;, cnClazz, String.class, Intent.class,int.class,Map.class,ArrayList.class new XC_MethodHook() &#123;</span><br><span class="line">    @Override</span><br><span class="line">    protected void beforeHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h5 id="Hook内部类中的函数"><a href="#Hook内部类中的函数" class="headerlink" title="Hook内部类中的函数"></a>Hook内部类中的函数</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">public class HookDemo &#123;</span><br><span class="line">    private String Tag = &quot;HookDemo&quot;;</span><br><span class="line">    class InnerClass&#123;</span><br><span class="line">        public int innerPublicInt = 10;</span><br><span class="line">        private int innerPrivateInt = 20;</span><br><span class="line">        public InnerClass()&#123;</span><br><span class="line">        &#125;</span><br><span class="line">        public void InnerFunc(String value)&#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">-------------------------------------------------------------------</span><br><span class="line">final Class&lt;?&gt; clazz1 = XposedHelpers.findClass(&quot;com.xxxxxx.HookDemo$InnerClass&quot;, loadPackageParam.classLoader);</span><br><span class="line">XposedHelpers.findAndHookMethod(clazz1, &quot;InnerMethod&quot;, String.class, new XC_MethodHook() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            protected void beforeHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>

<p><strong>注：hook内部类中的函数和变量，跟以上的hook方式没有区别，唯一的区别是，XposedHelpers.findClass中的路径名不同。</strong></p>
<h5 id="Hook匿名内部类中的函数"><a href="#Hook匿名内部类中的函数" class="headerlink" title="Hook匿名内部类中的函数"></a>Hook匿名内部类中的函数</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">anonymousInner(new ClasName() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void clasNameMethod(String value) &#123;</span><br><span class="line">        		Log.d(Tag, &quot;匿名类参数修改：get：&quot; + value);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">-------------------------------------------------------------------</span><br><span class="line">XposedHelpers.findAndHookMethod(&quot;com.xxxxxx.HookDemo$1&quot;, clazz.getClassLoader(),</span><br><span class="line">                    &quot;clasNameMethod&quot;,String.class, new XC_MethodHook() &#123;</span><br><span class="line">                        @Override</span><br><span class="line">                        protected void beforeHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">                             param.args[0] = &quot;匿名类-参数修改&quot;;                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line">-------------------------------------------------------------------</span><br><span class="line">执行结果：</span><br><span class="line">D/HookDemo: 匿名类参数修改：get：匿名类-参数修改</span><br></pre></td></tr></table></figure>

<h5 id="Hook替换函数"><a href="#Hook替换函数" class="headerlink" title="Hook替换函数"></a>Hook替换函数</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">private void repleaceMethod()&#123;</span><br><span class="line">    getHook(&quot;sfdsfs-afsafsf&quot;);</span><br><span class="line">&#125;</span><br><span class="line">-------------------------------------------------------------------</span><br><span class="line"> XposedHelpers.findAndHookMethod(clazz, &quot;repleaceMethod&quot;, new XC_MethodReplacement() &#123;</span><br><span class="line">                @Override</span><br><span class="line">                protected Object replaceHookedMethod(MethodHookParam methodHookParam) throws Throwable &#123;</span><br><span class="line">                    try &#123;</span><br><span class="line">	            			// 直接替换原来要执行的逻辑代码,目标方法就不在执行了</span><br><span class="line">			        &#125; catch (Throwable t) &#123;</span><br><span class="line">			            XposedBridge.log(t);</span><br><span class="line">			        &#125;                    </span><br><span class="line">		       </span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br></pre></td></tr></table></figure>

<h3 id="替换资源"><a href="#替换资源" class="headerlink" title="替换资源"></a>替换资源</h3><h4 id="IXposedHookZygoteInit"><a href="#IXposedHookZygoteInit" class="headerlink" title="IXposedHookZygoteInit"></a>IXposedHookZygoteInit</h4><p>Hook the initialization of Zygote process(es), from which all the apps are forked.</p>
<p>Implement this interface in your module’s main class in order to be notified when Android is starting up. In IXposedHookZygoteInit, you can modify objects and place hooks that should be applied for every app. Only the Android framework/system classes are available at that point in time. Use null as class loader for XposedHelpers.findAndHookMethod(String, ClassLoader, String, Object…) and its variants.</p>
<p>If you want to hook one/multiple specific apps, use IXposedHookLoadPackage instead.</p>
<p>替换系统框架资源（对所有app 起作用）需要实现 IXposedHookZygoteInit接口的 initZygote 方法，并在该方法中调用Resources.setSystemWideReplacement(…) 方法替换资源：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public class Tutorial2  implements IXposedHookZygoteInit&#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void initZygote(StartupParam arg0) throws Throwable &#123;</span><br><span class="line">        XResources.setSystemWideReplacement(&quot;android&quot;, &quot;bool&quot;, &quot;config_unplugTurnsOnScreen&quot;, false);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="IXposedHookInitPackageResources"><a href="#IXposedHookInitPackageResources" class="headerlink" title="IXposedHookInitPackageResources"></a>IXposedHookInitPackageResources</h4><p>替换app应用资源需要实现 IXposedHookInitPackageResources 类的<br>andleInitPackageResources方法，并在该方法中调用res.setReplacement(…)方法替换资源，注意在该方法中不要使用XResources.setSystemWideReplacement 方法:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line"> public void handleInitPackageResources(XC_InitPackageResources.InitPackageResourcesParam resparam) throws Throwable &#123;</span><br><span class="line"></span><br><span class="line">     if (resparam.packageName.equals(&quot;com.example.xposedhooktarget&quot;)) &#123;</span><br><span class="line">         //getClassInfo(clazz);</span><br><span class="line">         resparam.res.setReplacement(&quot;com.xxxxxx.xposedhooktarget&quot;, &quot;string&quot;, &quot;action_test&quot;, &quot;HkTargetTest&quot;);</span><br><span class="line">         resparam.res.setReplacement(&quot;com.example.xposedhooktarget&quot;, &quot;color&quot;, &quot;colorAccent&quot;, R.color.colorPrimary);</span><br><span class="line">resparam.res.setReplacement(&quot;2131165219&quot;, &quot;HkTargetTest-action_text&quot;);</span><br><span class="line">         resparam.res.setReplacement(&quot;com.xxxxxxx.xposedhooktarget&quot;, &quot;mipmap&quot;, &quot;test_icon&quot;, new XResources.DrawableLoader() &#123;</span><br><span class="line">             @Override</span><br><span class="line">             public Drawable newDrawable(XResources res, int id) throws Throwable &#123;</span><br><span class="line">                 Drawable dg = res.getDrawable(R.mipmap.ic_launcher);</span><br><span class="line">                 return dg;</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;);</span><br><span class="line"></span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>还可以替换动画文件等等。</p>
<h3 id="修改布局"><a href="#修改布局" class="headerlink" title="修改布局"></a>修改布局</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">resparam.res.hookLayout(&quot;com.xxxxxx.xposedhooktarget&quot;, &quot;layout&quot;, &quot;activity_main&quot;, new XC_LayoutInflated() &#123;</span><br><span class="line">               @Override</span><br><span class="line">               public void handleLayoutInflated(LayoutInflatedParam liparam) throws Throwable &#123;</span><br><span class="line">                   //增加一个TextView</span><br><span class="line">                   FrameLayout contentview = (FrameLayout) liparam.view;</span><br><span class="line">                   if (contentview != null) &#123;</span><br><span class="line">                       TextView textView = new TextView(contentview.getContext());</span><br><span class="line">                       textView.setText(&quot;修改布局&quot;);</span><br><span class="line">                       contentview.addView(textView);</span><br><span class="line">                   &#125;</span><br><span class="line">                   //修改@+id= bt_text1 的TextView的文案</span><br><span class="line">                   TextView bt_text1 = (TextView) liparam.view.findViewById(</span><br><span class="line">                           liparam.res.getIdentifier(&quot;bt_text1&quot;, &quot;id&quot;, &quot;com.xxxxxx.xposedhooktarget&quot;));</span><br><span class="line">                   bt_text1.setText(&quot;修改布局文本&quot;);</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;);</span><br></pre></td></tr></table></figure>

<h2 id="群控"><a href="#群控" class="headerlink" title="群控"></a>群控</h2><p>需求：被动添加好友。</p>
<p>要求：采用静默的无感知模式。</p>
<p>实现：思路，采用hook添加好友协议的模式，入口在db的hook基础上进行监听验证好友的请求，因为不论什么信息，都会首先会存储与微信的db中。</p>
<p>前提：已经hook了界面的跳转，和打开了微信的log信息。<a href="http://wxc.58corp.com/pages/viewpage.action?pageId=25070673" target="_blank" rel="noopener">详细点击</a>.</p>
<p>过程：在前提下，我们可以得到了三个关于被动添加好友的信息：</p>
<p>1、好友通过验证的界面名称和传递的参数。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">E/hotWeixinHook: ActivityHook; activity=com.tencent.mm.plugin.profile.ui.SayHiWithSnsPermissionUI@a3b6b62, onCreate; getIntent()=Intent</span><br><span class="line">        &#123; cmp=com.tencent.mm/.plugin.profile.ui.SayHiWithSnsPermissionUI (has extras), extra=bundle&#123;</span><br><span class="line">            sayhi_with_sns_perm_send_verify=true,</span><br><span class="line">        room_name=null,</span><br><span class="line">        source_from_user_name=null,</span><br><span class="line">        sayhi_with_sns_perm_add_remark=true,</span><br><span class="line">        source_from_nick_name=null,</span><br><span class="line">        Contact_Nick=大王,</span><br><span class="line">        Contact_User=v1_841761d9ad2fee00bafee3e6c65ec45aef0c541d5c3bacfc2d24acd30fe184f31cd28a41808180cfff4ebd0325d4a1a1@stranger,</span><br><span class="line">        Contact_Scene=15,</span><br><span class="line">        Contact_RemarkName=,</span><br><span class="line">        =false,</span><br><span class="line">        AntispamTicket=v2_6e521f51ae39720c3154a79ba26c689efab115f39b314795f803a2889d76a013e05b3569cdd1f5328da35803ed134968@stranger</span><br><span class="line"></span><br><span class="line">        &#125; &#125;, bundle=bundle&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>2、验证的详细信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">MicroMsg.FMessageProvider; setDigest, </span><br><span class="line">fmsgType = 1, fmsgScene = 30, </span><br><span class="line">fmsgContent = </span><br><span class="line">&lt;msg </span><br><span class="line">fromusername=&quot;aibhyi1314521&quot; encryptusername=&quot;v1_4bb4022da882fa9b480543b3a0e48fcc76b5530d371c9defe34a653497843e38@stranger&quot; </span><br><span class="line">fromnickname=&quot;忘记一切&quot; </span><br><span class="line">content=&quot;我是忘记一切&quot; </span><br><span class="line">fullpy=&quot;wangjiyiqie&quot; </span><br><span class="line">shortpy=&quot;WJYQ&quot; </span><br><span class="line">imagestatus=&quot;3&quot; </span><br><span class="line">scene=&quot;30&quot; country=&quot;CN&quot; province=&quot;Hebei&quot; city=&quot;Baoding&quot; </span><br><span class="line">sign=&quot;带走一盏渔火，让他温暖我的双眼。留下一段真情让他停泊在枫桥边&quot; percard=&quot;1&quot; sex=&quot;1&quot; alias=&quot;wuluqi0606&quot; weibo=&quot;&quot; albumflag=&quot;0&quot; albumstyle=&quot;0&quot; albumbgimgid=&quot;&quot; snsflag=&quot;17&quot; </span><br><span class="line">snsbgimgid=&quot;http://shmmsns.qpic.cn/mmsns/CttmTaYSYkS6fvUyDJs0icQ6oRUqibtDIuUylCkHeRHfk4jF7nToTbSYAm5H0z84qh9fHACkovW1c/0&quot; </span><br><span class="line">snsbgobjectid=&quot;12854304281324228767&quot; mhash=&quot;3140af8c3cd25f8db0eaa8815cc2cd95&quot; mfullhash=&quot;3140af8c3cd25f8db0eaa8815cc2cd95&quot; </span><br><span class="line">bigheadimgurl=&quot;http://wx.qlogo.cn/mmhead/ver_1/qKwkYHXZa7iahrsJ2DV7NhuZnrWft9icLTiculKSTJiaJVQvpMPV1dyKH9HuqM3F9picnfZ6dd1ujxxCADH0tHburXhYQBsSP0ZQbD8USaqzXh7c/0&quot; smallheadimgurl=&quot;http://wx.qlogo.cn/mmhead/ver_1/qKwkYHXZa7iahrsJ2DV7NhuZnrWft9icLTiculKSTJiaJVQvpMPV1dyKH9HuqM3F9picnfZ6dd1ujxxCADH0tHburXhYQBsSP0ZQbD8USaqzXh7c/96&quot; ticket=&quot;v2_e57f9519b15cab7743fe81feced778340c7cb4a2c6cbbb361fdd606bbf815478db4e967568ece4fbf27519726dda64492f68992a4e750ef8e4e6e72724f075e8@stranger&quot; </span><br><span class="line">opcode=&quot;2&quot; googlecontact=&quot;&quot; qrticket=&quot;&quot; chatroomusername=&quot;&quot; sourceusername=&quot;&quot; sourcenickname=&quot;&quot;&gt;</span><br><span class="line">&lt;brandlist count=&quot;0&quot; ver=&quot;685330891&quot;&gt;&lt;/brandlist&gt;</span><br><span class="line">&lt;/msg&gt;, </span><br><span class="line">isSend = false</span><br></pre></td></tr></table></figure>

<p>3、存储数据库名称。</p>
<p>MicroMsg.SDK.MAutoStorage; <strong>fmessage_conversation</strong>:get with primary key</p>
<p>4、根据1得到的界面，我们可以查看微信的逆向代码。我是用的jadx-0.7.2，不要用jadx低版本，因为低版本的逆向结果的代码中，不含有我们需要hook的具体类名和方法名。因为微信的包比较大，我们最好把逆向代码导出来，使用的时候用AS打开即可。</p>
<p>5、<br>我们看下点击发送按钮等源代码：（比较长，但是不贴一下，没法说啊）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">class C305316 implements OnMenuItemClickListener &#123;</span><br><span class="line">        C305316() &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public final boolean onMenuItemClick(MenuItem menuItem) &#123;</span><br><span class="line">            final C1138k c8233f;</span><br><span class="line">            SayHiWithSnsPermissionUI sayHiWithSnsPermissionUI;</span><br><span class="line">            Context context;</span><br><span class="line">            if (SayHiWithSnsPermissionUI.this.f97358pqM) &#123;</span><br><span class="line">                int i;</span><br><span class="line">                List linkedList = new LinkedList();</span><br><span class="line">                linkedList.add(SayHiWithSnsPermissionUI.this.userName);</span><br><span class="line">                List linkedList2 = new LinkedList();</span><br><span class="line">                linkedList2.add(Integer.valueOf(SayHiWithSnsPermissionUI.this.f97352pnn));</span><br><span class="line">                String g = SayHiWithSnsPermissionUI.m63520g(SayHiWithSnsPermissionUI.this);</span><br><span class="line">                Map hashMap = new HashMap();</span><br><span class="line">                if (SayHiWithSnsPermissionUI.this.f97357pqL.f28645zEk) &#123;</span><br><span class="line">                    i = 1;</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    i = 0;</span><br><span class="line">                &#125;</span><br><span class="line">                hashMap.put(SayHiWithSnsPermissionUI.this.userName, Integer.valueOf(i));</span><br><span class="line">                C6159x.m11666d(&quot;MicroMsg.SayHiWithSnsPermissionUI&quot;, &quot;select sns permission, %s&quot;, Integer.valueOf(i));</span><br><span class="line">                if (C10044x.m20844Xg(SayHiWithSnsPermissionUI.this.userName)) &#123;</span><br><span class="line">                    c8233f = new C8233f(SayHiWithSnsPermissionUI.this.userName, g, SayHiWithSnsPermissionUI.this.getIntent().getStringExtra(C32536a.f104548xML));</span><br><span class="line">                    C32688as.m69428CN().mo13442a(c8233f, 0);</span><br><span class="line">                    sayHiWithSnsPermissionUI = SayHiWithSnsPermissionUI.this;</span><br><span class="line">                    context = SayHiWithSnsPermissionUI.this.mController.f28409xRr;</span><br><span class="line">                    SayHiWithSnsPermissionUI.this.getString(C1085R.C1081l.f8616dGZ);</span><br><span class="line">                    sayHiWithSnsPermissionUI.f97348inI = C36199h.m82220a(context, SayHiWithSnsPermissionUI.this.getString(C1085R.C1081l.f10212eKs), true, new OnCancelListener() &#123;</span><br><span class="line">                        public final void onCancel(DialogInterface dialogInterface) &#123;</span><br><span class="line">                            C32688as.m69428CN().mo13446c(c8233f);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    final C1138k c31589o = new C31589o(2, linkedList, linkedList2, g, &quot;&quot;, hashMap, SayHiWithSnsPermissionUI.this.chatroomName);</span><br><span class="line">                    String stringExtra = SayHiWithSnsPermissionUI.this.getIntent().getStringExtra(&quot;source_from_user_name&quot;);</span><br><span class="line">                    String stringExtra2 = SayHiWithSnsPermissionUI.this.getIntent().getStringExtra(&quot;source_from_nick_name&quot;);</span><br><span class="line">                    if (!C6135bi.m11498oN(stringExtra)) &#123;</span><br><span class="line">                        c31589o.mo40569fj(stringExtra, stringExtra2);</span><br><span class="line">                    &#125;</span><br><span class="line">                    C32688as.m69428CN().mo13442a(c31589o, 0);</span><br><span class="line">                    SayHiWithSnsPermissionUI sayHiWithSnsPermissionUI2 = SayHiWithSnsPermissionUI.this;</span><br><span class="line">                    context = SayHiWithSnsPermissionUI.this.mController.f28409xRr;</span><br><span class="line">                    SayHiWithSnsPermissionUI.this.getString(C1085R.C1081l.f8616dGZ);</span><br><span class="line">                    sayHiWithSnsPermissionUI2.f97348inI = C36199h.m82220a(context, SayHiWithSnsPermissionUI.this.getString(C1085R.C1081l.f10212eKs), true, new OnCancelListener() &#123;</span><br><span class="line">                        public final void onCancel(DialogInterface dialogInterface) &#123;</span><br><span class="line">                            C32688as.m69428CN().mo13446c(c31589o);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; else if (SayHiWithSnsPermissionUI.this.f97359pqN) &#123;</span><br><span class="line">                String stringExtra3 = SayHiWithSnsPermissionUI.this.getIntent().getStringExtra(&quot;Verify_ticket&quot;);</span><br><span class="line">                if (C10044x.m20844Xg(SayHiWithSnsPermissionUI.this.userName)) &#123;</span><br><span class="line">                    c8233f = new C8234g(SayHiWithSnsPermissionUI.this.userName, stringExtra3);</span><br><span class="line">                    C32688as.m69428CN().mo13442a(c8233f, 0);</span><br><span class="line">                    sayHiWithSnsPermissionUI = SayHiWithSnsPermissionUI.this;</span><br><span class="line">                    context = SayHiWithSnsPermissionUI.this.mController.f28409xRr;</span><br><span class="line">                    SayHiWithSnsPermissionUI.this.getString(C1085R.C1081l.f8616dGZ);</span><br><span class="line">                    sayHiWithSnsPermissionUI.f97348inI = C36199h.m82220a(context, SayHiWithSnsPermissionUI.this.getString(C1085R.C1081l.f9343dUY), true, new OnCancelListener() &#123;</span><br><span class="line">                        public final void onCancel(DialogInterface dialogInterface) &#123;</span><br><span class="line">                            C32688as.m69428CN().mo13446c(c8233f);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    c8233f = new C31589o(SayHiWithSnsPermissionUI.this.userName, stringExtra3, SayHiWithSnsPermissionUI.this.f97352pnn);</span><br><span class="line">                    C32688as.m69428CN().mo13442a(c8233f, 0);</span><br><span class="line">                    sayHiWithSnsPermissionUI = SayHiWithSnsPermissionUI.this;</span><br><span class="line">                    context = SayHiWithSnsPermissionUI.this.mController.f28409xRr;</span><br><span class="line">                    SayHiWithSnsPermissionUI.this.getString(C1085R.C1081l.f8616dGZ);</span><br><span class="line">                    sayHiWithSnsPermissionUI.f97348inI = C36199h.m82220a(context, SayHiWithSnsPermissionUI.this.getString(C1085R.C1081l.f9343dUY), true, new OnCancelListener() &#123;</span><br><span class="line">                        public final void onCancel(DialogInterface dialogInterface) &#123;</span><br><span class="line">                            C32688as.m69428CN().mo13446c(c8233f);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>经过一系列判断，我们最终最后定位到通过协议的代码C32688as.m69428CN().mo13442a(c8233f, 0);为啥啊，因为不管是if和else if的的条件我们都能够拿到，怎么拿到，我们可以通过XposedHelpers.getObjectField(param.thisObject, “方法变量”);获得到f97359pqN和f97358pqM的值；然后我们看C32688as这个类：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">/* renamed from: com.tencent.mm.y.as */</span><br><span class="line">public final class C32688as &#123;</span><br><span class="line">	/* renamed from: CN */</span><br><span class="line">    public static C7656n m69428CN() &#123;</span><br><span class="line">        C1693g.m4270Dr();</span><br><span class="line">        return C1693g.m4268Dp().f13865gRu;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>再看C7656n调用类：好吧只看mo13442a这一个方法就行了，这个就是通过好友的开始方法了；</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">/* renamed from: com.tencent.mm.ad.n */</span><br><span class="line">public final class C7656n implements C1125e &#123;</span><br><span class="line">	/* renamed from: a */</span><br><span class="line">    public final boolean mo13442a(C1138k c1138k, int i) &#123;</span><br><span class="line">        boolean z = c1138k != null || i &gt;= 0;</span><br><span class="line">        Assert.assertTrue(z);</span><br><span class="line">        String str = &quot;worker thread has not been set&quot;;</span><br><span class="line">        if (this.f30978hoG != null) &#123;</span><br><span class="line">            z = true;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            z = false;</span><br><span class="line">        &#125;</span><br><span class="line">        Assert.assertTrue(str, z);</span><br><span class="line">        if (!m15236e(c1138k)) &#123;</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">        m15231b(c1138k, i);</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们在看请求的参数：一个类C31589o，好吧，看出来了，就是一个model类。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/* renamed from: com.tencent.mm.pluginsdk.model.o */</span><br><span class="line">public class C31589o extends C1138k implements C1865k &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>综上：我们可以得到最终的静默实现好友验证请求通过了：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">    public void onUpdate(Object database, String path, String table, ContentValues values, String whereClause, String[] whereArgs, int conflictAlgorithm) &#123;</span><br><span class="line">        if (DBConstants.MicroMsg.Fmessage_Conversation.TABLE_NAME.equals(table)) &#123;</span><br><span class="line"></span><br><span class="line">            Integer isNew = values.getAsInteger(DBConstants.MicroMsg.Fmessage_Conversation.COLUMN_isNew);</span><br><span class="line">            String talker = values.getAsString(DBConstants.MicroMsg.Fmessage_Conversation.COLUMN_talker);</span><br><span class="line">            Log.e(WeixinHook.TAG, &quot;DBEventReceiveFriendsVerify; parseRequestContent;isNew.&quot;+isNew);</span><br><span class="line"></span><br><span class="line">            // isNew == 1:新好友请求</span><br><span class="line">            if (isNew != null &amp;&amp; isNew == 1) &#123;</span><br><span class="line">                try &#123;</span><br><span class="line">                    String fmsgContent = values.getAsString(DBConstants.MicroMsg.Fmessage_Conversation.COLUMN_fmsgContent);</span><br><span class="line">                    Log.e(WeixinHook.TAG, &quot;DBEventReceiveFriendsVerify; parseRequestContent;fmsgContent.&quot;+fmsgContent);</span><br><span class="line"></span><br><span class="line">                    JSONObject jsonObject = new XmlToJson.Builder(fmsgContent).build().toJson();</span><br><span class="line">                    JSONObject appMsg = jsonObject.getJSONObject(&quot;msg&quot;);</span><br><span class="line">                    if (fmsgContent == null) &#123;</span><br><span class="line">                        Log.e(WeixinHook.TAG, &quot;DBEventReceiveFriendsVerify; parseRequestContent; appMsg is null, just return.&quot;);</span><br><span class="line">                        return;</span><br><span class="line">                    &#125;</span><br><span class="line">                    Log.e(WeixinHook.TAG, &quot;DBEventReceiveFriendsVerify; &amp;wxid:=&quot; + appMsg.getString(&quot;fromusername&quot;) + &quot;&amp;ticket:&quot; + appMsg.getString(&quot;ticket&quot;) + &quot;&amp;scene:&quot; + appMsg.getInt(&quot;scene&quot;));</span><br><span class="line">                    int state  = Utils.getFCState(talker);</span><br><span class="line">                    Log.e(WeixinHook.TAG, &quot;DBEventReceiveFriendsVerify; state1:&quot;+state);</span><br><span class="line">                    if(state == 1)&#123;</span><br><span class="line">                        report(appMsg.getString(&quot;fromusername&quot;).toString(),</span><br><span class="line">                                appMsg.getString(&quot;fromnickname&quot;).toString(),</span><br><span class="line">                                appMsg.getString(&quot;content&quot;).toString()</span><br><span class="line">                        );</span><br><span class="line">                    &#125;else&#123;</span><br><span class="line">                        final Object instance_y_as_cn = XposedHelpers.callStaticMethod(</span><br><span class="line">                                XposedHelpers.findClass(&quot;com.tencent.mm.y.as&quot;, mWeixinHook.getClassLoader()),</span><br><span class="line">                                &quot;CN&quot;</span><br><span class="line">                        );</span><br><span class="line"></span><br><span class="line">                        String username = appMsg.getString(&quot;fromusername&quot;).toString();</span><br><span class="line">                        String ticket = appMsg.getString(&quot;ticket&quot;).toString();</span><br><span class="line">                        int scene = appMsg.getInt(&quot;scene&quot;);</span><br><span class="line">                        Class&lt;?&gt; class_model_o = XposedHelpers.findClass(&quot;com.tencent.mm.pluginsdk.model.o&quot;, mWeixinHook.getClassLoader());</span><br><span class="line">                        Object request = XposedHelpers.newInstance(class_model_o, username, ticket, scene);</span><br><span class="line"></span><br><span class="line">                        Object result = XposedHelpers.callMethod(instance_y_as_cn, &quot;a&quot;, request, 0);</span><br><span class="line">                        Log.e(WeixinHook.TAG, &quot;DBEventReceiveFriendsVerify; result; &quot; + result);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; catch (Exception e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>测试一下，搞定。</p>
<h2 id="参考资源"><a href="#参考资源" class="headerlink" title="参考资源"></a>参考资源</h2><p><a href="https://api.xposed.info/reference/packages.html" target="_blank" rel="noopener">https://api.xposed.info/reference/packages.html</a></p>
<p><a href="https://bintray.com/rovo89/de.robv.android.xposed/api" target="_blank" rel="noopener">https://bintray.com/rovo89/de.robv.android.xposed/api</a></p>
<p><a href="http://www.infoq.com/cn/articles/android-in-depth-xposed" target="_blank" rel="noopener">http://www.infoq.com/cn/articles/android-in-depth-xposed</a></p>
<p><a href="https://blog.csdn.net/u012417380/article/details/55254369?locationNum=13&amp;fps=1" target="_blank" rel="noopener">https://blog.csdn.net/u012417380/article/details/55254369?locationNum=13&amp;fps=1</a></p>
<p><a href="https://www.cnblogs.com/gordon0918/p/6732100.html" target="_blank" rel="noopener">https://www.cnblogs.com/gordon0918/p/6732100.html</a></p>

        </div>
        
<blockquote class="post-copyright">
    <div class="content">
        
<span class="post-time">
    最后更新时间：<time datetime="2019-08-09T02:52:13.000Z" itemprop="dateUpdated">2019-08-09 10:52:13</time>
</span><br>


        
        转载注明出处，原文地址：<a href="/2019/07/02/xposed/" target="_blank" rel="external">http://nunu03.github.io/2019/07/02/xposed/</a>
        
    </div>
    <footer>
        <a href="http://nunu03.github.io">
            <img src="/img/avatar.jpg" alt="Nunu Long">
            Nunu Long
        </a>
    </footer>
</blockquote>

        
        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Xposed/">Xposed</a></li></ul>

            <div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://nunu03.github.io/2019/07/02/xposed/&title=《Xposed的配置与简单使用》 — chenyulong&pic=http://nunu03.github.io/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://nunu03.github.io/2019/07/02/xposed/&title=《Xposed的配置与简单使用》 — chenyulong&source=Xposed是什么官方对此的解释是这样的：“Xposed是一个适用于Android的框架。基于这个框架开发的模块可以改变系统和app应用的行为，而不需要修..." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>

        </div>
        
            


        
    </div>
    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="prev">
      <a href="/2019/07/03/tencentfdex/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">腾讯加固脱壳使用事例</h4>
      </a>
    </div>
  

  
    <div class="next">
      <a href="/2019/07/02/permissioncheck/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">MIUI权限检测之路</h4>
      </a>
    </div>
  
</nav>


    
    
        <aside class="post-widget">
            <nav class="post-toc-wrap" id="post-toc">
                <strong>目录</strong>
                <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Xposed是什么"><span class="post-toc-number">1.</span> <span class="post-toc-text">Xposed是什么</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Hook是什么"><span class="post-toc-number">2.</span> <span class="post-toc-text">Hook是什么</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Xposed接入"><span class="post-toc-number">3.</span> <span class="post-toc-text">Xposed接入</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#创建工程"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">创建工程</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#导入api"><span class="post-toc-number">3.2.</span> <span class="post-toc-text">导入api</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#修改AndroidManifest-xml文件"><span class="post-toc-number">3.3.</span> <span class="post-toc-text">修改AndroidManifest.xml文件</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#编写hook类"><span class="post-toc-number">3.4.</span> <span class="post-toc-text">编写hook类</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#创建xposed-init文件"><span class="post-toc-number">3.5.</span> <span class="post-toc-text">创建xposed_init文件</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Hook实现"><span class="post-toc-number">4.</span> <span class="post-toc-text">Hook实现</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#hook变量"><span class="post-toc-number">4.1.</span> <span class="post-toc-text">hook变量</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#hook方法"><span class="post-toc-number">4.2.</span> <span class="post-toc-text">hook方法</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#替换资源"><span class="post-toc-number">4.3.</span> <span class="post-toc-text">替换资源</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#IXposedHookZygoteInit"><span class="post-toc-number">4.3.1.</span> <span class="post-toc-text">IXposedHookZygoteInit</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#IXposedHookInitPackageResources"><span class="post-toc-number">4.3.2.</span> <span class="post-toc-text">IXposedHookInitPackageResources</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#修改布局"><span class="post-toc-number">4.4.</span> <span class="post-toc-text">修改布局</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#群控"><span class="post-toc-number">5.</span> <span class="post-toc-text">群控</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#参考资源"><span class="post-toc-number">6.</span> <span class="post-toc-text">参考资源</span></a></li></ol>
            </nav>
            <div class="toc-bar"><div>
        </aside>
    
</article>


</div>

    </main>
    <footer class="footer ">
    
    <div class="top">
        
            <p>
    <span>Links：</span>
    
    <span class="blogroll-item">
        <a href="https://handsomeliuyang.github.io/" target="_blank">HOME</a>
    </span>
    
    <span class="blogroll-item">
        <a href="https://www.kotlincn.net/docs/reference/map-operations.html" target="_blank">kotlincn</a>
    </span>
    
</p>

        
    </div>
    
    <div class="bottom">
        <p>
            <span>
                Nunu Long &copy; 2019 - 2022
            </span>
        		
           	
            
            
            <span>
	            Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/codefine/hexo-theme-mellow" target="_blank">mellow</a>
            </span>
            
            
            

            
                
<span class="site-uv" title="总访客量">
    <i class="icon icon-user"></i>
    <i class="busuanzi-value" id="busuanzi_value_site_uv"></i>
</span>


<span class="site-pv" title="总访问量">
    <i class="icon icon-eye"></i>
    <i class="busuanzi-value" id="busuanzi_value_site_pv"></i>
</span>

            
        </p>
    </div>
</footer>

    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://nunu03.github.io/2019/07/02/xposed/&title=《Xposed的配置与简单使用》 — chenyulong&pic=http://nunu03.github.io/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://nunu03.github.io/2019/07/02/xposed/&title=《Xposed的配置与简单使用》 — chenyulong&source=Xposed是什么官方对此的解释是这样的：“Xposed是一个适用于Android的框架。基于这个框架开发的模块可以改变系统和app应用的行为，而不需要修..." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAK4AAACuCAAAAACKZ2kyAAABxUlEQVR42u3ay46DMAwF0P7/T3ekWXUxwHUcXEY6WSGa0kMXlh95veL1/l2f1593jvbkz9y8cHFx29z36Tp69PkLnD8nuX/0p+Di4k5y8+CVvEZ/z+F9XFzch3GroCRLwcXF/e/canmTJEC4uLhP5ibFT/LpeeskL5Y21Gq4uLgN7lrDdO/17f1dXFzcTVOJpBWyFnreSwsXF3eGW21qJPQqsVxc4eLiDnLzUiQfjazhCrUaLi7uCDdJU6p7+s2UP1IcXFzcce5autNPbqKWKy4u7s3casrSb3pWy6fDLg4uLu5t3Oqjk9DTCYKt8SouLu5WbrKpyqoexSiERVxc3EHuWlLSqUoWfxEXF3eE22mbdmagedsUFxd3kpuUH9XKKUl3FkcpuLi4I9x8Uyd92XuwAxcX925u57BF3h7NE6OLYIeLizvIzYea1TJmcVx6HshwcXFHuPmqDk7yUmdx5oOLi3sDtxpQOiPVteKqMHzFxcXdyl0LXp2xSh7yLro4uLi4N3PzRme1gbKrdYKLi/tM7houGZYUXh4XF/eR3GQg2mm5XthwcXEHufmYpHNYc0MjBhcXd4Tb+XL1VZPQhouL+1XuD6Z/LuXnGTp/AAAAAElFTkSuQmCC" alt="微信分享二维码">
</div>


    
    <!-- main-js -->
<script type="text/javascript" src="//cdn.bootcss.com/jquery/2.1.0/jquery.min.js"></script>
<script type="text/javascript" src="/js/plugins/fastclick.js?v=1.4.4"></script>
<script type="text/javascript" src="/js/plugins/ios-orientationchange-fix.js?v=1.4.4"></script>
<script type="text/javascript" src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.2/dist/jquery.fancybox.min.js"></script>

<script type="text/javascript" src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>

<script type="text/javascript" src="/js/method.js?v=1.4.4"></script>
<script type="text/javascript" src="/js/blog.js?v=1.4.4"></script>

<!-- third-party -->






<script type="text/javascript" src="/js/plugins/local_search.js?v=1.4.4"></script>
<script type="text/javascript">
	var search_path = "search.xml";
	if (search_path.length === 0) {
		search_path = "search.xml";
	}
	var path = "/" + search_path;
	searchFunc(path, "local-search-input", "local-search-result");
</script>



<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>



    
    





    <!-- mathjax config similar to math.stackexchange -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
            processEscapes: true,
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>







    
</body>
</html>
